/*! For license information please see main.7e160c31.js.LICENSE.txt */
(()=>{var t={4:(t,e,n)=>{"use strict";var i=n(853),s=n(43),r=n(950);function o(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function l(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function c(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function h(t){if(l(t)!==t)throw Error(o(188))}function u(t){var e=t.tag;if(5===e||26===e||27===e||6===e)return t;for(t=t.child;null!==t;){if(null!==(e=u(t)))return e;t=t.sibling}return null}var d=Object.assign,p=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),_=Symbol.for("react.consumer"),w=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),E=Symbol.for("react.lazy");Symbol.for("react.scope");var C=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var T=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var P=Symbol.iterator;function L(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=P&&t[P]||t["@@iterator"])?t:null}var M=Symbol.for("react.client.reference");function I(t){if(null==t)return null;if("function"===typeof t)return t.$$typeof===M?null:t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case m:return"Fragment";case y:return"Profiler";case v:return"StrictMode";case S:return"Suspense";case A:return"SuspenseList";case C:return"Activity"}if("object"===typeof t)switch(t.$$typeof){case g:return"Portal";case w:return(t.displayName||"Context")+".Provider";case _:return(t._context.displayName||"Context")+".Consumer";case x:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case k:return null!==(e=t.displayName||null)?e:I(t.type)||"Memo";case E:e=t._payload,t=t._init;try{return I(t(e))}catch(n){}}return null}var R=Array.isArray,D=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,N={pending:!1,data:null,method:null,action:null},z=[],F=-1;function j(t){return{current:t}}function B(t){0>F||(t.current=z[F],z[F]=null,F--)}function U(t,e){F++,z[F]=t.current,t.current=e}var H=j(null),$=j(null),W=j(null),V=j(null);function G(t,e){switch(U(W,e),U($,t),U(H,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?su(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)t=ru(e=su(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}B(H),U(H,t)}function q(){B(H),B($),B(W)}function Z(t){null!==t.memoizedState&&U(V,t);var e=H.current,n=ru(e,t.type);e!==n&&(U($,t),U(H,n))}function K(t){$.current===t&&(B(H),B($)),V.current===t&&(B(V),Zu._currentValue=N)}var X=Object.prototype.hasOwnProperty,Y=i.unstable_scheduleCallback,J=i.unstable_cancelCallback,Q=i.unstable_shouldYield,tt=i.unstable_requestPaint,et=i.unstable_now,nt=i.unstable_getCurrentPriorityLevel,it=i.unstable_ImmediatePriority,st=i.unstable_UserBlockingPriority,rt=i.unstable_NormalPriority,ot=i.unstable_LowPriority,at=i.unstable_IdlePriority,lt=i.log,ct=i.unstable_setDisableYieldValue,ht=null,ut=null;function dt(t){if("function"===typeof lt&&ct(t),ut&&"function"===typeof ut.setStrictMode)try{ut.setStrictMode(ht,t)}catch(e){}}var pt=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(ft(t)/gt|0)|0},ft=Math.log,gt=Math.LN2;var mt=256,vt=4194304;function yt(t){var e=42&t;if(0!==e)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&t;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&t;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function bt(t,e,n){var i=t.pendingLanes;if(0===i)return 0;var s=0,r=t.suspendedLanes,o=t.pingedLanes;t=t.warmLanes;var a=134217727&i;return 0!==a?0!==(i=a&~r)?s=yt(i):0!==(o&=a)?s=yt(o):n||0!==(n=a&~t)&&(s=yt(n)):0!==(a=i&~r)?s=yt(a):0!==o?s=yt(o):n||0!==(n=i&~t)&&(s=yt(n)),0===s?0:0!==e&&e!==s&&0===(e&r)&&((r=s&-s)>=(n=e&-e)||32===r&&0!==(4194048&n))?e:s}function _t(t,e){return 0===(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)}function wt(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function xt(){var t=mt;return 0===(4194048&(mt<<=1))&&(mt=256),t}function St(){var t=vt;return 0===(62914560&(vt<<=1))&&(vt=4194304),t}function At(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function kt(t,e){t.pendingLanes|=e,268435456!==e&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Et(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var i=31-pt(e);t.entangledLanes|=e,t.entanglements[i]=1073741824|t.entanglements[i]|4194090&n}function Ct(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-pt(n),s=1<<i;s&e|t[i]&e&&(t[i]|=e),n&=~s}}function Tt(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Pt(t){return 2<(t&=-t)?8<t?0!==(134217727&t)?32:268435456:8:2}function Lt(){var t=O.p;return 0!==t?t:void 0===(t=window.event)?32:cd(t.type)}var Mt=Math.random().toString(36).slice(2),It="__reactFiber$"+Mt,Rt="__reactProps$"+Mt,Dt="__reactContainer$"+Mt,Ot="__reactEvents$"+Mt,Nt="__reactListeners$"+Mt,zt="__reactHandles$"+Mt,Ft="__reactResources$"+Mt,jt="__reactMarker$"+Mt;function Bt(t){delete t[It],delete t[Rt],delete t[Ot],delete t[Nt],delete t[zt]}function Ut(t){var e=t[It];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Dt]||n[It]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=bu(t);null!==t;){if(n=t[It])return n;t=bu(t)}return e}n=(t=n).parentNode}return null}function Ht(t){if(t=t[It]||t[Dt]){var e=t.tag;if(5===e||6===e||13===e||26===e||27===e||3===e)return t}return null}function $t(t){var e=t.tag;if(5===e||26===e||27===e||6===e)return t.stateNode;throw Error(o(33))}function Wt(t){var e=t[Ft];return e||(e=t[Ft]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function Vt(t){t[jt]=!0}var Gt=new Set,qt={};function Zt(t,e){Kt(t,e),Kt(t+"Capture",e)}function Kt(t,e){for(qt[t]=e,t=0;t<e.length;t++)Gt.add(e[t])}var Xt,Yt,Jt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qt={},te={};function ee(t,e,n){if(s=e,X.call(te,s)||!X.call(Qt,s)&&(Jt.test(s)?te[s]=!0:(Qt[s]=!0,0)))if(null===n)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":return void t.removeAttribute(e);case"boolean":var i=e.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void t.removeAttribute(e)}t.setAttribute(e,""+n)}var s}function ne(t,e,n){if(null===n)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void t.removeAttribute(e)}t.setAttribute(e,""+n)}}function ie(t,e,n,i){if(null===i)t.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void t.removeAttribute(n)}t.setAttributeNS(e,n,""+i)}}function se(t){if(void 0===Xt)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Xt=e&&e[1]||"",Yt=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Xt+t+Yt}var re=!1;function oe(t,e){if(!t||re)return"";re=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(e){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(s){var i=s}Reflect.construct(t,[],n)}else{try{n.call()}catch(r){i=r}t.call(n.prototype)}}else{try{throw Error()}catch(o){i=o}(n=t())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(a){if(a&&i&&"string"===typeof a.stack)return[a.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=i.DetermineComponentFrameRoot(),o=r[0],a=r[1];if(o&&a){var l=o.split("\n"),c=a.split("\n");for(s=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;if(i===l.length||s===c.length)for(i=l.length-1,s=c.length-1;1<=i&&0<=s&&l[i]!==c[s];)s--;for(;1<=i&&0<=s;i--,s--)if(l[i]!==c[s]){if(1!==i||1!==s)do{if(i--,0>--s||l[i]!==c[s]){var h="\n"+l[i].replace(" at new "," at ");return t.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",t.displayName)),h}}while(1<=i&&0<=s);break}}}finally{re=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?se(n):""}function ae(t){switch(t.tag){case 26:case 27:case 5:return se(t.type);case 16:return se("Lazy");case 13:return se("Suspense");case 19:return se("SuspenseList");case 0:case 15:return oe(t.type,!1);case 11:return oe(t.type.render,!1);case 1:return oe(t.type,!0);case 31:return se("Activity");default:return""}}function le(t){try{var e="";do{e+=ae(t),t=t.return}while(t);return e}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ce(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function he(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function ue(t){t._valueTracker||(t._valueTracker=function(t){var e=he(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,r=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(t){i=""+t,r.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(t){i=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function de(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=he(t)?t.checked?"true":"false":t.value),(t=i)!==n&&(e.setValue(t),!0)}function pe(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}var fe=/[\n"\\]/g;function ge(t){return t.replace(fe,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function me(t,e,n,i,s,r,o,a){t.name="",null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?t.type=o:t.removeAttribute("type"),null!=e?"number"===o?(0===e&&""===t.value||t.value!=e)&&(t.value=""+ce(e)):t.value!==""+ce(e)&&(t.value=""+ce(e)):"submit"!==o&&"reset"!==o||t.removeAttribute("value"),null!=e?ye(t,o,ce(e)):null!=n?ye(t,o,ce(n)):null!=i&&t.removeAttribute("value"),null==s&&null!=r&&(t.defaultChecked=!!r),null!=s&&(t.checked=s&&"function"!==typeof s&&"symbol"!==typeof s),null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?t.name=""+ce(a):t.removeAttribute("name")}function ve(t,e,n,i,s,r,o,a){if(null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&"boolean"!==typeof r&&(t.type=r),null!=e||null!=n){if(!("submit"!==r&&"reset"!==r||void 0!==e&&null!==e))return;n=null!=n?""+ce(n):"",e=null!=e?""+ce(e):n,a||e===t.value||(t.value=e),t.defaultValue=e}i="function"!==typeof(i=null!=i?i:s)&&"symbol"!==typeof i&&!!i,t.checked=a?t.checked:!!i,t.defaultChecked=!!i,null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(t.name=o)}function ye(t,e,n){"number"===e&&pe(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function be(t,e,n,i){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ce(n),e=null,s=0;s<t.length;s++){if(t[s].value===n)return t[s].selected=!0,void(i&&(t[s].defaultSelected=!0));null!==e||t[s].disabled||(e=t[s])}null!==e&&(e.selected=!0)}}function _e(t,e,n){null==e||((e=""+ce(e))!==t.value&&(t.value=e),null!=n)?t.defaultValue=null!=n?""+ce(n):"":t.defaultValue!==e&&(t.defaultValue=e)}function we(t,e,n,i){if(null==e){if(null!=i){if(null!=n)throw Error(o(92));if(R(i)){if(1<i.length)throw Error(o(93));i=i[0]}n=i}null==n&&(n=""),e=n}n=ce(e),t.defaultValue=n,(i=t.textContent)===n&&""!==i&&null!==i&&(t.value=i)}function xe(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var Se=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ae(t,e,n){var i=0===e.indexOf("--");null==n||"boolean"===typeof n||""===n?i?t.setProperty(e,""):"float"===e?t.cssFloat="":t[e]="":i?t.setProperty(e,n):"number"!==typeof n||0===n||Se.has(e)?"float"===e?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function ke(t,e,n){if(null!=e&&"object"!==typeof e)throw Error(o(62));if(t=t.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=e&&e.hasOwnProperty(i)||(0===i.indexOf("--")?t.setProperty(i,""):"float"===i?t.cssFloat="":t[i]="");for(var s in e)i=e[s],e.hasOwnProperty(s)&&n[s]!==i&&Ae(t,s,i)}else for(var r in e)e.hasOwnProperty(r)&&Ae(t,r,e[r])}function Ee(t){if(-1===t.indexOf("-"))return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ce=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Te=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Pe(t){return Te.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var Le=null;function Me(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Ie=null,Re=null;function De(t){var e=Ht(t);if(e&&(t=e.stateNode)){var n=t[Rt]||null;t:switch(t=e.stateNode,e.type){case"input":if(me(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+ge(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var s=i[Rt]||null;if(!s)throw Error(o(90));me(i,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name)}}for(e=0;e<n.length;e++)(i=n[e]).form===t.form&&de(i)}break t;case"textarea":_e(t,n.value,n.defaultValue);break t;case"select":null!=(e=n.value)&&be(t,!!n.multiple,e,!1)}}}var Oe=!1;function Ne(t,e,n){if(Oe)return t(e,n);Oe=!0;try{return t(e)}finally{if(Oe=!1,(null!==Ie||null!==Re)&&(Uc(),Ie&&(e=Ie,t=Re,Re=Ie=null,De(e),t)))for(e=0;e<t.length;e++)De(t[e])}}function ze(t,e){var n=t.stateNode;if(null===n)return null;var i=n[Rt]||null;if(null===i)return null;n=i[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!i;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(o(231,e,typeof n));return n}var Fe=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),je=!1;if(Fe)try{var Be={};Object.defineProperty(Be,"passive",{get:function(){je=!0}}),window.addEventListener("test",Be,Be),window.removeEventListener("test",Be,Be)}catch(Rd){je=!1}var Ue=null,He=null,$e=null;function We(){if($e)return $e;var t,e,n=He,i=n.length,s="value"in Ue?Ue.value:Ue.textContent,r=s.length;for(t=0;t<i&&n[t]===s[t];t++);var o=i-t;for(e=1;e<=o&&n[i-e]===s[r-e];e++);return $e=s.slice(t,1<e?1-e:void 0)}function Ve(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function Ge(){return!0}function qe(){return!1}function Ze(t){function e(e,n,i,s,r){for(var o in this._reactName=e,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=r,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(s):s[o]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?Ge:qe,this.isPropagationStopped=qe,this}return d(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=Ge)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=Ge)},persist:function(){},isPersistent:Ge}),e}var Ke,Xe,Ye,Je={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qe=Ze(Je),tn=d({},Je,{view:0,detail:0}),en=Ze(tn),nn=d({},tn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ye&&(Ye&&"mousemove"===t.type?(Ke=t.screenX-Ye.screenX,Xe=t.screenY-Ye.screenY):Xe=Ke=0,Ye=t),Ke)},movementY:function(t){return"movementY"in t?t.movementY:Xe}}),sn=Ze(nn),rn=Ze(d({},nn,{dataTransfer:0})),on=Ze(d({},tn,{relatedTarget:0})),an=Ze(d({},Je,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=Ze(d({},Je,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}})),cn=Ze(d({},Je,{data:0})),hn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},un={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pn(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=dn[t])&&!!e[t]}function fn(){return pn}var gn=Ze(d({},tn,{key:function(t){if(t.key){var e=hn[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=Ve(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?un[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fn,charCode:function(t){return"keypress"===t.type?Ve(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?Ve(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}})),mn=Ze(d({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),vn=Ze(d({},tn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fn})),yn=Ze(d({},Je,{propertyName:0,elapsedTime:0,pseudoElement:0})),bn=Ze(d({},nn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0})),_n=Ze(d({},Je,{newState:0,oldState:0})),wn=[9,13,27,32],xn=Fe&&"CompositionEvent"in window,Sn=null;Fe&&"documentMode"in document&&(Sn=document.documentMode);var An=Fe&&"TextEvent"in window&&!Sn,kn=Fe&&(!xn||Sn&&8<Sn&&11>=Sn),En=String.fromCharCode(32),Cn=!1;function Tn(t,e){switch(t){case"keyup":return-1!==wn.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pn(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var Ln=!1;var Mn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function In(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Mn[t.type]:"textarea"===e}function Rn(t,e,n,i){Ie?Re?Re.push(i):Re=[i]:Ie=i,0<(e=Wh(e,"onChange")).length&&(n=new Qe("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Dn=null,On=null;function Nn(t){Nh(t,0)}function zn(t){if(de($t(t)))return t}function Fn(t,e){if("change"===t)return e}var jn=!1;if(Fe){var Bn;if(Fe){var Un="oninput"in document;if(!Un){var Hn=document.createElement("div");Hn.setAttribute("oninput","return;"),Un="function"===typeof Hn.oninput}Bn=Un}else Bn=!1;jn=Bn&&(!document.documentMode||9<document.documentMode)}function $n(){Dn&&(Dn.detachEvent("onpropertychange",Wn),On=Dn=null)}function Wn(t){if("value"===t.propertyName&&zn(On)){var e=[];Rn(e,On,t,Me(t)),Ne(Nn,e)}}function Vn(t,e,n){"focusin"===t?($n(),On=n,(Dn=e).attachEvent("onpropertychange",Wn)):"focusout"===t&&$n()}function Gn(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return zn(On)}function qn(t,e){if("click"===t)return zn(e)}function Zn(t,e){if("input"===t||"change"===t)return zn(e)}var Kn="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function Xn(t,e){if(Kn(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!X.call(e,s)||!Kn(t[s],e[s]))return!1}return!0}function Yn(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Jn(t,e){var n,i=Yn(t);for(t=0;i;){if(3===i.nodeType){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=Yn(i)}}function Qn(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?Qn(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function ti(t){for(var e=pe((t=null!=t&&null!=t.ownerDocument&&null!=t.ownerDocument.defaultView?t.ownerDocument.defaultView:window).document);e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(i){n=!1}if(!n)break;e=pe((t=e.contentWindow).document)}return e}function ei(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}var ni=Fe&&"documentMode"in document&&11>=document.documentMode,ii=null,si=null,ri=null,oi=!1;function ai(t,e,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;oi||null==ii||ii!==pe(i)||("selectionStart"in(i=ii)&&ei(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},ri&&Xn(ri,i)||(ri=i,0<(i=Wh(si,"onSelect")).length&&(e=new Qe("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=ii)))}function li(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ci={animationend:li("Animation","AnimationEnd"),animationiteration:li("Animation","AnimationIteration"),animationstart:li("Animation","AnimationStart"),transitionrun:li("Transition","TransitionRun"),transitionstart:li("Transition","TransitionStart"),transitioncancel:li("Transition","TransitionCancel"),transitionend:li("Transition","TransitionEnd")},hi={},ui={};function di(t){if(hi[t])return hi[t];if(!ci[t])return t;var e,n=ci[t];for(e in n)if(n.hasOwnProperty(e)&&e in ui)return hi[t]=n[e];return t}Fe&&(ui=document.createElement("div").style,"AnimationEvent"in window||(delete ci.animationend.animation,delete ci.animationiteration.animation,delete ci.animationstart.animation),"TransitionEvent"in window||delete ci.transitionend.transition);var pi=di("animationend"),fi=di("animationiteration"),gi=di("animationstart"),mi=di("transitionrun"),vi=di("transitionstart"),yi=di("transitioncancel"),bi=di("transitionend"),_i=new Map,wi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xi(t,e){_i.set(t,e),Zt(e,[t])}wi.push("scrollEnd");var Si=new WeakMap;function Ai(t,e){if("object"===typeof t&&null!==t){var n=Si.get(t);return void 0!==n?n:(e={value:t,source:e,stack:le(e)},Si.set(t,e),e)}return{value:t,source:e,stack:le(e)}}var ki=[],Ei=0,Ci=0;function Ti(){for(var t=Ei,e=Ci=Ei=0;e<t;){var n=ki[e];ki[e++]=null;var i=ki[e];ki[e++]=null;var s=ki[e];ki[e++]=null;var r=ki[e];if(ki[e++]=null,null!==i&&null!==s){var o=i.pending;null===o?s.next=s:(s.next=o.next,o.next=s),i.pending=s}0!==r&&Ii(n,s,r)}}function Pi(t,e,n,i){ki[Ei++]=t,ki[Ei++]=e,ki[Ei++]=n,ki[Ei++]=i,Ci|=i,t.lanes|=i,null!==(t=t.alternate)&&(t.lanes|=i)}function Li(t,e,n,i){return Pi(t,e,n,i),Ri(t)}function Mi(t,e){return Pi(t,null,null,e),Ri(t)}function Ii(t,e,n){t.lanes|=n;var i=t.alternate;null!==i&&(i.lanes|=n);for(var s=!1,r=t.return;null!==r;)r.childLanes|=n,null!==(i=r.alternate)&&(i.childLanes|=n),22===r.tag&&(null===(t=r.stateNode)||1&t._visibility||(s=!0)),t=r,r=r.return;return 3===t.tag?(r=t.stateNode,s&&null!==e&&(s=31-pt(n),null===(i=(t=r.hiddenUpdates)[s])?t[s]=[e]:i.push(e),e.lane=536870912|n),r):null}function Ri(t){if(50<Ic)throw Ic=0,Rc=null,Error(o(185));for(var e=t.return;null!==e;)e=(t=e).return;return 3===t.tag?t.stateNode:null}var Di={};function Oi(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ni(t,e,n,i){return new Oi(t,e,n,i)}function zi(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Fi(t,e){var n=t.alternate;return null===n?((n=Ni(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function ji(t,e){t.flags&=65011714;var n=t.alternate;return null===n?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function Bi(t,e,n,i,s,r){var a=0;if(i=t,"function"===typeof t)zi(t)&&(a=1);else if("string"===typeof t)a=function(t,e,n){if(1===n||null!=e.itemProp)return!1;switch(t){case"meta":case"title":return!0;case"style":if("string"!==typeof e.precedence||"string"!==typeof e.href||""===e.href)break;return!0;case"link":if("string"!==typeof e.rel||"string"!==typeof e.href||""===e.href||e.onLoad||e.onError)break;return"stylesheet"!==e.rel||(t=e.disabled,"string"===typeof e.precedence&&null==t);case"script":if(e.async&&"function"!==typeof e.async&&"symbol"!==typeof e.async&&!e.onLoad&&!e.onError&&e.src&&"string"===typeof e.src)return!0}return!1}(t,n,H.current)?26:"html"===t||"head"===t||"body"===t?27:5;else t:switch(t){case C:return(t=Ni(31,n,e,s)).elementType=C,t.lanes=r,t;case m:return Ui(n.children,s,r,e);case v:a=8,s|=24;break;case y:return(t=Ni(12,n,e,2|s)).elementType=y,t.lanes=r,t;case S:return(t=Ni(13,n,e,s)).elementType=S,t.lanes=r,t;case A:return(t=Ni(19,n,e,s)).elementType=A,t.lanes=r,t;default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case b:case w:a=10;break t;case _:a=9;break t;case x:a=11;break t;case k:a=14;break t;case E:a=16,i=null;break t}a=29,n=Error(o(130,null===t?"null":typeof t,"")),i=null}return(e=Ni(a,n,e,s)).elementType=t,e.type=i,e.lanes=r,e}function Ui(t,e,n,i){return(t=Ni(7,t,i,e)).lanes=n,t}function Hi(t,e,n){return(t=Ni(6,t,null,e)).lanes=n,t}function $i(t,e,n){return(e=Ni(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var Wi=[],Vi=0,Gi=null,qi=0,Zi=[],Ki=0,Xi=null,Yi=1,Ji="";function Qi(t,e){Wi[Vi++]=qi,Wi[Vi++]=Gi,Gi=t,qi=e}function ts(t,e,n){Zi[Ki++]=Yi,Zi[Ki++]=Ji,Zi[Ki++]=Xi,Xi=t;var i=Yi;t=Ji;var s=32-pt(i)-1;i&=~(1<<s),n+=1;var r=32-pt(e)+s;if(30<r){var o=s-s%5;r=(i&(1<<o)-1).toString(32),i>>=o,s-=o,Yi=1<<32-pt(e)+s|n<<s|i,Ji=r+t}else Yi=1<<r|n<<s|i,Ji=t}function es(t){null!==t.return&&(Qi(t,1),ts(t,1,0))}function ns(t){for(;t===Gi;)Gi=Wi[--Vi],Wi[Vi]=null,qi=Wi[--Vi],Wi[Vi]=null;for(;t===Xi;)Xi=Zi[--Ki],Zi[Ki]=null,Ji=Zi[--Ki],Zi[Ki]=null,Yi=Zi[--Ki],Zi[Ki]=null}var is=null,ss=null,rs=!1,os=null,as=!1,ls=Error(o(519));function cs(t){throw gs(Ai(Error(o(418,"")),t)),ls}function hs(t){var e=t.stateNode,n=t.type,i=t.memoizedProps;switch(e[It]=t,e[Rt]=i,n){case"dialog":zh("cancel",e),zh("close",e);break;case"iframe":case"object":case"embed":zh("load",e);break;case"video":case"audio":for(n=0;n<Dh.length;n++)zh(Dh[n],e);break;case"source":zh("error",e);break;case"img":case"image":case"link":zh("error",e),zh("load",e);break;case"details":zh("toggle",e);break;case"input":zh("invalid",e),ve(e,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),ue(e);break;case"select":zh("invalid",e);break;case"textarea":zh("invalid",e),we(e,i.value,i.defaultValue,i.children),ue(e)}"string"!==typeof(n=i.children)&&"number"!==typeof n&&"bigint"!==typeof n||e.textContent===""+n||!0===i.suppressHydrationWarning||Xh(e.textContent,n)?(null!=i.popover&&(zh("beforetoggle",e),zh("toggle",e)),null!=i.onScroll&&zh("scroll",e),null!=i.onScrollEnd&&zh("scrollend",e),null!=i.onClick&&(e.onclick=Yh),e=!0):e=!1,e||cs(t)}function us(t){for(is=t.return;is;)switch(is.tag){case 5:case 13:return void(as=!1);case 27:case 3:return void(as=!0);default:is=is.return}}function ds(t){if(t!==is)return!1;if(!rs)return us(t),rs=!0,!1;var e,n=t.tag;if((e=3!==n&&27!==n)&&((e=5===n)&&(e=!("form"!==(e=t.type)&&"button"!==e)||ou(t.type,t.memoizedProps)),e=!e),e&&ss&&cs(t),us(t),13===n){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(o(317));t:{for(t=t.nextSibling,n=0;t;){if(8===t.nodeType)if("/$"===(e=t.data)){if(0===n){ss=vu(t.nextSibling);break t}n--}else"$"!==e&&"$!"!==e&&"$?"!==e||n++;t=t.nextSibling}ss=null}}else 27===n?(n=ss,pu(t.type)?(t=yu,yu=null,ss=t):ss=n):ss=is?vu(t.stateNode.nextSibling):null;return!0}function ps(){ss=is=null,rs=!1}function fs(){var t=os;return null!==t&&(null===bc?bc=t:bc.push.apply(bc,t),os=null),t}function gs(t){null===os?os=[t]:os.push(t)}var ms=j(null),vs=null,ys=null;function bs(t,e,n){U(ms,e._currentValue),e._currentValue=n}function _s(t){t._currentValue=ms.current,B(ms)}function ws(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function xs(t,e,n,i){var s=t.child;for(null!==s&&(s.return=t);null!==s;){var r=s.dependencies;if(null!==r){var a=s.child;r=r.firstContext;t:for(;null!==r;){var l=r;r=s;for(var c=0;c<e.length;c++)if(l.context===e[c]){r.lanes|=n,null!==(l=r.alternate)&&(l.lanes|=n),ws(r.return,n,t),i||(a=null);break t}r=l.next}}else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(r=a.alternate)&&(r.lanes|=n),ws(a,n,t),a=null}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}}function Ss(t,e,n,i){t=null;for(var s=e,r=!1;null!==s;){if(!r)if(0!==(524288&s.flags))r=!0;else if(0!==(262144&s.flags))break;if(10===s.tag){var a=s.alternate;if(null===a)throw Error(o(387));if(null!==(a=a.memoizedProps)){var l=s.type;Kn(s.pendingProps.value,a.value)||(null!==t?t.push(l):t=[l])}}else if(s===V.current){if(null===(a=s.alternate))throw Error(o(387));a.memoizedState.memoizedState!==s.memoizedState.memoizedState&&(null!==t?t.push(Zu):t=[Zu])}s=s.return}null!==t&&xs(e,t,n,i),e.flags|=262144}function As(t){for(t=t.firstContext;null!==t;){if(!Kn(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function ks(t){vs=t,ys=null,null!==(t=t.dependencies)&&(t.firstContext=null)}function Es(t){return Ts(vs,t)}function Cs(t,e){return null===vs&&ks(t),Ts(t,e)}function Ts(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},null===ys){if(null===t)throw Error(o(308));ys=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else ys=ys.next=e;return n}var Ps="undefined"!==typeof AbortController?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(e,n){t.push(n)}};this.abort=function(){e.aborted=!0,t.forEach(function(t){return t()})}},Ls=i.unstable_scheduleCallback,Ms=i.unstable_NormalPriority,Is={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Rs(){return{controller:new Ps,data:new Map,refCount:0}}function Ds(t){t.refCount--,0===t.refCount&&Ls(Ms,function(){t.controller.abort()})}var Os=null,Ns=0,zs=0,Fs=null;function js(){if(0===--Ns&&null!==Os){null!==Fs&&(Fs.status="fulfilled");var t=Os;Os=null,zs=0,Fs=null;for(var e=0;e<t.length;e++)(0,t[e])()}}var Bs=D.S;D.S=function(t,e){"object"===typeof e&&null!==e&&"function"===typeof e.then&&function(t,e){if(null===Os){var n=Os=[];Ns=0,zs=Ph(),Fs={status:"pending",value:void 0,then:function(t){n.push(t)}}}Ns++,e.then(js,js)}(0,e),null!==Bs&&Bs(t,e)};var Us=j(null);function Hs(){var t=Us.current;return null!==t?t:ic.pooledCache}function $s(t,e){U(Us,null===e?Us.current:e.pool)}function Ws(){var t=Hs();return null===t?null:{parent:Is._currentValue,pool:t}}var Vs=Error(o(460)),Gs=Error(o(474)),qs=Error(o(542)),Zs={then:function(){}};function Ks(t){return"fulfilled"===(t=t.status)||"rejected"===t}function Xs(){}function Ys(t,e,n){switch(void 0===(n=t[n])?t.push(e):n!==e&&(e.then(Xs,Xs),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw tr(t=e.reason),t;default:if("string"===typeof e.status)e.then(Xs,Xs);else{if(null!==(t=ic)&&100<t.shellSuspendCounter)throw Error(o(482));(t=e).status="pending",t.then(function(t){if("pending"===e.status){var n=e;n.status="fulfilled",n.value=t}},function(t){if("pending"===e.status){var n=e;n.status="rejected",n.reason=t}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw tr(t=e.reason),t}throw Js=e,Vs}}var Js=null;function Qs(){if(null===Js)throw Error(o(459));var t=Js;return Js=null,t}function tr(t){if(t===Vs||t===qs)throw Error(o(483))}var er=!1;function nr(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ir(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function sr(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function rr(t,e,n){var i=t.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&nc)){var s=i.pending;return null===s?e.next=e:(e.next=s.next,s.next=e),i.pending=e,e=Ri(t),Ii(t,null,n),e}return Pi(t,i,e,n),Ri(t)}function or(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194048&n))){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,Ct(t,n)}}function ar(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var s=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===r?s=r=o:r=r.next=o,n=n.next}while(null!==n);null===r?s=r=e:r=r.next=e}else s=r=e;return n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,callbacks:i.callbacks},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var lr=!1;function cr(){if(lr){if(null!==Fs)throw Fs}}function hr(t,e,n,i){lr=!1;var s=t.updateQueue;er=!1;var r=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(null!==a){s.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?r=c:o.next=c,o=l;var h=t.alternate;null!==h&&((a=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===a?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(null!==r){var u=s.baseState;for(o=0,h=c=l=null,a=r;;){var p=-536870913&a.lane,f=p!==a.lane;if(f?(rc&p)===p:(i&p)===p){0!==p&&p===zs&&(lr=!0),null!==h&&(h=h.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});t:{var g=t,m=a;p=e;var v=n;switch(m.tag){case 1:if("function"===typeof(g=m.payload)){u=g.call(v,u,p);break t}u=g;break t;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(p="function"===typeof(g=m.payload)?g.call(v,u,p):g)||void 0===p)break t;u=d({},u,p);break t;case 2:er=!0}}null!==(p=a.callback)&&(t.flags|=64,f&&(t.flags|=8192),null===(f=s.callbacks)?s.callbacks=[p]:f.push(p))}else f={lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===h?(c=h=f,l=u):h=h.next=f,o|=p;if(null===(a=a.next)){if(null===(a=s.shared.pending))break;a=(f=a).next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}null===h&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=h,null===r&&(s.shared.lanes=0),pc|=o,t.lanes=o,t.memoizedState=u}}function ur(t,e){if("function"!==typeof t)throw Error(o(191,t));t.call(e)}function dr(t,e){var n=t.callbacks;if(null!==n)for(t.callbacks=null,t=0;t<n.length;t++)ur(n[t],e)}var pr=j(null),fr=j(0);function gr(t,e){U(fr,t=uc),U(pr,e),uc=t|e.baseLanes}function mr(){U(fr,uc),U(pr,pr.current)}function vr(){uc=fr.current,B(pr),B(fr)}var yr=0,br=null,_r=null,wr=null,xr=!1,Sr=!1,Ar=!1,kr=0,Er=0,Cr=null,Tr=0;function Pr(){throw Error(o(321))}function Lr(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Kn(t[n],e[n]))return!1;return!0}function Mr(t,e,n,i,s,r){return yr=r,br=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,D.H=null===t||null===t.memoizedState?Go:qo,Ar=!1,r=n(i,s),Ar=!1,Sr&&(r=Rr(e,n,i,s)),Ir(t),r}function Ir(t){D.H=Vo;var e=null!==_r&&null!==_r.next;if(yr=0,wr=_r=br=null,xr=!1,Er=0,Cr=null,e)throw Error(o(300));null===t||Ca||null!==(t=t.dependencies)&&As(t)&&(Ca=!0)}function Rr(t,e,n,i){br=t;var s=0;do{if(Sr&&(Cr=null),Er=0,Sr=!1,25<=s)throw Error(o(301));if(s+=1,wr=_r=null,null!=t.updateQueue){var r=t.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,null!=r.memoCache&&(r.memoCache.index=0)}D.H=Zo,r=e(n,i)}while(Sr);return r}function Dr(){var t=D.H,e=t.useState()[0];return e="function"===typeof e.then?Br(e):e,t=t.useState()[0],(null!==_r?_r.memoizedState:null)!==t&&(br.flags|=1024),e}function Or(){var t=0!==kr;return kr=0,t}function Nr(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function zr(t){if(xr){for(t=t.memoizedState;null!==t;){var e=t.queue;null!==e&&(e.pending=null),t=t.next}xr=!1}yr=0,wr=_r=br=null,Sr=!1,Er=kr=0,Cr=null}function Fr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wr?br.memoizedState=wr=t:wr=wr.next=t,wr}function jr(){if(null===_r){var t=br.alternate;t=null!==t?t.memoizedState:null}else t=_r.next;var e=null===wr?br.memoizedState:wr.next;if(null!==e)wr=e,_r=t;else{if(null===t){if(null===br.alternate)throw Error(o(467));throw Error(o(310))}t={memoizedState:(_r=t).memoizedState,baseState:_r.baseState,baseQueue:_r.baseQueue,queue:_r.queue,next:null},null===wr?br.memoizedState=wr=t:wr=wr.next=t}return wr}function Br(t){var e=Er;return Er+=1,null===Cr&&(Cr=[]),t=Ys(Cr,t,e),e=br,null===(null===wr?e.memoizedState:wr.next)&&(e=e.alternate,D.H=null===e||null===e.memoizedState?Go:qo),t}function Ur(t){if(null!==t&&"object"===typeof t){if("function"===typeof t.then)return Br(t);if(t.$$typeof===w)return Es(t)}throw Error(o(438,String(t)))}function Hr(t){var e=null,n=br.updateQueue;if(null!==n&&(e=n.memoCache),null==e){var i=br.alternate;null!==i&&(null!==(i=i.updateQueue)&&(null!=(i=i.memoCache)&&(e={data:i.data.map(function(t){return t.slice()}),index:0})))}if(null==e&&(e={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},br.updateQueue=n),n.memoCache=e,void 0===(n=e.data[e.index]))for(n=e.data[e.index]=Array(t),i=0;i<t;i++)n[i]=T;return e.index++,n}function $r(t,e){return"function"===typeof e?e(t):e}function Wr(t){return Vr(jr(),_r,t)}function Vr(t,e,n){var i=t.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=n;var s=t.baseQueue,r=i.pending;if(null!==r){if(null!==s){var a=s.next;s.next=r.next,r.next=a}e.baseQueue=s=r,i.pending=null}if(r=t.baseState,null===s)t.memoizedState=r;else{var l=a=null,c=null,h=e=s.next,u=!1;do{var d=-536870913&h.lane;if(d!==h.lane?(rc&d)===d:(yr&d)===d){var p=h.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),d===zs&&(u=!0);else{if((yr&p)===p){h=h.next,p===zs&&(u=!0);continue}d={lane:0,revertLane:h.revertLane,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},null===c?(l=c=d,a=r):c=c.next=d,br.lanes|=p,pc|=p}d=h.action,Ar&&n(r,d),r=h.hasEagerState?h.eagerState:n(r,d)}else p={lane:d,revertLane:h.revertLane,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},null===c?(l=c=p,a=r):c=c.next=p,br.lanes|=d,pc|=d;h=h.next}while(null!==h&&h!==e);if(null===c?a=r:c.next=l,!Kn(r,t.memoizedState)&&(Ca=!0,u&&null!==(n=Fs)))throw n;t.memoizedState=r,t.baseState=a,t.baseQueue=c,i.lastRenderedState=r}return null===s&&(i.lanes=0),[t.memoizedState,i.dispatch]}function Gr(t){var e=jr(),n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=t;var i=n.dispatch,s=n.pending,r=e.memoizedState;if(null!==s){n.pending=null;var a=s=s.next;do{r=t(r,a.action),a=a.next}while(a!==s);Kn(r,e.memoizedState)||(Ca=!0),e.memoizedState=r,null===e.baseQueue&&(e.baseState=r),n.lastRenderedState=r}return[r,i]}function qr(t,e,n){var i=br,s=jr(),r=rs;if(r){if(void 0===n)throw Error(o(407));n=n()}else n=e();var a=!Kn((_r||s).memoizedState,n);if(a&&(s.memoizedState=n,Ca=!0),s=s.queue,vo(2048,8,Xr.bind(null,i,s,t),[t]),s.getSnapshot!==e||a||null!==wr&&1&wr.memoizedState.tag){if(i.flags|=2048,fo(9,{destroy:void 0,resource:void 0},Kr.bind(null,i,s,n,e),null),null===ic)throw Error(o(349));r||0!==(124&yr)||Zr(i,e,n)}return n}function Zr(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=br.updateQueue)?(e={lastEffect:null,events:null,stores:null,memoCache:null},br.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Kr(t,e,n,i){e.value=n,e.getSnapshot=i,Yr(e)&&Jr(t)}function Xr(t,e,n){return n(function(){Yr(e)&&Jr(t)})}function Yr(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Kn(t,n)}catch(i){return!0}}function Jr(t){var e=Mi(t,2);null!==e&&Nc(e,t,2)}function Qr(t){var e=Fr();if("function"===typeof t){var n=t;if(t=n(),Ar){dt(!0);try{n()}finally{dt(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$r,lastRenderedState:t},e}function to(t,e,n,i){return t.baseState=n,Vr(t,_r,"function"===typeof i?i:$r)}function eo(t,e,n,i,s){if(Ho(t))throw Error(o(485));if(null!==(t=e.action)){var r={payload:s,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(t){r.listeners.push(t)}};null!==D.T?n(!0):r.isTransition=!1,i(r),null===(n=e.pending)?(r.next=e.pending=r,no(e,r)):(r.next=n.next,e.pending=n.next=r)}}function no(t,e){var n=e.action,i=e.payload,s=t.state;if(e.isTransition){var r=D.T,o={};D.T=o;try{var a=n(s,i),l=D.S;null!==l&&l(o,a),io(t,e,a)}catch(c){ro(t,e,c)}finally{D.T=r}}else try{io(t,e,r=n(s,i))}catch(h){ro(t,e,h)}}function io(t,e,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){so(t,e,n)},function(n){return ro(t,e,n)}):so(t,e,n)}function so(t,e,n){e.status="fulfilled",e.value=n,oo(e),t.state=n,null!==(e=t.pending)&&((n=e.next)===e?t.pending=null:(n=n.next,e.next=n,no(t,n)))}function ro(t,e,n){var i=t.pending;if(t.pending=null,null!==i){i=i.next;do{e.status="rejected",e.reason=n,oo(e),e=e.next}while(e!==i)}t.action=null}function oo(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function ao(t,e){return e}function lo(t,e){if(rs){var n=ic.formState;if(null!==n){t:{var i=br;if(rs){if(ss){e:{for(var s=ss,r=as;8!==s.nodeType;){if(!r){s=null;break e}if(null===(s=vu(s.nextSibling))){s=null;break e}}s="F!"===(r=s.data)||"F"===r?s:null}if(s){ss=vu(s.nextSibling),i="F!"===s.data;break t}}cs(i)}i=!1}i&&(e=n[0])}}return(n=Fr()).memoizedState=n.baseState=e,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:e},n.queue=i,n=jo.bind(null,br,i),i.dispatch=n,i=Qr(!1),r=Uo.bind(null,br,!1,i.queue),s={state:e,dispatch:null,action:t,pending:null},(i=Fr()).queue=s,n=eo.bind(null,br,s,r,n),s.dispatch=n,i.memoizedState=t,[e,n,!1]}function co(t){return ho(jr(),_r,t)}function ho(t,e,n){if(e=Vr(t,e,ao)[0],t=Wr($r)[0],"object"===typeof e&&null!==e&&"function"===typeof e.then)try{var i=Br(e)}catch(o){if(o===Vs)throw qs;throw o}else i=e;var s=(e=jr()).queue,r=s.dispatch;return n!==e.memoizedState&&(br.flags|=2048,fo(9,{destroy:void 0,resource:void 0},uo.bind(null,s,n),null)),[i,r,t]}function uo(t,e){t.action=e}function po(t){var e=jr(),n=_r;if(null!==n)return ho(e,n,t);jr(),e=e.memoizedState;var i=(n=jr()).queue.dispatch;return n.memoizedState=t,[e,i,!1]}function fo(t,e,n,i){return t={tag:t,create:n,deps:i,inst:e,next:null},null===(e=br.updateQueue)&&(e={lastEffect:null,events:null,stores:null,memoCache:null},br.updateQueue=e),null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function go(){return jr().memoizedState}function mo(t,e,n,i){var s=Fr();i=void 0===i?null:i,br.flags|=t,s.memoizedState=fo(1|e,{destroy:void 0,resource:void 0},n,i)}function vo(t,e,n,i){var s=jr();i=void 0===i?null:i;var r=s.memoizedState.inst;null!==_r&&null!==i&&Lr(i,_r.memoizedState.deps)?s.memoizedState=fo(e,r,n,i):(br.flags|=t,s.memoizedState=fo(1|e,r,n,i))}function yo(t,e){mo(8390656,8,t,e)}function bo(t,e){vo(2048,8,t,e)}function _o(t,e){return vo(4,2,t,e)}function wo(t,e){return vo(4,4,t,e)}function xo(t,e){if("function"===typeof e){t=t();var n=e(t);return function(){"function"===typeof n?n():e(null)}}if(null!==e&&void 0!==e)return t=t(),e.current=t,function(){e.current=null}}function So(t,e,n){n=null!==n&&void 0!==n?n.concat([t]):null,vo(4,4,xo.bind(null,e,t),n)}function Ao(){}function ko(t,e){var n=jr();e=void 0===e?null:e;var i=n.memoizedState;return null!==e&&Lr(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Eo(t,e){var n=jr();e=void 0===e?null:e;var i=n.memoizedState;if(null!==e&&Lr(e,i[1]))return i[0];if(i=t(),Ar){dt(!0);try{t()}finally{dt(!1)}}return n.memoizedState=[i,e],i}function Co(t,e,n){return void 0===n||0!==(1073741824&yr)?t.memoizedState=e:(t.memoizedState=n,t=Oc(),br.lanes|=t,pc|=t,n)}function To(t,e,n,i){return Kn(n,e)?n:null!==pr.current?(t=Co(t,n,i),Kn(t,e)||(Ca=!0),t):0===(42&yr)?(Ca=!0,t.memoizedState=n):(t=Oc(),br.lanes|=t,pc|=t,e)}function Po(t,e,n,i,s){var r=O.p;O.p=0!==r&&8>r?r:8;var o=D.T,a={};D.T=a,Uo(t,!1,e,n);try{var l=s(),c=D.S;if(null!==c&&c(a,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)Bo(t,e,function(t,e){var n=[],i={status:"pending",value:null,reason:null,then:function(t){n.push(t)}};return t.then(function(){i.status="fulfilled",i.value=e;for(var t=0;t<n.length;t++)(0,n[t])(e)},function(t){for(i.status="rejected",i.reason=t,t=0;t<n.length;t++)(0,n[t])(void 0)}),i}(l,i),Dc());else Bo(t,e,i,Dc())}catch(h){Bo(t,e,{then:function(){},status:"rejected",reason:h},Dc())}finally{O.p=r,D.T=o}}function Lo(){}function Mo(t,e,n,i){if(5!==t.tag)throw Error(o(476));var s=Io(t).queue;Po(t,s,e,N,null===n?Lo:function(){return Ro(t),n(i)})}function Io(t){var e=t.memoizedState;if(null!==e)return e;var n={};return(e={memoizedState:N,baseState:N,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$r,lastRenderedState:N},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$r,lastRenderedState:n},next:null},t.memoizedState=e,null!==(t=t.alternate)&&(t.memoizedState=e),e}function Ro(t){Bo(t,Io(t).next.queue,{},Dc())}function Do(){return Es(Zu)}function Oo(){return jr().memoizedState}function No(){return jr().memoizedState}function zo(t){for(var e=t.return;null!==e;){switch(e.tag){case 24:case 3:var n=Dc(),i=rr(e,t=sr(n),n);return null!==i&&(Nc(i,e,n),or(i,e,n)),e={cache:Rs()},void(t.payload=e)}e=e.return}}function Fo(t,e,n){var i=Dc();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Ho(t)?$o(e,n):null!==(n=Li(t,e,n,i))&&(Nc(n,t,i),Wo(n,e,i))}function jo(t,e,n){Bo(t,e,n,Dc())}function Bo(t,e,n,i){var s={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ho(t))$o(e,s);else{var r=t.alternate;if(0===t.lanes&&(null===r||0===r.lanes)&&null!==(r=e.lastRenderedReducer))try{var o=e.lastRenderedState,a=r(o,n);if(s.hasEagerState=!0,s.eagerState=a,Kn(a,o))return Pi(t,e,s,0),null===ic&&Ti(),!1}catch(l){}if(null!==(n=Li(t,e,s,i)))return Nc(n,t,i),Wo(n,e,i),!0}return!1}function Uo(t,e,n,i){if(i={lane:2,revertLane:Ph(),action:i,hasEagerState:!1,eagerState:null,next:null},Ho(t)){if(e)throw Error(o(479))}else null!==(e=Li(t,n,i,2))&&Nc(e,t,2)}function Ho(t){var e=t.alternate;return t===br||null!==e&&e===br}function $o(t,e){Sr=xr=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Wo(t,e,n){if(0!==(4194048&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,Ct(t,n)}}var Vo={readContext:Es,use:Ur,useCallback:Pr,useContext:Pr,useEffect:Pr,useImperativeHandle:Pr,useLayoutEffect:Pr,useInsertionEffect:Pr,useMemo:Pr,useReducer:Pr,useRef:Pr,useState:Pr,useDebugValue:Pr,useDeferredValue:Pr,useTransition:Pr,useSyncExternalStore:Pr,useId:Pr,useHostTransitionStatus:Pr,useFormState:Pr,useActionState:Pr,useOptimistic:Pr,useMemoCache:Pr,useCacheRefresh:Pr},Go={readContext:Es,use:Ur,useCallback:function(t,e){return Fr().memoizedState=[t,void 0===e?null:e],t},useContext:Es,useEffect:yo,useImperativeHandle:function(t,e,n){n=null!==n&&void 0!==n?n.concat([t]):null,mo(4194308,4,xo.bind(null,e,t),n)},useLayoutEffect:function(t,e){return mo(4194308,4,t,e)},useInsertionEffect:function(t,e){mo(4,2,t,e)},useMemo:function(t,e){var n=Fr();e=void 0===e?null:e;var i=t();if(Ar){dt(!0);try{t()}finally{dt(!1)}}return n.memoizedState=[i,e],i},useReducer:function(t,e,n){var i=Fr();if(void 0!==n){var s=n(e);if(Ar){dt(!0);try{n(e)}finally{dt(!1)}}}else s=e;return i.memoizedState=i.baseState=s,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:s},i.queue=t,t=t.dispatch=Fo.bind(null,br,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},Fr().memoizedState=t},useState:function(t){var e=(t=Qr(t)).queue,n=jo.bind(null,br,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:Ao,useDeferredValue:function(t,e){return Co(Fr(),t,e)},useTransition:function(){var t=Qr(!1);return t=Po.bind(null,br,t.queue,!0,!1),Fr().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var i=br,s=Fr();if(rs){if(void 0===n)throw Error(o(407));n=n()}else{if(n=e(),null===ic)throw Error(o(349));0!==(124&rc)||Zr(i,e,n)}s.memoizedState=n;var r={value:n,getSnapshot:e};return s.queue=r,yo(Xr.bind(null,i,r,t),[t]),i.flags|=2048,fo(9,{destroy:void 0,resource:void 0},Kr.bind(null,i,r,n,e),null),n},useId:function(){var t=Fr(),e=ic.identifierPrefix;if(rs){var n=Ji;e="\xab"+e+"R"+(n=(Yi&~(1<<32-pt(Yi)-1)).toString(32)+n),0<(n=kr++)&&(e+="H"+n.toString(32)),e+="\xbb"}else e="\xab"+e+"r"+(n=Tr++).toString(32)+"\xbb";return t.memoizedState=e},useHostTransitionStatus:Do,useFormState:lo,useActionState:lo,useOptimistic:function(t){var e=Fr();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=Uo.bind(null,br,!0,n),n.dispatch=e,[t,e]},useMemoCache:Hr,useCacheRefresh:function(){return Fr().memoizedState=zo.bind(null,br)}},qo={readContext:Es,use:Ur,useCallback:ko,useContext:Es,useEffect:bo,useImperativeHandle:So,useInsertionEffect:_o,useLayoutEffect:wo,useMemo:Eo,useReducer:Wr,useRef:go,useState:function(){return Wr($r)},useDebugValue:Ao,useDeferredValue:function(t,e){return To(jr(),_r.memoizedState,t,e)},useTransition:function(){var t=Wr($r)[0],e=jr().memoizedState;return["boolean"===typeof t?t:Br(t),e]},useSyncExternalStore:qr,useId:Oo,useHostTransitionStatus:Do,useFormState:co,useActionState:co,useOptimistic:function(t,e){return to(jr(),0,t,e)},useMemoCache:Hr,useCacheRefresh:No},Zo={readContext:Es,use:Ur,useCallback:ko,useContext:Es,useEffect:bo,useImperativeHandle:So,useInsertionEffect:_o,useLayoutEffect:wo,useMemo:Eo,useReducer:Gr,useRef:go,useState:function(){return Gr($r)},useDebugValue:Ao,useDeferredValue:function(t,e){var n=jr();return null===_r?Co(n,t,e):To(n,_r.memoizedState,t,e)},useTransition:function(){var t=Gr($r)[0],e=jr().memoizedState;return["boolean"===typeof t?t:Br(t),e]},useSyncExternalStore:qr,useId:Oo,useHostTransitionStatus:Do,useFormState:po,useActionState:po,useOptimistic:function(t,e){var n=jr();return null!==_r?to(n,0,t,e):(n.baseState=t,[t,n.queue.dispatch])},useMemoCache:Hr,useCacheRefresh:No},Ko=null,Xo=0;function Yo(t){var e=Xo;return Xo+=1,null===Ko&&(Ko=[]),Ys(Ko,t,e)}function Jo(t,e){e=e.props.ref,t.ref=void 0!==e?e:null}function Qo(t,e){if(e.$$typeof===p)throw Error(o(525));throw t=Object.prototype.toString.call(e),Error(o(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ta(t){return(0,t._init)(t._payload)}function ea(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t){for(var e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(t,e){return(t=Fi(t,e)).index=0,t.sibling=null,t}function r(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=67108866,n):i:(e.flags|=67108866,n):(e.flags|=1048576,n)}function a(e){return t&&null===e.alternate&&(e.flags|=67108866),e}function l(t,e,n,i){return null===e||6!==e.tag?((e=Hi(n,t.mode,i)).return=t,e):((e=s(e,n)).return=t,e)}function c(t,e,n,i){var r=n.type;return r===m?u(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===E&&ta(r)===e.type)?(Jo(e=s(e,n.props),n),e.return=t,e):(Jo(e=Bi(n.type,n.key,n.props,null,t.mode,i),n),e.return=t,e)}function h(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=$i(n,t.mode,i)).return=t,e):((e=s(e,n.children||[])).return=t,e)}function u(t,e,n,i,r){return null===e||7!==e.tag?((e=Ui(n,t.mode,i,r)).return=t,e):((e=s(e,n)).return=t,e)}function d(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e||"bigint"===typeof e)return(e=Hi(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case f:return Jo(n=Bi(e.type,e.key,e.props,null,t.mode,n),e),n.return=t,n;case g:return(e=$i(e,t.mode,n)).return=t,e;case E:return d(t,e=(0,e._init)(e._payload),n)}if(R(e)||L(e))return(e=Ui(e,t.mode,n,null)).return=t,e;if("function"===typeof e.then)return d(t,Yo(e),n);if(e.$$typeof===w)return d(t,Cs(t,e),n);Qo(t,e)}return null}function p(t,e,n,i){var s=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==s?null:l(t,e,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===s?c(t,e,n,i):null;case g:return n.key===s?h(t,e,n,i):null;case E:return p(t,e,n=(s=n._init)(n._payload),i)}if(R(n)||L(n))return null!==s?null:u(t,e,n,i,null);if("function"===typeof n.then)return p(t,e,Yo(n),i);if(n.$$typeof===w)return p(t,e,Cs(t,n),i);Qo(t,n)}return null}function v(t,e,n,i,s){if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return l(e,t=t.get(n)||null,""+i,s);if("object"===typeof i&&null!==i){switch(i.$$typeof){case f:return c(e,t=t.get(null===i.key?n:i.key)||null,i,s);case g:return h(e,t=t.get(null===i.key?n:i.key)||null,i,s);case E:return v(t,e,n,i=(0,i._init)(i._payload),s)}if(R(i)||L(i))return u(e,t=t.get(n)||null,i,s,null);if("function"===typeof i.then)return v(t,e,n,Yo(i),s);if(i.$$typeof===w)return v(t,e,n,Cs(e,i),s);Qo(e,i)}return null}function y(l,c,h,u){if("object"===typeof h&&null!==h&&h.type===m&&null===h.key&&(h=h.props.children),"object"===typeof h&&null!==h){switch(h.$$typeof){case f:t:{for(var b=h.key;null!==c;){if(c.key===b){if((b=h.type)===m){if(7===c.tag){n(l,c.sibling),(u=s(c,h.props.children)).return=l,l=u;break t}}else if(c.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===E&&ta(b)===c.type){n(l,c.sibling),Jo(u=s(c,h.props),h),u.return=l,l=u;break t}n(l,c);break}e(l,c),c=c.sibling}h.type===m?((u=Ui(h.props.children,l.mode,u,h.key)).return=l,l=u):(Jo(u=Bi(h.type,h.key,h.props,null,l.mode,u),h),u.return=l,l=u)}return a(l);case g:t:{for(b=h.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===h.containerInfo&&c.stateNode.implementation===h.implementation){n(l,c.sibling),(u=s(c,h.children||[])).return=l,l=u;break t}n(l,c);break}e(l,c),c=c.sibling}(u=$i(h,l.mode,u)).return=l,l=u}return a(l);case E:return y(l,c,h=(b=h._init)(h._payload),u)}if(R(h))return function(s,o,a,l){for(var c=null,h=null,u=o,f=o=0,g=null;null!==u&&f<a.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var m=p(s,u,a[f],l);if(null===m){null===u&&(u=g);break}t&&u&&null===m.alternate&&e(s,u),o=r(m,o,f),null===h?c=m:h.sibling=m,h=m,u=g}if(f===a.length)return n(s,u),rs&&Qi(s,f),c;if(null===u){for(;f<a.length;f++)null!==(u=d(s,a[f],l))&&(o=r(u,o,f),null===h?c=u:h.sibling=u,h=u);return rs&&Qi(s,f),c}for(u=i(u);f<a.length;f++)null!==(g=v(u,s,f,a[f],l))&&(t&&null!==g.alternate&&u.delete(null===g.key?f:g.key),o=r(g,o,f),null===h?c=g:h.sibling=g,h=g);return t&&u.forEach(function(t){return e(s,t)}),rs&&Qi(s,f),c}(l,c,h,u);if(L(h)){if("function"!==typeof(b=L(h)))throw Error(o(150));return function(s,a,l,c){if(null==l)throw Error(o(151));for(var h=null,u=null,f=a,g=a=0,m=null,y=l.next();null!==f&&!y.done;g++,y=l.next()){f.index>g?(m=f,f=null):m=f.sibling;var b=p(s,f,y.value,c);if(null===b){null===f&&(f=m);break}t&&f&&null===b.alternate&&e(s,f),a=r(b,a,g),null===u?h=b:u.sibling=b,u=b,f=m}if(y.done)return n(s,f),rs&&Qi(s,g),h;if(null===f){for(;!y.done;g++,y=l.next())null!==(y=d(s,y.value,c))&&(a=r(y,a,g),null===u?h=y:u.sibling=y,u=y);return rs&&Qi(s,g),h}for(f=i(f);!y.done;g++,y=l.next())null!==(y=v(f,s,g,y.value,c))&&(t&&null!==y.alternate&&f.delete(null===y.key?g:y.key),a=r(y,a,g),null===u?h=y:u.sibling=y,u=y);return t&&f.forEach(function(t){return e(s,t)}),rs&&Qi(s,g),h}(l,c,h=b.call(h),u)}if("function"===typeof h.then)return y(l,c,Yo(h),u);if(h.$$typeof===w)return y(l,c,Cs(l,h),u);Qo(l,h)}return"string"===typeof h&&""!==h||"number"===typeof h||"bigint"===typeof h?(h=""+h,null!==c&&6===c.tag?(n(l,c.sibling),(u=s(c,h)).return=l,l=u):(n(l,c),(u=Hi(h,l.mode,u)).return=l,l=u),a(l)):n(l,c)}return function(t,e,n,i){try{Xo=0;var s=y(t,e,n,i);return Ko=null,s}catch(o){if(o===Vs||o===qs)throw o;var r=Ni(29,o,null,t.mode);return r.lanes=i,r.return=t,r}}}var na=ea(!0),ia=ea(!1),sa=j(null),ra=null;function oa(t){var e=t.alternate;U(ha,1&ha.current),U(sa,t),null===ra&&(null===e||null!==pr.current||null!==e.memoizedState)&&(ra=t)}function aa(t){if(22===t.tag){if(U(ha,ha.current),U(sa,t),null===ra){var e=t.alternate;null!==e&&null!==e.memoizedState&&(ra=t)}}else la()}function la(){U(ha,ha.current),U(sa,sa.current)}function ca(t){B(sa),ra===t&&(ra=null),B(ha)}var ha=j(0);function ua(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||mu(n)))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function da(t,e,n,i){n=null===(n=n(i,e=t.memoizedState))||void 0===n?e:d({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var pa={enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Dc(),s=sr(i);s.payload=e,void 0!==n&&null!==n&&(s.callback=n),null!==(e=rr(t,s,i))&&(Nc(e,t,i),or(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Dc(),s=sr(i);s.tag=1,s.payload=e,void 0!==n&&null!==n&&(s.callback=n),null!==(e=rr(t,s,i))&&(Nc(e,t,i),or(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Dc(),i=sr(n);i.tag=2,void 0!==e&&null!==e&&(i.callback=e),null!==(e=rr(t,i,n))&&(Nc(e,t,n),or(e,t,n))}};function fa(t,e,n,i,s,r,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,r,o):!e.prototype||!e.prototype.isPureReactComponent||(!Xn(n,i)||!Xn(s,r))}function ga(t,e,n,i){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&pa.enqueueReplaceState(e,e.state,null)}function ma(t,e){var n=e;if("ref"in e)for(var i in n={},e)"ref"!==i&&(n[i]=e[i]);if(t=t.defaultProps)for(var s in n===e&&(n=d({},n)),t)void 0===n[s]&&(n[s]=t[s]);return n}var va="function"===typeof reportError?reportError:function(t){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof t&&null!==t&&"string"===typeof t.message?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)};function ya(t){va(t)}function ba(t){console.error(t)}function _a(t){va(t)}function wa(t,e){try{(0,t.onUncaughtError)(e.value,{componentStack:e.stack})}catch(n){setTimeout(function(){throw n})}}function xa(t,e,n){try{(0,t.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===e.tag?e.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function Sa(t,e,n){return(n=sr(n)).tag=3,n.payload={element:null},n.callback=function(){wa(t,e)},n}function Aa(t){return(t=sr(t)).tag=3,t}function ka(t,e,n,i){var s=n.type.getDerivedStateFromError;if("function"===typeof s){var r=i.value;t.payload=function(){return s(r)},t.callback=function(){xa(e,n,i)}}var o=n.stateNode;null!==o&&"function"===typeof o.componentDidCatch&&(t.callback=function(){xa(e,n,i),"function"!==typeof s&&(null===Ac?Ac=new Set([this]):Ac.add(this));var t=i.stack;this.componentDidCatch(i.value,{componentStack:null!==t?t:""})})}var Ea=Error(o(461)),Ca=!1;function Ta(t,e,n,i){e.child=null===t?ia(e,null,n,i):na(e,t.child,n,i)}function Pa(t,e,n,i,s){n=n.render;var r=e.ref;if("ref"in i){var o={};for(var a in i)"ref"!==a&&(o[a]=i[a])}else o=i;return ks(e),i=Mr(t,e,n,o,r,s),a=Or(),null===t||Ca?(rs&&a&&es(e),e.flags|=1,Ta(t,e,i,s),e.child):(Nr(t,e,s),Ka(t,e,s))}function La(t,e,n,i,s){if(null===t){var r=n.type;return"function"!==typeof r||zi(r)||void 0!==r.defaultProps||null!==n.compare?((t=Bi(n.type,null,i,e,e.mode,s)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=r,Ma(t,e,r,i,s))}if(r=t.child,!Xa(t,s)){var o=r.memoizedProps;if((n=null!==(n=n.compare)?n:Xn)(o,i)&&t.ref===e.ref)return Ka(t,e,s)}return e.flags|=1,(t=Fi(r,i)).ref=e.ref,t.return=e,e.child=t}function Ma(t,e,n,i,s){if(null!==t){var r=t.memoizedProps;if(Xn(r,i)&&t.ref===e.ref){if(Ca=!1,e.pendingProps=i=r,!Xa(t,s))return e.lanes=t.lanes,Ka(t,e,s);0!==(131072&t.flags)&&(Ca=!0)}}return Oa(t,e,n,i,s)}function Ia(t,e,n){var i=e.pendingProps,s=i.children,r=null!==t?t.memoizedState:null;if("hidden"===i.mode){if(0!==(128&e.flags)){if(i=null!==r?r.baseLanes|n:n,null!==t){for(s=e.child=t.child,r=0;null!==s;)r=r|s.lanes|s.childLanes,s=s.sibling;e.childLanes=r&~i}else e.childLanes=0,e.child=null;return Ra(t,e,i,n)}if(0===(536870912&n))return e.lanes=e.childLanes=536870912,Ra(t,e,null!==r?r.baseLanes|n:n,n);e.memoizedState={baseLanes:0,cachePool:null},null!==t&&$s(0,null!==r?r.cachePool:null),null!==r?gr(e,r):mr(),aa(e)}else null!==r?($s(0,r.cachePool),gr(e,r),la(),e.memoizedState=null):(null!==t&&$s(0,null),mr(),la());return Ta(t,e,s,n),e.child}function Ra(t,e,n,i){var s=Hs();return s=null===s?null:{parent:Is._currentValue,pool:s},e.memoizedState={baseLanes:n,cachePool:s},null!==t&&$s(0,null),mr(),aa(e),null!==t&&Ss(t,e,i,!0),null}function Da(t,e){var n=e.ref;if(null===n)null!==t&&null!==t.ref&&(e.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(o(284));null!==t&&t.ref===n||(e.flags|=4194816)}}function Oa(t,e,n,i,s){return ks(e),n=Mr(t,e,n,i,void 0,s),i=Or(),null===t||Ca?(rs&&i&&es(e),e.flags|=1,Ta(t,e,n,s),e.child):(Nr(t,e,s),Ka(t,e,s))}function Na(t,e,n,i,s,r){return ks(e),e.updateQueue=null,n=Rr(e,i,n,s),Ir(t),i=Or(),null===t||Ca?(rs&&i&&es(e),e.flags|=1,Ta(t,e,n,r),e.child):(Nr(t,e,r),Ka(t,e,r))}function za(t,e,n,i,s){if(ks(e),null===e.stateNode){var r=Di,o=n.contextType;"object"===typeof o&&null!==o&&(r=Es(o)),r=new n(i,r),e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r.updater=pa,e.stateNode=r,r._reactInternals=e,(r=e.stateNode).props=i,r.state=e.memoizedState,r.refs={},nr(e),o=n.contextType,r.context="object"===typeof o&&null!==o?Es(o):Di,r.state=e.memoizedState,"function"===typeof(o=n.getDerivedStateFromProps)&&(da(e,n,o,i),r.state=e.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(o=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),o!==r.state&&pa.enqueueReplaceState(r,r.state,null),hr(e,i,r,s),cr(),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308),i=!0}else if(null===t){r=e.stateNode;var a=e.memoizedProps,l=ma(n,a);r.props=l;var c=r.context,h=n.contextType;o=Di,"object"===typeof h&&null!==h&&(o=Es(h));var u=n.getDerivedStateFromProps;h="function"===typeof u||"function"===typeof r.getSnapshotBeforeUpdate,a=e.pendingProps!==a,h||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(a||c!==o)&&ga(e,r,i,o),er=!1;var d=e.memoizedState;r.state=d,hr(e,i,r,s),cr(),c=e.memoizedState,a||d!==c||er?("function"===typeof u&&(da(e,n,u,i),c=e.memoizedState),(l=er||fa(e,n,l,i,d,c,o))?(h||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||("function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"===typeof r.componentDidMount&&(e.flags|=4194308)):("function"===typeof r.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),r.props=i,r.state=c,r.context=o,i=l):("function"===typeof r.componentDidMount&&(e.flags|=4194308),i=!1)}else{r=e.stateNode,ir(t,e),h=ma(n,o=e.memoizedProps),r.props=h,u=e.pendingProps,d=r.context,c=n.contextType,l=Di,"object"===typeof c&&null!==c&&(l=Es(c)),(c="function"===typeof(a=n.getDerivedStateFromProps)||"function"===typeof r.getSnapshotBeforeUpdate)||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(o!==u||d!==l)&&ga(e,r,i,l),er=!1,d=e.memoizedState,r.state=d,hr(e,i,r,s),cr();var p=e.memoizedState;o!==u||d!==p||er||null!==t&&null!==t.dependencies&&As(t.dependencies)?("function"===typeof a&&(da(e,n,a,i),p=e.memoizedState),(h=er||fa(e,n,h,i,d,p,l)||null!==t&&null!==t.dependencies&&As(t.dependencies))?(c||"function"!==typeof r.UNSAFE_componentWillUpdate&&"function"!==typeof r.componentWillUpdate||("function"===typeof r.componentWillUpdate&&r.componentWillUpdate(i,p,l),"function"===typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof r.componentDidUpdate&&(e.flags|=4),"function"===typeof r.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof r.componentDidUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),r.props=i,r.state=p,r.context=l,i=h):("function"!==typeof r.componentDidUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return r=i,Da(t,e),i=0!==(128&e.flags),r||i?(r=e.stateNode,n=i&&"function"!==typeof n.getDerivedStateFromError?null:r.render(),e.flags|=1,null!==t&&i?(e.child=na(e,t.child,null,s),e.child=na(e,null,n,s)):Ta(t,e,n,s),e.memoizedState=r.state,t=e.child):t=Ka(t,e,s),t}function Fa(t,e,n,i){return ps(),e.flags|=256,Ta(t,e,n,i),e.child}var ja={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ba(t){return{baseLanes:t,cachePool:Ws()}}function Ua(t,e,n){return t=null!==t?t.childLanes&~n:0,e&&(t|=mc),t}function Ha(t,e,n){var i,s=e.pendingProps,r=!1,a=0!==(128&e.flags);if((i=a)||(i=(null===t||null!==t.memoizedState)&&0!==(2&ha.current)),i&&(r=!0,e.flags&=-129),i=0!==(32&e.flags),e.flags&=-33,null===t){if(rs){if(r?oa(e):la(),rs){var l,c=ss;if(l=c){t:{for(l=c,c=as;8!==l.nodeType;){if(!c){c=null;break t}if(null===(l=vu(l.nextSibling))){c=null;break t}}c=l}null!==c?(e.memoizedState={dehydrated:c,treeContext:null!==Xi?{id:Yi,overflow:Ji}:null,retryLane:536870912,hydrationErrors:null},(l=Ni(18,null,null,0)).stateNode=c,l.return=e,e.child=l,is=e,ss=null,l=!0):l=!1}l||cs(e)}if(null!==(c=e.memoizedState)&&null!==(c=c.dehydrated))return mu(c)?e.lanes=32:e.lanes=536870912,null;ca(e)}return c=s.children,s=s.fallback,r?(la(),c=Wa({mode:"hidden",children:c},r=e.mode),s=Ui(s,r,n,null),c.return=e,s.return=e,c.sibling=s,e.child=c,(r=e.child).memoizedState=Ba(n),r.childLanes=Ua(t,i,n),e.memoizedState=ja,s):(oa(e),$a(e,c))}if(null!==(l=t.memoizedState)&&null!==(c=l.dehydrated)){if(a)256&e.flags?(oa(e),e.flags&=-257,e=Va(t,e,n)):null!==e.memoizedState?(la(),e.child=t.child,e.flags|=128,e=null):(la(),r=s.fallback,c=e.mode,s=Wa({mode:"visible",children:s.children},c),(r=Ui(r,c,n,null)).flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,na(e,t.child,null,n),(s=e.child).memoizedState=Ba(n),s.childLanes=Ua(t,i,n),e.memoizedState=ja,e=r);else if(oa(e),mu(c)){if(i=c.nextSibling&&c.nextSibling.dataset)var h=i.dgst;i=h,(s=Error(o(419))).stack="",s.digest=i,gs({value:s,source:null,stack:null}),e=Va(t,e,n)}else if(Ca||Ss(t,e,n,!1),i=0!==(n&t.childLanes),Ca||i){if(null!==(i=ic)&&(0!==(s=0!==((s=0!==(42&(s=n&-n))?1:Tt(s))&(i.suspendedLanes|n))?0:s)&&s!==l.retryLane))throw l.retryLane=s,Mi(t,s),Nc(i,t,s),Ea;"$?"===c.data||qc(),e=Va(t,e,n)}else"$?"===c.data?(e.flags|=192,e.child=t.child,e=null):(t=l.treeContext,ss=vu(c.nextSibling),is=e,rs=!0,os=null,as=!1,null!==t&&(Zi[Ki++]=Yi,Zi[Ki++]=Ji,Zi[Ki++]=Xi,Yi=t.id,Ji=t.overflow,Xi=e),(e=$a(e,s.children)).flags|=4096);return e}return r?(la(),r=s.fallback,c=e.mode,h=(l=t.child).sibling,(s=Fi(l,{mode:"hidden",children:s.children})).subtreeFlags=65011712&l.subtreeFlags,null!==h?r=Fi(h,r):(r=Ui(r,c,n,null)).flags|=2,r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,null===(c=t.child.memoizedState)?c=Ba(n):(null!==(l=c.cachePool)?(h=Is._currentValue,l=l.parent!==h?{parent:h,pool:h}:l):l=Ws(),c={baseLanes:c.baseLanes|n,cachePool:l}),r.memoizedState=c,r.childLanes=Ua(t,i,n),e.memoizedState=ja,s):(oa(e),t=(n=t.child).sibling,(n=Fi(n,{mode:"visible",children:s.children})).return=e,n.sibling=null,null!==t&&(null===(i=e.deletions)?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n,e.memoizedState=null,n)}function $a(t,e){return(e=Wa({mode:"visible",children:e},t.mode)).return=t,t.child=e}function Wa(t,e){return(t=Ni(22,t,null,e)).lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Va(t,e,n){return na(e,t.child,null,n),(t=$a(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Ga(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),ws(t.return,e,n)}function qa(t,e,n,i,s){var r=t.memoizedState;null===r?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=s)}function Za(t,e,n){var i=e.pendingProps,s=i.revealOrder,r=i.tail;if(Ta(t,e,i.children,n),0!==(2&(i=ha.current)))i=1&i|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Ga(t,n,e);else if(19===t.tag)Ga(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}switch(U(ha,i),s){case"forwards":for(n=e.child,s=null;null!==n;)null!==(t=n.alternate)&&null===ua(t)&&(s=n),n=n.sibling;null===(n=s)?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),qa(e,!1,s,n,r);break;case"backwards":for(n=null,s=e.child,e.child=null;null!==s;){if(null!==(t=s.alternate)&&null===ua(t)){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}qa(e,!0,n,null,r);break;case"together":qa(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ka(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),pc|=e.lanes,0===(n&e.childLanes)){if(null===t)return null;if(Ss(t,e,n,!1),0===(n&e.childLanes))return null}if(null!==t&&e.child!==t.child)throw Error(o(153));if(null!==e.child){for(n=Fi(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Fi(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Xa(t,e){return 0!==(t.lanes&e)||!(null===(t=t.dependencies)||!As(t))}function Ya(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps)Ca=!0;else{if(!Xa(t,n)&&0===(128&e.flags))return Ca=!1,function(t,e,n){switch(e.tag){case 3:G(e,e.stateNode.containerInfo),bs(0,Is,t.memoizedState.cache),ps();break;case 27:case 5:Z(e);break;case 4:G(e,e.stateNode.containerInfo);break;case 10:bs(0,e.type,e.memoizedProps.value);break;case 13:var i=e.memoizedState;if(null!==i)return null!==i.dehydrated?(oa(e),e.flags|=128,null):0!==(n&e.child.childLanes)?Ha(t,e,n):(oa(e),null!==(t=Ka(t,e,n))?t.sibling:null);oa(e);break;case 19:var s=0!==(128&t.flags);if((i=0!==(n&e.childLanes))||(Ss(t,e,n,!1),i=0!==(n&e.childLanes)),s){if(i)return Za(t,e,n);e.flags|=128}if(null!==(s=e.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),U(ha,ha.current),i)break;return null;case 22:case 23:return e.lanes=0,Ia(t,e,n);case 24:bs(0,Is,t.memoizedState.cache)}return Ka(t,e,n)}(t,e,n);Ca=0!==(131072&t.flags)}else Ca=!1,rs&&0!==(1048576&e.flags)&&ts(e,qi,e.index);switch(e.lanes=0,e.tag){case 16:t:{t=e.pendingProps;var i=e.elementType,s=i._init;if(i=s(i._payload),e.type=i,"function"!==typeof i){if(void 0!==i&&null!==i){if((s=i.$$typeof)===x){e.tag=11,e=Pa(null,e,i,t,n);break t}if(s===k){e.tag=14,e=La(null,e,i,t,n);break t}}throw e=I(i)||i,Error(o(306,e,""))}zi(i)?(t=ma(i,t),e.tag=1,e=za(null,e,i,t,n)):(e.tag=0,e=Oa(null,e,i,t,n))}return e;case 0:return Oa(t,e,e.type,e.pendingProps,n);case 1:return za(t,e,i=e.type,s=ma(i,e.pendingProps),n);case 3:t:{if(G(e,e.stateNode.containerInfo),null===t)throw Error(o(387));i=e.pendingProps;var r=e.memoizedState;s=r.element,ir(t,e),hr(e,i,null,n);var a=e.memoizedState;if(i=a.cache,bs(0,Is,i),i!==r.cache&&xs(e,[Is],n,!0),cr(),i=a.element,r.isDehydrated){if(r={element:i,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=r,e.memoizedState=r,256&e.flags){e=Fa(t,e,i,n);break t}if(i!==s){gs(s=Ai(Error(o(424)),e)),e=Fa(t,e,i,n);break t}if(9===(t=e.stateNode.containerInfo).nodeType)t=t.body;else t="HTML"===t.nodeName?t.ownerDocument.body:t;for(ss=vu(t.firstChild),is=e,rs=!0,os=null,as=!0,n=ia(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),i===s){e=Ka(t,e,n);break t}Ta(t,e,i,n)}e=e.child}return e;case 26:return Da(t,e),null===t?(n=Tu(e.type,null,e.pendingProps,null))?e.memoizedState=n:rs||(n=e.type,t=e.pendingProps,(i=iu(W.current).createElement(n))[It]=e,i[Rt]=t,tu(i,n,t),Vt(i),e.stateNode=i):e.memoizedState=Tu(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return Z(e),null===t&&rs&&(i=e.stateNode=_u(e.type,e.pendingProps,W.current),is=e,as=!0,s=ss,pu(e.type)?(yu=s,ss=vu(i.firstChild)):ss=s),Ta(t,e,e.pendingProps.children,n),Da(t,e),null===t&&(e.flags|=4194304),e.child;case 5:return null===t&&rs&&((s=i=ss)&&(null!==(i=function(t,e,n,i){for(;1===t.nodeType;){var s=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!i&&("INPUT"!==t.nodeName||"hidden"!==t.type))break}else if(i){if(!t[jt])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if("stylesheet"===(r=t.getAttribute("rel"))&&t.hasAttribute("data-precedence"))break;if(r!==s.rel||t.getAttribute("href")!==(null==s.href||""===s.href?null:s.href)||t.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin)||t.getAttribute("title")!==(null==s.title?null:s.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(((r=t.getAttribute("src"))!==(null==s.src?null:s.src)||t.getAttribute("type")!==(null==s.type?null:s.type)||t.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin))&&r&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else{if("input"!==e||"hidden"!==t.type)return t;var r=null==s.name?null:""+s.name;if("hidden"===s.type&&t.getAttribute("name")===r)return t}if(null===(t=vu(t.nextSibling)))break}return null}(i,e.type,e.pendingProps,as))?(e.stateNode=i,is=e,ss=vu(i.firstChild),as=!1,s=!0):s=!1),s||cs(e)),Z(e),s=e.type,r=e.pendingProps,a=null!==t?t.memoizedProps:null,i=r.children,ou(s,r)?i=null:null!==a&&ou(s,a)&&(e.flags|=32),null!==e.memoizedState&&(s=Mr(t,e,Dr,null,null,n),Zu._currentValue=s),Da(t,e),Ta(t,e,i,n),e.child;case 6:return null===t&&rs&&((t=n=ss)&&(null!==(n=function(t,e,n){if(""===e)return null;for(;3!==t.nodeType;){if((1!==t.nodeType||"INPUT"!==t.nodeName||"hidden"!==t.type)&&!n)return null;if(null===(t=vu(t.nextSibling)))return null}return t}(n,e.pendingProps,as))?(e.stateNode=n,is=e,ss=null,t=!0):t=!1),t||cs(e)),null;case 13:return Ha(t,e,n);case 4:return G(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=na(e,null,i,n):Ta(t,e,i,n),e.child;case 11:return Pa(t,e,e.type,e.pendingProps,n);case 7:return Ta(t,e,e.pendingProps,n),e.child;case 8:case 12:return Ta(t,e,e.pendingProps.children,n),e.child;case 10:return i=e.pendingProps,bs(0,e.type,i.value),Ta(t,e,i.children,n),e.child;case 9:return s=e.type._context,i=e.pendingProps.children,ks(e),i=i(s=Es(s)),e.flags|=1,Ta(t,e,i,n),e.child;case 14:return La(t,e,e.type,e.pendingProps,n);case 15:return Ma(t,e,e.type,e.pendingProps,n);case 19:return Za(t,e,n);case 31:return i=e.pendingProps,n=e.mode,i={mode:i.mode,children:i.children},null===t?((n=Wa(i,n)).ref=e.ref,e.child=n,n.return=e,e=n):((n=Fi(t.child,i)).ref=e.ref,e.child=n,n.return=e,e=n),e;case 22:return Ia(t,e,n);case 24:return ks(e),i=Es(Is),null===t?(null===(s=Hs())&&(s=ic,r=Rs(),s.pooledCache=r,r.refCount++,null!==r&&(s.pooledCacheLanes|=n),s=r),e.memoizedState={parent:i,cache:s},nr(e),bs(0,Is,s)):(0!==(t.lanes&n)&&(ir(t,e),hr(e,null,null,n),cr()),s=t.memoizedState,r=e.memoizedState,s.parent!==i?(s={parent:i,cache:i},e.memoizedState=s,0===e.lanes&&(e.memoizedState=e.updateQueue.baseState=s),bs(0,Is,i)):(i=r.cache,bs(0,Is,i),i!==s.cache&&xs(e,[Is],n,!0))),Ta(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(o(156,e.tag))}function Ja(t){t.flags|=4}function Qa(t,e){if("stylesheet"!==e.type||0!==(4&e.state.loading))t.flags&=-16777217;else if(t.flags|=16777216,!Uu(e)){if(null!==(e=sa.current)&&((4194048&rc)===rc?null!==ra:(62914560&rc)!==rc&&0===(536870912&rc)||e!==ra))throw Js=Zs,Gs;t.flags|=8192}}function tl(t,e){null!==e&&(t.flags|=4),16384&t.flags&&(e=22!==t.tag?St():536870912,t.lanes|=e,vc|=e)}function el(t,e){if(!rs)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function nl(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var s=t.child;null!==s;)n|=s.lanes|s.childLanes,i|=65011712&s.subtreeFlags,i|=65011712&s.flags,s.return=t,s=s.sibling;else for(s=t.child;null!==s;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function il(t,e,n){var i=e.pendingProps;switch(ns(e),e.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(e),null;case 3:return n=e.stateNode,i=null,null!==t&&(i=t.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),_s(Is),q(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==t&&null!==t.child||(ds(e)?Ja(e):null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,fs())),nl(e),null;case 26:return n=e.memoizedState,null===t?(Ja(e),null!==n?(nl(e),Qa(e,n)):(nl(e),e.flags&=-16777217)):n?n!==t.memoizedState?(Ja(e),nl(e),Qa(e,n)):(nl(e),e.flags&=-16777217):(t.memoizedProps!==i&&Ja(e),nl(e),e.flags&=-16777217),null;case 27:K(e),n=W.current;var s=e.type;if(null!==t&&null!=e.stateNode)t.memoizedProps!==i&&Ja(e);else{if(!i){if(null===e.stateNode)throw Error(o(166));return nl(e),null}t=H.current,ds(e)?hs(e):(t=_u(s,i,n),e.stateNode=t,Ja(e))}return nl(e),null;case 5:if(K(e),n=e.type,null!==t&&null!=e.stateNode)t.memoizedProps!==i&&Ja(e);else{if(!i){if(null===e.stateNode)throw Error(o(166));return nl(e),null}if(t=H.current,ds(e))hs(e);else{switch(s=iu(W.current),t){case 1:t=s.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:t=s.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":t=s.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":t=s.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(t=s.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t="string"===typeof i.is?s.createElement("select",{is:i.is}):s.createElement("select"),i.multiple?t.multiple=!0:i.size&&(t.size=i.size);break;default:t="string"===typeof i.is?s.createElement(n,{is:i.is}):s.createElement(n)}}t[It]=e,t[Rt]=i;t:for(s=e.child;null!==s;){if(5===s.tag||6===s.tag)t.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===e)break t;for(;null===s.sibling;){if(null===s.return||s.return===e)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}e.stateNode=t;t:switch(tu(t,n,i),n){case"button":case"input":case"select":case"textarea":t=!!i.autoFocus;break t;case"img":t=!0;break t;default:t=!1}t&&Ja(e)}}return nl(e),e.flags&=-16777217,null;case 6:if(t&&null!=e.stateNode)t.memoizedProps!==i&&Ja(e);else{if("string"!==typeof i&&null===e.stateNode)throw Error(o(166));if(t=W.current,ds(e)){if(t=e.stateNode,n=e.memoizedProps,i=null,null!==(s=is))switch(s.tag){case 27:case 5:i=s.memoizedProps}t[It]=e,(t=!!(t.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Xh(t.nodeValue,n)))||cs(e)}else(t=iu(t).createTextNode(i))[It]=e,e.stateNode=t}return nl(e),null;case 13:if(i=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(s=ds(e),null!==i&&null!==i.dehydrated){if(null===t){if(!s)throw Error(o(318));if(!(s=null!==(s=e.memoizedState)?s.dehydrated:null))throw Error(o(317));s[It]=e}else ps(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;nl(e),s=!1}else s=fs(),null!==t&&null!==t.memoizedState&&(t.memoizedState.hydrationErrors=s),s=!0;if(!s)return 256&e.flags?(ca(e),e):(ca(e),null)}if(ca(e),0!==(128&e.flags))return e.lanes=n,e;if(n=null!==i,t=null!==t&&null!==t.memoizedState,n){s=null,null!==(i=e.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(s=i.alternate.memoizedState.cachePool.pool);var r=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(r=i.memoizedState.cachePool.pool),r!==s&&(i.flags|=2048)}return n!==t&&n&&(e.child.flags|=8192),tl(e,e.updateQueue),nl(e),null;case 4:return q(),null===t&&Bh(e.stateNode.containerInfo),nl(e),null;case 10:return _s(e.type),nl(e),null;case 19:if(B(ha),null===(s=e.memoizedState))return nl(e),null;if(i=0!==(128&e.flags),null===(r=s.rendering))if(i)el(s,!1);else{if(0!==dc||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(r=ua(t))){for(e.flags|=128,el(s,!1),t=r.updateQueue,e.updateQueue=t,tl(e,t),e.subtreeFlags=0,t=n,n=e.child;null!==n;)ji(n,t),n=n.sibling;return U(ha,1&ha.current|2),e.child}t=t.sibling}null!==s.tail&&et()>xc&&(e.flags|=128,i=!0,el(s,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=ua(r))){if(e.flags|=128,i=!0,t=t.updateQueue,e.updateQueue=t,tl(e,t),el(s,!0),null===s.tail&&"hidden"===s.tailMode&&!r.alternate&&!rs)return nl(e),null}else 2*et()-s.renderingStartTime>xc&&536870912!==n&&(e.flags|=128,i=!0,el(s,!1),e.lanes=4194304);s.isBackwards?(r.sibling=e.child,e.child=r):(null!==(t=s.last)?t.sibling=r:e.child=r,s.last=r)}return null!==s.tail?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=et(),e.sibling=null,t=ha.current,U(ha,i?1&t|2:1&t),e):(nl(e),null);case 22:case 23:return ca(e),vr(),i=null!==e.memoizedState,null!==t?null!==t.memoizedState!==i&&(e.flags|=8192):i&&(e.flags|=8192),i?0!==(536870912&n)&&0===(128&e.flags)&&(nl(e),6&e.subtreeFlags&&(e.flags|=8192)):nl(e),null!==(n=e.updateQueue)&&tl(e,n.retryQueue),n=null,null!==t&&null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(n=t.memoizedState.cachePool.pool),i=null,null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(i=e.memoizedState.cachePool.pool),i!==n&&(e.flags|=2048),null!==t&&B(Us),null;case 24:return n=null,null!==t&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),_s(Is),nl(e),null;case 25:case 30:return null}throw Error(o(156,e.tag))}function sl(t,e){switch(ns(e),e.tag){case 1:return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return _s(Is),q(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 26:case 27:case 5:return K(e),null;case 13:if(ca(e),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(o(340));ps()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return B(ha),null;case 4:return q(),null;case 10:return _s(e.type),null;case 22:case 23:return ca(e),vr(),null!==t&&B(Us),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 24:return _s(Is),null;default:return null}}function rl(t,e){switch(ns(e),e.tag){case 3:_s(Is),q();break;case 26:case 27:case 5:K(e);break;case 4:q();break;case 13:ca(e);break;case 19:B(ha);break;case 10:_s(e.type);break;case 22:case 23:ca(e),vr(),null!==t&&B(Us);break;case 24:_s(Is)}}function ol(t,e){try{var n=e.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var s=i.next;n=s;do{if((n.tag&t)===t){i=void 0;var r=n.create,o=n.inst;i=r(),o.destroy=i}n=n.next}while(n!==s)}}catch(a){hh(e,e.return,a)}}function al(t,e,n){try{var i=e.updateQueue,s=null!==i?i.lastEffect:null;if(null!==s){var r=s.next;i=r;do{if((i.tag&t)===t){var o=i.inst,a=o.destroy;if(void 0!==a){o.destroy=void 0,s=e;var l=n,c=a;try{c()}catch(h){hh(s,l,h)}}}i=i.next}while(i!==r)}}catch(h){hh(e,e.return,h)}}function ll(t){var e=t.updateQueue;if(null!==e){var n=t.stateNode;try{dr(e,n)}catch(i){hh(t,t.return,i)}}}function cl(t,e,n){n.props=ma(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(i){hh(t,e,i)}}function hl(t,e){try{var n=t.ref;if(null!==n){switch(t.tag){case 26:case 27:case 5:var i=t.stateNode;break;default:i=t.stateNode}"function"===typeof n?t.refCleanup=n(i):n.current=i}}catch(s){hh(t,e,s)}}function ul(t,e){var n=t.ref,i=t.refCleanup;if(null!==n)if("function"===typeof i)try{i()}catch(s){hh(t,e,s)}finally{t.refCleanup=null,null!=(t=t.alternate)&&(t.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(r){hh(t,e,r)}else n.current=null}function dl(t){var e=t.type,n=t.memoizedProps,i=t.stateNode;try{t:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break t;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(s){hh(t,t.return,s)}}function pl(t,e,n){try{var i=t.stateNode;!function(t,e,n,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var s=null,r=null,a=null,l=null,c=null,h=null,u=null;for(f in n){var d=n[f];if(n.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":c=d;default:i.hasOwnProperty(f)||Jh(t,e,f,null,i,d)}}for(var p in i){var f=i[p];if(d=n[p],i.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":r=f;break;case"name":s=f;break;case"checked":h=f;break;case"defaultChecked":u=f;break;case"value":a=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(o(137,e));break;default:f!==d&&Jh(t,e,p,f,i,d)}}return void me(t,a,l,c,h,u,r,s);case"select":for(r in f=a=l=p=null,n)if(c=n[r],n.hasOwnProperty(r)&&null!=c)switch(r){case"value":break;case"multiple":f=c;default:i.hasOwnProperty(r)||Jh(t,e,r,null,i,c)}for(s in i)if(r=i[s],c=n[s],i.hasOwnProperty(s)&&(null!=r||null!=c))switch(s){case"value":p=r;break;case"defaultValue":l=r;break;case"multiple":a=r;default:r!==c&&Jh(t,e,s,r,i,c)}return e=l,n=a,i=f,void(null!=p?be(t,!!n,p,!1):!!i!==!!n&&(null!=e?be(t,!!n,e,!0):be(t,!!n,n?[]:"",!1)));case"textarea":for(l in f=p=null,n)if(s=n[l],n.hasOwnProperty(l)&&null!=s&&!i.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Jh(t,e,l,null,i,s)}for(a in i)if(s=i[a],r=n[a],i.hasOwnProperty(a)&&(null!=s||null!=r))switch(a){case"value":p=s;break;case"defaultValue":f=s;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=s)throw Error(o(91));break;default:s!==r&&Jh(t,e,a,s,i,r)}return void _e(t,p,f);case"option":for(var g in n)if(p=n[g],n.hasOwnProperty(g)&&null!=p&&!i.hasOwnProperty(g))if("selected"===g)t.selected=!1;else Jh(t,e,g,null,i,p);for(c in i)if(p=i[c],f=n[c],i.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))if("selected"===c)t.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Jh(t,e,c,p,i,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)p=n[m],n.hasOwnProperty(m)&&null!=p&&!i.hasOwnProperty(m)&&Jh(t,e,m,null,i,p);for(h in i)if(p=i[h],f=n[h],i.hasOwnProperty(h)&&p!==f&&(null!=p||null!=f))switch(h){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(o(137,e));break;default:Jh(t,e,h,p,i,f)}return;default:if(Ee(e)){for(var v in n)p=n[v],n.hasOwnProperty(v)&&void 0!==p&&!i.hasOwnProperty(v)&&Qh(t,e,v,void 0,i,p);for(u in i)p=i[u],f=n[u],!i.hasOwnProperty(u)||p===f||void 0===p&&void 0===f||Qh(t,e,u,p,i,f);return}}for(var y in n)p=n[y],n.hasOwnProperty(y)&&null!=p&&!i.hasOwnProperty(y)&&Jh(t,e,y,null,i,p);for(d in i)p=i[d],f=n[d],!i.hasOwnProperty(d)||p===f||null==p&&null==f||Jh(t,e,d,p,i,f)}(i,t.type,n,e),i[Rt]=e}catch(s){hh(t,t.return,s)}}function fl(t){return 5===t.tag||3===t.tag||26===t.tag||27===t.tag&&pu(t.type)||4===t.tag}function gl(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||fl(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(27===t.tag&&pu(t.type))continue t;if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function ml(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(t,e):((e=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(t),null!==(n=n._reactRootContainer)&&void 0!==n||null!==e.onclick||(e.onclick=Yh));else if(4!==i&&(27===i&&pu(t.type)&&(n=t.stateNode,e=null),null!==(t=t.child)))for(ml(t,e,n),t=t.sibling;null!==t;)ml(t,e,n),t=t.sibling}function vl(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==i&&(27===i&&pu(t.type)&&(n=t.stateNode),null!==(t=t.child)))for(vl(t,e,n),t=t.sibling;null!==t;)vl(t,e,n),t=t.sibling}function yl(t){var e=t.stateNode,n=t.memoizedProps;try{for(var i=t.type,s=e.attributes;s.length;)e.removeAttributeNode(s[0]);tu(e,i,n),e[It]=t,e[Rt]=n}catch(r){hh(t,t.return,r)}}var bl=!1,_l=!1,wl=!1,xl="function"===typeof WeakSet?WeakSet:Set,Sl=null;function Al(t,e,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:zl(t,n),4&i&&ol(5,n);break;case 1:if(zl(t,n),4&i)if(t=n.stateNode,null===e)try{t.componentDidMount()}catch(o){hh(n,n.return,o)}else{var s=ma(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(s,e,t.__reactInternalSnapshotBeforeUpdate)}catch(a){hh(n,n.return,a)}}64&i&&ll(n),512&i&&hl(n,n.return);break;case 3:if(zl(t,n),64&i&&null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:e=n.child.stateNode}try{dr(t,e)}catch(o){hh(n,n.return,o)}}break;case 27:null===e&&4&i&&yl(n);case 26:case 5:zl(t,n),null===e&&4&i&&dl(n),512&i&&hl(n,n.return);break;case 12:zl(t,n);break;case 13:zl(t,n),4&i&&Ll(t,n),64&i&&(null!==(t=n.memoizedState)&&(null!==(t=t.dehydrated)&&function(t,e){var n=t.ownerDocument;if("$?"!==t.data||"complete"===n.readyState)e();else{var i=function(){e(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),t._reactRetry=i}}(t,n=fh.bind(null,n))));break;case 22:if(!(i=null!==n.memoizedState||bl)){e=null!==e&&null!==e.memoizedState||_l,s=bl;var r=_l;bl=i,(_l=e)&&!r?jl(t,n,0!==(8772&n.subtreeFlags)):zl(t,n),bl=s,_l=r}break;case 30:break;default:zl(t,n)}}function kl(t){var e=t.alternate;null!==e&&(t.alternate=null,kl(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&Bt(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var El=null,Cl=!1;function Tl(t,e,n){for(n=n.child;null!==n;)Pl(t,e,n),n=n.sibling}function Pl(t,e,n){if(ut&&"function"===typeof ut.onCommitFiberUnmount)try{ut.onCommitFiberUnmount(ht,n)}catch(r){}switch(n.tag){case 26:_l||ul(n,e),Tl(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:_l||ul(n,e);var i=El,s=Cl;pu(n.type)&&(El=n.stateNode,Cl=!1),Tl(t,e,n),wu(n.stateNode),El=i,Cl=s;break;case 5:_l||ul(n,e);case 6:if(i=El,s=Cl,El=null,Tl(t,e,n),Cl=s,null!==(El=i))if(Cl)try{(9===El.nodeType?El.body:"HTML"===El.nodeName?El.ownerDocument.body:El).removeChild(n.stateNode)}catch(o){hh(n,e,o)}else try{El.removeChild(n.stateNode)}catch(o){hh(n,e,o)}break;case 18:null!==El&&(Cl?(fu(9===(t=El).nodeType?t.body:"HTML"===t.nodeName?t.ownerDocument.body:t,n.stateNode),Cd(t)):fu(El,n.stateNode));break;case 4:i=El,s=Cl,El=n.stateNode.containerInfo,Cl=!0,Tl(t,e,n),El=i,Cl=s;break;case 0:case 11:case 14:case 15:_l||al(2,n,e),_l||al(4,n,e),Tl(t,e,n);break;case 1:_l||(ul(n,e),"function"===typeof(i=n.stateNode).componentWillUnmount&&cl(n,e,i)),Tl(t,e,n);break;case 21:Tl(t,e,n);break;case 22:_l=(i=_l)||null!==n.memoizedState,Tl(t,e,n),_l=i;break;default:Tl(t,e,n)}}function Ll(t,e){if(null===e.memoizedState&&(null!==(t=e.alternate)&&(null!==(t=t.memoizedState)&&null!==(t=t.dehydrated))))try{Cd(t)}catch(n){hh(e,e.return,n)}}function Ml(t,e){var n=function(t){switch(t.tag){case 13:case 19:var e=t.stateNode;return null===e&&(e=t.stateNode=new xl),e;case 22:return null===(e=(t=t.stateNode)._retryCache)&&(e=t._retryCache=new xl),e;default:throw Error(o(435,t.tag))}}(t);e.forEach(function(e){var i=gh.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))})}function Il(t,e){var n=e.deletions;if(null!==n)for(var i=0;i<n.length;i++){var s=n[i],r=t,a=e,l=a;t:for(;null!==l;){switch(l.tag){case 27:if(pu(l.type)){El=l.stateNode,Cl=!1;break t}break;case 5:El=l.stateNode,Cl=!1;break t;case 3:case 4:El=l.stateNode.containerInfo,Cl=!0;break t}l=l.return}if(null===El)throw Error(o(160));Pl(r,a,s),El=null,Cl=!1,null!==(r=s.alternate)&&(r.return=null),s.return=null}if(13878&e.subtreeFlags)for(e=e.child;null!==e;)Dl(e,t),e=e.sibling}var Rl=null;function Dl(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Il(e,t),Ol(t),4&i&&(al(3,t,t.return),ol(3,t),al(5,t,t.return));break;case 1:Il(e,t),Ol(t),512&i&&(_l||null===n||ul(n,n.return)),64&i&&bl&&(null!==(t=t.updateQueue)&&(null!==(i=t.callbacks)&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=null===n?i:n.concat(i))));break;case 26:var s=Rl;if(Il(e,t),Ol(t),512&i&&(_l||null===n||ul(n,n.return)),4&i){var r=null!==n?n.memoizedState:null;if(i=t.memoizedState,null===n)if(null===i)if(null===t.stateNode){t:{i=t.type,n=t.memoizedProps,s=s.ownerDocument||s;e:switch(i){case"title":(!(r=s.getElementsByTagName("title")[0])||r[jt]||r[It]||"http://www.w3.org/2000/svg"===r.namespaceURI||r.hasAttribute("itemprop"))&&(r=s.createElement(i),s.head.insertBefore(r,s.querySelector("head > title"))),tu(r,i,n),r[It]=t,Vt(r),i=r;break t;case"link":var a=ju("link","href",s).get(i+(n.href||""));if(a)for(var l=0;l<a.length;l++)if((r=a[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&r.getAttribute("rel")===(null==n.rel?null:n.rel)&&r.getAttribute("title")===(null==n.title?null:n.title)&&r.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){a.splice(l,1);break e}tu(r=s.createElement(i),i,n),s.head.appendChild(r);break;case"meta":if(a=ju("meta","content",s).get(i+(n.content||"")))for(l=0;l<a.length;l++)if((r=a[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&r.getAttribute("name")===(null==n.name?null:n.name)&&r.getAttribute("property")===(null==n.property?null:n.property)&&r.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&r.getAttribute("charset")===(null==n.charSet?null:n.charSet)){a.splice(l,1);break e}tu(r=s.createElement(i),i,n),s.head.appendChild(r);break;default:throw Error(o(468,i))}r[It]=t,Vt(r),i=r}t.stateNode=i}else Bu(s,t.type,t.stateNode);else t.stateNode=Du(s,i,t.memoizedProps);else r!==i?(null===r?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):r.count--,null===i?Bu(s,t.type,t.stateNode):Du(s,i,t.memoizedProps)):null===i&&null!==t.stateNode&&pl(t,t.memoizedProps,n.memoizedProps)}break;case 27:Il(e,t),Ol(t),512&i&&(_l||null===n||ul(n,n.return)),null!==n&&4&i&&pl(t,t.memoizedProps,n.memoizedProps);break;case 5:if(Il(e,t),Ol(t),512&i&&(_l||null===n||ul(n,n.return)),32&t.flags){s=t.stateNode;try{xe(s,"")}catch(f){hh(t,t.return,f)}}4&i&&null!=t.stateNode&&pl(t,s=t.memoizedProps,null!==n?n.memoizedProps:s),1024&i&&(wl=!0);break;case 6:if(Il(e,t),Ol(t),4&i){if(null===t.stateNode)throw Error(o(162));i=t.memoizedProps,n=t.stateNode;try{n.nodeValue=i}catch(f){hh(t,t.return,f)}}break;case 3:if(Fu=null,s=Rl,Rl=Au(e.containerInfo),Il(e,t),Rl=s,Ol(t),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Cd(e.containerInfo)}catch(f){hh(t,t.return,f)}wl&&(wl=!1,Nl(t));break;case 4:i=Rl,Rl=Au(t.stateNode.containerInfo),Il(e,t),Ol(t),Rl=i;break;case 12:default:Il(e,t),Ol(t);break;case 13:Il(e,t),Ol(t),8192&t.child.flags&&null!==t.memoizedState!==(null!==n&&null!==n.memoizedState)&&(wc=et()),4&i&&(null!==(i=t.updateQueue)&&(t.updateQueue=null,Ml(t,i)));break;case 22:s=null!==t.memoizedState;var c=null!==n&&null!==n.memoizedState,h=bl,u=_l;if(bl=h||s,_l=u||c,Il(e,t),_l=u,bl=h,Ol(t),8192&i)t:for(e=t.stateNode,e._visibility=s?-2&e._visibility:1|e._visibility,s&&(null===n||c||bl||_l||Fl(t)),n=null,e=t;;){if(5===e.tag||26===e.tag){if(null===n){c=n=e;try{if(r=c.stateNode,s)"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,p=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(f){hh(c,c.return,f)}}}else if(6===e.tag){if(null===n){c=e;try{c.stateNode.nodeValue=s?"":c.memoizedProps}catch(f){hh(c,c.return,f)}}}else if((22!==e.tag&&23!==e.tag||null===e.memoizedState||e===t)&&null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break t;for(;null===e.sibling;){if(null===e.return||e.return===t)break t;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}4&i&&(null!==(i=t.updateQueue)&&(null!==(n=i.retryQueue)&&(i.retryQueue=null,Ml(t,n))));break;case 19:Il(e,t),Ol(t),4&i&&(null!==(i=t.updateQueue)&&(t.updateQueue=null,Ml(t,i)));case 30:case 21:}}function Ol(t){var e=t.flags;if(2&e){try{for(var n,i=t.return;null!==i;){if(fl(i)){n=i;break}i=i.return}if(null==n)throw Error(o(160));switch(n.tag){case 27:var s=n.stateNode;vl(t,gl(t),s);break;case 5:var r=n.stateNode;32&n.flags&&(xe(r,""),n.flags&=-33),vl(t,gl(t),r);break;case 3:case 4:var a=n.stateNode.containerInfo;ml(t,gl(t),a);break;default:throw Error(o(161))}}catch(l){hh(t,t.return,l)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function Nl(t){if(1024&t.subtreeFlags)for(t=t.child;null!==t;){var e=t;Nl(e),5===e.tag&&1024&e.flags&&e.stateNode.reset(),t=t.sibling}}function zl(t,e){if(8772&e.subtreeFlags)for(e=e.child;null!==e;)Al(t,e.alternate,e),e=e.sibling}function Fl(t){for(t=t.child;null!==t;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:al(4,e,e.return),Fl(e);break;case 1:ul(e,e.return);var n=e.stateNode;"function"===typeof n.componentWillUnmount&&cl(e,e.return,n),Fl(e);break;case 27:wu(e.stateNode);case 26:case 5:ul(e,e.return),Fl(e);break;case 22:null===e.memoizedState&&Fl(e);break;default:Fl(e)}t=t.sibling}}function jl(t,e,n){for(n=n&&0!==(8772&e.subtreeFlags),e=e.child;null!==e;){var i=e.alternate,s=t,r=e,o=r.flags;switch(r.tag){case 0:case 11:case 15:jl(s,r,n),ol(4,r);break;case 1:if(jl(s,r,n),"function"===typeof(s=(i=r).stateNode).componentDidMount)try{s.componentDidMount()}catch(c){hh(i,i.return,c)}if(null!==(s=(i=r).updateQueue)){var a=i.stateNode;try{var l=s.shared.hiddenCallbacks;if(null!==l)for(s.shared.hiddenCallbacks=null,s=0;s<l.length;s++)ur(l[s],a)}catch(c){hh(i,i.return,c)}}n&&64&o&&ll(r),hl(r,r.return);break;case 27:yl(r);case 26:case 5:jl(s,r,n),n&&null===i&&4&o&&dl(r),hl(r,r.return);break;case 12:jl(s,r,n);break;case 13:jl(s,r,n),n&&4&o&&Ll(s,r);break;case 22:null===r.memoizedState&&jl(s,r,n),hl(r,r.return);break;case 30:break;default:jl(s,r,n)}e=e.sibling}}function Bl(t,e){var n=null;null!==t&&null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(n=t.memoizedState.cachePool.pool),t=null,null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(t=e.memoizedState.cachePool.pool),t!==n&&(null!=t&&t.refCount++,null!=n&&Ds(n))}function Ul(t,e){t=null,null!==e.alternate&&(t=e.alternate.memoizedState.cache),(e=e.memoizedState.cache)!==t&&(e.refCount++,null!=t&&Ds(t))}function Hl(t,e,n,i){if(10256&e.subtreeFlags)for(e=e.child;null!==e;)$l(t,e,n,i),e=e.sibling}function $l(t,e,n,i){var s=e.flags;switch(e.tag){case 0:case 11:case 15:Hl(t,e,n,i),2048&s&&ol(9,e);break;case 1:case 13:default:Hl(t,e,n,i);break;case 3:Hl(t,e,n,i),2048&s&&(t=null,null!==e.alternate&&(t=e.alternate.memoizedState.cache),(e=e.memoizedState.cache)!==t&&(e.refCount++,null!=t&&Ds(t)));break;case 12:if(2048&s){Hl(t,e,n,i),t=e.stateNode;try{var r=e.memoizedProps,o=r.id,a=r.onPostCommit;"function"===typeof a&&a(o,null===e.alternate?"mount":"update",t.passiveEffectDuration,-0)}catch(l){hh(e,e.return,l)}}else Hl(t,e,n,i);break;case 23:break;case 22:r=e.stateNode,o=e.alternate,null!==e.memoizedState?2&r._visibility?Hl(t,e,n,i):Vl(t,e):2&r._visibility?Hl(t,e,n,i):(r._visibility|=2,Wl(t,e,n,i,0!==(10256&e.subtreeFlags))),2048&s&&Bl(o,e);break;case 24:Hl(t,e,n,i),2048&s&&Ul(e.alternate,e)}}function Wl(t,e,n,i,s){for(s=s&&0!==(10256&e.subtreeFlags),e=e.child;null!==e;){var r=t,o=e,a=n,l=i,c=o.flags;switch(o.tag){case 0:case 11:case 15:Wl(r,o,a,l,s),ol(8,o);break;case 23:break;case 22:var h=o.stateNode;null!==o.memoizedState?2&h._visibility?Wl(r,o,a,l,s):Vl(r,o):(h._visibility|=2,Wl(r,o,a,l,s)),s&&2048&c&&Bl(o.alternate,o);break;case 24:Wl(r,o,a,l,s),s&&2048&c&&Ul(o.alternate,o);break;default:Wl(r,o,a,l,s)}e=e.sibling}}function Vl(t,e){if(10256&e.subtreeFlags)for(e=e.child;null!==e;){var n=t,i=e,s=i.flags;switch(i.tag){case 22:Vl(n,i),2048&s&&Bl(i.alternate,i);break;case 24:Vl(n,i),2048&s&&Ul(i.alternate,i);break;default:Vl(n,i)}e=e.sibling}}var Gl=8192;function ql(t){if(t.subtreeFlags&Gl)for(t=t.child;null!==t;)Zl(t),t=t.sibling}function Zl(t){switch(t.tag){case 26:ql(t),t.flags&Gl&&null!==t.memoizedState&&function(t,e,n){if(null===Hu)throw Error(o(475));var i=Hu;if("stylesheet"===e.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&e.state.loading)){if(null===e.instance){var s=Pu(n.href),r=t.querySelector(Lu(s));if(r)return null!==(t=r._p)&&"object"===typeof t&&"function"===typeof t.then&&(i.count++,i=Wu.bind(i),t.then(i,i)),e.state.loading|=4,e.instance=r,void Vt(r);r=t.ownerDocument||t,n=Mu(n),(s=xu.get(s))&&Nu(n,s),Vt(r=r.createElement("link"));var a=r;a._p=new Promise(function(t,e){a.onload=t,a.onerror=e}),tu(r,"link",n),e.instance=r}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(e,t),(t=e.state.preload)&&0===(3&e.state.loading)&&(i.count++,e=Wu.bind(i),t.addEventListener("load",e),t.addEventListener("error",e))}}(Rl,t.memoizedState,t.memoizedProps);break;case 5:default:ql(t);break;case 3:case 4:var e=Rl;Rl=Au(t.stateNode.containerInfo),ql(t),Rl=e;break;case 22:null===t.memoizedState&&(null!==(e=t.alternate)&&null!==e.memoizedState?(e=Gl,Gl=16777216,ql(t),Gl=e):ql(t))}}function Kl(t){var e=t.alternate;if(null!==e&&null!==(t=e.child)){e.child=null;do{e=t.sibling,t.sibling=null,t=e}while(null!==t)}}function Xl(t){var e=t.deletions;if(0!==(16&t.flags)){if(null!==e)for(var n=0;n<e.length;n++){var i=e[n];Sl=i,Ql(i,t)}Kl(t)}if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Yl(t),t=t.sibling}function Yl(t){switch(t.tag){case 0:case 11:case 15:Xl(t),2048&t.flags&&al(9,t,t.return);break;case 3:case 12:default:Xl(t);break;case 22:var e=t.stateNode;null!==t.memoizedState&&2&e._visibility&&(null===t.return||13!==t.return.tag)?(e._visibility&=-3,Jl(t)):Xl(t)}}function Jl(t){var e=t.deletions;if(0!==(16&t.flags)){if(null!==e)for(var n=0;n<e.length;n++){var i=e[n];Sl=i,Ql(i,t)}Kl(t)}for(t=t.child;null!==t;){switch((e=t).tag){case 0:case 11:case 15:al(8,e,e.return),Jl(e);break;case 22:2&(n=e.stateNode)._visibility&&(n._visibility&=-3,Jl(e));break;default:Jl(e)}t=t.sibling}}function Ql(t,e){for(;null!==Sl;){var n=Sl;switch(n.tag){case 0:case 11:case 15:al(8,n,e);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:Ds(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,Sl=i;else t:for(n=t;null!==Sl;){var s=(i=Sl).sibling,r=i.return;if(kl(i),i===n){Sl=null;break t}if(null!==s){s.return=r,Sl=s;break t}Sl=r}}}var tc={getCacheForType:function(t){var e=Es(Is),n=e.data.get(t);return void 0===n&&(n=t(),e.data.set(t,n)),n}},ec="function"===typeof WeakMap?WeakMap:Map,nc=0,ic=null,sc=null,rc=0,oc=0,ac=null,lc=!1,cc=!1,hc=!1,uc=0,dc=0,pc=0,fc=0,gc=0,mc=0,vc=0,yc=null,bc=null,_c=!1,wc=0,xc=1/0,Sc=null,Ac=null,kc=0,Ec=null,Cc=null,Tc=0,Pc=0,Lc=null,Mc=null,Ic=0,Rc=null;function Dc(){if(0!==(2&nc)&&0!==rc)return rc&-rc;if(null!==D.T){return 0!==zs?zs:Ph()}return Lt()}function Oc(){0===mc&&(mc=0===(536870912&rc)||rs?xt():536870912);var t=sa.current;return null!==t&&(t.flags|=32),mc}function Nc(t,e,n){(t!==ic||2!==oc&&9!==oc)&&null===t.cancelPendingCommit||($c(t,0),Bc(t,rc,mc,!1)),kt(t,n),0!==(2&nc)&&t===ic||(t===ic&&(0===(2&nc)&&(fc|=n),4===dc&&Bc(t,rc,mc,!1)),xh(t))}function zc(t,e,n){if(0!==(6&nc))throw Error(o(327));for(var i=!n&&0===(124&e)&&0===(e&t.expiredLanes)||_t(t,e),s=i?function(t,e){var n=nc;nc|=2;var i=Vc(),s=Gc();ic!==t||rc!==e?(Sc=null,xc=et()+500,$c(t,e)):cc=_t(t,e);t:for(;;)try{if(0!==oc&&null!==sc){e=sc;var r=ac;e:switch(oc){case 1:oc=0,ac=null,Qc(t,e,r,1);break;case 2:case 9:if(Ks(r)){oc=0,ac=null,Jc(e);break}e=function(){2!==oc&&9!==oc||ic!==t||(oc=7),xh(t)},r.then(e,e);break t;case 3:oc=7;break t;case 4:oc=5;break t;case 7:Ks(r)?(oc=0,ac=null,Jc(e)):(oc=0,ac=null,Qc(t,e,r,7));break;case 5:var a=null;switch(sc.tag){case 26:a=sc.memoizedState;case 5:case 27:var l=sc;if(!a||Uu(a)){oc=0,ac=null;var c=l.sibling;if(null!==c)sc=c;else{var h=l.return;null!==h?(sc=h,th(h)):sc=null}break e}}oc=0,ac=null,Qc(t,e,r,5);break;case 6:oc=0,ac=null,Qc(t,e,r,6);break;case 8:Hc(),dc=6;break t;default:throw Error(o(462))}}Xc();break}catch(u){Wc(t,u)}return ys=vs=null,D.H=i,D.A=s,nc=n,null!==sc?0:(ic=null,rc=0,Ti(),dc)}(t,e):Zc(t,e,!0),r=i;;){if(0===s){cc&&!i&&Bc(t,e,0,!1);break}if(n=t.current.alternate,!r||jc(n)){if(2===s){if(r=e,t.errorRecoveryDisabledLanes&r)var a=0;else a=0!==(a=-536870913&t.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){e=a;t:{var l=t;s=yc;var c=l.current.memoizedState.isDehydrated;if(c&&($c(l,a).flags|=256),2!==(a=Zc(l,a,!1))){if(hc&&!c){l.errorRecoveryDisabledLanes|=r,fc|=r,s=4;break t}r=bc,bc=s,null!==r&&(null===bc?bc=r:bc.push.apply(bc,r))}s=a}if(r=!1,2!==s)continue}}if(1===s){$c(t,0),Bc(t,e,0,!0);break}t:{switch(i=t,r=s){case 0:case 1:throw Error(o(345));case 4:if((4194048&e)!==e)break;case 6:Bc(i,e,mc,!lc);break t;case 2:bc=null;break;case 3:case 5:break;default:throw Error(o(329))}if((62914560&e)===e&&10<(s=wc+300-et())){if(Bc(i,e,mc,!lc),0!==bt(i,0,!0))break t;i.timeoutHandle=lu(Fc.bind(null,i,n,bc,Sc,_c,e,mc,fc,vc,lc,r,2,-0,0),s)}else Fc(i,n,bc,Sc,_c,e,mc,fc,vc,lc,r,0,-0,0)}break}s=Zc(t,e,!1),r=!1}xh(t)}function Fc(t,e,n,i,s,r,a,l,c,h,u,d,p,f){if(t.timeoutHandle=-1,(8192&(d=e.subtreeFlags)||16785408===(16785408&d))&&(Hu={stylesheets:null,count:0,unsuspend:$u},Zl(e),null!==(d=function(){if(null===Hu)throw Error(o(475));var t=Hu;return t.stylesheets&&0===t.count&&Gu(t,t.stylesheets),0<t.count?function(e){var n=setTimeout(function(){if(t.stylesheets&&Gu(t,t.stylesheets),t.unsuspend){var e=t.unsuspend;t.unsuspend=null,e()}},6e4);return t.unsuspend=e,function(){t.unsuspend=null,clearTimeout(n)}}:null}())))return t.cancelPendingCommit=d(nh.bind(null,t,e,r,n,i,s,a,l,c,u,1,p,f)),void Bc(t,r,a,!h);nh(t,e,r,n,i,s,a,l,c)}function jc(t){for(var e=t;;){var n=e.tag;if((0===n||11===n||15===n)&&16384&e.flags&&(null!==(n=e.updateQueue)&&null!==(n=n.stores)))for(var i=0;i<n.length;i++){var s=n[i],r=s.getSnapshot;s=s.value;try{if(!Kn(r(),s))return!1}catch(o){return!1}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Bc(t,e,n,i){e&=~gc,e&=~fc,t.suspendedLanes|=e,t.pingedLanes&=~e,i&&(t.warmLanes|=e),i=t.expirationTimes;for(var s=e;0<s;){var r=31-pt(s),o=1<<r;i[r]=-1,s&=~o}0!==n&&Et(t,n,e)}function Uc(){return 0!==(6&nc)||(Sh(0,!1),!1)}function Hc(){if(null!==sc){if(0===oc)var t=sc.return;else ys=vs=null,zr(t=sc),Ko=null,Xo=0,t=sc;for(;null!==t;)rl(t.alternate,t),t=t.return;sc=null}}function $c(t,e){var n=t.timeoutHandle;-1!==n&&(t.timeoutHandle=-1,cu(n)),null!==(n=t.cancelPendingCommit)&&(t.cancelPendingCommit=null,n()),Hc(),ic=t,sc=n=Fi(t.current,null),rc=e,oc=0,ac=null,lc=!1,cc=_t(t,e),hc=!1,vc=mc=gc=fc=pc=dc=0,bc=yc=null,_c=!1,0!==(8&e)&&(e|=32&e);var i=t.entangledLanes;if(0!==i)for(t=t.entanglements,i&=e;0<i;){var s=31-pt(i),r=1<<s;e|=t[s],i&=~r}return uc=e,Ti(),n}function Wc(t,e){br=null,D.H=Vo,e===Vs||e===qs?(e=Qs(),oc=3):e===Gs?(e=Qs(),oc=4):oc=e===Ea?8:null!==e&&"object"===typeof e&&"function"===typeof e.then?6:1,ac=e,null===sc&&(dc=1,wa(t,Ai(e,t.current)))}function Vc(){var t=D.H;return D.H=Vo,null===t?Vo:t}function Gc(){var t=D.A;return D.A=tc,t}function qc(){dc=4,lc||(4194048&rc)!==rc&&null!==sa.current||(cc=!0),0===(134217727&pc)&&0===(134217727&fc)||null===ic||Bc(ic,rc,mc,!1)}function Zc(t,e,n){var i=nc;nc|=2;var s=Vc(),r=Gc();ic===t&&rc===e||(Sc=null,$c(t,e)),e=!1;var o=dc;t:for(;;)try{if(0!==oc&&null!==sc){var a=sc,l=ac;switch(oc){case 8:Hc(),o=6;break t;case 3:case 2:case 9:case 6:null===sa.current&&(e=!0);var c=oc;if(oc=0,ac=null,Qc(t,a,l,c),n&&cc){o=0;break t}break;default:c=oc,oc=0,ac=null,Qc(t,a,l,c)}}Kc(),o=dc;break}catch(h){Wc(t,h)}return e&&t.shellSuspendCounter++,ys=vs=null,nc=i,D.H=s,D.A=r,null===sc&&(ic=null,rc=0,Ti()),o}function Kc(){for(;null!==sc;)Yc(sc)}function Xc(){for(;null!==sc&&!Q();)Yc(sc)}function Yc(t){var e=Ya(t.alternate,t,uc);t.memoizedProps=t.pendingProps,null===e?th(t):sc=e}function Jc(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=Na(n,e,e.pendingProps,e.type,void 0,rc);break;case 11:e=Na(n,e,e.pendingProps,e.type.render,e.ref,rc);break;case 5:zr(e);default:rl(n,e),e=Ya(n,e=sc=ji(e,uc),uc)}t.memoizedProps=t.pendingProps,null===e?th(t):sc=e}function Qc(t,e,n,i){ys=vs=null,zr(e),Ko=null,Xo=0;var s=e.return;try{if(function(t,e,n,i,s){if(n.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){if(null!==(e=n.alternate)&&Ss(e,n,s,!0),null!==(n=sa.current)){switch(n.tag){case 13:return null===ra?qc():null===n.alternate&&0===dc&&(dc=3),n.flags&=-257,n.flags|=65536,n.lanes=s,i===Zs?n.flags|=16384:(null===(e=n.updateQueue)?n.updateQueue=new Set([i]):e.add(i),uh(t,i,s)),!1;case 22:return n.flags|=65536,i===Zs?n.flags|=16384:(null===(e=n.updateQueue)?(e={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=e):null===(n=e.retryQueue)?e.retryQueue=new Set([i]):n.add(i),uh(t,i,s)),!1}throw Error(o(435,n.tag))}return uh(t,i,s),qc(),!1}if(rs)return null!==(e=sa.current)?(0===(65536&e.flags)&&(e.flags|=256),e.flags|=65536,e.lanes=s,i!==ls&&gs(Ai(t=Error(o(422),{cause:i}),n))):(i!==ls&&gs(Ai(e=Error(o(423),{cause:i}),n)),(t=t.current.alternate).flags|=65536,s&=-s,t.lanes|=s,i=Ai(i,n),ar(t,s=Sa(t.stateNode,i,s)),4!==dc&&(dc=2)),!1;var r=Error(o(520),{cause:i});if(r=Ai(r,n),null===yc?yc=[r]:yc.push(r),4!==dc&&(dc=2),null===e)return!0;i=Ai(i,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=s&-s,n.lanes|=t,ar(n,t=Sa(n.stateNode,i,t)),!1;case 1:if(e=n.type,r=n.stateNode,0===(128&n.flags)&&("function"===typeof e.getDerivedStateFromError||null!==r&&"function"===typeof r.componentDidCatch&&(null===Ac||!Ac.has(r))))return n.flags|=65536,s&=-s,n.lanes|=s,ka(s=Aa(s),t,n,i),ar(n,s),!1}n=n.return}while(null!==n);return!1}(t,s,e,n,rc))return dc=1,wa(t,Ai(n,t.current)),void(sc=null)}catch(r){if(null!==s)throw sc=s,r;return dc=1,wa(t,Ai(n,t.current)),void(sc=null)}32768&e.flags?(rs||1===i?t=!0:cc||0!==(536870912&rc)?t=!1:(lc=t=!0,(2===i||9===i||3===i||6===i)&&(null!==(i=sa.current)&&13===i.tag&&(i.flags|=16384))),eh(e,t)):th(e)}function th(t){var e=t;do{if(0!==(32768&e.flags))return void eh(e,lc);t=e.return;var n=il(e.alternate,e,uc);if(null!==n)return void(sc=n);if(null!==(e=e.sibling))return void(sc=e);sc=e=t}while(null!==e);0===dc&&(dc=5)}function eh(t,e){do{var n=sl(t.alternate,t);if(null!==n)return n.flags&=32767,void(sc=n);if(null!==(n=t.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&null!==(t=t.sibling))return void(sc=t);sc=t=n}while(null!==t);dc=6,sc=null}function nh(t,e,n,i,s,r,a,l,c){t.cancelPendingCommit=null;do{ah()}while(0!==kc);if(0!==(6&nc))throw Error(o(327));if(null!==e){if(e===t.current)throw Error(o(177));if(r=e.lanes|e.childLanes,function(t,e,n,i,s,r){var o=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var a=t.entanglements,l=t.expirationTimes,c=t.hiddenUpdates;for(n=o&~n;0<n;){var h=31-pt(n),u=1<<h;a[h]=0,l[h]=-1;var d=c[h];if(null!==d)for(c[h]=null,h=0;h<d.length;h++){var p=d[h];null!==p&&(p.lane&=-536870913)}n&=~u}0!==i&&Et(t,i,0),0!==r&&0===s&&0!==t.tag&&(t.suspendedLanes|=r&~(o&~e))}(t,n,r|=Ci,a,l,c),t===ic&&(sc=ic=null,rc=0),Cc=e,Ec=t,Tc=n,Pc=r,Lc=s,Mc=i,0!==(10256&e.subtreeFlags)||0!==(10256&e.flags)?(t.callbackNode=null,t.callbackPriority=0,Y(rt,function(){return lh(),null})):(t.callbackNode=null,t.callbackPriority=0),i=0!==(13878&e.flags),0!==(13878&e.subtreeFlags)||i){i=D.T,D.T=null,s=O.p,O.p=2,a=nc,nc|=4;try{!function(t,e){if(t=t.containerInfo,eu=nd,ei(t=ti(t))){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var i=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var s=i.anchorOffset,r=i.focusNode;i=i.focusOffset;try{n.nodeType,r.nodeType}catch(m){n=null;break t}var a=0,l=-1,c=-1,h=0,u=0,d=t,p=null;e:for(;;){for(var f;d!==n||0!==s&&3!==d.nodeType||(l=a+s),d!==r||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===t)break e;if(p===n&&++h===s&&(l=a),p===r&&++u===i&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nu={focusedElem:t,selectionRange:n},nd=!1,Sl=e;null!==Sl;)if(t=(e=Sl).child,0!==(1024&e.subtreeFlags)&&null!==t)t.return=e,Sl=t;else for(;null!==Sl;){switch(r=(e=Sl).alternate,t=e.flags,e.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&t)&&null!==r){t=void 0,n=e,s=r.memoizedProps,r=r.memoizedState,i=n.stateNode;try{var g=ma(n.type,s,(n.elementType,n.type));t=i.getSnapshotBeforeUpdate(g,r),i.__reactInternalSnapshotBeforeUpdate=t}catch(v){hh(n,n.return,v)}}break;case 3:if(0!==(1024&t))if(9===(n=(t=e.stateNode.containerInfo).nodeType))gu(t);else if(1===n)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":gu(t);break;default:t.textContent=""}break;default:if(0!==(1024&t))throw Error(o(163))}if(null!==(t=e.sibling)){t.return=e.return,Sl=t;break}Sl=e.return}}(t,e)}finally{nc=a,O.p=s,D.T=i}}kc=1,ih(),sh(),rh()}}function ih(){if(1===kc){kc=0;var t=Ec,e=Cc,n=0!==(13878&e.flags);if(0!==(13878&e.subtreeFlags)||n){n=D.T,D.T=null;var i=O.p;O.p=2;var s=nc;nc|=4;try{Dl(e,t);var r=nu,o=ti(t.containerInfo),a=r.focusedElem,l=r.selectionRange;if(o!==a&&a&&a.ownerDocument&&Qn(a.ownerDocument.documentElement,a)){if(null!==l&&ei(a)){var c=l.start,h=l.end;if(void 0===h&&(h=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(h,a.value.length);else{var u=a.ownerDocument||document,d=u&&u.defaultView||window;if(d.getSelection){var p=d.getSelection(),f=a.textContent.length,g=Math.min(l.start,f),m=void 0===l.end?g:Math.min(l.end,f);!p.extend&&g>m&&(o=m,m=g,g=o);var v=Jn(a,g),y=Jn(a,m);if(v&&y&&(1!==p.rangeCount||p.anchorNode!==v.node||p.anchorOffset!==v.offset||p.focusNode!==y.node||p.focusOffset!==y.offset)){var b=u.createRange();b.setStart(v.node,v.offset),p.removeAllRanges(),g>m?(p.addRange(b),p.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),p.addRange(b))}}}}for(u=[],p=a;p=p.parentNode;)1===p.nodeType&&u.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof a.focus&&a.focus(),a=0;a<u.length;a++){var _=u[a];_.element.scrollLeft=_.left,_.element.scrollTop=_.top}}nd=!!eu,nu=eu=null}finally{nc=s,O.p=i,D.T=n}}t.current=e,kc=2}}function sh(){if(2===kc){kc=0;var t=Ec,e=Cc,n=0!==(8772&e.flags);if(0!==(8772&e.subtreeFlags)||n){n=D.T,D.T=null;var i=O.p;O.p=2;var s=nc;nc|=4;try{Al(t,e.alternate,e)}finally{nc=s,O.p=i,D.T=n}}kc=3}}function rh(){if(4===kc||3===kc){kc=0,tt();var t=Ec,e=Cc,n=Tc,i=Mc;0!==(10256&e.subtreeFlags)||0!==(10256&e.flags)?kc=5:(kc=0,Cc=Ec=null,oh(t,t.pendingLanes));var s=t.pendingLanes;if(0===s&&(Ac=null),Pt(n),e=e.stateNode,ut&&"function"===typeof ut.onCommitFiberRoot)try{ut.onCommitFiberRoot(ht,e,void 0,128===(128&e.current.flags))}catch(l){}if(null!==i){e=D.T,s=O.p,O.p=2,D.T=null;try{for(var r=t.onRecoverableError,o=0;o<i.length;o++){var a=i[o];r(a.value,{componentStack:a.stack})}}finally{D.T=e,O.p=s}}0!==(3&Tc)&&ah(),xh(t),s=t.pendingLanes,0!==(4194090&n)&&0!==(42&s)?t===Rc?Ic++:(Ic=0,Rc=t):Ic=0,Sh(0,!1)}}function oh(t,e){0===(t.pooledCacheLanes&=e)&&(null!=(e=t.pooledCache)&&(t.pooledCache=null,Ds(e)))}function ah(t){return ih(),sh(),rh(),lh()}function lh(){if(5!==kc)return!1;var t=Ec,e=Pc;Pc=0;var n=Pt(Tc),i=D.T,s=O.p;try{O.p=32>n?32:n,D.T=null,n=Lc,Lc=null;var r=Ec,a=Tc;if(kc=0,Cc=Ec=null,Tc=0,0!==(6&nc))throw Error(o(331));var l=nc;if(nc|=4,Yl(r.current),$l(r,r.current,a,n),nc=l,Sh(0,!1),ut&&"function"===typeof ut.onPostCommitFiberRoot)try{ut.onPostCommitFiberRoot(ht,r)}catch(c){}return!0}finally{O.p=s,D.T=i,oh(t,e)}}function ch(t,e,n){e=Ai(n,e),null!==(t=rr(t,e=Sa(t.stateNode,e,2),2))&&(kt(t,2),xh(t))}function hh(t,e,n){if(3===t.tag)ch(t,t,n);else for(;null!==e;){if(3===e.tag){ch(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Ac||!Ac.has(i))){t=Ai(n,t),null!==(i=rr(e,n=Aa(2),2))&&(ka(n,i,e,t),kt(i,2),xh(i));break}}e=e.return}}function uh(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new ec;var s=new Set;i.set(e,s)}else void 0===(s=i.get(e))&&(s=new Set,i.set(e,s));s.has(n)||(hc=!0,s.add(n),t=dh.bind(null,t,e,n),e.then(t,t))}function dh(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,ic===t&&(rc&n)===n&&(4===dc||3===dc&&(62914560&rc)===rc&&300>et()-wc?0===(2&nc)&&$c(t,0):gc|=n,vc===rc&&(vc=0)),xh(t)}function ph(t,e){0===e&&(e=St()),null!==(t=Mi(t,e))&&(kt(t,e),xh(t))}function fh(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),ph(t,n)}function gh(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,s=t.memoizedState;null!==s&&(n=s.retryLane);break;case 19:i=t.stateNode;break;case 22:i=t.stateNode._retryCache;break;default:throw Error(o(314))}null!==i&&i.delete(e),ph(t,n)}var mh=null,vh=null,yh=!1,bh=!1,_h=!1,wh=0;function xh(t){t!==vh&&null===t.next&&(null===vh?mh=vh=t:vh=vh.next=t),bh=!0,yh||(yh=!0,uu(function(){0!==(6&nc)?Y(it,Ah):kh()}))}function Sh(t,e){if(!_h&&bh){_h=!0;do{for(var n=!1,i=mh;null!==i;){if(!e)if(0!==t){var s=i.pendingLanes;if(0===s)var r=0;else{var o=i.suspendedLanes,a=i.pingedLanes;r=(1<<31-pt(42|t)+1)-1,r=201326741&(r&=s&~(o&~a))?201326741&r|1:r?2|r:0}0!==r&&(n=!0,Th(i,r))}else r=rc,0===(3&(r=bt(i,i===ic?r:0,null!==i.cancelPendingCommit||-1!==i.timeoutHandle)))||_t(i,r)||(n=!0,Th(i,r));i=i.next}}while(n);_h=!1}}function Ah(){kh()}function kh(){bh=yh=!1;var t=0;0!==wh&&(function(){var t=window.event;if(t&&"popstate"===t.type)return t!==au&&(au=t,!0);return au=null,!1}()&&(t=wh),wh=0);for(var e=et(),n=null,i=mh;null!==i;){var s=i.next,r=Eh(i,e);0===r?(i.next=null,null===n?mh=s:n.next=s,null===s&&(vh=n)):(n=i,(0!==t||0!==(3&r))&&(bh=!0)),i=s}Sh(t,!1)}function Eh(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,s=t.expirationTimes,r=-62914561&t.pendingLanes;0<r;){var o=31-pt(r),a=1<<o,l=s[o];-1===l?0!==(a&n)&&0===(a&i)||(s[o]=wt(a,e)):l<=e&&(t.expiredLanes|=a),r&=~a}if(n=rc,n=bt(t,t===(e=ic)?n:0,null!==t.cancelPendingCommit||-1!==t.timeoutHandle),i=t.callbackNode,0===n||t===e&&(2===oc||9===oc)||null!==t.cancelPendingCommit)return null!==i&&null!==i&&J(i),t.callbackNode=null,t.callbackPriority=0;if(0===(3&n)||_t(t,n)){if((e=n&-n)===t.callbackPriority)return e;switch(null!==i&&J(i),Pt(n)){case 2:case 8:n=st;break;case 32:default:n=rt;break;case 268435456:n=at}return i=Ch.bind(null,t),n=Y(n,i),t.callbackPriority=e,t.callbackNode=n,e}return null!==i&&null!==i&&J(i),t.callbackPriority=2,t.callbackNode=null,2}function Ch(t,e){if(0!==kc&&5!==kc)return t.callbackNode=null,t.callbackPriority=0,null;var n=t.callbackNode;if(ah()&&t.callbackNode!==n)return null;var i=rc;return 0===(i=bt(t,t===ic?i:0,null!==t.cancelPendingCommit||-1!==t.timeoutHandle))?null:(zc(t,i,e),Eh(t,et()),null!=t.callbackNode&&t.callbackNode===n?Ch.bind(null,t):null)}function Th(t,e){if(ah())return null;zc(t,e,!0)}function Ph(){return 0===wh&&(wh=xt()),wh}function Lh(t){return null==t||"symbol"===typeof t||"boolean"===typeof t?null:"function"===typeof t?t:Pe(""+t)}function Mh(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}for(var Ih=0;Ih<wi.length;Ih++){var Rh=wi[Ih];xi(Rh.toLowerCase(),"on"+(Rh[0].toUpperCase()+Rh.slice(1)))}xi(pi,"onAnimationEnd"),xi(fi,"onAnimationIteration"),xi(gi,"onAnimationStart"),xi("dblclick","onDoubleClick"),xi("focusin","onFocus"),xi("focusout","onBlur"),xi(mi,"onTransitionRun"),xi(vi,"onTransitionStart"),xi(yi,"onTransitionCancel"),xi(bi,"onTransitionEnd"),Kt("onMouseEnter",["mouseout","mouseover"]),Kt("onMouseLeave",["mouseout","mouseover"]),Kt("onPointerEnter",["pointerout","pointerover"]),Kt("onPointerLeave",["pointerout","pointerover"]),Zt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Zt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Zt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Zt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Zt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Zt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Dh));function Nh(t,e){e=0!==(4&e);for(var n=0;n<t.length;n++){var i=t[n],s=i.event;i=i.listeners;t:{var r=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==r&&s.isPropagationStopped())break t;r=a,s.currentTarget=c;try{r(s)}catch(h){va(h)}s.currentTarget=null,r=l}else for(o=0;o<i.length;o++){if(l=(a=i[o]).instance,c=a.currentTarget,a=a.listener,l!==r&&s.isPropagationStopped())break t;r=a,s.currentTarget=c;try{r(s)}catch(h){va(h)}s.currentTarget=null,r=l}}}}function zh(t,e){var n=e[Ot];void 0===n&&(n=e[Ot]=new Set);var i=t+"__bubble";n.has(i)||(Uh(e,t,2,!1),n.add(i))}function Fh(t,e,n){var i=0;e&&(i|=4),Uh(n,t,i,e)}var jh="_reactListening"+Math.random().toString(36).slice(2);function Bh(t){if(!t[jh]){t[jh]=!0,Gt.forEach(function(e){"selectionchange"!==e&&(Oh.has(e)||Fh(e,!1,t),Fh(e,!0,t))});var e=9===t.nodeType?t:t.ownerDocument;null===e||e[jh]||(e[jh]=!0,Fh("selectionchange",!1,e))}}function Uh(t,e,n,i){switch(cd(e)){case 2:var s=id;break;case 8:s=sd;break;default:s=rd}n=s.bind(null,e,n,t),s=void 0,!je||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(s=!0),i?void 0!==s?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):void 0!==s?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Hh(t,e,n,i,s){var r=i;if(0===(1&e)&&0===(2&e)&&null!==i)t:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var a=i.stateNode.containerInfo;if(a===s)break;if(4===o)for(o=i.return;null!==o;){var c=o.tag;if((3===c||4===c)&&o.stateNode.containerInfo===s)return;o=o.return}for(;null!==a;){if(null===(o=Ut(a)))return;if(5===(c=o.tag)||6===c||26===c||27===c){i=r=o;continue t}a=a.parentNode}}i=i.return}Ne(function(){var i=r,s=Me(n),o=[];t:{var a=_i.get(t);if(void 0!==a){var c=Qe,h=t;switch(t){case"keypress":if(0===Ve(n))break t;case"keydown":case"keyup":c=gn;break;case"focusin":h="focus",c=on;break;case"focusout":h="blur",c=on;break;case"beforeblur":case"afterblur":c=on;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=sn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=rn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=vn;break;case pi:case fi:case gi:c=an;break;case bi:c=yn;break;case"scroll":case"scrollend":c=en;break;case"wheel":c=bn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=mn;break;case"toggle":case"beforetoggle":c=_n}var u=0!==(4&e),d=!u&&("scroll"===t||"scrollend"===t),p=u?null!==a?a+"Capture":null:a;u=[];for(var f,g=i;null!==g;){var m=g;if(f=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===f||null===p||null!=(m=ze(g,p))&&u.push($h(g,m,f)),d)break;g=g.return}0<u.length&&(a=new c(a,h,null,n,s),o.push({event:a,listeners:u}))}}if(0===(7&e)){if(c="mouseout"===t||"pointerout"===t,(!(a="mouseover"===t||"pointerover"===t)||n===Le||!(h=n.relatedTarget||n.fromElement)||!Ut(h)&&!h[Dt])&&(c||a)&&(a=s.window===s?s:(a=s.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=i,null!==(h=(h=n.relatedTarget||n.toElement)?Ut(h):null)&&(d=l(h),u=h.tag,h!==d||5!==u&&27!==u&&6!==u)&&(h=null)):(c=null,h=i),c!==h)){if(u=sn,m="onMouseLeave",p="onMouseEnter",g="mouse","pointerout"!==t&&"pointerover"!==t||(u=mn,m="onPointerLeave",p="onPointerEnter",g="pointer"),d=null==c?a:$t(c),f=null==h?a:$t(h),(a=new u(m,g+"leave",c,n,s)).target=d,a.relatedTarget=f,m=null,Ut(s)===i&&((u=new u(p,g+"enter",h,n,s)).target=f,u.relatedTarget=d,m=u),d=m,c&&h)t:{for(p=h,g=0,f=u=c;f;f=Vh(f))g++;for(f=0,m=p;m;m=Vh(m))f++;for(;0<g-f;)u=Vh(u),g--;for(;0<f-g;)p=Vh(p),f--;for(;g--;){if(u===p||null!==p&&u===p.alternate)break t;u=Vh(u),p=Vh(p)}u=null}else u=null;null!==c&&Gh(o,a,c,u,!1),null!==h&&null!==d&&Gh(o,d,h,u,!0)}if("select"===(c=(a=i?$t(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var v=Fn;else if(In(a))if(jn)v=Zn;else{v=Gn;var y=Vn}else!(c=a.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type?i&&Ee(i.elementType)&&(v=Fn):v=qn;switch(v&&(v=v(t,i))?Rn(o,v,n,s):(y&&y(t,a,i),"focusout"===t&&i&&"number"===a.type&&null!=i.memoizedProps.value&&ye(a,"number",a.value)),y=i?$t(i):window,t){case"focusin":(In(y)||"true"===y.contentEditable)&&(ii=y,si=i,ri=null);break;case"focusout":ri=si=ii=null;break;case"mousedown":oi=!0;break;case"contextmenu":case"mouseup":case"dragend":oi=!1,ai(o,n,s);break;case"selectionchange":if(ni)break;case"keydown":case"keyup":ai(o,n,s)}var b;if(xn)t:{switch(t){case"compositionstart":var _="onCompositionStart";break t;case"compositionend":_="onCompositionEnd";break t;case"compositionupdate":_="onCompositionUpdate";break t}_=void 0}else Ln?Tn(t,n)&&(_="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(_="onCompositionStart");_&&(kn&&"ko"!==n.locale&&(Ln||"onCompositionStart"!==_?"onCompositionEnd"===_&&Ln&&(b=We()):(He="value"in(Ue=s)?Ue.value:Ue.textContent,Ln=!0)),0<(y=Wh(i,_)).length&&(_=new cn(_,t,null,n,s),o.push({event:_,listeners:y}),b?_.data=b:null!==(b=Pn(n))&&(_.data=b))),(b=An?function(t,e){switch(t){case"compositionend":return Pn(e);case"keypress":return 32!==e.which?null:(Cn=!0,En);case"textInput":return(t=e.data)===En&&Cn?null:t;default:return null}}(t,n):function(t,e){if(Ln)return"compositionend"===t||!xn&&Tn(t,e)?(t=We(),$e=He=Ue=null,Ln=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return kn&&"ko"!==e.locale?null:e.data}}(t,n))&&(0<(_=Wh(i,"onBeforeInput")).length&&(y=new cn("onBeforeInput","beforeinput",null,n,s),o.push({event:y,listeners:_}),y.data=b)),function(t,e,n,i,s){if("submit"===e&&n&&n.stateNode===s){var r=Lh((s[Rt]||null).action),o=i.submitter;o&&null!==(e=(e=o[Rt]||null)?Lh(e.formAction):o.getAttribute("formAction"))&&(r=e,o=null);var a=new Qe("action","action",null,i,s);t.push({event:a,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==wh){var t=o?Mh(s,o):new FormData(s);Mo(n,{pending:!0,data:t,method:s.method,action:r},null,t)}}else"function"===typeof r&&(a.preventDefault(),t=o?Mh(s,o):new FormData(s),Mo(n,{pending:!0,data:t,method:s.method,action:r},r,t))},currentTarget:s}]})}}(o,t,i,n,s)}Nh(o,e)})}function $h(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Wh(t,e){for(var n=e+"Capture",i=[];null!==t;){var s=t,r=s.stateNode;if(5!==(s=s.tag)&&26!==s&&27!==s||null===r||(null!=(s=ze(t,n))&&i.unshift($h(t,s,r)),null!=(s=ze(t,e))&&i.push($h(t,s,r))),3===t.tag)return i;t=t.return}return[]}function Vh(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag&&27!==t.tag);return t||null}function Gh(t,e,n,i,s){for(var r=e._reactName,o=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===i)break;5!==a&&26!==a&&27!==a||null===c||(l=c,s?null!=(c=ze(n,r))&&o.unshift($h(n,c,l)):s||null!=(c=ze(n,r))&&o.push($h(n,c,l))),n=n.return}0!==o.length&&t.push({event:e,listeners:o})}var qh=/\r\n?/g,Zh=/\u0000|\uFFFD/g;function Kh(t){return("string"===typeof t?t:""+t).replace(qh,"\n").replace(Zh,"")}function Xh(t,e){return e=Kh(e),Kh(t)===e}function Yh(){}function Jh(t,e,n,i,s,r){switch(n){case"children":"string"===typeof i?"body"===e||"textarea"===e&&""===i||xe(t,i):("number"===typeof i||"bigint"===typeof i)&&"body"!==e&&xe(t,""+i);break;case"className":ne(t,"class",i);break;case"tabIndex":ne(t,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":ne(t,n,i);break;case"style":ke(t,i,r);break;case"data":if("object"!==e){ne(t,"data",i);break}case"src":case"href":if(""===i&&("a"!==e||"href"!==n)){t.removeAttribute(n);break}if(null==i||"function"===typeof i||"symbol"===typeof i||"boolean"===typeof i){t.removeAttribute(n);break}i=Pe(""+i),t.setAttribute(n,i);break;case"action":case"formAction":if("function"===typeof i){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof r&&("formAction"===n?("input"!==e&&Jh(t,e,"name",s.name,s,null),Jh(t,e,"formEncType",s.formEncType,s,null),Jh(t,e,"formMethod",s.formMethod,s,null),Jh(t,e,"formTarget",s.formTarget,s,null)):(Jh(t,e,"encType",s.encType,s,null),Jh(t,e,"method",s.method,s,null),Jh(t,e,"target",s.target,s,null))),null==i||"symbol"===typeof i||"boolean"===typeof i){t.removeAttribute(n);break}i=Pe(""+i),t.setAttribute(n,i);break;case"onClick":null!=i&&(t.onclick=Yh);break;case"onScroll":null!=i&&zh("scroll",t);break;case"onScrollEnd":null!=i&&zh("scrollend",t);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(o(61));if(null!=(n=i.__html)){if(null!=s.children)throw Error(o(60));t.innerHTML=n}}break;case"multiple":t.multiple=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"muted":t.muted=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"===typeof i||"boolean"===typeof i||"symbol"===typeof i){t.removeAttribute("xlink:href");break}n=Pe(""+i),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!==typeof i&&"symbol"!==typeof i?t.setAttribute(n,""+i):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!==typeof i&&"symbol"!==typeof i?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":!0===i?t.setAttribute(n,""):!1!==i&&null!=i&&"function"!==typeof i&&"symbol"!==typeof i?t.setAttribute(n,i):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&!isNaN(i)&&1<=i?t.setAttribute(n,i):t.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"===typeof i||"symbol"===typeof i||isNaN(i)?t.removeAttribute(n):t.setAttribute(n,i);break;case"popover":zh("beforetoggle",t),zh("toggle",t),ee(t,"popover",i);break;case"xlinkActuate":ie(t,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":ie(t,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":ie(t,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":ie(t,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":ie(t,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":ie(t,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":ie(t,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":ie(t,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":ie(t,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":ee(t,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&ee(t,n=Ce.get(n)||n,i)}}function Qh(t,e,n,i,s,r){switch(n){case"style":ke(t,i,r);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(o(61));if(null!=(n=i.__html)){if(null!=s.children)throw Error(o(60));t.innerHTML=n}}break;case"children":"string"===typeof i?xe(t,i):("number"===typeof i||"bigint"===typeof i)&&xe(t,""+i);break;case"onScroll":null!=i&&zh("scroll",t);break;case"onScrollEnd":null!=i&&zh("scrollend",t);break;case"onClick":null!=i&&(t.onclick=Yh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:qt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(s=n.endsWith("Capture"),e=n.slice(2,s?n.length-7:void 0),"function"===typeof(r=null!=(r=t[Rt]||null)?r[n]:null)&&t.removeEventListener(e,r,s),"function"!==typeof i)?n in t?t[n]=i:!0===i?t.setAttribute(n,""):ee(t,n,i):("function"!==typeof r&&null!==r&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,i,s)))}}function tu(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":zh("error",t),zh("load",t);var i,s=!1,r=!1;for(i in n)if(n.hasOwnProperty(i)){var a=n[i];if(null!=a)switch(i){case"src":s=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,e));default:Jh(t,e,i,a,n,null)}}return r&&Jh(t,e,"srcSet",n.srcSet,n,null),void(s&&Jh(t,e,"src",n.src,n,null));case"input":zh("invalid",t);var l=i=a=r=null,c=null,h=null;for(s in n)if(n.hasOwnProperty(s)){var u=n[s];if(null!=u)switch(s){case"name":r=u;break;case"type":a=u;break;case"checked":c=u;break;case"defaultChecked":h=u;break;case"value":i=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(o(137,e));break;default:Jh(t,e,s,u,n,null)}}return ve(t,i,l,c,h,a,r,!1),void ue(t);case"select":for(r in zh("invalid",t),s=a=i=null,n)if(n.hasOwnProperty(r)&&null!=(l=n[r]))switch(r){case"value":i=l;break;case"defaultValue":a=l;break;case"multiple":s=l;default:Jh(t,e,r,l,n,null)}return e=i,n=a,t.multiple=!!s,void(null!=e?be(t,!!s,e,!1):null!=n&&be(t,!!s,n,!0));case"textarea":for(a in zh("invalid",t),i=r=s=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":s=l;break;case"defaultValue":r=l;break;case"children":i=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(o(91));break;default:Jh(t,e,a,l,n,null)}return we(t,s,r,i),void ue(t);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(s=n[c]))if("selected"===c)t.selected=s&&"function"!==typeof s&&"symbol"!==typeof s;else Jh(t,e,c,s,n,null);return;case"dialog":zh("beforetoggle",t),zh("toggle",t),zh("cancel",t),zh("close",t);break;case"iframe":case"object":zh("load",t);break;case"video":case"audio":for(s=0;s<Dh.length;s++)zh(Dh[s],t);break;case"image":zh("error",t),zh("load",t);break;case"details":zh("toggle",t);break;case"embed":case"source":case"link":zh("error",t),zh("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(h in n)if(n.hasOwnProperty(h)&&null!=(s=n[h]))switch(h){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,e));default:Jh(t,e,h,s,n,null)}return;default:if(Ee(e)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(s=n[u])&&Qh(t,e,u,s,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(s=n[l])&&Jh(t,e,l,s,n,null))}var eu=null,nu=null;function iu(t){return 9===t.nodeType?t:t.ownerDocument}function su(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ru(t,e){if(0===t)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return 1===t&&"foreignObject"===e?0:t}function ou(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"bigint"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var au=null;var lu="function"===typeof setTimeout?setTimeout:void 0,cu="function"===typeof clearTimeout?clearTimeout:void 0,hu="function"===typeof Promise?Promise:void 0,uu="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof hu?function(t){return hu.resolve(null).then(t).catch(du)}:lu;function du(t){setTimeout(function(){throw t})}function pu(t){return"head"===t}function fu(t,e){var n=e,i=0,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0<i&&8>i){n=i;var o=t.ownerDocument;if(1&n&&wu(o.documentElement),2&n&&wu(o.body),4&n)for(wu(n=o.head),o=n.firstChild;o;){var a=o.nextSibling,l=o.nodeName;o[jt]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=a}}if(0===s)return t.removeChild(r),void Cd(e);s--}else"$"===n||"$?"===n||"$!"===n?s++:i=n.charCodeAt(0)-48;else i=0;n=r}while(n);Cd(e)}function gu(t){var e=t.firstChild;for(e&&10===e.nodeType&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":gu(n),Bt(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}t.removeChild(n)}}function mu(t){return"$!"===t.data||"$?"===t.data&&"complete"===t.ownerDocument.readyState}function vu(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e||"F!"===e||"F"===e)break;if("/$"===e)return null}}return t}var yu=null;function bu(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}function _u(t,e,n){switch(e=iu(n),t){case"html":if(!(t=e.documentElement))throw Error(o(452));return t;case"head":if(!(t=e.head))throw Error(o(453));return t;case"body":if(!(t=e.body))throw Error(o(454));return t;default:throw Error(o(451))}}function wu(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);Bt(t)}var xu=new Map,Su=new Set;function Au(t){return"function"===typeof t.getRootNode?t.getRootNode():9===t.nodeType?t:t.ownerDocument}var ku=O.d;O.d={f:function(){var t=ku.f(),e=Uc();return t||e},r:function(t){var e=Ht(t);null!==e&&5===e.tag&&"form"===e.type?Ro(e):ku.r(t)},D:function(t){ku.D(t),Cu("dns-prefetch",t,null)},C:function(t,e){ku.C(t,e),Cu("preconnect",t,e)},L:function(t,e,n){ku.L(t,e,n);var i=Eu;if(i&&t&&e){var s='link[rel="preload"][as="'+ge(e)+'"]';"image"===e&&n&&n.imageSrcSet?(s+='[imagesrcset="'+ge(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(s+='[imagesizes="'+ge(n.imageSizes)+'"]')):s+='[href="'+ge(t)+'"]';var r=s;switch(e){case"style":r=Pu(t);break;case"script":r=Iu(t)}xu.has(r)||(t=d({rel:"preload",href:"image"===e&&n&&n.imageSrcSet?void 0:t,as:e},n),xu.set(r,t),null!==i.querySelector(s)||"style"===e&&i.querySelector(Lu(r))||"script"===e&&i.querySelector(Ru(r))||(tu(e=i.createElement("link"),"link",t),Vt(e),i.head.appendChild(e)))}},m:function(t,e){ku.m(t,e);var n=Eu;if(n&&t){var i=e&&"string"===typeof e.as?e.as:"script",s='link[rel="modulepreload"][as="'+ge(i)+'"][href="'+ge(t)+'"]',r=s;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=Iu(t)}if(!xu.has(r)&&(t=d({rel:"modulepreload",href:t},e),xu.set(r,t),null===n.querySelector(s))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Ru(r)))return}tu(i=n.createElement("link"),"link",t),Vt(i),n.head.appendChild(i)}}},X:function(t,e){ku.X(t,e);var n=Eu;if(n&&t){var i=Wt(n).hoistableScripts,s=Iu(t),r=i.get(s);r||((r=n.querySelector(Ru(s)))||(t=d({src:t,async:!0},e),(e=xu.get(s))&&zu(t,e),Vt(r=n.createElement("script")),tu(r,"link",t),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},i.set(s,r))}},S:function(t,e,n){ku.S(t,e,n);var i=Eu;if(i&&t){var s=Wt(i).hoistableStyles,r=Pu(t);e=e||"default";var o=s.get(r);if(!o){var a={loading:0,preload:null};if(o=i.querySelector(Lu(r)))a.loading=5;else{t=d({rel:"stylesheet",href:t,"data-precedence":e},n),(n=xu.get(r))&&Nu(t,n);var l=o=i.createElement("link");Vt(l),tu(l,"link",t),l._p=new Promise(function(t,e){l.onload=t,l.onerror=e}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,Ou(o,e,i)}o={type:"stylesheet",instance:o,count:1,state:a},s.set(r,o)}}},M:function(t,e){ku.M(t,e);var n=Eu;if(n&&t){var i=Wt(n).hoistableScripts,s=Iu(t),r=i.get(s);r||((r=n.querySelector(Ru(s)))||(t=d({src:t,async:!0,type:"module"},e),(e=xu.get(s))&&zu(t,e),Vt(r=n.createElement("script")),tu(r,"link",t),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},i.set(s,r))}}};var Eu="undefined"===typeof document?null:document;function Cu(t,e,n){var i=Eu;if(i&&"string"===typeof e&&e){var s=ge(e);s='link[rel="'+t+'"][href="'+s+'"]',"string"===typeof n&&(s+='[crossorigin="'+n+'"]'),Su.has(s)||(Su.add(s),t={rel:t,crossOrigin:n,href:e},null===i.querySelector(s)&&(tu(e=i.createElement("link"),"link",t),Vt(e),i.head.appendChild(e)))}}function Tu(t,e,n,i){var s,r,a,l,c=(c=W.current)?Au(c):null;if(!c)throw Error(o(446));switch(t){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(e=Pu(n.href),(i=(n=Wt(c).hoistableStyles).get(e))||(i={type:"style",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){t=Pu(n.href);var h=Wt(c).hoistableStyles,u=h.get(t);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(t,u),(h=c.querySelector(Lu(t)))&&!h._p&&(u.instance=h,u.state.loading=5),xu.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},xu.set(t,n),h||(s=c,r=t,a=n,l=u.state,s.querySelector('link[rel="preload"][as="style"]['+r+"]")?l.loading=1:(r=s.createElement("link"),l.preload=r,r.addEventListener("load",function(){return l.loading|=1}),r.addEventListener("error",function(){return l.loading|=2}),tu(r,"link",a),Vt(r),s.head.appendChild(r))))),e&&null===i)throw Error(o(528,""));return u}if(e&&null!==i)throw Error(o(529,""));return null;case"script":return e=n.async,"string"===typeof(n=n.src)&&e&&"function"!==typeof e&&"symbol"!==typeof e?(e=Iu(n),(i=(n=Wt(c).hoistableScripts).get(e))||(i={type:"script",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,t))}}function Pu(t){return'href="'+ge(t)+'"'}function Lu(t){return'link[rel="stylesheet"]['+t+"]"}function Mu(t){return d({},t,{"data-precedence":t.precedence,precedence:null})}function Iu(t){return'[src="'+ge(t)+'"]'}function Ru(t){return"script[async]"+t}function Du(t,e,n){if(e.count++,null===e.instance)switch(e.type){case"style":var i=t.querySelector('style[data-href~="'+ge(n.href)+'"]');if(i)return e.instance=i,Vt(i),i;var s=d({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Vt(i=(t.ownerDocument||t).createElement("style")),tu(i,"style",s),Ou(i,n.precedence,t),e.instance=i;case"stylesheet":s=Pu(n.href);var r=t.querySelector(Lu(s));if(r)return e.state.loading|=4,e.instance=r,Vt(r),r;i=Mu(n),(s=xu.get(s))&&Nu(i,s),Vt(r=(t.ownerDocument||t).createElement("link"));var a=r;return a._p=new Promise(function(t,e){a.onload=t,a.onerror=e}),tu(r,"link",i),e.state.loading|=4,Ou(r,n.precedence,t),e.instance=r;case"script":return r=Iu(n.src),(s=t.querySelector(Ru(r)))?(e.instance=s,Vt(s),s):(i=n,(s=xu.get(r))&&zu(i=d({},n),s),Vt(s=(t=t.ownerDocument||t).createElement("script")),tu(s,"link",i),t.head.appendChild(s),e.instance=s);case"void":return null;default:throw Error(o(443,e.type))}else"stylesheet"===e.type&&0===(4&e.state.loading)&&(i=e.instance,e.state.loading|=4,Ou(i,n.precedence,t));return e.instance}function Ou(t,e,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=i.length?i[i.length-1]:null,r=s,o=0;o<i.length;o++){var a=i[o];if(a.dataset.precedence===e)r=a;else if(r!==s)break}r?r.parentNode.insertBefore(t,r.nextSibling):(e=9===n.nodeType?n.head:n).insertBefore(t,e.firstChild)}function Nu(t,e){null==t.crossOrigin&&(t.crossOrigin=e.crossOrigin),null==t.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),null==t.title&&(t.title=e.title)}function zu(t,e){null==t.crossOrigin&&(t.crossOrigin=e.crossOrigin),null==t.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),null==t.integrity&&(t.integrity=e.integrity)}var Fu=null;function ju(t,e,n){if(null===Fu){var i=new Map,s=Fu=new Map;s.set(n,i)}else(i=(s=Fu).get(n))||(i=new Map,s.set(n,i));if(i.has(t))return i;for(i.set(t,null),n=n.getElementsByTagName(t),s=0;s<n.length;s++){var r=n[s];if(!(r[jt]||r[It]||"link"===t&&"stylesheet"===r.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==r.namespaceURI){var o=r.getAttribute(e)||"";o=t+o;var a=i.get(o);a?a.push(r):i.set(o,[r])}}return i}function Bu(t,e,n){(t=t.ownerDocument||t).head.insertBefore(n,"title"===e?t.querySelector("head > title"):null)}function Uu(t){return"stylesheet"!==t.type||0!==(3&t.state.loading)}var Hu=null;function $u(){}function Wu(){if(this.count--,0===this.count)if(this.stylesheets)Gu(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}var Vu=null;function Gu(t,e){t.stylesheets=null,null!==t.unsuspend&&(t.count++,Vu=new Map,e.forEach(qu,t),Vu=null,Wu.call(t))}function qu(t,e){if(!(4&e.state.loading)){var n=Vu.get(t);if(n)var i=n.get(null);else{n=new Map,Vu.set(t,n);for(var s=t.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<s.length;r++){var o=s[r];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),i=o)}i&&n.set(null,i)}o=(s=e.instance).getAttribute("data-precedence"),(r=n.get(o)||i)===i&&n.set(null,s),n.set(o,s),this.count++,i=Wu.bind(this),s.addEventListener("load",i),s.addEventListener("error",i),r?r.parentNode.insertBefore(s,r.nextSibling):(t=9===t.nodeType?t.head:t).insertBefore(s,t.firstChild),e.state.loading|=4}}var Zu={$$typeof:w,Provider:null,Consumer:null,_currentValue:N,_currentValue2:N,_threadCount:0};function Ku(t,e,n,i,s,r,o,a){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=At(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=At(0),this.hiddenUpdates=At(null),this.identifierPrefix=i,this.onUncaughtError=s,this.onCaughtError=r,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function Xu(t,e,n,i,s,r,o,a,l,c,h,u){return t=new Ku(t,e,n,o,a,l,c,u),e=1,!0===r&&(e|=24),r=Ni(3,null,null,e),t.current=r,r.stateNode=t,(e=Rs()).refCount++,t.pooledCache=e,e.refCount++,r.memoizedState={element:i,isDehydrated:n,cache:e},nr(r),t}function Yu(t){return t?t=Di:Di}function Ju(t,e,n,i,s,r){s=Yu(s),null===i.context?i.context=s:i.pendingContext=s,(i=sr(e)).payload={element:n},null!==(r=void 0===r?null:r)&&(i.callback=r),null!==(n=rr(t,i,e))&&(Nc(n,0,e),or(n,t,e))}function Qu(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function td(t,e){Qu(t,e),(t=t.alternate)&&Qu(t,e)}function ed(t){if(13===t.tag){var e=Mi(t,67108864);null!==e&&Nc(e,0,67108864),td(t,67108864)}}var nd=!0;function id(t,e,n,i){var s=D.T;D.T=null;var r=O.p;try{O.p=2,rd(t,e,n,i)}finally{O.p=r,D.T=s}}function sd(t,e,n,i){var s=D.T;D.T=null;var r=O.p;try{O.p=8,rd(t,e,n,i)}finally{O.p=r,D.T=s}}function rd(t,e,n,i){if(nd){var s=od(i);if(null===s)Hh(t,e,i,ad,n),yd(t,i);else if(function(t,e,n,i,s){switch(e){case"focusin":return ud=bd(ud,t,e,n,i,s),!0;case"dragenter":return dd=bd(dd,t,e,n,i,s),!0;case"mouseover":return pd=bd(pd,t,e,n,i,s),!0;case"pointerover":var r=s.pointerId;return fd.set(r,bd(fd.get(r)||null,t,e,n,i,s)),!0;case"gotpointercapture":return r=s.pointerId,gd.set(r,bd(gd.get(r)||null,t,e,n,i,s)),!0}return!1}(s,t,e,n,i))i.stopPropagation();else if(yd(t,i),4&e&&-1<vd.indexOf(t)){for(;null!==s;){var r=Ht(s);if(null!==r)switch(r.tag){case 3:if((r=r.stateNode).current.memoizedState.isDehydrated){var o=yt(r.pendingLanes);if(0!==o){var a=r;for(a.pendingLanes|=2,a.entangledLanes|=2;o;){var l=1<<31-pt(o);a.entanglements[1]|=l,o&=~l}xh(r),0===(6&nc)&&(xc=et()+500,Sh(0,!1))}}break;case 13:null!==(a=Mi(r,2))&&Nc(a,0,2),Uc(),td(r,2)}if(null===(r=od(i))&&Hh(t,e,i,ad,n),r===s)break;s=r}null!==s&&i.stopPropagation()}else Hh(t,e,i,null,n)}}function od(t){return ld(t=Me(t))}var ad=null;function ld(t){if(ad=null,null!==(t=Ut(t))){var e=l(t);if(null===e)t=null;else{var n=e.tag;if(13===n){if(null!==(t=c(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return ad=t,null}function cd(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(nt()){case it:return 2;case st:return 8;case rt:case ot:return 32;case at:return 268435456;default:return 32}default:return 32}}var hd=!1,ud=null,dd=null,pd=null,fd=new Map,gd=new Map,md=[],vd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yd(t,e){switch(t){case"focusin":case"focusout":ud=null;break;case"dragenter":case"dragleave":dd=null;break;case"mouseover":case"mouseout":pd=null;break;case"pointerover":case"pointerout":fd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gd.delete(e.pointerId)}}function bd(t,e,n,i,s,r){return null===t||t.nativeEvent!==r?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},null!==e&&(null!==(e=Ht(e))&&ed(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,null!==s&&-1===e.indexOf(s)&&e.push(s),t)}function _d(t){var e=Ut(t.target);if(null!==e){var n=l(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=c(n)))return t.blockedOn=e,void function(t,e){var n=O.p;try{return O.p=t,e()}finally{O.p=n}}(t.priority,function(){if(13===n.tag){var t=Dc();t=Tt(t);var e=Mi(n,t);null!==e&&Nc(e,0,t),td(n,t)}})}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function wd(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=od(t.nativeEvent);if(null!==n)return null!==(e=Ht(n))&&ed(e),t.blockedOn=n,!1;var i=new(n=t.nativeEvent).constructor(n.type,n);Le=i,n.target.dispatchEvent(i),Le=null,e.shift()}return!0}function xd(t,e,n){wd(t)&&n.delete(e)}function Sd(){hd=!1,null!==ud&&wd(ud)&&(ud=null),null!==dd&&wd(dd)&&(dd=null),null!==pd&&wd(pd)&&(pd=null),fd.forEach(xd),gd.forEach(xd)}function Ad(t,e){t.blockedOn===e&&(t.blockedOn=null,hd||(hd=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Sd)))}var kd=null;function Ed(t){kd!==t&&(kd=t,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){kd===t&&(kd=null);for(var e=0;e<t.length;e+=3){var n=t[e],i=t[e+1],s=t[e+2];if("function"!==typeof i){if(null===ld(i||n))continue;break}var r=Ht(n);null!==r&&(t.splice(e,3),e-=3,Mo(r,{pending:!0,data:s,method:n.method,action:i},i,s))}}))}function Cd(t){function e(e){return Ad(e,t)}null!==ud&&Ad(ud,t),null!==dd&&Ad(dd,t),null!==pd&&Ad(pd,t),fd.forEach(e),gd.forEach(e);for(var n=0;n<md.length;n++){var i=md[n];i.blockedOn===t&&(i.blockedOn=null)}for(;0<md.length&&null===(n=md[0]).blockedOn;)_d(n),null===n.blockedOn&&md.shift();if(null!=(n=(t.ownerDocument||t).$$reactFormReplay))for(i=0;i<n.length;i+=3){var s=n[i],r=n[i+1],o=s[Rt]||null;if("function"===typeof r)o||Ed(n);else if(o){var a=null;if(r&&r.hasAttribute("formAction")){if(s=r,o=r[Rt]||null)a=o.formAction;else if(null!==ld(s))continue}else a=o.action;"function"===typeof a?n[i+1]=a:(n.splice(i,3),i-=3),Ed(n)}}}function Td(t){this._internalRoot=t}function Pd(t){this._internalRoot=t}Pd.prototype.render=Td.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(o(409));Ju(e.current,Dc(),t,e,null,null)},Pd.prototype.unmount=Td.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;Ju(t.current,2,null,t,null,null),Uc(),e[Dt]=null}},Pd.prototype.unstable_scheduleHydration=function(t){if(t){var e=Lt();t={blockedOn:null,target:t,priority:e};for(var n=0;n<md.length&&0!==e&&e<md[n].priority;n++);md.splice(n,0,t),0===n&&_d(t)}};var Ld=s.version;if("19.1.1"!==Ld)throw Error(o(527,Ld,"19.1.1"));O.findDOMNode=function(t){var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(o(188));throw t=Object.keys(t).join(","),Error(o(268,t))}return t=function(t){var e=t.alternate;if(!e){if(null===(e=l(t)))throw Error(o(188));return e!==t?null:t}for(var n=t,i=e;;){var s=n.return;if(null===s)break;var r=s.alternate;if(null===r){if(null!==(i=s.return)){n=i;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===n)return h(s),t;if(r===i)return h(s),e;r=r.sibling}throw Error(o(188))}if(n.return!==i.return)n=s,i=r;else{for(var a=!1,c=s.child;c;){if(c===n){a=!0,n=s,i=r;break}if(c===i){a=!0,i=s,n=r;break}c=c.sibling}if(!a){for(c=r.child;c;){if(c===n){a=!0,n=r,i=s;break}if(c===i){a=!0,i=r,n=s;break}c=c.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?t:e}(e),t=null===(t=null!==t?u(t):null)?null:t.stateNode};var Md={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.1.1"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Id=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Id.isDisabled&&Id.supportsFiber)try{ht=Id.inject(Md),ut=Id}catch(Dd){}}e.createRoot=function(t,e){if(!a(t))throw Error(o(299));var n=!1,i="",s=ya,r=ba,l=_a;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(i=e.identifierPrefix),void 0!==e.onUncaughtError&&(s=e.onUncaughtError),void 0!==e.onCaughtError&&(r=e.onCaughtError),void 0!==e.onRecoverableError&&(l=e.onRecoverableError),void 0!==e.unstable_transitionCallbacks&&e.unstable_transitionCallbacks),e=Xu(t,1,!1,null,0,n,i,s,r,l,0,null),t[Dt]=e.current,Bh(t),new Td(e)},e.hydrateRoot=function(t,e,n){if(!a(t))throw Error(o(299));var i=!1,s="",r=ya,l=ba,c=_a,h=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onUncaughtError&&(r=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(h=n.formState)),(e=Xu(t,1,!0,e,0,i,s,r,l,c,0,h)).context=Yu(null),n=e.current,(s=sr(i=Tt(i=Dc()))).callback=null,rr(n,s,i),n=i,e.current.lanes=n,kt(e,n),xh(e),t[Dt]=e.current,Bh(t),new Pd(e)},e.version="19.1.1"},24:t=>{"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII="},43:(t,e,n)=>{"use strict";t.exports=n(288)},71:t=>{"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC"},210:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n(829)),r=i(n(736)),o=n(745);class a{constructor(t){let{headers:e={},schema:n,fetch:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=t,this.headers=Object.assign(Object.assign({},o.DEFAULT_HEADERS),e),this.schemaName=n,this.fetch=i}from(t){const e=new URL(`${this.url}/${t}`);return new s.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new a(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:i=!1,get:s=!1,count:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=new URL(`${this.url}/rpc/${t}`);let l;i||s?(e=i?"HEAD":"GET",Object.entries(n).filter(t=>{let[e,n]=t;return void 0!==n}).map(t=>{let[e,n]=t;return[e,Array.isArray(n)?`{${n.join(",")}}`:`${n}`]}).forEach(t=>{let[e,n]=t;a.searchParams.append(e,n)})):(e="POST",l=n);const c=Object.assign({},this.headers);return o&&(c.Prefer=`count=${o}`),new r.default({method:e,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}e.default=a},228:function(t,e){!function(t){"use strict";var e="1.9.4";function n(t){var e,n,i,s;for(n=1,i=arguments.length;n<i;n++)for(e in s=arguments[n])t[e]=s[e];return t}var i=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function s(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var i=n.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(n.call(arguments)):arguments)}}var r=0;function o(t){return"_leaflet_id"in t||(t._leaflet_id=++r),t._leaflet_id}function a(t,e,n){var i,s,r,o;return o=function(){i=!1,s&&(r.apply(n,s),s=!1)},r=function(){i?s=arguments:(t.apply(n,arguments),setTimeout(o,e),i=!0)},r}function l(t,e,n){var i=e[1],s=e[0],r=i-s;return t===i&&n?t:((t-s)%r+r)%r+s}function c(){return!1}function h(t,e){if(!1===e)return t;var n=Math.pow(10,void 0===e?6:e);return Math.round(t*n)/n}function u(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function d(t){return u(t).split(/\s+/)}function p(t,e){for(var n in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?i(t.options):{}),e)t.options[n]=e[n];return t.options}function f(t,e,n){var i=[];for(var s in t)i.push(encodeURIComponent(n?s.toUpperCase():s)+"="+encodeURIComponent(t[s]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}var g=/\{ *([\w_ -]+) *\}/g;function m(t,e){return t.replace(g,function(t,n){var i=e[n];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"===typeof i&&(i=i(e)),i})}var v=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function y(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}var b="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var w=0;function x(t){var e=+new Date,n=Math.max(0,16-(e-w));return w=e+n,window.setTimeout(t,n)}var S=window.requestAnimationFrame||_("RequestAnimationFrame")||x,A=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function k(t,e,n){if(!n||S!==x)return S.call(window,s(t,e));t.call(e)}function E(t){t&&A.call(window,t)}var C={__proto__:null,extend:n,create:i,bind:s,get lastId(){return r},stamp:o,throttle:a,wrapNum:l,falseFn:c,formatNum:h,trim:u,splitWords:d,setOptions:p,getParamString:f,template:m,isArray:v,indexOf:y,emptyImageUrl:b,requestFn:S,cancelFn:A,requestAnimFrame:k,cancelAnimFrame:E};function T(){}function P(t){if("undefined"!==typeof L&&L&&L.Mixin){t=v(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}T.extend=function(t){var e=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},s=e.__super__=this.prototype,r=i(s);for(var o in r.constructor=e,e.prototype=r,this)Object.prototype.hasOwnProperty.call(this,o)&&"prototype"!==o&&"__super__"!==o&&(e[o]=this[o]);return t.statics&&n(e,t.statics),t.includes&&(P(t.includes),n.apply(null,[r].concat(t.includes))),n(r,t),delete r.statics,delete r.includes,r.options&&(r.options=s.options?i(s.options):{},n(r.options,t.options)),r._initHooks=[],r.callInitHooks=function(){if(!this._initHooksCalled){s.callInitHooks&&s.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=r._initHooks.length;t<e;t++)r._initHooks[t].call(this)}},e},T.include=function(t){var e=this.prototype.options;return n(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},T.mergeOptions=function(t){return n(this.prototype.options,t),this},T.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"===typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var M={on:function(t,e,n){if("object"===typeof t)for(var i in t)this._on(i,t[i],e);else for(var s=0,r=(t=d(t)).length;s<r;s++)this._on(t[s],e,n);return this},off:function(t,e,n){if(arguments.length)if("object"===typeof t)for(var i in t)this._off(i,t[i],e);else{t=d(t);for(var s=1===arguments.length,r=0,o=t.length;r<o;r++)s?this._off(t[r]):this._off(t[r],e,n)}else delete this._events;return this},_on:function(t,e,n,i){if("function"===typeof e){if(!1===this._listens(t,e,n)){n===this&&(n=void 0);var s={fn:e,ctx:n};i&&(s.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(s)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,n){var i,s,r;if(this._events&&(i=this._events[t]))if(1!==arguments.length)if("function"===typeof e){var o=this._listens(t,e,n);if(!1!==o){var a=i[o];this._firingCount&&(a.fn=c,this._events[t]=i=i.slice()),i.splice(o,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(s=0,r=i.length;s<r;s++)i[s].fn=c;delete this._events[t]}},fire:function(t,e,i){if(!this.listens(t,i))return this;var s=n({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var r=this._events[t];if(r){this._firingCount=this._firingCount+1||1;for(var o=0,a=r.length;o<a;o++){var l=r[o],c=l.fn;l.once&&this.off(t,c,l.ctx),c.call(l.ctx||this,s)}this._firingCount--}}return i&&this._propagateEvent(s),this},listens:function(t,e,n,i){"string"!==typeof t&&console.warn('"string" type argument expected');var s=e;"function"!==typeof e&&(i=!!e,s=void 0,n=void 0);var r=this._events&&this._events[t];if(r&&r.length&&!1!==this._listens(t,s,n))return!0;if(i)for(var o in this._eventParents)if(this._eventParents[o].listens(t,e,n,i))return!0;return!1},_listens:function(t,e,n){if(!this._events)return!1;var i=this._events[t]||[];if(!e)return!!i.length;n===this&&(n=void 0);for(var s=0,r=i.length;s<r;s++)if(i[s].fn===e&&i[s].ctx===n)return s;return!1},once:function(t,e,n){if("object"===typeof t)for(var i in t)this._on(i,t[i],e,!0);else for(var s=0,r=(t=d(t)).length;s<r;s++)this._on(t[s],e,n,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[o(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[o(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,n({layer:t.target,propagatedFrom:t.target},t),!0)}};M.addEventListener=M.on,M.removeEventListener=M.clearAllEventListeners=M.off,M.addOneTimeEventListener=M.once,M.fireEvent=M.fire,M.hasEventListeners=M.listens;var I=T.extend(M);function R(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}var D=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function O(t,e,n){return t instanceof R?t:v(t)?new R(t[0],t[1]):void 0===t||null===t?t:"object"===typeof t&&"x"in t&&"y"in t?new R(t.x,t.y):new R(t,e,n)}function N(t,e){if(t)for(var n=e?[t,e]:t,i=0,s=n.length;i<s;i++)this.extend(n[i])}function z(t,e){return!t||t instanceof N?t:new N(t,e)}function F(t,e){if(t)for(var n=e?[t,e]:t,i=0,s=n.length;i<s;i++)this.extend(n[i])}function j(t,e){return t instanceof F?t:new F(t,e)}function B(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==n&&(this.alt=+n)}function U(t,e,n){return t instanceof B?t:v(t)&&"object"!==typeof t[0]?3===t.length?new B(t[0],t[1],t[2]):2===t.length?new B(t[0],t[1]):null:void 0===t||null===t?t:"object"===typeof t&&"lat"in t?new B(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new B(t,e,n)}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(t){return this.clone()._add(O(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(O(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new R(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new R(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=D(this.x),this.y=D(this.y),this},distanceTo:function(t){var e=(t=O(t)).x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return(t=O(t)).x===this.x&&t.y===this.y},contains:function(t){return t=O(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+h(this.x)+", "+h(this.y)+")"}},N.prototype={extend:function(t){var e,n;if(!t)return this;if(t instanceof R||"number"===typeof t[0]||"x"in t)e=n=O(t);else if(e=(t=z(t)).min,n=t.max,!e||!n)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=e.clone(),this.max=n.clone()),this},getCenter:function(t){return O((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return O(this.min.x,this.max.y)},getTopRight:function(){return O(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return(t="number"===typeof t[0]||t instanceof R?O(t):z(t))instanceof N?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=z(t);var e=this.min,n=this.max,i=t.min,s=t.max,r=s.x>=e.x&&i.x<=n.x,o=s.y>=e.y&&i.y<=n.y;return r&&o},overlaps:function(t){t=z(t);var e=this.min,n=this.max,i=t.min,s=t.max,r=s.x>e.x&&i.x<n.x,o=s.y>e.y&&i.y<n.y;return r&&o},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,n=this.max,i=Math.abs(e.x-n.x)*t,s=Math.abs(e.y-n.y)*t;return z(O(e.x-i,e.y-s),O(n.x+i,n.y+s))},equals:function(t){return!!t&&(t=z(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},F.prototype={extend:function(t){var e,n,i=this._southWest,s=this._northEast;if(t instanceof B)e=t,n=t;else{if(!(t instanceof F))return t?this.extend(U(t)||j(t)):this;if(e=t._southWest,n=t._northEast,!e||!n)return this}return i||s?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),s.lat=Math.max(n.lat,s.lat),s.lng=Math.max(n.lng,s.lng)):(this._southWest=new B(e.lat,e.lng),this._northEast=new B(n.lat,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,i=Math.abs(e.lat-n.lat)*t,s=Math.abs(e.lng-n.lng)*t;return new F(new B(e.lat-i,e.lng-s),new B(n.lat+i,n.lng+s))},getCenter:function(){return new B((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new B(this.getNorth(),this.getWest())},getSouthEast:function(){return new B(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"===typeof t[0]||t instanceof B||"lat"in t?U(t):j(t);var e,n,i=this._southWest,s=this._northEast;return t instanceof F?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=i.lat&&n.lat<=s.lat&&e.lng>=i.lng&&n.lng<=s.lng},intersects:function(t){t=j(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>=e.lat&&i.lat<=n.lat,o=s.lng>=e.lng&&i.lng<=n.lng;return r&&o},overlaps:function(t){t=j(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>e.lat&&i.lat<n.lat,o=s.lng>e.lng&&i.lng<n.lng;return r&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=j(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},B.prototype={equals:function(t,e){return!!t&&(t=U(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+h(this.lat,t)+", "+h(this.lng,t)+")"},distanceTo:function(t){return $.distance(this,U(t))},wrap:function(){return $.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return j([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new B(this.lat,this.lng,this.alt)}};var H={latLngToPoint:function(t,e){var n=this.projection.project(t),i=this.scale(e);return this.transformation._transform(n,i)},pointToLatLng:function(t,e){var n=this.scale(e),i=this.transformation.untransform(t,n);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,n=this.scale(t);return new N(this.transformation.transform(e.min,n),this.transformation.transform(e.max,n))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?l(t.lng,this.wrapLng,!0):t.lng;return new B(this.wrapLat?l(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),n=this.wrapLatLng(e),i=e.lat-n.lat,s=e.lng-n.lng;if(0===i&&0===s)return t;var r=t.getSouthWest(),o=t.getNorthEast();return new F(new B(r.lat-i,r.lng-s),new B(o.lat-i,o.lng-s))}},$=n({},H,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,i=t.lat*n,s=e.lat*n,r=Math.sin((e.lat-t.lat)*n/2),o=Math.sin((e.lng-t.lng)*n/2),a=r*r+Math.cos(i)*Math.cos(s)*o*o,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),W=6378137,V={R:W,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,t.lat),-n),s=Math.sin(i*e);return new R(this.R*t.lng*e,this.R*Math.log((1+s)/(1-s))/2)},unproject:function(t){var e=180/Math.PI;return new B((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=W*Math.PI;return new N([-t,-t],[t,t])}()};function G(t,e,n,i){if(v(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=n,this._d=i}function q(t,e,n,i){return new G(t,e,n,i)}G.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new R((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var Z=n({},$,{code:"EPSG:3857",projection:V,transformation:function(){var t=.5/(Math.PI*V.R);return q(t,.5,-t,.5)}()}),K=n({},Z,{code:"EPSG:900913"});function X(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Y(t,e){var n,i,s,r,o,a,l="";for(n=0,s=t.length;n<s;n++){for(i=0,r=(o=t[n]).length;i<r;i++)l+=(i?"L":"M")+(a=o[i]).x+" "+a.y;l+=e?Nt.svg?"z":"x":""}return l||"M0 0"}var J=document.documentElement.style,Q="ActiveXObject"in window,tt=Q&&!document.addEventListener,et="msLaunchUri"in navigator&&!("documentMode"in document),nt=Ot("webkit"),it=Ot("android"),st=Ot("android 2")||Ot("android 3"),rt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ot=it&&Ot("Google")&&rt<537&&!("AudioNode"in window),at=!!window.opera,lt=!et&&Ot("chrome"),ct=Ot("gecko")&&!nt&&!at&&!Q,ht=!lt&&Ot("safari"),ut=Ot("phantom"),dt="OTransition"in J,pt=0===navigator.platform.indexOf("Win"),ft=Q&&"transition"in J,gt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!st,mt="MozPerspective"in J,vt=!window.L_DISABLE_3D&&(ft||gt||mt)&&!dt&&!ut,yt="undefined"!==typeof orientation||Ot("mobile"),bt=yt&&nt,_t=yt&&gt,wt=!window.PointerEvent&&window.MSPointerEvent,xt=!(!window.PointerEvent&&!wt),St="ontouchstart"in window||!!window.TouchEvent,At=!window.L_NO_TOUCH&&(St||xt),kt=yt&&at,Et=yt&&ct,Ct=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Tt=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",c,e),window.removeEventListener("testPassiveEventSupport",c,e)}catch(n){}return t}(),Pt=!!document.createElement("canvas").getContext,Lt=!(!document.createElementNS||!X("svg").createSVGRect),Mt=!!Lt&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(t.firstChild&&t.firstChild.namespaceURI)}(),It=!Lt&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"===typeof e.adj}catch(n){return!1}}(),Rt=0===navigator.platform.indexOf("Mac"),Dt=0===navigator.platform.indexOf("Linux");function Ot(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Nt={ie:Q,ielt9:tt,edge:et,webkit:nt,android:it,android23:st,androidStock:ot,opera:at,chrome:lt,gecko:ct,safari:ht,phantom:ut,opera12:dt,win:pt,ie3d:ft,webkit3d:gt,gecko3d:mt,any3d:vt,mobile:yt,mobileWebkit:bt,mobileWebkit3d:_t,msPointer:wt,pointer:xt,touch:At,touchNative:St,mobileOpera:kt,mobileGecko:Et,retina:Ct,passiveEvents:Tt,canvas:Pt,svg:Lt,vml:It,inlineSvg:Mt,mac:Rt,linux:Dt},zt=Nt.msPointer?"MSPointerDown":"pointerdown",Ft=Nt.msPointer?"MSPointerMove":"pointermove",jt=Nt.msPointer?"MSPointerUp":"pointerup",Bt=Nt.msPointer?"MSPointerCancel":"pointercancel",Ut={touchstart:zt,touchmove:Ft,touchend:jt,touchcancel:Bt},Ht={touchstart:Jt,touchmove:Yt,touchend:Yt,touchcancel:Yt},$t={},Wt=!1;function Vt(t,e,n){return"touchstart"===e&&Xt(),Ht[e]?(n=Ht[e].bind(this,n),t.addEventListener(Ut[e],n,!1),n):(console.warn("wrong event specified:",e),c)}function Gt(t,e,n){Ut[e]?t.removeEventListener(Ut[e],n,!1):console.warn("wrong event specified:",e)}function qt(t){$t[t.pointerId]=t}function Zt(t){$t[t.pointerId]&&($t[t.pointerId]=t)}function Kt(t){delete $t[t.pointerId]}function Xt(){Wt||(document.addEventListener(zt,qt,!0),document.addEventListener(Ft,Zt,!0),document.addEventListener(jt,Kt,!0),document.addEventListener(Bt,Kt,!0),Wt=!0)}function Yt(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in e.touches=[],$t)e.touches.push($t[n]);e.changedTouches=[e],t(e)}}function Jt(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&qe(e),Yt(t,e)}function Qt(t){var e,n,i={};for(n in t)e=t[n],i[n]=e&&e.bind?e.bind(t):e;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var te=200;function ee(t,e){t.addEventListener("dblclick",e);var n,i=0;function s(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var s=Ke(t);if(!s.some(function(t){return t instanceof HTMLLabelElement&&t.attributes.for})||s.some(function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement})){var r=Date.now();r-i<=te?2===++n&&e(Qt(t)):n=1,i=r}}}else n=t.detail}return t.addEventListener("click",s),{dblclick:e,simDblclick:s}}function ne(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var ie,se,re,oe,ae,le=ke(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ce=ke(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),he="webkitTransition"===ce||"OTransition"===ce?ce+"End":"transitionend";function ue(t){return"string"===typeof t?document.getElementById(t):t}function de(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||"auto"===n)&&document.defaultView){var i=document.defaultView.getComputedStyle(t,null);n=i?i[e]:null}return"auto"===n?null:n}function pe(t,e,n){var i=document.createElement(t);return i.className=e||"",n&&n.appendChild(i),i}function fe(t){var e=t.parentNode;e&&e.removeChild(t)}function ge(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function me(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function ve(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function ye(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=xe(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function be(t,e){if(void 0!==t.classList)for(var n=d(e),i=0,s=n.length;i<s;i++)t.classList.add(n[i]);else if(!ye(t,e)){var r=xe(t);we(t,(r?r+" ":"")+e)}}function _e(t,e){void 0!==t.classList?t.classList.remove(e):we(t,u((" "+xe(t)+" ").replace(" "+e+" "," ")))}function we(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function xe(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function Se(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&Ae(t,e)}function Ae(t,e){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(i)}catch(s){if(1===e)return}e=Math.round(100*e),n?(n.Enabled=100!==e,n.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}function ke(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1}function Ee(t,e,n){var i=e||new R(0,0);t.style[le]=(Nt.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}function Ce(t,e){t._leaflet_pos=e,Nt.any3d?Ee(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function Te(t){return t._leaflet_pos||new R(0,0)}if("onselectstart"in document)ie=function(){ze(window,"selectstart",qe)},se=function(){je(window,"selectstart",qe)};else{var Pe=ke(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ie=function(){if(Pe){var t=document.documentElement.style;re=t[Pe],t[Pe]="none"}},se=function(){Pe&&(document.documentElement.style[Pe]=re,re=void 0)}}function Le(){ze(window,"dragstart",qe)}function Me(){je(window,"dragstart",qe)}function Ie(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Re(),oe=t,ae=t.style.outlineStyle,t.style.outlineStyle="none",ze(window,"keydown",Re))}function Re(){oe&&(oe.style.outlineStyle=ae,oe=void 0,ae=void 0,je(window,"keydown",Re))}function De(t){do{t=t.parentNode}while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function Oe(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var Ne={__proto__:null,TRANSFORM:le,TRANSITION:ce,TRANSITION_END:he,get:ue,getStyle:de,create:pe,remove:fe,empty:ge,toFront:me,toBack:ve,hasClass:ye,addClass:be,removeClass:_e,setClass:we,getClass:xe,setOpacity:Se,testProp:ke,setTransform:Ee,setPosition:Ce,getPosition:Te,get disableTextSelection(){return ie},get enableTextSelection(){return se},disableImageDrag:Le,enableImageDrag:Me,preventOutline:Ie,restoreOutline:Re,getSizedParentNode:De,getScale:Oe};function ze(t,e,n,i){if(e&&"object"===typeof e)for(var s in e)He(t,s,e[s],n);else for(var r=0,o=(e=d(e)).length;r<o;r++)He(t,e[r],n,i);return this}var Fe="_leaflet_events";function je(t,e,n,i){if(1===arguments.length)Be(t),delete t[Fe];else if(e&&"object"===typeof e)for(var s in e)$e(t,s,e[s],n);else if(e=d(e),2===arguments.length)Be(t,function(t){return-1!==y(e,t)});else for(var r=0,o=e.length;r<o;r++)$e(t,e[r],n,i);return this}function Be(t,e){for(var n in t[Fe]){var i=n.split(/\d/)[0];e&&!e(i)||$e(t,i,null,null,n)}}var Ue={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function He(t,e,n,i){var s=e+o(n)+(i?"_"+o(i):"");if(t[Fe]&&t[Fe][s])return this;var r=function(e){return n.call(i||t,e||window.event)},a=r;!Nt.touchNative&&Nt.pointer&&0===e.indexOf("touch")?r=Vt(t,e,r):Nt.touch&&"dblclick"===e?r=ee(t,r):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(Ue[e]||e,r,!!Nt.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(r=function(e){e=e||window.event,Qe(t,e)&&a(e)},t.addEventListener(Ue[e],r,!1)):t.addEventListener(e,a,!1):t.attachEvent("on"+e,r),t[Fe]=t[Fe]||{},t[Fe][s]=r}function $e(t,e,n,i,s){s=s||e+o(n)+(i?"_"+o(i):"");var r=t[Fe]&&t[Fe][s];if(!r)return this;!Nt.touchNative&&Nt.pointer&&0===e.indexOf("touch")?Gt(t,e,r):Nt.touch&&"dblclick"===e?ne(t,r):"removeEventListener"in t?t.removeEventListener(Ue[e]||e,r,!1):t.detachEvent("on"+e,r),t[Fe][s]=null}function We(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Ve(t){return He(t,"wheel",We),this}function Ge(t){return ze(t,"mousedown touchstart dblclick contextmenu",We),t._leaflet_disable_click=!0,this}function qe(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Ze(t){return qe(t),We(t),this}function Ke(t){if(t.composedPath)return t.composedPath();for(var e=[],n=t.target;n;)e.push(n),n=n.parentNode;return e}function Xe(t,e){if(!e)return new R(t.clientX,t.clientY);var n=Oe(e),i=n.boundingClientRect;return new R((t.clientX-i.left)/n.x-e.clientLeft,(t.clientY-i.top)/n.y-e.clientTop)}var Ye=Nt.linux&&Nt.chrome?window.devicePixelRatio:Nt.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Je(t){return Nt.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Ye:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function Qe(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(i){return!1}return n!==t}var tn={__proto__:null,on:ze,off:je,stopPropagation:We,disableScrollPropagation:Ve,disableClickPropagation:Ge,preventDefault:qe,stop:Ze,getPropagationPath:Ke,getMousePosition:Xe,getWheelDelta:Je,isExternalTarget:Qe,addListener:ze,removeListener:je},en=I.extend({run:function(t,e,n,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=Te(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=k(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=1e3*this._duration;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var n=this._startPos.add(this._offset.multiplyBy(t));e&&n._round(),Ce(this._el,n),this.fire("step")},_complete:function(){E(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),nn=I.extend({options:{crs:Z,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=p(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(U(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ce&&Nt.any3d&&!Nt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ze(this._proxy,he,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,i){return e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(U(t),e,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=n({animate:i.animate},i.zoom),i.pan=n({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,i.zoom):this._tryAnimatedPan(t,i.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,e,i.pan&&i.pan.noMoveStart),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var i=this.getZoomScale(e),s=this.getSize().divideBy(2),r=(t instanceof R?t:this.latLngToContainerPoint(t)).subtract(s).multiplyBy(1-1/i),o=this.containerPointToLatLng(s.add(r));return this.setView(o,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():j(t);var n=O(e.paddingTopLeft||e.padding||[0,0]),i=O(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,n.add(i));if((s="number"===typeof e.maxZoom?Math.min(e.maxZoom,s):s)===1/0)return{center:t.getCenter(),zoom:s};var r=i.subtract(n).divideBy(2),o=this.project(t.getSouthWest(),s),a=this.project(t.getNorthEast(),s);return{center:this.unproject(o.add(a).divideBy(2).add(r),s),zoom:s}},fitBounds:function(t,e){if(!(t=j(t)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=O(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new en,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){be(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){if(!1===(n=n||{}).animate||!Nt.any3d)return this.setView(t,e,n);this._stop();var i=this.project(this.getCenter()),s=this.project(t),r=this.getSize(),o=this._zoom;t=U(t),e=void 0===e?o:e;var a=Math.max(r.x,r.y),l=a*this.getZoomScale(o,e),c=s.distanceTo(i)||1,h=1.42,u=h*h;function d(t){var e=(l*l-a*a+(t?-1:1)*u*u*c*c)/(2*(t?l:a)*u*c),n=Math.sqrt(e*e+1)-e;return n<1e-9?-18:Math.log(n)}function p(t){return(Math.exp(t)-Math.exp(-t))/2}function f(t){return(Math.exp(t)+Math.exp(-t))/2}function g(t){return p(t)/f(t)}var m=d(0);function v(t){return a*(f(m)/f(m+h*t))}function y(t){return a*(f(m)*g(m+h*t)-p(m))/u}function b(t){return 1-Math.pow(1-t,1.5)}var _=Date.now(),w=(d(1)-m)/h,x=n.duration?1e3*n.duration:1e3*w*.8;function S(){var n=(Date.now()-_)/x,r=b(n)*w;n<=1?(this._flyToFrame=k(S,this),this._move(this.unproject(i.add(s.subtract(i).multiplyBy(y(r)/c)),o),this.getScaleZoom(a/v(r),o),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),S.call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return t=j(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,j(t));return n.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},panInside:function(t,e){var n=O((e=e||{}).paddingTopLeft||e.padding||[0,0]),i=O(e.paddingBottomRight||e.padding||[0,0]),s=this.project(this.getCenter()),r=this.project(t),o=this.getPixelBounds(),a=z([o.min.add(n),o.max.subtract(i)]),l=a.getSize();if(!a.contains(r)){this._enforcingBounds=!0;var c=r.subtract(a.getCenter()),h=a.extend(r).getSize().subtract(l);s.x+=c.x<0?-h.x:h.x,s.y+=c.y<0?-h.y:h.y,this.panTo(this.unproject(s),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=n({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),r=e.divideBy(2).round(),o=i.divideBy(2).round(),a=r.subtract(o);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=n({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=s(this._handleGeolocationResponse,this),i=s(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new B(t.coords.latitude,t.coords.longitude),n=e.toBounds(2*t.coords.accuracy),i=this._locateOptions;if(i.setView){var s=this.getBoundsZoom(n);this.setView(e,i.maxZoom?Math.min(s,i.maxZoom):s)}var r={latlng:e,bounds:n,timestamp:t.timestamp};for(var o in t.coords)"number"===typeof t.coords[o]&&(r[o]=t.coords[o]);this.fire("locationfound",r)}},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(e){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),fe(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(E(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)fe(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var n=pe("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new F(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=j(t),n=O(n||[0,0]);var i=this.getZoom()||0,s=this.getMinZoom(),r=this.getMaxZoom(),o=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(n),c=z(this.project(a,i),this.project(o,i)).getSize(),h=Nt.any3d?this.options.zoomSnap:1,u=l.x/c.x,d=l.y/c.y,p=e?Math.max(u,d):Math.min(u,d);return i=this.getScaleZoom(p,i),h&&(i=Math.round(i/(h/100))*(h/100),i=e?Math.ceil(i/h)*h:Math.floor(i/h)*h),Math.max(s,Math.min(r,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new R(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new N(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"===typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=void 0===e?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=void 0===e?this._zoom:e;var i=n.zoom(t*n.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(U(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(O(t),e)},layerPointToLatLng:function(t){var e=O(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(U(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(U(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(j(t))},distance:function(t,e){return this.options.crs.distance(U(t),U(e))},containerPointToLayerPoint:function(t){return O(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return O(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(O(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(U(t)))},mouseEventToContainerPoint:function(t){return Xe(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=ue(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");ze(e,"scroll",this._onScroll,this),this._containerId=o(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Nt.any3d,be(t,"leaflet-container"+(Nt.touch?" leaflet-touch":"")+(Nt.retina?" leaflet-retina":"")+(Nt.ielt9?" leaflet-oldie":"")+(Nt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=de(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ce(this._mapPane,new R(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(be(t.markerPane,"leaflet-zoom-hide"),be(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,n){Ce(this._mapPane,new R(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var s=this._zoom!==e;this._moveStart(s,n)._move(t,e)._moveEnd(s),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,n,i){void 0===e&&(e=this._zoom);var s=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),i?n&&n.pinch&&this.fire("zoom",n):((s||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return E(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){Ce(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[o(this._container)]=this;var e=t?je:ze;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Nt.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){E(this._resizeRequest),this._resizeRequest=k(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n,i=[],s="mouseout"===e||"mouseover"===e,r=t.target||t.srcElement,a=!1;r;){if((n=this._targets[o(r)])&&("click"===e||"preclick"===e)&&this._draggableMoved(n)){a=!0;break}if(n&&n.listens(e,!0)){if(s&&!Qe(r,t))break;if(i.push(n),s)break}if(r===this._container)break;r=r.parentNode}return i.length||a||s||!this.listens(e,!0)||(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var n=t.type;"mousedown"===n&&Ie(e),this._fireDOMEvent(t,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,i){if("click"===t.type){var s=n({},t);s.type="preclick",this._fireDOMEvent(s,s.type,i)}var r=this._findEventTargets(t,e);if(i){for(var o=[],a=0;a<i.length;a++)i[a].listens(e,!0)&&o.push(i[a]);r=o.concat(r)}if(r.length){"contextmenu"===e&&qe(t);var l=r[0],c={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var h=l.getLatLng&&(!l._radius||l._radius<=10);c.containerPoint=h?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(t),c.layerPoint=this.containerPointToLayerPoint(c.containerPoint),c.latlng=h?l.getLatLng():this.layerPointToLatLng(c.layerPoint)}for(a=0;a<r.length;a++)if(r[a].fire(e,c,!0),c.originalEvent._stopped||!1===r[a].options.bubblingMouseEvents&&-1!==y(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return Te(this._mapPane)||new R(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return z([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var i=this.project(t,e),s=this.getSize().divideBy(2),r=new N(i.subtract(s),i.add(s)),o=this._getBoundsOffset(r,n,e);return Math.abs(o.x)<=1&&Math.abs(o.y)<=1?t:this.unproject(i.add(o),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),i=new N(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,n){var i=z(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),s=i.min.subtract(t.min),r=i.max.subtract(t.max);return new R(this._rebound(s.x,-r.x),this._rebound(s.y,-r.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),i=Nt.any3d?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){_e(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(n))&&(this.panBy(n,e),!0)},_createAnimProxy:function(){var t=this._proxy=pe("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=le,n=this._proxy.style[e];Ee(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),n===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){fe(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();Ee(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==n.animate&&!this.getSize().contains(s))&&(k(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,n,i){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,be(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&_e(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function sn(t,e){return new nn(t,e)}var rn=T.extend({options:{position:"topright"},initialize:function(t){p(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),i=t._controlCorners[n];return be(e,"leaflet-control"),-1!==n.indexOf("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(fe(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),on=function(t){return new rn(t)};nn.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",n=this._controlContainer=pe("div",e+"control-container",this._container);function i(i,s){var r=e+i+" "+e+s;t[i+s]=pe("div",r,n)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)fe(this._controlCorners[t]);fe(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var an=rn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,i){return n<i?-1:i<n?1:0}},initialize:function(t,e,n){for(var i in p(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return rn.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(o(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){be(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(be(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):_e(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return _e(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=pe("div",t),n=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Ge(e),Ve(e);var i=this._section=pe("section",t+"-list");n&&(this._map.on("click",this.collapse,this),ze(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var s=this._layersLink=pe("a",t+"-toggle",e);s.href="#",s.title="Layers",s.setAttribute("role","button"),ze(s,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){qe(t),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=pe("div",t+"-base",i),this._separator=pe("div",t+"-separator",i),this._overlaysList=pe("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&o(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(s(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ge(this._baseLayersList),ge(this._overlaysList),this._layerControlInputs=[];var t,e,n,i,s=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,s+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&s>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(o(t.target)),n=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(t){var e,n=document.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers_"+o(this),i),this._layerControlInputs.push(e),e.layerId=o(t.layer),ze(e,"click",this._onInputClick,this);var s=document.createElement("span");s.innerHTML=" "+t.name;var r=document.createElement("span");return n.appendChild(r),r.appendChild(e),r.appendChild(s),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var t,e,n=this._layerControlInputs,i=[],s=[];this._handlingClick=!0;for(var r=n.length-1;r>=0;r--)t=n[r],e=this._getLayer(t.layerId).layer,t.checked?i.push(e):t.checked||s.push(e);for(r=0;r<s.length;r++)this._map.hasLayer(s[r])&&this._map.removeLayer(s[r]);for(r=0;r<i.length;r++)this._map.hasLayer(i[r])||this._map.addLayer(i[r]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,n=this._layerControlInputs,i=this._map.getZoom(),s=n.length-1;s>=0;s--)t=n[s],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&i<e.options.minZoom||void 0!==e.options.maxZoom&&i>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,ze(t,"click",qe),this.expand();var e=this;setTimeout(function(){je(t,"click",qe),e._preventClick=!1})}}),ln=function(t,e,n){return new an(t,e,n)},cn=rn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=pe("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",n,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,n,i,s){var r=pe("a",n,i);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),Ge(r),ze(r,"click",Ze),ze(r,"click",s,this),ze(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";_e(this._zoomInButton,e),_e(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(be(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(be(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});nn.mergeOptions({zoomControl:!0}),nn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new cn,this.addControl(this.zoomControl))});var hn=function(t){return new cn(t)},un=rn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",n=pe("div",e),i=this.options;return this._addScales(i,e+"-line",n),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=pe("div",e,n)),t.imperial&&(this._iScale=pe("div",e,n))},_update:function(){var t=this._map,e=t.getSize().y/2,n=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(n)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},_updateImperial:function(t){var e,n,i,s=3.2808399*t;s>5280?(e=s/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mi",n/e)):(i=this._getRoundNum(s),this._updateScale(this._iScale,i+" ft",i/s))},_updateScale:function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),dn=function(t){return new un(t)},pn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',fn=rn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Nt.inlineSvg?pn+" ":"")+"Leaflet</a>"},initialize:function(t){p(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=pe("div","leaflet-control-attribution"),Ge(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});nn.mergeOptions({attributionControl:!0}),nn.addInitHook(function(){this.options.attributionControl&&(new fn).addTo(this)});var gn=function(t){return new fn(t)};rn.Layers=an,rn.Zoom=cn,rn.Scale=un,rn.Attribution=fn,on.layers=ln,on.zoom=hn,on.scale=dn,on.attribution=gn;var mn=T.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});mn.addTo=function(t,e){return t.addHandler(e,this),this};var vn={Events:M},yn=Nt.touch?"touchstart mousedown":"mousedown",bn=I.extend({options:{clickTolerance:3},initialize:function(t,e,n,i){p(this,i),this._element=t,this._dragStartTarget=e||t,this._preventOutline=n},enable:function(){this._enabled||(ze(this._dragStartTarget,yn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(bn._dragging===this&&this.finishDrag(!0),je(this._dragStartTarget,yn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!ye(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)bn._dragging===this&&this.finishDrag();else if(!(bn._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches)&&(bn._dragging=this,this._preventOutline&&Ie(this._element),Le(),ie(),!this._moving)){this.fire("down");var e=t.touches?t.touches[0]:t,n=De(this._element);this._startPoint=new R(e.clientX,e.clientY),this._startPos=Te(this._element),this._parentScale=Oe(n);var i="mousedown"===t.type;ze(document,i?"mousemove":"touchmove",this._onMove,this),ze(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new R(e.clientX,e.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,qe(t),this._moved||(this.fire("dragstart"),this._moved=!0,be(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),be(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),Ce(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){_e(document.body,"leaflet-dragging"),this._lastTarget&&(_e(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),je(document,"mousemove touchmove",this._onMove,this),je(document,"mouseup touchend touchcancel",this._onUp,this),Me(),se();var e=this._moved&&this._moving;this._moving=!1,bn._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function _n(t,e,n){var i,s,r,o,a,l,c,h,u,d=[1,4,2,8];for(s=0,c=t.length;s<c;s++)t[s]._code=Rn(t[s],e);for(o=0;o<4;o++){for(h=d[o],i=[],s=0,r=(c=t.length)-1;s<c;r=s++)a=t[s],l=t[r],a._code&h?l._code&h||((u=In(l,a,h,e,n))._code=Rn(u,e),i.push(u)):(l._code&h&&((u=In(l,a,h,e,n))._code=Rn(u,e),i.push(u)),i.push(a));t=i}return t}function wn(t,e){var n,i,s,r,o,a,l,c,h;if(!t||0===t.length)throw new Error("latlngs not passed");Nn(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var u=U([0,0]),d=j(t);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(u=xn(t));var p=t.length,f=[];for(n=0;n<p;n++){var g=U(t[n]);f.push(e.project(U([g.lat-u.lat,g.lng-u.lng])))}for(a=l=c=0,n=0,i=p-1;n<p;i=n++)s=f[n],r=f[i],o=s.y*r.x-r.y*s.x,l+=(s.x+r.x)*o,c+=(s.y+r.y)*o,a+=3*o;h=0===a?f[0]:[l/a,c/a];var m=e.unproject(O(h));return U([m.lat+u.lat,m.lng+u.lng])}function xn(t){for(var e=0,n=0,i=0,s=0;s<t.length;s++){var r=U(t[s]);e+=r.lat,n+=r.lng,i++}return U([e/i,n/i])}var Sn,An={__proto__:null,clipPolygon:_n,polygonCenter:wn,centroid:xn};function kn(t,e){if(!e||!t.length)return t.slice();var n=e*e;return t=Tn(t=Ln(t,n),n)}function En(t,e,n){return Math.sqrt(On(t,e,n,!0))}function Cn(t,e,n){return On(t,e,n)}function Tn(t,e){var n=t.length,i=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(n);i[0]=i[n-1]=1,Pn(t,i,e,0,n-1);var s,r=[];for(s=0;s<n;s++)i[s]&&r.push(t[s]);return r}function Pn(t,e,n,i,s){var r,o,a,l=0;for(o=i+1;o<=s-1;o++)(a=On(t[o],t[i],t[s],!0))>l&&(r=o,l=a);l>n&&(e[r]=1,Pn(t,e,n,i,r),Pn(t,e,n,r,s))}function Ln(t,e){for(var n=[t[0]],i=1,s=0,r=t.length;i<r;i++)Dn(t[i],t[s])>e&&(n.push(t[i]),s=i);return s<r-1&&n.push(t[r-1]),n}function Mn(t,e,n,i,s){var r,o,a,l=i?Sn:Rn(t,n),c=Rn(e,n);for(Sn=c;;){if(!(l|c))return[t,e];if(l&c)return!1;a=Rn(o=In(t,e,r=l||c,n,s),n),r===l?(t=o,l=a):(e=o,c=a)}}function In(t,e,n,i,s){var r,o,a=e.x-t.x,l=e.y-t.y,c=i.min,h=i.max;return 8&n?(r=t.x+a*(h.y-t.y)/l,o=h.y):4&n?(r=t.x+a*(c.y-t.y)/l,o=c.y):2&n?(r=h.x,o=t.y+l*(h.x-t.x)/a):1&n&&(r=c.x,o=t.y+l*(c.x-t.x)/a),new R(r,o,s)}function Rn(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n}function Dn(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function On(t,e,n,i){var s,r=e.x,o=e.y,a=n.x-r,l=n.y-o,c=a*a+l*l;return c>0&&((s=((t.x-r)*a+(t.y-o)*l)/c)>1?(r=n.x,o=n.y):s>0&&(r+=a*s,o+=l*s)),a=t.x-r,l=t.y-o,i?a*a+l*l:new R(r,o)}function Nn(t){return!v(t[0])||"object"!==typeof t[0][0]&&"undefined"!==typeof t[0][0]}function zn(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Nn(t)}function Fn(t,e){var n,i,s,r,o,a,l,c;if(!t||0===t.length)throw new Error("latlngs not passed");Nn(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var h=U([0,0]),u=j(t);u.getNorthWest().distanceTo(u.getSouthWest())*u.getNorthEast().distanceTo(u.getNorthWest())<1700&&(h=xn(t));var d=t.length,p=[];for(n=0;n<d;n++){var f=U(t[n]);p.push(e.project(U([f.lat-h.lat,f.lng-h.lng])))}for(n=0,i=0;n<d-1;n++)i+=p[n].distanceTo(p[n+1])/2;if(0===i)c=p[0];else for(n=0,r=0;n<d-1;n++)if(o=p[n],a=p[n+1],(r+=s=o.distanceTo(a))>i){l=(r-i)/s,c=[a.x-l*(a.x-o.x),a.y-l*(a.y-o.y)];break}var g=e.unproject(O(c));return U([g.lat+h.lat,g.lng+h.lng])}var jn={__proto__:null,simplify:kn,pointToSegmentDistance:En,closestPointOnSegment:Cn,clipSegment:Mn,_getEdgeIntersection:In,_getBitCode:Rn,_sqClosestPointOnSegment:On,isFlat:Nn,_flat:zn,polylineCenter:Fn},Bn={project:function(t){return new R(t.lng,t.lat)},unproject:function(t){return new B(t.y,t.x)},bounds:new N([-180,-90],[180,90])},Un={R:6378137,R_MINOR:6356752.314245179,bounds:new N([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,n=this.R,i=t.lat*e,s=this.R_MINOR/n,r=Math.sqrt(1-s*s),o=r*Math.sin(i),a=Math.tan(Math.PI/4-i/2)/Math.pow((1-o)/(1+o),r/2);return i=-n*Math.log(Math.max(a,1e-10)),new R(t.lng*e*n,i)},unproject:function(t){for(var e,n=180/Math.PI,i=this.R,s=this.R_MINOR/i,r=Math.sqrt(1-s*s),o=Math.exp(-t.y/i),a=Math.PI/2-2*Math.atan(o),l=0,c=.1;l<15&&Math.abs(c)>1e-7;l++)e=r*Math.sin(a),e=Math.pow((1-e)/(1+e),r/2),a+=c=Math.PI/2-2*Math.atan(o*e)-a;return new B(a*n,t.x*n/i)}},Hn={__proto__:null,LonLat:Bn,Mercator:Un,SphericalMercator:V},$n=n({},$,{code:"EPSG:3395",projection:Un,transformation:function(){var t=.5/(Math.PI*Un.R);return q(t,.5,-t,.5)}()}),Wn=n({},$,{code:"EPSG:4326",projection:Bn,transformation:q(1/180,1,-1/180,.5)}),Vn=n({},H,{projection:Bn,transformation:q(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(n*n+i*i)},infinite:!0});H.Earth=$,H.EPSG3395=$n,H.EPSG3857=Z,H.EPSG900913=K,H.EPSG4326=Wn,H.Simple=Vn;var Gn=I.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[o(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[o(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var n=this.getEvents();e.on(n,this),this.once("remove",function(){e.off(n,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});nn.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=o(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=o(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return o(t)in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},_addLayers:function(t){for(var e=0,n=(t=t?v(t)?t:[t]:[]).length;e<n;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[o(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=o(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var s=this._zoomBoundLayers[i].options;t=void 0===s.minZoom?t:Math.min(t,s.minZoom),e=void 0===s.maxZoom?e:Math.max(e,s.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var qn=Gn.extend({initialize:function(t,e){var n,i;if(p(this,e),this._layers={},t)for(n=0,i=t.length;n<i;n++)this.addLayer(t[n])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"===typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,n,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)(n=this._layers[e])[t]&&n[t].apply(n,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o(t)}}),Zn=function(t,e){return new qn(t,e)},Kn=qn.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),qn.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),qn.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new F;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),Xn=function(t,e){return new Kn(t,e)},Yn=T.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){p(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(t,e){var n=this.options,i=n[e+"Size"];"number"===typeof i&&(i=[i,i]);var s=O(i),r=O("shadow"===e&&n.shadowAnchor||n.iconAnchor||s&&s.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(n.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Nt.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Jn(t){return new Yn(t)}var Qn=Yn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!==typeof Qn.imagePath&&(Qn.imagePath=this._detectIconPath()),(this.options.imagePath||Qn.imagePath)+Yn.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,n){var i=e.exec(t);return i&&i[n]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=pe("div","leaflet-default-icon-path",document.body),e=de(t,"background-image")||de(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),ti=mn.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new bn(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),be(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&_e(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,n=e._map,i=this._marker.options.autoPanSpeed,s=this._marker.options.autoPanPadding,r=Te(e._icon),o=n.getPixelBounds(),a=n.getPixelOrigin(),l=z(o.min._subtract(a).add(s),o.max._subtract(a).subtract(s));if(!l.contains(r)){var c=O((Math.max(l.max.x,r.x)-l.max.x)/(o.max.x-l.max.x)-(Math.min(l.min.x,r.x)-l.min.x)/(o.min.x-l.min.x),(Math.max(l.max.y,r.y)-l.max.y)/(o.max.y-l.max.y)-(Math.min(l.min.y,r.y)-l.min.y)/(o.min.y-l.min.y)).multiplyBy(i);n.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),Ce(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=k(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(E(this._panRequest),this._panRequest=k(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,n=e._shadow,i=Te(e._icon),s=e._map.layerPointToLatLng(i);n&&Ce(n,i),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){E(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),ei=Gn.extend({options:{icon:new Qn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){p(this,e),this._latlng=U(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=U(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(n.title=t.title),"IMG"===n.tagName&&(n.alt=t.alt||"")),be(n,e),t.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ze(n,"focus",this._panOnFocus,this);var s=t.icon.createShadow(this._shadow),r=!1;s!==this._shadow&&(this._removeShadow(),r=!0),s&&(be(s,e),s.alt=""),this._shadow=s,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),s&&r&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&je(this._icon,"focus",this._panOnFocus,this),fe(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&fe(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&Ce(this._icon,t),this._shadow&&Ce(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(be(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ti)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ti(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&Se(this._icon,t),this._shadow&&Se(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,n=e.iconSize?O(e.iconSize):O(0,0),i=e.iconAnchor?O(e.iconAnchor):O(0,0);t.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:n.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function ni(t,e){return new ei(t,e)}var ii=Gn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return p(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),si=ii.extend({options:{fill:!0,radius:10},initialize:function(t,e){p(this,e),this._latlng=U(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=U(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return ii.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),i=[t+n,e+n];this._pxBounds=new N(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ri(t,e){return new si(t,e)}var oi=si.extend({initialize:function(t,e,i){if("number"===typeof e&&(e=n({},i,{radius:e})),p(this,e),this._latlng=U(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new F(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:ii.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===$.distance){var s=Math.PI/180,r=this._mRadius/$.R/s,o=n.project([e+r,t]),a=n.project([e-r,t]),l=o.add(a).divideBy(2),c=n.unproject(l).lat,h=Math.acos((Math.cos(r*s)-Math.sin(e*s)*Math.sin(c*s))/(Math.cos(e*s)*Math.cos(c*s)))/s;(isNaN(h)||0===h)&&(h=r/Math.cos(Math.PI/180*e)),this._point=l.subtract(n.getPixelOrigin()),this._radius=isNaN(h)?0:l.x-n.project([c,t-h]).x,this._radiusY=l.y-o.y}else{var u=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(u).x}this._updateBounds()}});function ai(t,e,n){return new oi(t,e,n)}var li=ii.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){p(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,n,i=1/0,s=null,r=On,o=0,a=this._parts.length;o<a;o++)for(var l=this._parts[o],c=1,h=l.length;c<h;c++){var u=r(t,e=l[c-1],n=l[c],!0);u<i&&(i=u,s=r(t,e,n))}return s&&(s.distance=Math.sqrt(i)),s},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Fn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=U(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new F,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return Nn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=Nn(t),i=0,s=t.length;i<s;i++)n?(e[i]=U(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new N;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new R(t,t);this._rawPxBounds&&(this._pxBounds=new N([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,n){var i,s,r=t[0]instanceof B,o=t.length;if(r){for(s=[],i=0;i<o;i++)s[i]=this._map.latLngToLayerPoint(t[i]),n.extend(s[i]);e.push(s)}else for(i=0;i<o;i++)this._projectLatlngs(t[i],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,n,i,s,r,o,a,l=this._parts;for(e=0,i=0,s=this._rings.length;e<s;e++)for(n=0,r=(a=this._rings[e]).length;n<r-1;n++)(o=Mn(a[n],a[n+1],t,n,!0))&&(l[i]=l[i]||[],l[i].push(o[0]),o[1]===a[n+1]&&n!==r-2||(l[i].push(o[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,n=0,i=t.length;n<i;n++)t[n]=kn(t[n],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var n,i,s,r,o,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,r=this._parts.length;n<r;n++)for(i=0,s=(o=(a=this._parts[n]).length)-1;i<o;s=i++)if((e||0!==i)&&En(t,a[s],a[i])<=l)return!0;return!1}});function ci(t,e){return new li(t,e)}li._flat=zn;var hi=li.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return wn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=li.prototype._convertLatLngs.call(this,t),n=e.length;return n>=2&&e[0]instanceof B&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){li.prototype._setLatLngs.call(this,t),Nn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Nn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,n=new R(e,e);if(t=new N(t.min.subtract(n),t.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var i,s=0,r=this._rings.length;s<r;s++)(i=_n(this._rings[s],t,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,n,i,s,r,o,a,l,c=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(s=0,a=this._parts.length;s<a;s++)for(r=0,o=(l=(e=this._parts[s]).length)-1;r<l;o=r++)n=e[r],i=e[o],n.y>t.y!==i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(c=!c);return c||li.prototype._containsPoint.call(this,t,!0)}});function ui(t,e){return new hi(t,e)}var di=Kn.extend({initialize:function(t,e){p(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,n,i,s=v(t)?t:t.features;if(s){for(e=0,n=s.length;e<n;e++)((i=s[e]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var r=this.options;if(r.filter&&!r.filter(t))return this;var o=pi(t,r);return o?(o.feature=_i(t),o.defaultOptions=o.options,this.resetStyle(o),r.onEachFeature&&r.onEachFeature(t,o),this.addLayer(o)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=n({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"===typeof e&&(e=e(t.feature)),t.setStyle(e))}});function pi(t,e){var n,i,s,r,o="Feature"===t.type?t.geometry:t,a=o?o.coordinates:null,l=[],c=e&&e.pointToLayer,h=e&&e.coordsToLatLng||gi;if(!a&&!o)return null;switch(o.type){case"Point":return fi(c,t,n=h(a),e);case"MultiPoint":for(s=0,r=a.length;s<r;s++)n=h(a[s]),l.push(fi(c,t,n,e));return new Kn(l);case"LineString":case"MultiLineString":return i=mi(a,"LineString"===o.type?0:1,h),new li(i,e);case"Polygon":case"MultiPolygon":return i=mi(a,"Polygon"===o.type?1:2,h),new hi(i,e);case"GeometryCollection":for(s=0,r=o.geometries.length;s<r;s++){var u=pi({geometry:o.geometries[s],type:"Feature",properties:t.properties},e);u&&l.push(u)}return new Kn(l);case"FeatureCollection":for(s=0,r=o.features.length;s<r;s++){var d=pi(o.features[s],e);d&&l.push(d)}return new Kn(l);default:throw new Error("Invalid GeoJSON object.")}}function fi(t,e,n,i){return t?t(e,n):new ei(n,i&&i.markersInheritOptions&&i)}function gi(t){return new B(t[1],t[0],t[2])}function mi(t,e,n){for(var i,s=[],r=0,o=t.length;r<o;r++)i=e?mi(t[r],e-1,n):(n||gi)(t[r]),s.push(i);return s}function vi(t,e){return void 0!==(t=U(t)).alt?[h(t.lng,e),h(t.lat,e),h(t.alt,e)]:[h(t.lng,e),h(t.lat,e)]}function yi(t,e,n,i){for(var s=[],r=0,o=t.length;r<o;r++)s.push(e?yi(t[r],Nn(t[r])?0:e-1,n,i):vi(t[r],i));return!e&&n&&s.length>0&&s.push(s[0].slice()),s}function bi(t,e){return t.feature?n({},t.feature,{geometry:e}):_i(e)}function _i(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var wi={toGeoJSON:function(t){return bi(this,{type:"Point",coordinates:vi(this.getLatLng(),t)})}};function xi(t,e){return new di(t,e)}ei.include(wi),oi.include(wi),si.include(wi),li.include({toGeoJSON:function(t){var e=!Nn(this._latlngs);return bi(this,{type:(e?"Multi":"")+"LineString",coordinates:yi(this._latlngs,e?1:0,!1,t)})}}),hi.include({toGeoJSON:function(t){var e=!Nn(this._latlngs),n=e&&!Nn(this._latlngs[0]),i=yi(this._latlngs,n?2:e?1:0,!0,t);return e||(i=[i]),bi(this,{type:(n?"Multi":"")+"Polygon",coordinates:i})}}),qn.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(n){e.push(n.toGeoJSON(t).geometry.coordinates)}),bi(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var n="GeometryCollection"===e,i=[];return this.eachLayer(function(e){if(e.toGeoJSON){var s=e.toGeoJSON(t);if(n)i.push(s.geometry);else{var r=_i(s);"FeatureCollection"===r.type?i.push.apply(i,r.features):i.push(r)}}}),n?bi(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Si=xi,Ai=Gn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,n){this._url=t,this._bounds=j(e),p(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(be(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){fe(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&me(this._image),this},bringToBack:function(){return this._map&&ve(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=j(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:pe("img");be(e,"leaflet-image-layer"),this._zoomAnimated&&be(e,"leaflet-zoom-animated"),this.options.className&&be(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onload=s(this.fire,this,"load"),e.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;Ee(this._image,n,e)},_reset:function(){var t=this._image,e=new N(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=e.getSize();Ce(t,e.min),t.style.width=n.x+"px",t.style.height=n.y+"px"},_updateOpacity:function(){Se(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),ki=function(t,e,n){return new Ai(t,e,n)},Ei=Ai.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:pe("video");if(be(e,"leaflet-image-layer"),this._zoomAnimated&&be(e,"leaflet-zoom-animated"),this.options.className&&be(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onloadeddata=s(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),i=[],r=0;r<n.length;r++)i.push(n[r].src);this._url=n.length>0?i:[e.src]}else{v(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var o=0;o<this._url.length;o++){var a=pe("source");a.src=this._url[o],e.appendChild(a)}}}});function Ci(t,e,n){return new Ei(t,e,n)}var Ti=Ai.extend({_initImage:function(){var t=this._image=this._url;be(t,"leaflet-image-layer"),this._zoomAnimated&&be(t,"leaflet-zoom-animated"),this.options.className&&be(t,this.options.className),t.onselectstart=c,t.onmousemove=c}});function Pi(t,e,n){return new Ti(t,e,n)}var Li=Gn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof B||v(t))?(this._latlng=U(t),p(this,e)):(p(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&Se(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&Se(this._container,1),this.bringToFront(),this.options.interactive&&(be(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(Se(this._container,0),this._removeTimeout=setTimeout(s(fe,void 0,this._container),200)):fe(this._container),this.options.interactive&&(_e(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=U(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&me(this._container),this},bringToBack:function(){return this._map&&ve(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof Kn){e=null;var n=this._source._layers;for(var i in n)if(n[i]._map){e=n[i];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=O(this.options.offset),n=this._getAnchor();this._zoomAnimated?Ce(this._container,t.add(n)):e=e.add(t).add(n);var i=this._containerBottom=-e.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=s+"px"}},_getAnchor:function(){return[0,0]}});nn.include({_initOverlay:function(t,e,n,i){var s=e;return s instanceof t||(s=new t(i).setContent(e)),n&&s.setLatLng(n),s}}),Gn.include({_initOverlay:function(t,e,n,i){var s=n;return s instanceof t?(p(s,i),s._source=this):(s=e&&!i?e:new t(i,this)).setContent(n),s}});var Mi=Li.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Li.prototype.openOn.call(this,t)},onAdd:function(t){Li.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof ii||this._source.on("preclick",We))},onRemove:function(t){Li.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof ii||this._source.off("preclick",We))},getEvents:function(){var t=Li.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=pe("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=pe("div",t+"-content-wrapper",e);if(this._contentNode=pe("div",t+"-content",n),Ge(e),Ve(this._contentNode),ze(e,"contextmenu",We),this._tipContainer=pe("div",t+"-tip-container",e),this._tip=pe("div",t+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=pe("a",t+"-close-button",e);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',ze(i,"click",function(t){qe(t),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,s=this.options.maxHeight,r="leaflet-popup-scrolled";s&&i>s?(e.height=s+"px",be(t,r)):_e(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();Ce(this._container,e.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(de(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+e,i=this._containerWidth,s=new R(this._containerLeft,-n-this._containerBottom);s._add(Te(this._container));var r=t.layerPointToContainerPoint(s),o=O(this.options.autoPanPadding),a=O(this.options.autoPanPaddingTopLeft||o),l=O(this.options.autoPanPaddingBottomRight||o),c=t.getSize(),h=0,u=0;r.x+i+l.x>c.x&&(h=r.x+i-c.x+l.x),r.x-h-a.x<0&&(h=r.x-a.x),r.y+n+l.y>c.y&&(u=r.y+n-c.y+l.y),r.y-u-a.y<0&&(u=r.y-a.y),(h||u)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([h,u]))}},_getAnchor:function(){return O(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ii=function(t,e){return new Mi(t,e)};nn.mergeOptions({closePopupOnClick:!0}),nn.include({openPopup:function(t,e,n){return this._initOverlay(Mi,t,e,n).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),Gn.include({bindPopup:function(t,e){return this._popup=this._initOverlay(Mi,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Kn||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){Ze(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof ii?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var Ri=Li.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Li.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Li.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Li.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=pe("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+o(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,n,i=this._map,s=this._container,r=i.latLngToContainerPoint(i.getCenter()),o=i.layerPointToContainerPoint(t),a=this.options.direction,l=s.offsetWidth,c=s.offsetHeight,h=O(this.options.offset),u=this._getAnchor();"top"===a?(e=l/2,n=c):"bottom"===a?(e=l/2,n=0):"center"===a?(e=l/2,n=c/2):"right"===a?(e=0,n=c/2):"left"===a?(e=l,n=c/2):o.x<r.x?(a="right",e=0,n=c/2):(a="left",e=l+2*(h.x+u.x),n=c/2),t=t.subtract(O(e,n,!0)).add(h).add(u),_e(s,"leaflet-tooltip-right"),_e(s,"leaflet-tooltip-left"),_e(s,"leaflet-tooltip-top"),_e(s,"leaflet-tooltip-bottom"),be(s,"leaflet-tooltip-"+a),Ce(s,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&Se(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return O(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Di=function(t,e){return new Ri(t,e)};nn.include({openTooltip:function(t,e,n){return this._initOverlay(Ri,t,e,n).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Gn.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ri,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[e](n),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Kn||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"===typeof t.getElement&&t.getElement();e&&(ze(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),ze(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"===typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)})}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,n,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}});var Oi=Yn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),n=this.options;if(n.html instanceof Element?(ge(e),e.appendChild(n.html)):e.innerHTML=!1!==n.html?n.html:"",n.bgPos){var i=O(n.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});function Ni(t){return new Oi(t)}Yn.Default=Qn;var zi=Gn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Nt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){p(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),fe(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(me(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ve(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof R?t:new R(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,n=this.getPane().children,i=-t(-1/0,1/0),s=0,r=n.length;s<r;s++)e=n[s].style.zIndex,n[s]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Nt.ielt9){Se(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var i in this._tiles){var s=this._tiles[i];if(s.current&&s.loaded){var r=Math.min(1,(t-s.loaded)/200);Se(s.el,r),r<1?e=!0:(s.active?n=!0:this._onOpaqueTile(s),s.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(E(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this))}},_onOpaqueTile:c,_initContainer:function(){this._container||(this._container=pe("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===t?(this._levels[n].el.style.zIndex=e-Math.abs(t-n),this._onUpdateLevel(n)):(fe(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var i=this._levels[t],s=this._map;return i||((i=this._levels[t]={}).el=pe("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=s.project(s.unproject(s.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,s.getCenter(),s.getZoom()),c(i.el.offsetWidth),this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:c,_onRemoveLevel:c,_onCreateLevel:c,_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)fe(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,n,i){var s=Math.floor(t/2),r=Math.floor(e/2),o=n-1,a=new R(+s,+r);a.z=+o;var l=this._tileCoordsToKey(a),c=this._tiles[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),o>i&&this._retainParent(s,r,o,i))},_retainChildren:function(t,e,n,i){for(var s=2*t;s<2*t+2;s++)for(var r=2*e;r<2*e+2;r++){var o=new R(s,r);o.z=n+1;var a=this._tileCoordsToKey(o),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),n+1<i&&this._retainChildren(s,r,n+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,n,i){var s=Math.round(e);s=void 0!==this.options.maxZoom&&s>this.options.maxZoom||void 0!==this.options.minZoom&&s<this.options.minZoom?void 0:this._clampZoom(s);var r=this.options.updateWhenZooming&&s!==this._tileZoom;i&&!r||(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==s&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var n in this._levels)this._setZoomTransform(this._levels[n],t,e)},_setZoomTransform:function(t,e,n){var i=this._map.getZoomScale(n,t.zoom),s=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,n)).round();Nt.any3d?Ee(t.el,s,i):Ce(t.el,s)},_resetGrid:function(){var t=this._map,e=t.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,s=this._map.getPixelWorldBounds(this._tileZoom);s&&(this._globalTileRange=this._pxBoundsToTileRange(s)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/n.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/n.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/n.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,n=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(n,this._tileZoom),s=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*i);return new N(s.subtract(r),s.add(r))},_update:function(t){var e=this._map;if(e){var n=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(t),s=this._pxBoundsToTileRange(i),r=s.getCenter(),o=[],a=this.options.keepBuffer,l=new N(s.getBottomLeft().subtract([a,-a]),s.getTopRight().add([a,-a]));if(!(isFinite(s.min.x)&&isFinite(s.min.y)&&isFinite(s.max.x)&&isFinite(s.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var c in this._tiles){var h=this._tiles[c].coords;h.z===this._tileZoom&&l.contains(new R(h.x,h.y))||(this._tiles[c].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(t,n);else{for(var u=s.min.y;u<=s.max.y;u++)for(var d=s.min.x;d<=s.max.x;d++){var p=new R(d,u);if(p.z=this._tileZoom,this._isValidTile(p)){var f=this._tiles[this._tileCoordsToKey(p)];f?f.current=!0:o.push(p)}}if(o.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)}),0!==o.length){this._loading||(this._loading=!0,this.fire("loading"));var g=document.createDocumentFragment();for(d=0;d<o.length;d++)this._addTile(o[d],g);this._level.el.appendChild(g)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return j(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,n=this.getTileSize(),i=t.scaleBy(n),s=i.add(n);return[e.unproject(i,t.z),e.unproject(s,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),n=new F(e[0],e[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new R(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(fe(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){be(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=c,t.onmousemove=c,Nt.ielt9&&this.options.opacity<1&&Se(t,this.options.opacity)},_addTile:function(t,e){var n=this._getTilePos(t),i=this._tileCoordsToKey(t),r=this.createTile(this._wrapCoords(t),s(this._tileReady,this,t));this._initTile(r),this.createTile.length<2&&k(s(this._tileReady,this,t,null,r)),Ce(r,n),this._tiles[i]={el:r,coords:t,current:!0},e.appendChild(r),this.fire("tileloadstart",{tile:r,coords:t})},_tileReady:function(t,e,n){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var i=this._tileCoordsToKey(t);(n=this._tiles[i])&&(n.loaded=+new Date,this._map._fadeAnimated?(Se(n.el,0),E(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(be(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Nt.ielt9||!this._map._fadeAnimated?k(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new R(this._wrapX?l(t.x,this._wrapX):t.x,this._wrapY?l(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new N(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function Fi(t){return new zi(t)}var ji=zi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=p(this,e)).detectRetina&&Nt.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"===typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return ze(n,"load",s(this._tileOnLoad,this,e,n)),ze(n,"error",s(this._tileOnError,this,e,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:Nt.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}return m(this._url,n(e,this.options))},_tileOnLoad:function(t,e){Nt.ielt9?setTimeout(s(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(n,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=c,e.onerror=c,!e.complete)){e.src=b;var n=this._tiles[t].coords;fe(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:n})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",b),zi.prototype._removeTile.call(this,t)},_tileReady:function(t,e,n){if(this._map&&(!n||n.getAttribute("src")!==b))return zi.prototype._tileReady.call(this,t,e,n)}});function Bi(t,e){return new ji(t,e)}var Ui=ji.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=n({},this.defaultWmsParams);for(var s in e)s in this.options||(i[s]=e[s]);var r=(e=p(this,e)).detectRetina&&Nt.retina?2:1,o=this.getTileSize();i.width=o.x*r,i.height=o.y*r,this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,ji.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),n=this._crs,i=z(n.project(e[0]),n.project(e[1])),s=i.min,r=i.max,o=(this._wmsVersion>=1.3&&this._crs===Wn?[s.y,s.x,r.y,r.x]:[s.x,s.y,r.x,r.y]).join(","),a=ji.prototype.getTileUrl.call(this,t);return a+f(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+o},setParams:function(t,e){return n(this.wmsParams,t),e||this.redraw(),this}});function Hi(t,e){return new Ui(t,e)}ji.WMS=Ui,Bi.wms=Hi;var $i=Gn.extend({options:{padding:.1},initialize:function(t){p(this,t),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),be(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),r=i.multiplyBy(-n).add(s).subtract(this._map._getNewPixelOrigin(t,e));Nt.any3d?Ee(this._container,r,n):Ce(this._container,r)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new N(n,n.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Wi=$i.extend({options:{tolerance:0},getEvents:function(){var t=$i.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){$i.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");ze(t,"mousemove",this._onMouseMove,this),ze(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ze(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){E(this._redrawRequest),delete this._ctx,fe(this._container),je(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){$i.prototype._update.call(this);var t=this._bounds,e=this._container,n=t.getSize(),i=Nt.retina?2:1;Ce(e,t.min),e.width=i*n.x,e.height=i*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",Nt.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){$i.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[o(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,i=e.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete t._order,delete this._layers[o(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"===typeof t.options.dashArray){var e,n,i=t.options.dashArray.split(/[, ]+/),s=[];for(n=0;n<i.length;n++){if(e=Number(i[n]),isNaN(e))return;s.push(e)}t.options._dashArray=s}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||k(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new N,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var n,i,s,r,o=t._parts,a=o.length,l=this._ctx;if(a){for(l.beginPath(),n=0;n<a;n++){for(i=0,s=o[n].length;i<s;i++)r=o[n][i],l[i?"lineTo":"moveTo"](r.x,r.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=this._ctx,i=Math.max(Math.round(t._radius),1),s=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==s&&(n.save(),n.scale(1,s)),n.beginPath(),n.arc(e.x,e.y/s,i,0,2*Math.PI,!1),1!==s&&n.restore(),this._fillStroke(n,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e,n,i=this._map.mouseEventToLayerPoint(t),s=this._drawFirst;s;s=s.next)(e=s.layer).options.interactive&&e._containsPoint(i)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(n=e);this._fireEvent(!!n&&[n],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(_e(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var n,i,r=this._drawFirst;r;r=r.next)(n=r.layer).options.interactive&&n._containsPoint(e)&&(i=n);i!==this._hoveredLayer&&(this._handleMouseOut(t),i&&(be(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var n=e.next,i=e.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var n=e.next,i=e.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function Vi(t){return Nt.canvas?new Wi(t):null}var Gi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),qi={_initContainer:function(){this._container=pe("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||($i.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=Gi("shape");be(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=Gi("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[o(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;fe(e),t.removeInteractiveTarget(e),delete this._layers[o(t)]},_updateStyle:function(t){var e=t._stroke,n=t._fill,i=t.options,s=t._container;s.stroked=!!i.stroke,s.filled=!!i.fill,i.stroke?(e||(e=t._stroke=Gi("stroke")),s.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=v(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(s.removeChild(e),t._stroke=null),i.fill?(n||(n=t._fill=Gi("fill")),s.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(s.removeChild(n),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),n=Math.round(t._radius),i=Math.round(t._radiusY||n);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+n+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){me(t._container)},_bringToBack:function(t){ve(t._container)}},Zi=Nt.vml?Gi:X,Ki=$i.extend({_initContainer:function(){this._container=Zi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Zi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){fe(this._container),je(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){$i.prototype._update.call(this);var t=this._bounds,e=t.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,n.setAttribute("width",e.x),n.setAttribute("height",e.y)),Ce(n,t.min),n.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=Zi("path");t.options.className&&be(e,t.options.className),t.options.interactive&&be(e,"leaflet-interactive"),this._updateStyle(t),this._layers[o(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){fe(t._path),t.removeInteractiveTarget(t._path),delete this._layers[o(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,n=t.options;e&&(n.stroke?(e.setAttribute("stroke",n.color),e.setAttribute("stroke-opacity",n.opacity),e.setAttribute("stroke-width",n.weight),e.setAttribute("stroke-linecap",n.lineCap),e.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?e.setAttribute("stroke-dasharray",n.dashArray):e.removeAttribute("stroke-dasharray"),n.dashOffset?e.setAttribute("stroke-dashoffset",n.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),n.fill?(e.setAttribute("fill",n.fillColor||n.color),e.setAttribute("fill-opacity",n.fillOpacity),e.setAttribute("fill-rule",n.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,Y(t._parts,e))},_updateCircle:function(t){var e=t._point,n=Math.max(Math.round(t._radius),1),i="a"+n+","+(Math.max(Math.round(t._radiusY),1)||n)+" 0 1,0 ",s=t._empty()?"M0 0":"M"+(e.x-n)+","+e.y+i+2*n+",0 "+i+2*-n+",0 ";this._setPath(t,s)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){me(t._path)},_bringToBack:function(t){ve(t._path)}});function Xi(t){return Nt.svg||Nt.vml?new Ki(t):null}Nt.vml&&Ki.include(qi),nn.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&Vi(t)||Xi(t)}});var Yi=hi.extend({initialize:function(t,e){hi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=j(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function Ji(t,e){return new Yi(t,e)}Ki.create=Zi,Ki.pointsToPath=Y,di.geometryToLayer=pi,di.coordsToLatLng=gi,di.coordsToLatLngs=mi,di.latLngToCoords=vi,di.latLngsToCoords=yi,di.getFeature=bi,di.asFeature=_i,nn.mergeOptions({boxZoom:!0});var Qi=mn.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){ze(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){je(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){fe(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),ie(),Le(),this._startPoint=this._map.mouseEventToContainerPoint(t),ze(document,{contextmenu:Ze,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=pe("div","leaflet-zoom-box",this._container),be(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new N(this._point,this._startPoint),n=e.getSize();Ce(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(fe(this._box),_e(this._container,"leaflet-crosshair")),se(),Me(),je(document,{contextmenu:Ze,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var e=new F(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});nn.addInitHook("addHandler","boxZoom",Qi),nn.mergeOptions({doubleClickZoom:!0});var ts=mn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom(),i=e.options.zoomDelta,s=t.originalEvent.shiftKey?n-i:n+i;"center"===e.options.doubleClickZoom?e.setZoom(s):e.setZoomAround(t.containerPoint,s)}});nn.addInitHook("addHandler","doubleClickZoom",ts),nn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var es=mn.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new bn(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}be(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){_e(this._map._container,"leaflet-grab"),_e(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=j(this._map.options.maxBounds);this._offsetLimit=z(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,s=(i-e+n)%t+e-n,r=(i+e+n)%t-e-n,o=Math.abs(s+n)<Math.abs(r+n)?s:r;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=o},_onDragEnd:function(t){var e=this._map,n=e.options,i=!n.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);var s=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,o=n.easeLinearity,a=s.multiplyBy(o/r),l=a.distanceTo([0,0]),c=Math.min(n.inertiaMaxSpeed,l),h=a.multiplyBy(c/l),u=c/(n.inertiaDeceleration*o),d=h.multiplyBy(-u/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),k(function(){e.panBy(d,{duration:u,easeLinearity:o,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});nn.addInitHook("addHandler","dragging",es),nn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var ns=mn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),ze(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),je(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,n=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,n,i=this._panKeys={},s=this.keyCodes;for(e=0,n=s.left.length;e<n;e++)i[s.left[e]]=[-1*t,0];for(e=0,n=s.right.length;e<n;e++)i[s.right[e]]=[t,0];for(e=0,n=s.down.length;e<n;e++)i[s.down[e]]=[0,t];for(e=0,n=s.up.length;e<n;e++)i[s.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,n,i=this._zoomKeys={},s=this.keyCodes;for(e=0,n=s.zoomIn.length;e<n;e++)i[s.zoomIn[e]]=t;for(e=0,n=s.zoomOut.length;e<n;e++)i[s.zoomOut[e]]=-t},_addHooks:function(){ze(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){je(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,n=t.keyCode,i=this._map;if(n in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(e=this._panKeys[n],t.shiftKey&&(e=O(e).multiplyBy(3)),i.options.maxBounds&&(e=i._limitOffset(O(e),i.options.maxBounds)),i.options.worldCopyJump){var s=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(e)));i.panTo(s)}else i.panBy(e)}else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Ze(t)}}});nn.addInitHook("addHandler","keyboard",ns),nn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var is=mn.extend({addHooks:function(){ze(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){je(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Je(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),i),Ze(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),n=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),s=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,r=n?Math.ceil(s/n)*n:s,o=t._limitZoom(e+(this._delta>0?r:-r))-e;this._delta=0,this._startTime=null,o&&("center"===t.options.scrollWheelZoom?t.setZoom(e+o):t.setZoomAround(this._lastMousePos,e+o))}});nn.addInitHook("addHandler","scrollWheelZoom",is);var ss=600;nn.mergeOptions({tapHold:Nt.touchNative&&Nt.safari&&Nt.mobile,tapTolerance:15});var rs=mn.extend({addHooks:function(){ze(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){je(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new R(e.clientX,e.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(ze(document,"touchend",qe),ze(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),ss),ze(document,"touchend touchcancel contextmenu",this._cancel,this),ze(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){je(document,"touchend",qe),je(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),je(document,"touchend touchcancel contextmenu",this._cancel,this),je(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new R(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var n=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});n._simulated=!0,e.target.dispatchEvent(n)}});nn.addInitHook("addHandler","tapHold",rs),nn.mergeOptions({touchZoom:Nt.touch,bounceAtZoomLimits:!0});var os=mn.extend({addHooks:function(){be(this._map._container,"leaflet-touch-zoom"),ze(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){_e(this._map._container,"leaflet-touch-zoom"),je(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),ze(document,"touchmove",this._onTouchMove,this),ze(document,"touchend touchcancel",this._onTouchEnd,this),qe(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]),r=n.distanceTo(i)/this._startDist;if(this._zoom=e.getScaleZoom(r,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&r<1||this._zoom>e.getMaxZoom()&&r>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===r)return}else{var o=n._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===r&&0===o.x&&0===o.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),E(this._animRequest);var a=s(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=k(a,this,!0),qe(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,E(this._animRequest),je(document,"touchmove",this._onTouchMove,this),je(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});nn.addInitHook("addHandler","touchZoom",os),nn.BoxZoom=Qi,nn.DoubleClickZoom=ts,nn.Drag=es,nn.Keyboard=ns,nn.ScrollWheelZoom=is,nn.TapHold=rs,nn.TouchZoom=os,t.Bounds=N,t.Browser=Nt,t.CRS=H,t.Canvas=Wi,t.Circle=oi,t.CircleMarker=si,t.Class=T,t.Control=rn,t.DivIcon=Oi,t.DivOverlay=Li,t.DomEvent=tn,t.DomUtil=Ne,t.Draggable=bn,t.Evented=I,t.FeatureGroup=Kn,t.GeoJSON=di,t.GridLayer=zi,t.Handler=mn,t.Icon=Yn,t.ImageOverlay=Ai,t.LatLng=B,t.LatLngBounds=F,t.Layer=Gn,t.LayerGroup=qn,t.LineUtil=jn,t.Map=nn,t.Marker=ei,t.Mixin=vn,t.Path=ii,t.Point=R,t.PolyUtil=An,t.Polygon=hi,t.Polyline=li,t.Popup=Mi,t.PosAnimation=en,t.Projection=Hn,t.Rectangle=Yi,t.Renderer=$i,t.SVG=Ki,t.SVGOverlay=Ti,t.TileLayer=ji,t.Tooltip=Ri,t.Transformation=G,t.Util=C,t.VideoOverlay=Ei,t.bind=s,t.bounds=z,t.canvas=Vi,t.circle=ai,t.circleMarker=ri,t.control=on,t.divIcon=Ni,t.extend=n,t.featureGroup=Xn,t.geoJSON=xi,t.geoJson=Si,t.gridLayer=Fi,t.icon=Jn,t.imageOverlay=ki,t.latLng=U,t.latLngBounds=j,t.layerGroup=Zn,t.map=sn,t.marker=ni,t.point=O,t.polygon=ui,t.polyline=ci,t.popup=Ii,t.rectangle=Ji,t.setOptions=p,t.stamp=o,t.svg=Xi,t.svgOverlay=Pi,t.tileLayer=Bi,t.tooltip=Di,t.transformation=q,t.version=e,t.videoOverlay=Ci;var as=window.L;t.noConflict=function(){return window.L=as,this},window.L=t}(e)},286:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n(392)),r=i(n(611));e.default=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"===typeof fetch?this.fetch=s.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=Object.assign({},this.headers),this.headers[t]=e,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var e,n,i;let s=null,o=null,a=null,l=t.status,c=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=await t.text();""===e||(o="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const i=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),r=null===(n=t.headers.get("content-range"))||void 0===n?void 0:n.split("/");i&&r&&r.length>1&&(a=parseInt(r[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(s={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{const e=await t.text();try{s=JSON.parse(e),Array.isArray(s)&&404===t.status&&(o=[],s=null,l=200,c="OK")}catch(h){404===t.status&&""===e?(l=204,c="No Content"):s={message:e}}if(s&&this.isMaybeSingle&&(null===(i=null===s||void 0===s?void 0:s.details)||void 0===i?void 0:i.includes("0 rows"))&&(s=null,l=200,c="OK"),s&&this.shouldThrowOnError)throw new r.default(s)}return{error:s,data:o,count:a,status:l,statusText:c}});return this.shouldThrowOnError||(n=n.catch(t=>{var e,n,i;return{error:{message:`${null!==(e=null===t||void 0===t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null===t||void 0===t?void 0:t.message}`,details:`${null!==(n=null===t||void 0===t?void 0:t.stack)&&void 0!==n?n:""}`,hint:"",code:`${null!==(i=null===t||void 0===t?void 0:t.code)&&void 0!==i?i:""}`},data:null,count:null,status:0,statusText:""}})),n.then(t,e)}returns(){return this}overrideTypes(){return this}}},288:(t,e)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||f}function y(){}function b(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},v.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},y.prototype=v.prototype;var _=b.prototype=new y;_.constructor=b,g(_,v.prototype),_.isPureReactComponent=!0;var w=Array.isArray,x={H:null,A:null,T:null,S:null,V:null},S=Object.prototype.hasOwnProperty;function A(t,e,i,s,r,o){return i=o.ref,{$$typeof:n,type:t,key:e,ref:void 0!==i?i:null,props:o}}function k(t){return"object"===typeof t&&null!==t&&t.$$typeof===n}var E=/\/+/g;function C(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(t){return e[t]})}(""+t.key):e.toString(36)}function T(){}function P(t,e,s,r,o){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var l,c,h=!1;if(null===t)h=!0;else switch(a){case"bigint":case"string":case"number":h=!0;break;case"object":switch(t.$$typeof){case n:case i:h=!0;break;case d:return P((h=t._init)(t._payload),e,s,r,o)}}if(h)return o=o(t),h=""===r?"."+C(t,0):r,w(o)?(s="",null!=h&&(s=h.replace(E,"$&/")+"/"),P(o,e,s,"",function(t){return t})):null!=o&&(k(o)&&(l=o,c=s+(null==o.key||t&&t.key===o.key?"":(""+o.key).replace(E,"$&/")+"/")+h,o=A(l.type,c,void 0,0,0,l.props)),e.push(o)),1;h=0;var u,f=""===r?".":r+":";if(w(t))for(var g=0;g<t.length;g++)h+=P(r=t[g],e,s,a=f+C(r,g),o);else if("function"===typeof(g=null===(u=t)||"object"!==typeof u?null:"function"===typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(t=g.call(t),g=0;!(r=t.next()).done;)h+=P(r=r.value,e,s,a=f+C(r,g++),o);else if("object"===a){if("function"===typeof t.then)return P(function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch("string"===typeof t.status?t.then(T,T):(t.status="pending",t.then(function(e){"pending"===t.status&&(t.status="fulfilled",t.value=e)},function(e){"pending"===t.status&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}(t),e,s,r,o);throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return h}function L(t,e,n){if(null==t)return t;var i=[],s=0;return P(t,i,"","",function(t){return e.call(n,t,s++)}),i}function M(t){if(-1===t._status){var e=t._result;(e=e()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var I="function"===typeof reportError?reportError:function(t){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof t&&null!==t&&"string"===typeof t.message?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)};function R(){}e.Children={map:L,forEach:function(t,e,n){L(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return L(t,function(){e++}),e},toArray:function(t){return L(t,function(t){return t})||[]},only:function(t){if(!k(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=v,e.Fragment=s,e.Profiler=o,e.PureComponent=b,e.StrictMode=r,e.Suspense=h,e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=x,e.__COMPILER_RUNTIME={__proto__:null,c:function(t){return x.H.useMemoCache(t)}},e.cache=function(t){return function(){return t.apply(null,arguments)}},e.cloneElement=function(t,e,n){if(null===t||void 0===t)throw Error("The argument must be a React element, but you passed "+t+".");var i=g({},t.props),s=t.key;if(null!=e)for(r in void 0!==e.ref&&void 0,void 0!==e.key&&(s=""+e.key),e)!S.call(e,r)||"key"===r||"__self"===r||"__source"===r||"ref"===r&&void 0===e.ref||(i[r]=e[r]);var r=arguments.length-2;if(1===r)i.children=n;else if(1<r){for(var o=Array(r),a=0;a<r;a++)o[a]=arguments[a+2];i.children=o}return A(t.type,s,void 0,0,0,i)},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider=t,t.Consumer={$$typeof:a,_context:t},t},e.createElement=function(t,e,n){var i,s={},r=null;if(null!=e)for(i in void 0!==e.key&&(r=""+e.key),e)S.call(e,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(s[i]=e[i]);var o=arguments.length-2;if(1===o)s.children=n;else if(1<o){for(var a=Array(o),l=0;l<o;l++)a[l]=arguments[l+2];s.children=a}if(t&&t.defaultProps)for(i in o=t.defaultProps)void 0===s[i]&&(s[i]=o[i]);return A(t,r,void 0,0,0,s)},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=k,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:M}},e.memo=function(t,e){return{$$typeof:u,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=x.T,n={};x.T=n;try{var i=t(),s=x.S;null!==s&&s(n,i),"object"===typeof i&&null!==i&&"function"===typeof i.then&&i.then(R,I)}catch(r){I(r)}finally{x.T=e}},e.unstable_useCacheRefresh=function(){return x.H.useCacheRefresh()},e.use=function(t){return x.H.use(t)},e.useActionState=function(t,e,n){return x.H.useActionState(t,e,n)},e.useCallback=function(t,e){return x.H.useCallback(t,e)},e.useContext=function(t){return x.H.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t,e){return x.H.useDeferredValue(t,e)},e.useEffect=function(t,e,n){var i=x.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return i.useEffect(t,e)},e.useId=function(){return x.H.useId()},e.useImperativeHandle=function(t,e,n){return x.H.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return x.H.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return x.H.useLayoutEffect(t,e)},e.useMemo=function(t,e){return x.H.useMemo(t,e)},e.useOptimistic=function(t,e){return x.H.useOptimistic(t,e)},e.useReducer=function(t,e,n){return x.H.useReducer(t,e,n)},e.useRef=function(t){return x.H.useRef(t)},e.useState=function(t){return x.H.useState(t)},e.useSyncExternalStore=function(t,e,n){return x.H.useSyncExternalStore(t,e,n)},e.useTransition=function(){return x.H.useTransition()},e.version="19.1.1"},374:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n(286));class r extends s.default{select(t){let e=!1;const n=(null!==t&&void 0!==t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t){let{ascending:e=!0,nullsFirst:n,foreignTable:i,referencedTable:s=i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=s?`${s}.order`:"order",o=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${void 0===n?"":n?".nullsfirst":".nullslast"}`),this}limit(t){let{foreignTable:e,referencedTable:n=e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i="undefined"===typeof n?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${t}`),this}range(t,e){let{foreignTable:n,referencedTable:i=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s="undefined"===typeof i?"offset":`${i}.offset`,r="undefined"===typeof i?"limit":`${i}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(r,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain(){let{analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:i=!1,wal:s=!1,format:r="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,i?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${r}; for="${l}"; options=${a};`,this}rollback(){var t;return(null!==(t=this.headers.Prefer)&&void 0!==t?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}e.default=r},391:(t,e,n)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(4)},392:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Headers:()=>o,Request:()=>a,Response:()=>l,default:()=>r,fetch:()=>s});var i=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("unable to locate global object")}();const s=i.fetch,r=i.fetch.bind(i),o=i.Headers,a=i.Request,l=i.Response},400:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.version=void 0,e.version="0.0.0-automated"},403:(t,e,n)=>{"use strict";var i;n.d(e,{E_:()=>l,F3:()=>a}),function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"}(i||(i={}));class s extends Error{constructor(t,e,n){super(t),this.message=t,this.code=e,this.data=n}}const r=t=>{const e=t.CapacitorCustomPlatform||null,n=t.Capacitor||{},r=n.Plugins=n.Plugins||{},o=()=>null!==e?e.name:(t=>{var e,n;return(null===t||void 0===t?void 0:t.androidBridge)?"android":(null===(n=null===(e=null===t||void 0===t?void 0:t.webkit)||void 0===e?void 0:e.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(t),a=t=>{var e;return null===(e=n.PluginHeaders)||void 0===e?void 0:e.find(e=>e.name===t)},l=new Map;return n.convertFileSrc||(n.convertFileSrc=t=>t),n.getPlatform=o,n.handleError=e=>t.console.error(e),n.isNativePlatform=()=>"web"!==o(),n.isPluginAvailable=t=>{const e=l.get(t);return!!(null===e||void 0===e?void 0:e.platforms.has(o()))||!!a(t)},n.registerPlugin=function(t){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=l.get(t);if(h)return console.warn(`Capacitor plugin "${t}" already registered. Cannot register plugins twice.`),h.proxy;const u=o(),d=a(t);let p;const f=r=>{let o;const a=function(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];const f=(async()=>(!p&&u in c?p=p="function"===typeof c[u]?await c[u]():c[u]:null!==e&&!p&&"web"in c&&(p=p="function"===typeof c.web?await c.web():c.web),p))().then(e=>{const a=((e,r)=>{var o,a;if(!d){if(e)return null===(a=e[r])||void 0===a?void 0:a.bind(e);throw new s(`"${t}" plugin is not implemented on ${u}`,i.Unimplemented)}{const i=null===d||void 0===d?void 0:d.methods.find(t=>r===t.name);if(i)return"promise"===i.rtype?e=>n.nativePromise(t,r.toString(),e):(e,i)=>n.nativeCallback(t,r.toString(),e,i);if(e)return null===(o=e[r])||void 0===o?void 0:o.bind(e)}})(e,r);if(a){const t=a(...l);return o=null===t||void 0===t?void 0:t.remove,t}throw new s(`"${t}.${r}()" is not implemented on ${u}`,i.Unimplemented)});return"addListener"===r&&(f.remove=async()=>o()),f};return a.toString=()=>`${r.toString()}() { [capacitor code] }`,Object.defineProperty(a,"name",{value:r,writable:!1,configurable:!1}),a},g=f("addListener"),m=f("removeListener"),v=(t,e)=>{const n=g({eventName:t},e),i=async()=>{const i=await n;m({eventName:t,callbackId:i},e)},s=new Promise(t=>n.then(()=>t({remove:i})));return s.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await i()},s},y=new Proxy({},{get(t,e){switch(e){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?v:g;case"removeListener":return m;default:return f(e)}}});return r[t]=y,l.set(t,{name:t,proxy:y,platforms:new Set([...Object.keys(c),...d?[u]:[]])}),y},n.Exception=s,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},o=(t=>t.Capacitor=r(t))("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{}),a=o.registerPlugin;class l{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,e){let n=!1;this.listeners[t]||(this.listeners[t]=[],n=!0),this.listeners[t].push(e);const i=this.windowListeners[t];i&&!i.registered&&this.addWindowListener(i),n&&this.sendRetainedArgumentsForEvent(t);return Promise.resolve({remove:async()=>this.removeListener(t,e)})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,e,n){const i=this.listeners[t];if(i)i.forEach(t=>t(e));else if(n){let n=this.retainedEventArguments[t];n||(n=[]),n.push(e),this.retainedEventArguments[t]=n}}hasListeners(t){var e;return!!(null===(e=this.listeners[t])||void 0===e?void 0:e.length)}registerWindowListener(t,e){this.windowListeners[e]={registered:!1,windowEventName:t,pluginEventName:e,handler:t=>{this.notifyListeners(e,t)}}}unimplemented(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not implemented";return new o.Exception(t,i.Unimplemented)}unavailable(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not available";return new o.Exception(t,i.Unavailable)}async removeListener(t,e){const n=this.listeners[t];if(!n)return;const i=n.indexOf(e);this.listeners[t].splice(i,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const e=this.retainedEventArguments[t];e&&(delete this.retainedEventArguments[t],e.forEach(e=>{this.notifyListeners(t,e)}))}}const c=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),h=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class u extends l{async getCookies(){const t=document.cookie,e={};return t.split(";").forEach(t=>{if(t.length<=0)return;let[n,i]=t.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=h(n).trim(),i=h(i).trim(),e[n]=i}),e}async setCookie(t){try{const e=c(t.key),n=c(t.value),i=`; expires=${(t.expires||"").replace("expires=","")}`,s=(t.path||"/").replace("path=",""),r=null!=t.url&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${e}=${n||""}${i}; path=${s}; ${r};`}catch(e){return Promise.reject(e)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const e of t)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}a("CapacitorCookies",{web:()=>new u});const d=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Object.assign({method:t.method||"GET",headers:t.headers},e),i=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=Object.keys(t);return Object.keys(t).map(t=>t.toLocaleLowerCase()).reduce((n,i,s)=>(n[i]=t[e[s]],n),{})}(t.headers),s=i["content-type"]||"";if("string"===typeof t.data)n.body=t.data;else if(s.includes("application/x-www-form-urlencoded")){const e=new URLSearchParams;for(const[n,i]of Object.entries(t.data||{}))e.set(n,i);n.body=e.toString()}else if(s.includes("multipart/form-data")||t.data instanceof FormData){const e=new FormData;if(t.data instanceof FormData)t.data.forEach((t,n)=>{e.append(n,t)});else for(const n of Object.keys(t.data))e.append(n,t.data[n]);n.body=e;const i=new Headers(n.headers);i.delete("content-type"),n.headers=i}else(s.includes("application/json")||"object"===typeof t.data)&&(n.body=JSON.stringify(t.data));return n};class p extends l{async request(t){const e=d(t,t.webFetchExtra),n=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t?Object.entries(t).reduce((t,n)=>{const[i,s]=n;let r,o;return Array.isArray(s)?(o="",s.forEach(t=>{r=e?encodeURIComponent(t):t,o+=`${i}=${r}&`}),o.slice(0,-1)):(r=e?encodeURIComponent(s):s,o=`${i}=${r}`),`${t}&${o}`},"").substr(1):null}(t.params,t.shouldEncodeUrlParams),i=n?`${t.url}?${n}`:t.url,s=await fetch(i,e),r=s.headers.get("content-type")||"";let o,a,{responseType:l="text"}=s.ok?t:{};switch(r.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":a=await s.blob(),o=await(async t=>new Promise((e,n)=>{const i=new FileReader;i.onload=()=>{const t=i.result;e(t.indexOf(",")>=0?t.split(",")[1]:t)},i.onerror=t=>n(t),i.readAsDataURL(t)}))(a);break;case"json":o=await s.json();break;default:o=await s.text()}const c={};return s.headers.forEach((t,e)=>{c[e]=t}),{data:o,headers:c,status:s.status,url:s.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}a("CapacitorHttp",{web:()=>new p})},579:(t,e,n)=>{"use strict";t.exports=n(799)},611:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}e.default=n},630:t=>{"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg=="},672:(t,e,n)=>{"use strict";var i=n(43);function s(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var o={d:{f:r,r:function(){throw Error(s(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(t,e){return"font"===t?"":"string"===typeof e?"use-credentials"===e?e:"":void 0}e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)throw Error(s(299));return function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}}(t,e,null,n)},e.flushSync=function(t){var e=l.T,n=o.p;try{if(l.T=null,o.p=2,t)return t()}finally{l.T=e,o.p=n,o.d.f()}},e.preconnect=function(t,e){"string"===typeof t&&(e?e="string"===typeof(e=e.crossOrigin)?"use-credentials"===e?e:"":void 0:e=null,o.d.C(t,e))},e.prefetchDNS=function(t){"string"===typeof t&&o.d.D(t)},e.preinit=function(t,e){if("string"===typeof t&&e&&"string"===typeof e.as){var n=e.as,i=c(n,e.crossOrigin),s="string"===typeof e.integrity?e.integrity:void 0,r="string"===typeof e.fetchPriority?e.fetchPriority:void 0;"style"===n?o.d.S(t,"string"===typeof e.precedence?e.precedence:void 0,{crossOrigin:i,integrity:s,fetchPriority:r}):"script"===n&&o.d.X(t,{crossOrigin:i,integrity:s,fetchPriority:r,nonce:"string"===typeof e.nonce?e.nonce:void 0})}},e.preinitModule=function(t,e){if("string"===typeof t)if("object"===typeof e&&null!==e){if(null==e.as||"script"===e.as){var n=c(e.as,e.crossOrigin);o.d.M(t,{crossOrigin:n,integrity:"string"===typeof e.integrity?e.integrity:void 0,nonce:"string"===typeof e.nonce?e.nonce:void 0})}}else null==e&&o.d.M(t)},e.preload=function(t,e){if("string"===typeof t&&"object"===typeof e&&null!==e&&"string"===typeof e.as){var n=e.as,i=c(n,e.crossOrigin);o.d.L(t,n,{crossOrigin:i,integrity:"string"===typeof e.integrity?e.integrity:void 0,nonce:"string"===typeof e.nonce?e.nonce:void 0,type:"string"===typeof e.type?e.type:void 0,fetchPriority:"string"===typeof e.fetchPriority?e.fetchPriority:void 0,referrerPolicy:"string"===typeof e.referrerPolicy?e.referrerPolicy:void 0,imageSrcSet:"string"===typeof e.imageSrcSet?e.imageSrcSet:void 0,imageSizes:"string"===typeof e.imageSizes?e.imageSizes:void 0,media:"string"===typeof e.media?e.media:void 0})}},e.preloadModule=function(t,e){if("string"===typeof t)if(e){var n=c(e.as,e.crossOrigin);o.d.m(t,{as:"string"===typeof e.as&&"script"!==e.as?e.as:void 0,crossOrigin:n,integrity:"string"===typeof e.integrity?e.integrity:void 0})}else o.d.m(t)},e.requestFormReset=function(t){o.d.r(t)},e.unstable_batchedUpdates=function(t,e){return t(e)},e.useFormState=function(t,e,n){return l.H.useFormState(t,e,n)},e.useFormStatus=function(){return l.H.useHostTransitionStatus()},e.version="19.1.1"},736:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n(374));class r extends s.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(t=>"string"===typeof t&&new RegExp("[,()]").test(t)?`"${t}"`:`${t}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,e){return"string"===typeof e?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"===typeof e?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return"string"===typeof e?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e){let{config:n,type:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s="";"plain"===i?s="pl":"phrase"===i?s="ph":"websearch"===i&&(s="w");const r=void 0===n?"":`(${n})`;return this.url.searchParams.append(t,`${s}fts${r}.${e}`),this}match(t){return Object.entries(t).forEach(t=>{let[e,n]=t;this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t){let{foreignTable:e,referencedTable:n=e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=n?`${n}.or`:"or";return this.url.searchParams.append(i,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}}e.default=r},745:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_HEADERS=void 0;const i=n(400);e.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${i.version}`}},799:(t,e)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function s(t,e,i){var s=null;if(void 0!==i&&(s=""+i),void 0!==e.key&&(s=""+e.key),"key"in e)for(var r in i={},e)"key"!==r&&(i[r]=e[r]);else i=e;return e=i.ref,{$$typeof:n,type:t,key:s,ref:void 0!==e?e:null,props:i}}e.Fragment=i,e.jsx=s,e.jsxs=s},829:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n(736));e.default=class{constructor(t,e){let{headers:n={},schema:i,fetch:s}=e;this.url=t,this.headers=n,this.schema=i,this.fetch=s}select(t){let{head:e=!1,count:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e?"HEAD":"GET";let r=!1;const o=(null!==t&&void 0!==t?t:"*").split("").map(t=>/\s/.test(t)&&!r?"":('"'===t&&(r=!r),t)).join("");return this.url.searchParams.set("select",o),n&&(this.headers.Prefer=`count=${n}`),new s.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t){let{count:e,defaultToNull:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),n||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t){let{onConflict:e,ignoreDuplicates:n=!1,count:i,defaultToNull:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[`resolution=${n?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t){let{count:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),e&&n.push(`count=${e}`),this.headers.Prefer=n.join(","),new s.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete(){let{count:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=[];return t&&e.push(`count=${t}`),this.headers.Prefer&&e.unshift(this.headers.Prefer),this.headers.Prefer=e.join(","),new s.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},853:(t,e,n)=>{"use strict";t.exports=n(896)},896:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,s=t[i];if(!(0<r(s,e)))break t;t[i]=e,t[n]=s,n=i}}function i(t){return 0===t.length?null:t[0]}function s(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,s=t.length,o=s>>>1;i<o;){var a=2*(i+1)-1,l=t[a],c=a+1,h=t[c];if(0>r(l,n))c<s&&0>r(h,l)?(t[i]=h,t[c]=n,i=c):(t[i]=l,t[a]=n,i=a);else{if(!(c<s&&0>r(h,n)))break t;t[i]=h,t[c]=n,i=c}}}return e}function r(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if(e.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var c=[],h=[],u=1,d=null,p=3,f=!1,g=!1,m=!1,v=!1,y="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function w(t){for(var e=i(h);null!==e;){if(null===e.callback)s(h);else{if(!(e.startTime<=t))break;s(h),e.sortIndex=e.expirationTime,n(c,e)}e=i(h)}}function x(t){if(m=!1,w(t),!g)if(null!==i(c))g=!0,A||(A=!0,S());else{var e=i(h);null!==e&&I(x,e.startTime-t)}}var S,A=!1,k=-1,E=5,C=-1;function T(){return!!v||!(e.unstable_now()-C<E)}function P(){if(v=!1,A){var t=e.unstable_now();C=t;var n=!0;try{t:{g=!1,m&&(m=!1,b(k),k=-1),f=!0;var r=p;try{e:{for(w(t),d=i(c);null!==d&&!(d.expirationTime>t&&T());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var a=o(d.expirationTime<=t);if(t=e.unstable_now(),"function"===typeof a){d.callback=a,w(t),n=!0;break e}d===i(c)&&s(c),w(t)}else s(c);d=i(c)}if(null!==d)n=!0;else{var l=i(h);null!==l&&I(x,l.startTime-t),n=!1}}break t}finally{d=null,p=r,f=!1}n=void 0}}finally{n?S():A=!1}}}if("function"===typeof _)S=function(){_(P)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,M=L.port2;L.port1.onmessage=P,S=function(){M.postMessage(null)}}else S=function(){y(P,0)};function I(t,n){k=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_requestPaint=function(){v=!0},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_scheduleCallback=function(t,s,r){var o=e.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?o+r:o:r=o,t){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return t={id:u++,callback:s,priorityLevel:t,startTime:r,expirationTime:a=r+a,sortIndex:-1},r>o?(t.sortIndex=r,n(h,t),null===i(c)&&t===i(h)&&(m?(b(k),k=-1):m=!0,I(x,r-o))):(t.sortIndex=a,n(c,t),g||f||(g=!0,A||(A=!0,S()))),t},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(t){var e=p;return function(){var n=p;p=e;try{return t.apply(this,arguments)}finally{p=n}}}},950:(t,e,n)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(672)},980:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PostgrestError=e.PostgrestBuilder=e.PostgrestTransformBuilder=e.PostgrestFilterBuilder=e.PostgrestQueryBuilder=e.PostgrestClient=void 0;const s=i(n(210));e.PostgrestClient=s.default;const r=i(n(829));e.PostgrestQueryBuilder=r.default;const o=i(n(736));e.PostgrestFilterBuilder=o.default;const a=i(n(374));e.PostgrestTransformBuilder=a.default;const l=i(n(286));e.PostgrestBuilder=l.default;const c=i(n(611));e.PostgrestError=c.default,e.default={PostgrestClient:s.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:l.default,PostgrestError:c.default}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce((e,i)=>(n.f[i](t,e),e),[])),n.u=t=>"static/js/"+t+"."+{312:"6cc919e0",453:"f54aa79c",950:"ae390d02"}[t]+".chunk.js",n.miniCssF=t=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={},e="map-overlay:";n.l=(i,s,r,o)=>{if(t[i])t[i].push(s);else{var a,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==e+r){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+r),a.src=i),t[i]=[s];var d=(e,n)=>{a.onerror=a.onload=null,clearTimeout(p);var s=t[i];if(delete t[i],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach(t=>t(n)),e)return e(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="/map-overlay/",(()=>{var t={792:0};n.f.j=(e,i)=>{var s=n.o(t,e)?t[e]:void 0;if(0!==s)if(s)i.push(s[2]);else{var r=new Promise((n,i)=>s=t[e]=[n,i]);i.push(s[2]=r);var o=n.p+n.u(e),a=new Error;n.l(o,i=>{if(n.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var r=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",a.name="ChunkLoadError",a.type=r,a.request=o,s[1](a)}},"chunk-"+e,e)}};var e=(e,i)=>{var s,r,o=i[0],a=i[1],l=i[2],c=0;if(o.some(e=>0!==t[e])){for(s in a)n.o(a,s)&&(n.m[s]=a[s]);if(l)l(n)}for(e&&e(i);c<o.length;c++)r=o[c],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0},i=self.webpackChunkmap_overlay=self.webpackChunkmap_overlay||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),(()=>{"use strict";var t=n(43),e=n(391);const i=(0,t.createContext)(null);function s(){const e=(0,t.use)(i);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function r(){return s().map}n(950);function o(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function a(e,n){return null==n?function(n,i){const s=(0,t.useRef)(void 0);return s.current||(s.current=e(n,i)),s}:function(i,s){const r=(0,t.useRef)(void 0);r.current||(r.current=e(i,s));const o=(0,t.useRef)(i),{instance:a}=r.current;return(0,t.useEffect)(function(){o.current!==i&&(n(a,i,o.current),o.current=i)},[a,i,n]),r}}function l(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}function c(e){return function(n){const i=s(),r=e(l(n,i),i);return function(e,n){const i=(0,t.useRef)(n);(0,t.useEffect)(function(){n!==i.current&&null!=e.attributionControl&&(null!=i.current&&e.attributionControl.removeAttribution(i.current),null!=n&&e.attributionControl.addAttribution(n)),i.current=n},[e,n])}(i.map,n.attribution),function(e,n){const i=(0,t.useRef)(void 0);(0,t.useEffect)(function(){return null!=n&&e.instance.on(n),i.current=n,function(){null!=i.current&&e.instance.off(i.current),i.current=null}},[e,n])}(r.current,n.eventHandlers),function(e,n){(0,t.useEffect)(function(){return(n.layerContainer??n.map).addLayer(e.instance),function(){n.layerContainer?.removeLayer(e.instance),n.map.removeLayer(e.instance)}},[n,e])}(r.current,i),r}}var h=n(228),u=n.n(h);const d=function(e){function n(n,s){const{instance:r,context:o}=e(n).current;(0,t.useImperativeHandle)(s,()=>r);const{children:a}=n;return null==a?null:t.createElement(i,{value:o},a)}return(0,t.forwardRef)(n)}(c(a(function(t,e){let{position:n,...i}=t;const s=new h.Marker(n,i);return o(s,(r=e,a={overlayContainer:s},Object.freeze({...r,...a})));var r,a},function(t,e,n){e.position!==n.position&&t.setLatLng(e.position),null!=e.icon&&e.icon!==n.icon&&t.setIcon(e.icon),null!=e.zIndexOffset&&e.zIndexOffset!==n.zIndexOffset&&t.setZIndexOffset(e.zIndexOffset),null!=e.opacity&&e.opacity!==n.opacity&&t.setOpacity(e.opacity),null!=t.dragging&&e.draggable!==n.draggable&&(!0===e.draggable?t.dragging.enable():t.dragging.disable())})));function p(e,n){let{bounds:s,boundsOptions:r,center:o,children:a,className:l,id:c,placeholder:u,style:d,whenReady:p,zoom:f,...g}=e;const[m]=(0,t.useState)({className:l,id:c,style:d}),[v,y]=(0,t.useState)(null),b=(0,t.useRef)(void 0);(0,t.useImperativeHandle)(n,()=>v?.map??null,[v]);const _=(0,t.useCallback)(t=>{if(null!==t&&!b.current){const e=new h.Map(t,g);b.current=e,null!=o&&null!=f?e.setView(o,f):null!=s&&e.fitBounds(s,r),null!=p&&e.whenReady(p),y(function(t){return Object.freeze({__version:1,map:t})}(e))}},[]);(0,t.useEffect)(()=>()=>{v?.map.remove()},[v]);const w=v?t.createElement(i,{value:v},a):u??null;return t.createElement("div",{...m,ref:_},w)}const f=(0,t.forwardRef)(p);const g=function(e,n){return function(e){function n(n,i){const{instance:s}=e(n).current;return(0,t.useImperativeHandle)(i,()=>s),null}return(0,t.forwardRef)(n)}(c(a(e,n)))}(function(t,e){let{url:n,...i}=t;return o(new h.TileLayer(n,l(i,e)),e)},function(t,e,n){!function(t,e,n){const{opacity:i,zIndex:s}=e;null!=i&&i!==n.opacity&&t.setOpacity(i),null!=s&&s!==n.zIndex&&t.setZIndex(s)}(t,e,n);const{url:i}=e;null!=i&&i!==n.url&&t.setUrl(i)});var m=n(579);delete u().Icon.Default.prototype._getIconUrl,u().Icon.Default.mergeOptions({iconRetinaUrl:n(630),iconUrl:n(24),shadowUrl:n(71)});const v=e=>{let{center:n}=e;const i=r();return(0,t.useEffect)(()=>{if(i&&i.getContainer())try{i.setView(n,i.getZoom())}catch(t){console.error("Error updating map view:",t)}},[n,i]),null},y=t=>{let{currentLocation:e}=t;const n=r();return e?(0,m.jsx)("div",{style:{position:"absolute",bottom:"20px",right:"20px",zIndex:1e3,backgroundColor:"#3A5F76",color:"white",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",border:"2px solid white",transition:"all 0.2s ease"},onClick:()=>{e&&n.setView([e.latitude,e.longitude],n.getZoom())},onMouseEnter:t=>{t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#2C4A5F"},onMouseLeave:t=>{t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#3A5F76"},title:"Centrar en mi ubicaci\xf3n",children:(0,m.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,m.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,m.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,m.jsx)("circle",{cx:"12",cy:"12",r:"1"})]})}):null},b=e=>{let{overlay:n,isEditMode:i,onEditComplete:s}=e;const o=r(),a=(0,t.useRef)(null),l=(0,t.useRef)([]),c=(0,t.useRef)([]),h=(0,t.useRef)(null),[d,p]=(0,t.useState)(!1);window.getCurrentOverlayBounds=()=>{if(l.current.length>0){const t=l.current.map(t=>t.getLatLng()),e=Math.min(...t.map(t=>t.lat)),n=Math.max(...t.map(t=>t.lat)),i=Math.min(...t.map(t=>t.lng)),s=Math.max(...t.map(t=>t.lng)),r=u().latLngBounds([e,i],[n,s]),o={topLeft:{lat:n,lng:i},topRight:{lat:n,lng:s},bottomLeft:{lat:e,lng:i},bottomRight:{lat:e,lng:s}},a=(t=>({lat:(t.topLeft.lat+t.bottomRight.lat)/2,lng:(t.topLeft.lng+t.bottomRight.lng)/2}))(o);return{bounds:r,anchorPoints:o,centerPosition:a}}return null},(0,t.useEffect)(()=>(o.dragging.enable(),o.scrollWheelZoom.enable(),o.touchZoom.enable(),o.doubleClickZoom.enable(),()=>{o.dragging.enable(),o.scrollWheelZoom.enable(),o.touchZoom.enable(),o.doubleClickZoom.enable()}),[i,o]),(0,t.useEffect)(()=>{if(!i||!h.current)return;const t=()=>{if(h.current)if(a.current){const t=a.current.getBounds(),e=(t.getSouthWest().lat+t.getNorthEast().lat)/2,n=(t.getSouthWest().lng+t.getNorthEast().lng)/2;h.current.setLatLng([e,n]);const i=a.current.getElement();if(i){const t=i.getBoundingClientRect(),e=u().divIcon({className:"center-drag-marker",html:`<div style="\n                width: ${t.width}px;\n                height: ${t.height}px;\n                background: transparent;\n                border: 2px dashed #3A5F76;\n                border-radius: 8px;\n                cursor: move;\n                opacity: 0.3;\n                pointer-events: auto;\n              "></div>`,iconSize:[t.width,t.height],iconAnchor:[t.width/2,t.height/2]});h.current.setIcon(e)}}else{const t=o.getZoom(),e=100,n=Math.pow(1.5,t-10),i=Math.max(50,Math.min(300,e*n)),s=u().divIcon({className:"center-drag-marker",html:`<div style="\n              width: ${i}px;\n              height: ${i}px;\n              background: transparent;\n              border: 2px dashed #3A5F76;\n              border-radius: 8px;\n              cursor: move;\n              opacity: 0.3;\n              pointer-events: auto;\n            "></div>`,iconSize:[i,i],iconAnchor:[i/2,i/2]});h.current.setIcon(s)}};return o.on("zoomend",t),o.on("moveend",t),()=>{o.off("zoomend",t),o.off("moveend",t)}},[i,h.current,o]),(0,t.useEffect)(()=>{if(!o||!n||!o.getContainer())return;if(a.current){try{o.removeLayer(a.current),console.log("[Overlay] Removed previous overlay")}catch(e){console.error("[Overlay] Error removing existing overlay:",e)}a.current=null}if(l.current.forEach(t=>{try{o.removeLayer(t)}catch(e){console.error("[Overlay] Error removing corner marker:",e)}}),l.current=[],h.current){try{o.removeLayer(h.current)}catch(e){console.error("[Overlay] Error removing center marker:",e)}h.current=null}let t;if(c.current.forEach(t=>{try{o.removeLayer(t)}catch(e){console.error("[Overlay] Error removing anchor point marker:",e)}}),c.current=[],n.anchorPoints)t=[[n.anchorPoints.bottomLeft.lat,n.anchorPoints.bottomLeft.lng],[n.anchorPoints.topRight.lat,n.anchorPoints.topRight.lng]];else{const e=n.position.lat,i=n.position.lng,s=.01*n.scale;t=[[e-s,i-s],[e+s,i+s]]}try{const e=u().imageOverlay(n.imageUrl,t,{opacity:n.opacity||1,interactive:!0,bubblingMouseEvents:!1}),s=e.getElement();if(s){const t=s.querySelector("img");t&&(t.onerror=()=>{console.error("[Overlay] Error loading image:",n.imageUrl),p(!0)},t.onload=()=>{p(!1)})}if(void 0!==n.rotation&&0!==n.rotation){const t=e.getElement();if(t){const e=t.style.transform;t.style.transform=`${e} rotate(${n.rotation}deg)`}}if(i){const t=e.getElement();t&&(t.style.border="4px solid #3A5F76",t.style.boxShadow="0 0 15px rgba(58, 95, 118, 0.7)",t.style.borderRadius="4px",t.style.zIndex="1000",t.style.cursor="grab")}if(e.addTo(o),a.current=e,i){const t=e.getElement();t&&t.classList.add("edit-mode-overlay")}if(i){const n=t,i=[[n[0][0],n[0][1]],[n[0][0],n[1][1]],[n[1][0],n[1][1]],[n[1][0],n[0][1]]],s=(n[0][0]+n[1][0])/2,r=(n[0][1]+n[1][1])/2,c=e.getElement();let d=100,p=100;if(c){const t=c.getBoundingClientRect();d=t.width,p=t.height}const g=u().marker([s,r],{draggable:!0,icon:u().divIcon({className:"center-drag-marker",html:`<div style="\n                width: ${d}px;\n                height: ${p}px;\n                background: transparent;\n                border: 2px dashed #3A5F76;\n                border-radius: 8px;\n                cursor: move;\n                opacity: 0.3;\n                pointer-events: auto;\n              "></div>`,iconSize:[d,p],iconAnchor:[d/2,p/2]}),interactive:!0,bubblingMouseEvents:!1});g.on("dragstart",()=>{if(a.current){const t=a.current.getElement();if(t){const e=t.style.transform.match(/rotate\(([^)]+)deg\)/),n=e?parseFloat(e[1]):0;0!==n&&(t._currentRotation=n)}}}),g.on("drag",()=>{if(a.current){const t=g.getLatLng(),e=a.current.getBounds(),n=(e.getSouthWest().lat+e.getNorthEast().lat)/2,i=(e.getSouthWest().lng+e.getNorthEast().lng)/2,s=t.lat-n,r=t.lng-i,o=u().latLngBounds([e.getSouthWest().lat+s,e.getSouthWest().lng+r],[e.getNorthEast().lat+s,e.getNorthEast().lng+r]);a.current.setBounds(o);const c=[[o.getSouthWest().lat,o.getSouthWest().lng],[o.getSouthWest().lat,o.getNorthEast().lng],[o.getNorthEast().lat,o.getNorthEast().lng],[o.getNorthEast().lat,o.getSouthWest().lng]];l.current.forEach((t,e)=>{t.setLatLng(c[e])});const h=a.current.getElement();if(h){const t=h._currentRotation;if(t&&0!==t){const e=h.style.transform.replace(/rotate\([^)]*\)/g,"").trim();h.style.transform=`${e} rotate(${t}deg)`}}}}),g.on("dragend",()=>{if(a.current){const t=a.current.getElement();t&&f(t)}}),g.addTo(o),h.current=g,g.on("mousedown",t=>{t.originalEvent.stopPropagation()}),g.on("click",t=>{t.originalEvent.stopPropagation()}),g.on("dragend",()=>{if(a.current&&h.current){const t=a.current.getBounds(),e=(t.getSouthWest().lat+t.getNorthEast().lat)/2,n=(t.getSouthWest().lng+t.getNorthEast().lng)/2;h.current.setLatLng([e,n]);const i=a.current.getElement();if(i){const t=i.getBoundingClientRect(),e=u().divIcon({className:"center-drag-marker",html:`<div style="\n                    width: ${t.width}px;\n                    height: ${t.height}px;\n                    background: transparent;\n                    border: 2px dashed #3A5F76;\n                    border-radius: 8px;\n                    cursor: move;\n                    opacity: 0.3;\n                    pointer-events: auto;\n                  "></div>`,iconSize:[t.width,t.height],iconAnchor:[t.width/2,t.height/2]});h.current.setIcon(e)}}}),i.forEach((t,e)=>{const n=u().marker(t,{draggable:!0,icon:u().divIcon({className:"corner-marker",html:'<div style="\n                width: 16px;\n                height: 16px;\n                background: #3A5F76;\n                border: 3px solid white;\n                border-radius: 50%;\n                cursor: move;\n                box-shadow: 0 4px 8px rgba(0,0,0,0.4);\n                position: relative;\n              ">\n                <div style="\n                  position: absolute;\n                  top: 50%;\n                  left: 50%;\n                  transform: translate(-50%, -50%);\n                  width: 4px;\n                  height: 4px;\n                  background: white;\n                  border-radius: 50%;\n                "></div>\n              </div>',iconSize:[16,16],iconAnchor:[8,8]})});n.on("dragstart",()=>{if(a.current){const t=a.current.getElement();if(t){const e=t.style.transform.match(/rotate\(([^)]+)deg\)/),n=e?parseFloat(e[1]):0;0!==n&&(t._currentRotation=n)}}}),n.on("drag",()=>{if(a.current){const t=n.getLatLng();let i;if(0===e){const e=l.current[2].getLatLng();i=u().latLngBounds([t.lat,t.lng],[e.lat,e.lng])}else if(1===e){const e=l.current[3].getLatLng();i=u().latLngBounds([t.lat,e.lng],[e.lat,t.lng])}else if(2===e){const e=l.current[0].getLatLng();i=u().latLngBounds([e.lat,e.lng],[t.lat,t.lng])}else{const e=l.current[1].getLatLng();i=u().latLngBounds([t.lat,e.lng],[e.lat,t.lng])}a.current.setBounds(i);const s=[[i.getSouthWest().lat,i.getSouthWest().lng],[i.getSouthWest().lat,i.getNorthEast().lng],[i.getNorthEast().lat,i.getNorthEast().lng],[i.getNorthEast().lat,i.getSouthWest().lng]];if(l.current.forEach((t,n)=>{if(n!==e){const e=s[n];t.setLatLng(e)}}),h.current){const t=(i.getSouthWest().lat+i.getNorthEast().lat)/2,e=(i.getSouthWest().lng+i.getNorthEast().lng)/2;h.current.setLatLng([t,e]);const n=a.current.getElement();if(n){const t=n.getBoundingClientRect(),e=u().divIcon({className:"center-drag-marker",html:`<div style="\n                      width: ${t.width}px;\n                      height: ${t.height}px;\n                      background: transparent;\n                      border: 2px dashed #3A5F76;\n                      border-radius: 8px;\n                      cursor: move;\n                      opacity: 0.3;\n                      pointer-events: auto;\n                    "></div>`,iconSize:[t.width,t.height],iconAnchor:[t.width/2,t.height/2]});h.current.setIcon(e)}}const r=a.current.getElement();if(r){const t=r._currentRotation;if(t&&0!==t){const e=r.style.transform.replace(/rotate\([^)]*\)/g,"").trim();r.style.transform=`${e} rotate(${t}deg)`}}}}),n.on("dragend",()=>{if(a.current){const t=a.current.getElement();t&&f(t)}}),n.addTo(o),l.current.push(n)})}}catch(e){console.error("[Overlay] Error creating image overlay:",e)}return()=>{if(a.current,a.current&&o.getContainer()){try{o.removeLayer(a.current)}catch(e){console.error("[Overlay] Error cleaning up overlay:",e)}a.current=null}l.current.forEach(t=>{try{o.removeLayer(t)}catch(e){console.error("[Overlay] Error removing corner marker:",e)}}),l.current=[]}},[o,n.imageUrl,n.anchorPoints,n.position,n.scale,i]),(0,t.useEffect)(()=>{a.current&&void 0!==n.opacity&&a.current.setOpacity(n.opacity)},[n.opacity]),(0,t.useEffect)(()=>{if(a.current&&void 0!==n.rotation){const t=a.current.getElement();if(t){const e=t.style.transform.replace(/rotate\([^)]*\)/g,"").trim();0!==n.rotation?t.style.transform=`${e} rotate(${n.rotation}deg)`:t.style.transform=e}}},[n.rotation]),(0,t.useEffect)(()=>{if(!o||!a.current)return;const t=()=>{if(a.current&&void 0!==n.rotation&&0!==n.rotation){const t=a.current.getElement();t&&f(t)}};return o.on("zoomend",t),o.on("moveend",t),()=>{o.off("zoomend",t),o.off("moveend",t)}},[o,n.rotation]);const f=t=>{void 0!==n.rotation&&0!==n.rotation&&requestAnimationFrame(()=>{const e=t.style.transform.replace(/rotate\([^)]*\)/g,"").trim();t.style.transform=`${e} rotate(${n.rotation}deg)`})};return d?(0,m.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(220, 53, 69, 0.9)",color:"white",padding:"16px 24px",borderRadius:"8px",zIndex:1e3,textAlign:"center",maxWidth:"300px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[(0,m.jsx)("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"\u26a0\ufe0f Error al cargar el mapa"}),(0,m.jsxs)("div",{style:{fontSize:"14px",opacity:.9},children:["No se pudo cargar la imagen del mapa.",n.imageUrl.includes(".pdf")&&(0,m.jsx)("div",{style:{marginTop:"8px",fontSize:"12px"},children:"Los PDFs deben ser convertidos a imagen antes de subirlos."})]})]}):null},_=t=>{let{currentLocation:e}=t;r();if(!e)return null;const n=u().icon({iconUrl:"data:image/svg+xml;base64,"+btoa('\n      <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">\n        <defs>\n          <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">\n            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0,0,0,0.3)"/>\n          </filter>\n        </defs>\n        <circle cx="20" cy="20" r="18" fill="#E74C3C" stroke="white" stroke-width="4" filter="url(#shadow)"/>\n        <circle cx="20" cy="20" r="8" fill="white"/>\n        <circle cx="20" cy="20" r="4" fill="#E74C3C"/>\n      </svg>\n    '),iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20]});return(0,m.jsx)(d,{position:[e.latitude,e.longitude],icon:n,zIndexOffset:1e3})},w=e=>{let{currentLocation:n,selectedMap:i,isEditMode:s,onEditComplete:r,onOpacityChange:o,onRotationChange:a}=e;const[l,c]=(0,t.useState)([40.4168,-3.7038]),[h]=(0,t.useState)(13),[p,w]=(0,t.useState)(!1);(0,t.useEffect)(()=>{},[n]),(0,t.useEffect)(()=>{if(i&&p){const{lat:t,lng:e}=i.position;c([t,e])}},[i,p]);return(0,m.jsxs)("div",{style:{height:"100vh",width:"100vw",display:"flex",flexDirection:"column"},children:[(0,m.jsx)("style",{children:s&&"\n          .leaflet-control-zoom {\n            left: auto !important;\n            right: 60px !important;\n          }\n        "}),(0,m.jsxs)(f,{center:l,zoom:h,style:{height:s?"calc(100vh - 80px)":"100%",width:"100%"},zoomControl:!0,whenReady:()=>{w(!0)},children:[(0,m.jsx)(g,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),!s&&(0,m.jsx)(_,{currentLocation:n}),i&&p&&(0,m.jsx)(b,{overlay:{...i,position:i.position,opacity:i.opacity},isEditMode:s,onEditComplete:r}),i&&(0,m.jsx)(d,{position:[i.position.lat,i.position.lng],icon:u().divIcon({className:"selected-map-marker",html:`<div style="\n                background: #3A5F76;\n                color: white;\n                padding: 8px 12px;\n                border-radius: 20px;\n                font-size: 12px;\n                font-weight: bold;\n                white-space: nowrap;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n                border: 2px solid white;\n              ">${i.name}</div>`,iconSize:[0,0],iconAnchor:[0,0]})}),p&&(0,m.jsx)(v,{center:l}),!s&&(0,m.jsx)(y,{currentLocation:n}),i&&!s&&(0,m.jsx)("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,backgroundColor:"#E74C3C",color:"white",padding:"12px 16px",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",border:"none",fontSize:"14px",fontWeight:"600",transition:"all 0.2s ease"},onClick:()=>{window.dispatchEvent(new CustomEvent("clearMapSelection"))},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#C53030",t.currentTarget.style.transform="translateX(-50%) scale(1.05)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#E74C3C",t.currentTarget.style.transform="translateX(-50%) scale(1)"},title:"Limpiar selecci\xf3n de mapa",children:"\u2715 Limpiar mapa"})]}),i&&s&&(0,m.jsxs)("div",{style:{backgroundColor:"white",padding:"16px 20px",boxShadow:"0 -4px 12px rgba(0,0,0,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center",height:"80px",boxSizing:"border-box"},children:[(0,m.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,m.jsx)("span",{style:{fontSize:"14px",fontWeight:"600",color:"#333",minWidth:"80px"},children:"Transparencia:"}),(0,m.jsx)("input",{type:"range",min:"0",max:"100",defaultValue:i.opacity?Math.round(100*i.opacity):100,style:{width:"200px",height:"6px",borderRadius:"3px",background:"#ddd",outline:"none",cursor:"pointer"},onChange:t=>{const e=parseInt(t.target.value)/100;o&&o(e)}}),(0,m.jsxs)("span",{style:{fontSize:"14px",fontWeight:"600",color:"#333",minWidth:"40px",textAlign:"center"},children:[i.opacity?Math.round(100*i.opacity):100,"%"]})]}),(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,m.jsx)("span",{style:{fontSize:"14px",fontWeight:"600",color:"#333",minWidth:"80px"},children:"Rotaci\xf3n:"}),(0,m.jsx)("input",{type:"range",min:"-10",max:"10",defaultValue:i.rotation||0,style:{width:"200px",height:"6px",borderRadius:"3px",background:"#ddd",outline:"none",cursor:"pointer"},onChange:t=>{const e=parseInt(t.target.value);a&&a(e)}}),(0,m.jsxs)("span",{style:{fontSize:"14px",fontWeight:"600",color:"#333",minWidth:"40px",textAlign:"center"},children:[i.rotation||0,"\xb0"]})]})]}),(0,m.jsxs)("div",{style:{display:"flex",gap:"16px"},children:[(0,m.jsx)("button",{style:{backgroundColor:"#E74C3C",color:"white",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",border:"none",fontSize:"16px",fontWeight:"600",transition:"all 0.2s ease",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{window.dispatchEvent(new CustomEvent("cancelMapEdit"))},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#C53030",t.currentTarget.style.transform="scale(1.05)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#E74C3C",t.currentTarget.style.transform="scale(1)"},title:"Cancelar edici\xf3n",children:"\u274c"}),(0,m.jsx)("button",{style:{backgroundColor:"#27AE60",color:"white",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",border:"none",fontSize:"16px",fontWeight:"600",transition:"all 0.2s ease",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{var t,e;const n=null===(t=(e=window).getCurrentOverlayBounds)||void 0===t?void 0:t.call(e);n&&(r(n.bounds),window.currentAnchorPoints=n.anchorPoints,window.currentCenterPosition=n.centerPosition),window.dispatchEvent(new CustomEvent("confirmMapEdit"))},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#229954",t.currentTarget.style.transform="scale(1.05)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#27AE60",t.currentTarget.style.transform="scale(1)"},title:"Confirmar edici\xf3n",children:"\u2705"})]})]})]})};var x=n(403);const S=(0,x.F3)("Geolocation",{web:()=>n.e(312).then(n.bind(n,312)).then(t=>new t.GeolocationWeb)});!function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||t?void 0!==window.cordova&&function(t){t.CapacitorUtils.Synapse=new Proxy({},{get:(e,n)=>t.cordova.plugins[n]})}(window):function(t){t.CapacitorUtils.Synapse=new Proxy({},{get:(e,n)=>new Proxy({},{get:(e,i)=>(e,s,r)=>{const o=t.Capacitor.Plugins[n];void 0!==o?"function"==typeof o[i]?(async()=>{try{const t=await o[i](e);s(t)}catch(t){r(t)}})():r(new Error(`Method ${i} not found in Capacitor plugin ${n}`)):r(new Error(`Capacitor plugin ${n} not found`))}})})}(window))}();const A=(0,x.F3)("Device",{web:()=>n.e(950).then(n.bind(n,569)).then(t=>new t.DeviceWeb)});class k extends Error{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",n=arguments.length>2?arguments[2]:void 0;super(t),this.name=e,this.context=n}}class E extends k{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class C extends k{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class T extends k{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var P;!function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"}(P||(P={}));var L=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class M{constructor(t){let{headers:e={},customFetch:i,region:s=P.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=t,this.headers=e,this.region=s,this.fetch=(t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Promise.resolve().then(n.bind(n,392)).then(t=>{let{default:n}=t;return n(...e)})}:fetch),function(){return e(...arguments)}})(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return L(this,void 0,void 0,function*(){try{const{headers:i,method:s,body:r}=e;let o={},{region:a}=e;a||(a=this.region);const l=new URL(`${this.url}/${t}`);let c;a&&"any"!==a&&(o["x-region"]=a,l.searchParams.set("forceFunctionRegion",a)),r&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&("undefined"!==typeof Blob&&r instanceof Blob||r instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=r):"string"===typeof r?(o["Content-Type"]="text/plain",c=r):"undefined"!==typeof FormData&&r instanceof FormData?c=r:(o["Content-Type"]="application/json",c=JSON.stringify(r)));const h=yield this.fetch(l.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:c}).catch(t=>{throw new E(t)}),u=h.headers.get("x-relay-error");if(u&&"true"===u)throw new C(h);if(!h.ok)throw new T(h);let d,p=(null!==(n=h.headers.get("Content-Type"))&&void 0!==n?n:"text/plain").split(";")[0].trim();return d="application/json"===p?yield h.json():"application/octet-stream"===p?yield h.blob():"text/event-stream"===p?h:"multipart/form-data"===p?yield h.formData():yield h.text(),{data:d,error:null,response:h}}catch(i){return{data:null,error:i,response:i instanceof T||i instanceof C?i.context:void 0}}})}}var I=n(980);const{PostgrestClient:R,PostgrestQueryBuilder:D,PostgrestFilterBuilder:O,PostgrestTransformBuilder:N,PostgrestBuilder:z,PostgrestError:F}=I;const j=function(){if("undefined"!==typeof WebSocket)return WebSocket;if("undefined"!==typeof global.WebSocket)return global.WebSocket;if("undefined"!==typeof window.WebSocket)return window.WebSocket;if("undefined"!==typeof self.WebSocket)return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}();var B,U,H,$,W,V;!function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"}(B||(B={})),function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"}(U||(U={})),function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"}(H||(H={})),function(t){t.websocket="websocket"}($||($={})),function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"}(W||(W={}));class G{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e("string"===typeof t?JSON.parse(t):{})}_binaryDecode(t){const e=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,e,n)}_decodeBroadcast(t,e,n){const i=e.getUint8(1),s=e.getUint8(2);let r=this.HEADER_LENGTH+2;const o=n.decode(t.slice(r,r+i));r+=i;const a=n.decode(t.slice(r,r+s));r+=s;return{ref:null,topic:o,event:a,payload:JSON.parse(n.decode(t.slice(r,t.byteLength)))}}}class q{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"}(V||(V={}));const Z=function(t,e){var n;const i=null!==(n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==n?n:[];return Object.keys(e).reduce((n,s)=>(n[s]=K(s,t,e,i),n),{})},K=(t,e,n,i)=>{const s=e.find(e=>e.name===t),r=null===s||void 0===s?void 0:s.type,o=n[t];return r&&!i.includes(r)?X(r,o):Y(o)},X=(t,e)=>{if("_"===t.charAt(0)){const n=t.slice(1,t.length);return et(e,n)}switch(t){case V.bool:return J(e);case V.float4:case V.float8:case V.int2:case V.int4:case V.int8:case V.numeric:case V.oid:return Q(e);case V.json:case V.jsonb:return tt(e);case V.timestamp:return nt(e);case V.abstime:case V.date:case V.daterange:case V.int4range:case V.int8range:case V.money:case V.reltime:case V.text:case V.time:case V.timestamptz:case V.timetz:case V.tsrange:case V.tstzrange:default:return Y(e)}},Y=t=>t,J=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Q=t=>{if("string"===typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},tt=t=>{if("string"===typeof t)try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},et=(t,e)=>{if("string"!==typeof t)return t;const n=t.length-1,i=t[n];if("{"===t[0]&&"}"===i){let i;const r=t.slice(1,n);try{i=JSON.parse("["+r+"]")}catch(s){i=r?r.split(","):[]}return i.map(t=>X(e,t))}return t},nt=t=>"string"===typeof t?t.replace(" ","T"):t,it=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class st{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;this.channel=t,this.event=e,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var n;return this._hasReceived(t)&&e(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(t){let{status:e,response:n}=t;this.recHooks.filter(t=>t.status===e).forEach(t=>t.callback(n))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var rt,ot,at,lt;!function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"}(rt||(rt={}));class ct{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null===e||void 0===e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},t=>{const{onJoin:e,onLeave:n,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ct.syncState(this.state,t,e,n),this.pendingDiffs.forEach(t=>{this.state=ct.syncDiff(this.state,t,e,n)}),this.pendingDiffs=[],i()}),this.channel._on(n.diff,{},t=>{const{onJoin:e,onLeave:n,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=ct.syncDiff(this.state,t,e,n),i())}),this.onJoin((t,e,n)=>{this.channel._trigger("presence",{event:"join",key:t,currentPresences:e,newPresences:n})}),this.onLeave((t,e,n)=>{this.channel._trigger("presence",{event:"leave",key:t,currentPresences:e,leftPresences:n})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,n,i){const s=this.cloneDeep(t),r=this.transformState(e),o={},a={};return this.map(s,(t,e)=>{r[t]||(a[t]=e)}),this.map(r,(t,e)=>{const n=s[t];if(n){const i=e.map(t=>t.presence_ref),s=n.map(t=>t.presence_ref),r=e.filter(t=>s.indexOf(t.presence_ref)<0),l=n.filter(t=>i.indexOf(t.presence_ref)<0);r.length>0&&(o[t]=r),l.length>0&&(a[t]=l)}else o[t]=e}),this.syncDiff(s,{joins:o,leaves:a},n,i)}static syncDiff(t,e,n,i){const{joins:s,leaves:r}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(s,(e,i)=>{var s;const r=null!==(s=t[e])&&void 0!==s?s:[];if(t[e]=this.cloneDeep(i),r.length>0){const n=t[e].map(t=>t.presence_ref),i=r.filter(t=>n.indexOf(t.presence_ref)<0);t[e].unshift(...i)}n(e,r,i)}),this.map(r,(e,n)=>{let s=t[e];if(!s)return;const r=n.map(t=>t.presence_ref);s=s.filter(t=>r.indexOf(t.presence_ref)<0),t[e]=s,i(e,s,n),0===s.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(n=>e(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,n)=>{const i=t[n];return e[n]="metas"in i?i.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):i,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"}(ot||(ot={})),function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"}(at||(at={})),function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"}(lt||(lt={}));class ht{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},n=arguments.length>2?arguments[2]:void 0;this.topic=t,this.params=e,this.socket=n,this.bindings={},this.state=U.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new st(this,H.join,this.params,this.timeout),this.rejoinTimer=new q(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=U.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=U.closed,this.socket._remove(this)}),this._onError(t=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this._on(H.reply,{},(t,e)=>{this._trigger(this._replyEventName(e),t)}),this.presence=new ct(this),this.broadcastEndpointURL=it(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==U.closed){const{config:{broadcast:s,presence:r,private:o}}=this.params;this._onError(e=>null===t||void 0===t?void 0:t(lt.CHANNEL_ERROR,e)),this._onClose(()=>null===t||void 0===t?void 0:t(lt.CLOSED));const a={},l={broadcast:s,presence:r,postgres_changes:null!==(i=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(t=>t.filter))&&void 0!==i?i:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async e=>{let{postgres_changes:n}=e;var i;if(this.socket.setAuth(),void 0!==n){const e=this.bindings.postgres_changes,s=null!==(i=null===e||void 0===e?void 0:e.length)&&void 0!==i?i:0,r=[];for(let i=0;i<s;i++){const s=e[i],{filter:{event:o,schema:a,table:l,filter:c}}=s,h=n&&n[i];if(!h||h.event!==o||h.schema!==a||h.table!==l||h.filter!==c)return this.unsubscribe(),this.state=U.errored,void(null===t||void 0===t||t(lt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));r.push(Object.assign(Object.assign({},s),{id:h.id}))}return this.bindings.postgres_changes=r,void(t&&t(lt.SUBSCRIBED))}null===t||void 0===t||t(lt.SUBSCRIBED)}).receive("error",e=>{this.state=U.errored,null===t||void 0===t||t(lt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null===t||void 0===t||t(lt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},t)}on(t,e,n){return this._on(t,e,n)}async send(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,i;if(this._canPush()||"broadcast"!==t.type)return new Promise(n=>{var i,s,r;const o=this._push(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(r=null===(s=null===(i=this.params)||void 0===i?void 0:i.config)||void 0===s?void 0:s.broadcast)||void 0===r?void 0:r.ack)||n("ok"),o.receive("ok",()=>n("ok")),o.receive("error",()=>n("error")),o.receive("timeout",()=>n("timed out"))});{const{event:r,payload:o}=t,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const t=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(n=e.timeout)&&void 0!==n?n:this.timeout);return await(null===(i=t.body)||void 0===i?void 0:i.cancel()),t.ok?"ok":"error"}catch(s){return"AbortError"===s.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=U.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(H.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new st(this,H.leave,{},t),n.receive("ok",()=>{e(),i("ok")}).receive("timeout",()=>{e(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{null===n||void 0===n||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(t,e,n){const i=new AbortController,s=setTimeout(()=>i.abort(),n),r=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(s),r}_push(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new st(this,t,e,n);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(t,e,n){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,n){var i,s;const r=t.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=H;if(n&&[o,a,l,c].indexOf(r)>=0&&n!==this._joinRef())return;let h=this._onMessage(r,e,n);if(e&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(r)?null===(i=this.bindings.postgres_changes)||void 0===i||i.filter(t=>{var e,n,i;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(i=null===(n=t.filter)||void 0===n?void 0:n.event)||void 0===i?void 0:i.toLocaleLowerCase())===r}).map(t=>t.callback(h,n)):null===(s=this.bindings[r])||void 0===s||s.filter(t=>{var n,i,s,o,a,l;if(["broadcast","presence","postgres_changes"].includes(r)){if("id"in t){const r=t.id,o=null===(n=t.filter)||void 0===n?void 0:n.event;return r&&(null===(i=e.ids)||void 0===i?void 0:i.includes(r))&&("*"===o||(null===o||void 0===o?void 0:o.toLocaleLowerCase())===(null===(s=e.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const n=null===(a=null===(o=null===t||void 0===t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===n||n===(null===(l=null===e||void 0===e?void 0:e.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===r}).map(t=>{if("object"===typeof h&&"ids"in h){const t=h.data,{schema:e,table:n,commit_timestamp:i,type:s,errors:r}=t,o={schema:e,table:n,commit_timestamp:i,eventType:s,new:{},old:{},errors:r};h=Object.assign(Object.assign({},o),this._getPayloadRecords(t))}t.callback(h,n)})}_isClosed(){return this.state===U.closed}_isJoined(){return this.state===U.joined}_isJoining(){return this.state===U.joining}_isLeaving(){return this.state===U.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,n){const i=t.toLocaleLowerCase(),s={type:i,filter:e,callback:n};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(t,e){const n=t.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(t=>{var i;return!((null===(i=t.type)||void 0===i?void 0:i.toLocaleLowerCase())===n&&ht.isEqual(t.filter,e))}),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(H.close,{},t)}_onError(t){this._on(H.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=U.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=Z(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=Z(t.columns,t.old_record)),e}}const ut=()=>{};class dt{constructor(t,e){var i;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ut,this.ref=0,this.logger=ut,this.conn=null,this.sendBuffer=[],this.serializer=new G,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Promise.resolve().then(n.bind(n,392)).then(t=>{let{default:n}=t;return n(...e)})}:fetch),function(){return e(...arguments)}},this.endPoint=`${t}/${$.websocket}`,this.httpEndpoint=it(t),(null===e||void 0===e?void 0:e.transport)?this.transport=e.transport:this.transport=null,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.timeout)&&(this.timeout=e.timeout),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const s=null===(i=null===e||void 0===e?void 0:e.params)||void 0===i?void 0:i.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=(null===e||void 0===e?void 0:e.reconnectAfterMs)?e.reconnectAfterMs:t=>[1e3,2e3,5e3,1e4][t-1]||1e4,this.encode=(null===e||void 0===e?void 0:e.encode)?e.encode:(t,e)=>e(JSON.stringify(t)),this.decode=(null===e||void 0===e?void 0:e.decode)?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new q(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null===e||void 0===e?void 0:e.fetch),null===e||void 0===e?void 0:e.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null===e||void 0===e?void 0:e.worker)||!1,this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}this.accessToken=(null===e||void 0===e?void 0:e.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=j),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,null!==e&&void 0!==e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(t=>t.teardown()))}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,n){this.logger(t,e,n)}connectionState(){switch(this.conn&&this.conn.readyState){case B.connecting:return W.Connecting;case B.open:return W.Open;case B.closing:return W.Closing;default:return W.Closed}}isConnected(){return this.connectionState()===W.Open}channel(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const n=`realtime:${t}`,i=this.getChannels().find(t=>t.topic===n);if(i)return i;{const n=new ht(`realtime:${t}`,e,this);return this.channels.push(n),n}}push(t){const{topic:e,event:n,payload:i,ref:s}=t,r=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push",`${e} ${n} (${s})`,i),this.isConnected()?r():this.sendBuffer.push(r)}async setAuth(){let t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const n={access_token:t,version:"realtime-js/2.11.15"};t&&e.updateJoinPayload(n),e.joinedOnce&&e._isJoined()&&e._push(H.access_token,{access_token:t})}))}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(t=this.conn)||void 0===t||t.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(e=>e.topic===t&&(e._isJoined()||e._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,t=>{let{topic:e,event:n,payload:i,ref:s}=t;"phoenix"===e&&"phx_reply"===n&&this.heartbeatCallback("ok"==t.payload.status?"ok":"error"),s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${e} ${n} ${s&&"("+s+")"||""}`,i),Array.from(this.channels).filter(t=>t._isMember(e)).forEach(t=>t._trigger(n,i,s)),this.stateChangeCallbacks.message.forEach(e=>e(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(t=>t())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}_onConnError(t){this.log("transport",`${t}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(H.error))}_appendParams(t,e){if(0===Object.keys(e).length)return t;const n=t.match(/\?/)?"&":"?";return`${t}${n}${new URLSearchParams(e)}`}_workerObjectUrl(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}}class pt extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ft(t){return"object"===typeof t&&null!==t&&"__isStorageError"in t}class gt extends pt{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class mt extends pt{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}var vt=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};const yt=t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Promise.resolve().then(n.bind(n,392)).then(t=>{let{default:n}=t;return n(...e)})}:fetch),function(){return e(...arguments)}},bt=t=>{if(Array.isArray(t))return t.map(t=>bt(t));if("function"===typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(t=>{let[n,i]=t;const s=n.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[s]=bt(i)}),e};var _t=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};const wt=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),xt=(t,e,i)=>_t(void 0,void 0,void 0,function*(){const s=yield vt(void 0,void 0,void 0,function*(){return"undefined"===typeof Response?(yield Promise.resolve().then(n.bind(n,392))).Response:Response});t instanceof s&&!(null===i||void 0===i?void 0:i.noResolveJson)?t.json().then(n=>{const i=t.status||500,s=(null===n||void 0===n?void 0:n.statusCode)||i+"";e(new gt(wt(n),i,s))}).catch(t=>{e(new mt(wt(t),t))}):e(new mt(wt(t),t))}),St=(t,e,n,i)=>{const s={method:t,headers:(null===e||void 0===e?void 0:e.headers)||{}};return"GET"!==t&&i?((t=>{if("object"!==typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)})(i)?(s.headers=Object.assign({"Content-Type":"application/json"},null===e||void 0===e?void 0:e.headers),s.body=JSON.stringify(i)):s.body=i,Object.assign(Object.assign({},s),n)):s};function At(t,e,n,i,s,r){return _t(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(n,St(e,i,s,r)).then(t=>{if(!t.ok)throw t;return(null===i||void 0===i?void 0:i.noResolveJson)?t:t.json()}).then(t=>o(t)).catch(t=>xt(t,a,i))})})}function kt(t,e,n,i){return _t(this,void 0,void 0,function*(){return At(t,"GET",e,n,i)})}function Et(t,e,n,i,s){return _t(this,void 0,void 0,function*(){return At(t,"POST",e,i,s,n)})}function Ct(t,e,n,i,s){return _t(this,void 0,void 0,function*(){return At(t,"PUT",e,i,s,n)})}function Tt(t,e,n,i,s){return _t(this,void 0,void 0,function*(){return At(t,"DELETE",e,i,s,n)})}var Pt=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};const Lt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Mt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class It{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;this.url=t,this.headers=e,this.bucketId=n,this.fetch=yt(i)}uploadOrUpdate(t,e,n,i){return Pt(this,void 0,void 0,function*(){try{let s;const r=Object.assign(Object.assign({},Mt),i);let o=Object.assign(Object.assign({},this.headers),"POST"===t&&{"x-upsert":String(r.upsert)});const a=r.metadata;"undefined"!==typeof Blob&&n instanceof Blob?(s=new FormData,s.append("cacheControl",r.cacheControl),a&&s.append("metadata",this.encodeMetadata(a)),s.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(s=n,s.append("cacheControl",r.cacheControl),a&&s.append("metadata",this.encodeMetadata(a))):(s=n,o["cache-control"]=`max-age=${r.cacheControl}`,o["content-type"]=r.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null===i||void 0===i?void 0:i.headers)&&(o=Object.assign(Object.assign({},o),i.headers));const l=this._removeEmptyFolders(e),c=this._getFinalPath(l),h=yield("PUT"==t?Ct:Et)(this.fetch,`${this.url}/object/${c}`,s,Object.assign({headers:o},(null===r||void 0===r?void 0:r.duplex)?{duplex:r.duplex}:{}));return{data:{path:l,id:h.Id,fullPath:h.Key},error:null}}catch(s){if(ft(s))return{data:null,error:s};throw s}})}upload(t,e,n){return Pt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,n)})}uploadToSignedUrl(t,e,n,i){return Pt(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(t),r=this._getFinalPath(s),o=new URL(this.url+`/object/upload/sign/${r}`);o.searchParams.set("token",e);try{let t;const e=Object.assign({upsert:Mt.upsert},i),r=Object.assign(Object.assign({},this.headers),{"x-upsert":String(e.upsert)});"undefined"!==typeof Blob&&n instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(t=n,t.append("cacheControl",e.cacheControl)):(t=n,r["cache-control"]=`max-age=${e.cacheControl}`,r["content-type"]=e.contentType);return{data:{path:s,fullPath:(yield Ct(this.fetch,o.toString(),t,{headers:r})).Key},error:null}}catch(a){if(ft(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(t,e){return Pt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const i=Object.assign({},this.headers);(null===e||void 0===e?void 0:e.upsert)&&(i["x-upsert"]="true");const s=yield Et(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),r=new URL(this.url+s.url),o=r.searchParams.get("token");if(!o)throw new pt("No token returned by API");return{data:{signedUrl:r.toString(),path:t,token:o},error:null}}catch(n){if(ft(n))return{data:null,error:n};throw n}})}update(t,e,n){return Pt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,n)})}move(t,e,n){return Pt(this,void 0,void 0,function*(){try{return{data:yield Et(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}copy(t,e,n){return Pt(this,void 0,void 0,function*(){try{return{data:{path:(yield Et(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}createSignedUrl(t,e,n){return Pt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(t),s=yield Et(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:e},(null===n||void 0===n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const r=(null===n||void 0===n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${r}`)},{data:s,error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}createSignedUrls(t,e,n){return Pt(this,void 0,void 0,function*(){try{const i=yield Et(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),s=(null===n||void 0===n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return{data:i.map(t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${s}`):null})),error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}download(t,e){return Pt(this,void 0,void 0,function*(){const n="undefined"!==typeof(null===e||void 0===e?void 0:e.transform)?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null===e||void 0===e?void 0:e.transform)||{}),s=i?`?${i}`:"";try{const e=this._getFinalPath(t),i=yield kt(this.fetch,`${this.url}/${n}/${e}${s}`,{headers:this.headers,noResolveJson:!0});return{data:yield i.blob(),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}info(t){return Pt(this,void 0,void 0,function*(){const e=this._getFinalPath(t);try{const t=yield kt(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:bt(t),error:null}}catch(n){if(ft(n))return{data:null,error:n};throw n}})}exists(t){return Pt(this,void 0,void 0,function*(){const e=this._getFinalPath(t);try{return yield function(t,e,n,i){return _t(this,void 0,void 0,function*(){return At(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),i)})}(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(ft(n)&&n instanceof mt){const t=n.originalError;if([400,404].includes(null===t||void 0===t?void 0:t.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,e){const n=this._getFinalPath(t),i=[],s=(null===e||void 0===e?void 0:e.download)?`download=${!0===e.download?"":e.download}`:"";""!==s&&i.push(s);const r="undefined"!==typeof(null===e||void 0===e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null===e||void 0===e?void 0:e.transform)||{});""!==o&&i.push(o);let a=i.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${n}${a}`)}}}remove(t){return Pt(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(ft(e))return{data:null,error:e};throw e}})}list(t,e,n){return Pt(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Lt),e),{prefix:t||""});return{data:yield Et(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!==typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const Rt={"X-Client-Info":"storage-js/2.10.4"};var Dt=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class Ot{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const s=new URL(t);if(null===i||void 0===i?void 0:i.useNewHostname){/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."))}this.url=s.href,this.headers=Object.assign(Object.assign({},Rt),e),this.fetch=yt(n)}listBuckets(){return Dt(this,void 0,void 0,function*(){try{return{data:yield kt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}getBucket(t){return Dt(this,void 0,void 0,function*(){try{return{data:yield kt(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(ft(e))return{data:null,error:e};throw e}})}createBucket(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return Dt(this,void 0,void 0,function*(){try{return{data:yield Et(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ft(n))return{data:null,error:n};throw n}})}updateBucket(t,e){return Dt(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ft(n))return{data:null,error:n};throw n}})}emptyBucket(t){return Dt(this,void 0,void 0,function*(){try{return{data:yield Et(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(ft(e))return{data:null,error:e};throw e}})}deleteBucket(t){return Dt(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(ft(e))return{data:null,error:e};throw e}})}}class Nt extends Ot{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(t){return new It(this.url,this.headers,t,this.fetch)}}let zt="";zt="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Ft={headers:{"X-Client-Info":`supabase-js-${zt}/2.53.0`}},jt={schema:"public"},Bt={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ut={};var Ht=n(392),$t=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};const Wt=t=>{let e;return e=t||("undefined"===typeof fetch?Ht.default:fetch),function(){return e(...arguments)}},Vt=(t,e,n)=>{const i=Wt(n),s="undefined"===typeof Headers?Ht.Headers:Headers;return(n,r)=>$t(void 0,void 0,void 0,function*(){var o;const a=null!==(o=yield e())&&void 0!==o?o:t;let l=new s(null===r||void 0===r?void 0:r.headers);return l.has("apikey")||l.set("apikey",t),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),i(n,Object.assign(Object.assign({},r),{headers:l}))})};var Gt=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};const qt="2.71.1",Zt=3e4,Kt=9e4,Xt={"X-Client-Info":`gotrue-js/${qt}`},Yt="X-Supabase-Api-Version",Jt={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Qt=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class te extends Error{constructor(t,e,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=n}}function ee(t){return"object"===typeof t&&null!==t&&"__isAuthError"in t}class ne extends te{constructor(t,e,n){super(t,e,n),this.name="AuthApiError",this.status=e,this.code=n}}class ie extends te{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class se extends te{constructor(t,e,n,i){super(t,n,i),this.name=e,this.status=n}}class re extends se{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class oe extends se{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ae extends se{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class le extends se{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ce extends se{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class he extends se{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function ue(t){return ee(t)&&"AuthRetryableFetchError"===t.name}class de extends se{constructor(t,e,n){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=n}}class pe extends se{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ge=" \t\n\r=".split(""),me=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<ge.length;e+=1)t[ge[e].charCodeAt(0)]=-2;for(let e=0;e<fe.length;e+=1)t[fe[e].charCodeAt(0)]=e;return t})();function ve(t,e,n){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;n(fe[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;n(fe[t]),e.queuedBits-=6}}function ye(t,e,n){const i=me[t];if(!(i>-1)){if(-2===i)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function be(t){const e=[],n=t=>{e.push(String.fromCodePoint(t))},i={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},r=t=>{!function(t,e,n){if(0===e.utf8seq){if(t<=127)return void n(t);for(let n=1;n<6;n+=1)if(0===(t>>7-n&1)){e.utf8seq=n;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw new Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&n(e.codepoint)}}(t,i,n)};for(let o=0;o<t.length;o+=1)ye(t.charCodeAt(o),s,r);return e.join("")}function _e(t,e){if(!(t<=127)){if(t<=2047)return e(192|t>>6),void e(128|63&t);if(t<=65535)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(t<=1114111)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}e(t)}function we(t,e){for(let n=0;n<t.length;n+=1){let i=t.charCodeAt(n);if(i>55295&&i<=56319){const e=1024*(i-55296)&65535;i=65536+(t.charCodeAt(n+1)-56320&65535|e),n+=1}_e(i,e)}}function xe(t){const e=[],n={queue:0,queuedBits:0},i=t=>{e.push(t)};for(let s=0;s<t.length;s+=1)ye(t.charCodeAt(s),n,i);return new Uint8Array(e)}function Se(t){const e=[],n={queue:0,queuedBits:0},i=t=>{e.push(t)};return t.forEach(t=>ve(t,n,i)),ve(null,n,i),e.join("")}const Ae=()=>"undefined"!==typeof window&&"undefined"!==typeof document,ke={tested:!1,writable:!1},Ee=()=>{if(!Ae())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(e){return!1}if(ke.tested)return ke.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ke.tested=!0,ke.writable=!0}catch(e){ke.tested=!0,ke.writable=!1}return ke.writable};const Ce=t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Promise.resolve().then(n.bind(n,392)).then(t=>{let{default:n}=t;return n(...e)})}:fetch),function(){return e(...arguments)}},Te=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Pe=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch(i){return n}},Le=async(t,e)=>{await t.removeItem(e)};class Me{constructor(){this.promise=new Me.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}function Ie(t){const e=t.split(".");if(3!==e.length)throw new pe("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Qt.test(e[n]))throw new pe("JWT not in base64url format");return{header:JSON.parse(be(e[0])),payload:JSON.parse(be(e[1])),signature:xe(e[2]),raw:{header:e[0],payload:e[1]}}}function Re(t){return("0"+t.toString(16)).substr(-2)}async function De(t){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const e=await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e),i=new Uint8Array(n);return Array.from(i).map(t=>String.fromCharCode(t)).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Oe(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=function(){const t=new Uint32Array(56);if("undefined"===typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*e));return n}return crypto.getRandomValues(t),Array.from(t,Re).join("")}();let s=i;n&&(s+="/PASSWORD_RECOVERY"),await Te(t,`${e}-code-verifier`,s);const r=await De(i);return[r,i===r?"plain":"s256"]}Me.promiseConstructor=Promise;const Ne=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const ze=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Fe(t){if(!ze.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function je(){return new Proxy({},{get:(t,e)=>{if("__isUserNotAvailableProxy"===e)return!0;if("symbol"===typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Be(t){return JSON.parse(JSON.stringify(t))}var Ue=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};const He=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),$e=[502,503,504];async function We(t){var e,n;if(!("object"===typeof(n=t)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"===typeof n.json))throw new he(He(t),0);if($e.includes(t.status))throw new he(He(t),t.status);let i,s;try{i=await t.json()}catch(o){throw new ie(He(o),o)}const r=function(t){const e=t.headers.get(Yt);if(!e)return null;if(!e.match(Ne))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(o){return null}}(t);if(r&&r.getTime()>=Jt.timestamp&&"object"===typeof i&&i&&"string"===typeof i.code?s=i.code:"object"===typeof i&&i&&"string"===typeof i.error_code&&(s=i.error_code),s){if("weak_password"===s)throw new de(He(i),t.status,(null===(e=i.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===s)throw new re}else if("object"===typeof i&&i&&"object"===typeof i.weak_password&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((t,e)=>t&&"string"===typeof e,!0))throw new de(He(i),t.status,i.weak_password.reasons);throw new ne(He(i),t.status||500,s)}async function Ve(t,e,n,i){var s;const r=Object.assign({},null===i||void 0===i?void 0:i.headers);r[Yt]||(r[Yt]=Jt.name),(null===i||void 0===i?void 0:i.jwt)&&(r.Authorization=`Bearer ${i.jwt}`);const o=null!==(s=null===i||void 0===i?void 0:i.query)&&void 0!==s?s:{};(null===i||void 0===i?void 0:i.redirectTo)&&(o.redirect_to=i.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(t,e,n,i,s,r){const o=((t,e,n,i)=>{const s={method:t,headers:(null===e||void 0===e?void 0:e.headers)||{}};return"GET"===t?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===e||void 0===e?void 0:e.headers),s.body=JSON.stringify(i),Object.assign(Object.assign({},s),n))})(e,i,s,r);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new he(He(l),0)}a.ok||await We(a);if(null===i||void 0===i?void 0:i.noResolveJson)return a;try{return await a.json()}catch(l){await We(l)}}(t,e,n+a,{headers:r,noResolveJson:null===i||void 0===i?void 0:i.noResolveJson},{},null===i||void 0===i?void 0:i.body);return(null===i||void 0===i?void 0:i.xform)?null===i||void 0===i?void 0:i.xform(l):{data:Object.assign({},l),error:null}}function Ge(t){var e;let n=null;var i;(function(t){return t.access_token&&t.refresh_token&&t.expires_in})(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=(i=t.expires_in,Math.round(Date.now()/1e3)+i)));return{data:{session:n,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function qe(t){const e=Ge(t);return!e.error&&t.weak_password&&"object"===typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"===typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"===typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function Ze(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function Ke(t){return{data:t,error:null}}function Xe(t){const{action_link:e,email_otp:n,hashed_token:i,redirect_to:s,verification_type:r}=t,o=Ue(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:n,hashed_token:i,redirect_to:s,verification_type:r},user:Object.assign({},o)},error:null}}function Ye(t){return t}const Je=["global","local","others"];var Qe=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class tn{constructor(t){let{url:e="",headers:n={},fetch:i}=t;this.url=e,this.headers=n,this.fetch=Ce(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Je[0];if(Je.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Je.join(", ")}`);try{return await Ve(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ee(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await Ve(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Ze})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:e}=t,n=Qe(t,["options"]),i=Object.assign(Object.assign({},n),e);return"newEmail"in n&&(i.new_email=null===n||void 0===n?void 0:n.newEmail,delete i.newEmail),await Ve(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Xe,redirectTo:null===e||void 0===e?void 0:e.redirectTo})}catch(e){if(ee(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await Ve(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ze})}catch(e){if(ee(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,n,i,s,r,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await Ve(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(e=null===t||void 0===t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==n?n:"",per_page:null!==(s=null===(i=null===t||void 0===t?void 0:t.perPage)||void 0===i?void 0:i.toString())&&void 0!==s?s:""},xform:Ye});if(c.error)throw c.error;const h=await c.json(),u=null!==(r=c.headers.get("x-total-count"))&&void 0!==r?r:0,d=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(t.split(";")[1].split("=")[1]);l[`${n}Page`]=e}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(ee(l))return{data:{users:[]},error:l};throw l}}async getUserById(t){Fe(t);try{return await Ve(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ze})}catch(e){if(ee(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){Fe(t);try{return await Ve(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:Ze})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}async deleteUser(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Fe(t);try{return await Ve(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:Ze})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Fe(t.userId);try{const{data:e,error:n}=await Ve(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:n}}catch(e){if(ee(e))return{data:null,error:e};throw e}}async _deleteFactor(t){Fe(t.userId),Fe(t.id);try{return{data:await Ve(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(ee(e))return{data:null,error:e};throw e}}}function en(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const nn=!!(globalThis&&Ee()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class sn extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class rn extends sn{}async function on(t,e,n){nn&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),nn&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async i=>{if(!i){if(0===e)throw nn&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new rn(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(nn)try{const t=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(t,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}nn&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,i.name);try{return await n()}finally{nn&&console.log("@supabase/gotrue-js: navigatorLock: released",t,i.name)}}))}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(t){"undefined"!==typeof self&&(self.globalThis=self)}}();const an={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Xt,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ln(t,e,n){return await n()}const cn={};class hn{constructor(t){var e,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=hn.nextInstanceID,hn.nextInstanceID+=1,this.instanceID>0&&Ae()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},an),t);if(this.logDebugMessages=!!i.debug,"function"===typeof i.debug&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new tn({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Ce(i.fetch),this.lock=i.lock||ln,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Ae()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=on:this.lock=ln,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Ee()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=en(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=en(this.memoryStorage)),Ae()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",async t=>{this._debug("received broadcast notification from other tab or client",t),await this._notifyAllSubscribers(t.data.event,t.data.session,!1)})}this.initialize()}get jwks(){var t,e;return null!==(e=null===(t=cn[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){cn[this.storageKey]=Object.assign(Object.assign({},cn[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=cn[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){cn[this.storageKey]=Object.assign(Object.assign({},cn[this.storageKey]),{cachedAt:t})}_debug(){if(this.logDebugMessages){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logger(`GoTrueClient@${this.instanceID} (${qt}) ${(new Date).toISOString()}`,...e)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var t;try{const e=function(t){const e={},n=new URL(t);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach((t,n)=>{e[n]=t})}catch(i){}return n.searchParams.forEach((t,n)=>{e[n]=t}),e}(window.location.href);let n="none";if(this._isImplicitGrantCallback(e)?n="implicit":await this._isPKCECallback(e)&&(n="pkce"),Ae()&&this.detectSessionInUrl&&"none"!==n){const{data:i,error:s}=await this._getSessionFromURL(e,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),function(t){return ee(t)&&"AuthImplicitGrantRedirectError"===t.name}(s)){const e=null===(t=s.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:s}}return await this._removeSession(),{error:s}}const{session:r,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",r,"redirect type",o),await this._saveSession(r),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return ee(e)?{error:e}:{error:new ie("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,n,i;try{const s=await Ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(n=null===(e=null===t||void 0===t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(i=null===t||void 0===t?void 0:t.options)||void 0===i?void 0:i.captchaToken}},xform:Ge}),{data:r,error:o}=s;if(o||!r)return{data:{user:null,session:null},error:o};const a=r.session,l=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(ee(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(t){var e,n,i;try{let s;if("email"in t){const{email:n,password:i,options:r}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Oe(this.storage,this.storageKey)),s=await Ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null===r||void 0===r?void 0:r.emailRedirectTo,body:{email:n,password:i,data:null!==(e=null===r||void 0===r?void 0:r.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken},code_challenge:o,code_challenge_method:a},xform:Ge})}else{if(!("phone"in t))throw new ae("You must provide either an email or phone number and a password");{const{phone:e,password:r,options:o}=t;s=await Ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:r,data:null!==(n=null===o||void 0===o?void 0:o.data)&&void 0!==n?n:{},channel:null!==(i=null===o||void 0===o?void 0:o.channel)&&void 0!==i?i:"sms",gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},xform:Ge})}}const{data:r,error:o}=s;if(o||!r)return{data:{user:null,session:null},error:o};const a=r.session,l=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(ee(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(t){try{let e;if("email"in t){const{email:n,password:i,options:s}=t;e=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:i,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},xform:qe})}else{if(!("phone"in t))throw new ae("You must provide either an email or phone number and a password");{const{phone:n,password:i,options:s}=t;e=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:i,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},xform:qe})}}const{data:n,error:i}=e;return i?{data:{user:null,session:null},error:i}:n&&n.session&&n.user?(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i}):{data:{user:null,session:null},error:new oe}}catch(e){if(ee(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,n,i,s;return await this._handleProviderSignIn(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(n=t.options)||void 0===n?void 0:n.scopes,queryParams:null===(i=t.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:null===(s=t.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:e}=t;if("solana"===e)return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}async signInWithSolana(t){var e,n,i,s,r,o,a,l,c,h,u,d;let p,f;if("message"in t)p=t.message,f=t.signature;else{const{chain:u,wallet:d,statement:g,options:m}=t;let v;if(Ae())if("object"===typeof d)v=d;else{const t=window;if(!("solana"in t)||"object"!==typeof t.solana||!("signIn"in t.solana&&"function"===typeof t.solana.signIn||"signMessage"in t.solana&&"function"===typeof t.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=t.solana}else{if("object"!==typeof d||!(null===m||void 0===m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=d}const y=new URL(null!==(e=null===m||void 0===m?void 0:m.url)&&void 0!==e?e:window.location.href);if("signIn"in v&&v.signIn){const t=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===m||void 0===m?void 0:m.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),g?{statement:g}:null));let e;if(Array.isArray(t)&&t[0]&&"object"===typeof t[0])e=t[0];else{if(!(t&&"object"===typeof t&&"signedMessage"in t&&"signature"in t))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"===typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");p="string"===typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),f=e.signature}else{if(!("signMessage"in v)||"function"!==typeof v.signMessage||!("publicKey"in v)||"object"!==typeof v||!v.publicKey||!("toBase58"in v.publicKey)||"function"!==typeof v.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${y.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${null!==(i=null===(n=null===m||void 0===m?void 0:m.signInWithSolana)||void 0===n?void 0:n.issuedAt)&&void 0!==i?i:(new Date).toISOString()}`,...(null===(s=null===m||void 0===m?void 0:m.signInWithSolana)||void 0===s?void 0:s.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(r=null===m||void 0===m?void 0:m.signInWithSolana)||void 0===r?void 0:r.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(o=null===m||void 0===m?void 0:m.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(a=null===m||void 0===m?void 0:m.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(l=null===m||void 0===m?void 0:m.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(h=null===(c=null===m||void 0===m?void 0:m.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===h?void 0:h.length)?["Resources",...m.signInWithSolana.resources.map(t=>`- ${t}`)]:[]].join("\n");const t=await v.signMessage((new TextEncoder).encode(p),"utf8");if(!t||!(t instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=t}}try{const{data:e,error:n}=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Se(f)},(null===(u=t.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=t.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Ge});if(n)throw n;return e&&e.session&&e.user?(e.session&&(await this._saveSession(e.session),await this._notifyAllSubscribers("SIGNED_IN",e.session)),{data:Object.assign({},e),error:n}):{data:{user:null,session:null},error:new oe}}catch(g){if(ee(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(t){const e=await Pe(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(null!==e&&void 0!==e?e:"").split("/");try{const{data:e,error:s}=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Ge});if(await Le(this.storage,`${this.storageKey}-code-verifier`),s)throw s;return e&&e.session&&e.user?(e.session&&(await this._saveSession(e.session),await this._notifyAllSubscribers("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!==i&&void 0!==i?i:null}),error:s}):{data:{user:null,session:null,redirectType:null},error:new oe}}catch(s){if(ee(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(t){try{const{options:e,provider:n,token:i,access_token:s,nonce:r}=t,o=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:s,nonce:r,gotrue_meta_security:{captcha_token:null===e||void 0===e?void 0:e.captchaToken}},xform:Ge}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new oe}}catch(e){if(ee(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,n,i,s,r;try{if("email"in t){const{email:i,options:s}=t;let r=null,o=null;"pkce"===this.flowType&&([r,o]=await Oe(this.storage,this.storageKey));const{error:a}=await Ve(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:null!==(e=null===s||void 0===s?void 0:s.data)&&void 0!==e?e:{},create_user:null===(n=null===s||void 0===s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken},code_challenge:r,code_challenge_method:o},redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:n}=t,{data:o,error:a}=await Ve(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(i=null===n||void 0===n?void 0:n.data)&&void 0!==i?i:{},create_user:null===(s=null===n||void 0===n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null===n||void 0===n?void 0:n.captchaToken},channel:null!==(r=null===n||void 0===n?void 0:n.channel)&&void 0!==r?r:"sms"}});return{data:{user:null,session:null,messageId:null===o||void 0===o?void 0:o.message_id},error:a}}throw new ae("You must provide either an email or phone number.")}catch(o){if(ee(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var e,n;try{let i,s;"options"in t&&(i=null===(e=t.options)||void 0===e?void 0:e.redirectTo,s=null===(n=t.options)||void 0===n?void 0:n.captchaToken);const{data:r,error:o}=await Ve(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:Ge});if(o)throw o;if(!r)throw new Error("An error occurred on token verification.");const a=r.session,l=r.user;return(null===a||void 0===a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(ee(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(t){var e,n,i;try{let s=null,r=null;return"pkce"===this.flowType&&([s,r]=await Oe(this.storage,this.storageKey)),await Ve(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(n=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==n?n:void 0}),(null===(i=null===t||void 0===t?void 0:t.options)||void 0===i?void 0:i.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:r}),headers:this.headers,xform:Ke})}catch(s){if(ee(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:n}=t;if(n)throw n;if(!e)throw new re;const{error:i}=await Ve(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:i}})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:n,type:i,options:s}=t,{error:r}=await Ve(this.fetch,"POST",e,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:r}}if("phone"in t){const{phone:n,type:i,options:s}=t,{data:r,error:o}=await Ve(this.fetch,"POST",e,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:null===r||void 0===r?void 0:r.message_id},error:o}}throw new ae("You must provide either an email or phone number and a type")}catch(e){if(ee(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await n}catch(t){}})()),n}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(e){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const e=await Pe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),null!==e&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=!!t.expires_at&&1e3*t.expires_at-Date.now()<Kt;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const e=await Pe(this.userStorage,this.storageKey+"-user");(null===e||void 0===e?void 0:e.user)?t.user=e.user:t.user=je()}if(this.storage.isServer&&t.user){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,n,i)=>(e||"user"!==n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,n,i))})}return{data:{session:t},error:null}}const{session:i,error:s}=await this._callRefreshToken(t.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(t){try{return t?await Ve(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ze}):await this._useSession(async t=>{var e,n,i;const{data:s,error:r}=t;if(r)throw r;return(null===(e=s.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await Ve(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(i=null===(n=s.session)||void 0===n?void 0:n.access_token)&&void 0!==i?i:void 0,xform:Ze}):{data:{user:null},error:new re}})}catch(e){if(ee(e))return function(t){return ee(t)&&"AuthSessionMissingError"===t.name}(e)&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,e))}async _updateUser(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async n=>{const{data:i,error:s}=n;if(s)throw s;if(!i.session)throw new re;const r=i.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await Oe(this.storage,this.storageKey));const{data:l,error:c}=await Ve(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null===e||void 0===e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:r.access_token,xform:Ze});if(c)throw c;return r.user=l.user,await this._saveSession(r),await this._notifyAllSubscribers("USER_UPDATED",r),{data:{user:r.user},error:null}})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new re;const e=Date.now()/1e3;let n=e,i=!0,s=null;const{payload:r}=Ie(t.access_token);if(r.exp&&(n=r.exp,i=n<=e),i){const{session:e,error:n}=await this._callRefreshToken(t.refresh_token);if(n)return{data:{user:null,session:null},error:n};if(!e)return{data:{user:null,session:null},error:null};s=e}else{const{data:i,error:r}=await this._getUser(t.access_token);if(r)throw r;s={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:n-e,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(e){if(ee(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var n;if(!t){const{data:i,error:s}=e;if(s)throw s;t=null!==(n=i.session)&&void 0!==n?n:void 0}if(!(null===t||void 0===t?void 0:t.refresh_token))throw new re;const{session:i,error:s}=await this._callRefreshToken(t.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(ee(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(t,e){try{if(!Ae())throw new le("No browser detected.");if(t.error||t.error_description||t.error_code)throw new le(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new ce("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new le("Not a valid implicit grant flow url.")}if("pkce"===e){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new ce("No code detected.");const{data:e,error:n}=await this._exchangeCodeForSession(t.code);if(n)throw n;const i=new URL(window.location.href);return i.searchParams.delete("code"),window.history.replaceState(window.history.state,"",i.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:s,refresh_token:r,expires_in:o,expires_at:a,token_type:l}=t;if(!s||!o||!r||!l)throw new le("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(o);let u=c+h;a&&(u=parseInt(a));const d=u-c;1e3*d<=Zt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const p=u-h;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,u,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,u,c);const{data:f,error:g}=await this._getUser(s);if(g)throw g;const m={provider_token:n,provider_refresh_token:i,access_token:s,expires_in:h,expires_at:u,refresh_token:r,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:t.type},error:null}}catch(n){if(ee(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return Boolean(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await Pe(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)}async signOut(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut(){let{scope:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async e=>{var n;const{data:i,error:s}=e;if(s)return{error:s};const r=null===(n=i.session)||void 0===n?void 0:n.access_token;if(r){const{error:e}=await this.admin.signOut(r,t);if(e&&(!function(t){return ee(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),n={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,n),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(e)})})(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async e=>{var n,i;try{const{data:{session:i},error:s}=e;if(s)throw s;await(null===(n=this.stateChangeEmitters.get(t))||void 0===n?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(s){await(null===(i=this.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",s),console.error(s)}})}async resetPasswordForEmail(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,i=null;"pkce"===this.flowType&&([n,i]=await Oe(this.storage,this.storageKey,!0));try{return await Ve(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(s){if(ee(s))return{data:null,error:s};throw s}}async getUserIdentities(){var t;try{const{data:e,error:n}=await this.getUser();if(n)throw n;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(ee(e))return{data:null,error:e};throw e}}async linkIdentity(t){var e;try{const{data:n,error:i}=await this._useSession(async e=>{var n,i,s,r,o;const{data:a,error:l}=e;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(n=t.options)||void 0===n?void 0:n.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(s=t.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await Ve(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(r=a.session)||void 0===r?void 0:r.access_token)&&void 0!==o?o:void 0})});if(i)throw i;return Ae()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null===n||void 0===n?void 0:n.url),{data:{provider:t.provider,url:null===n||void 0===n?void 0:n.url},error:null}}catch(n){if(ee(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession(async e=>{var n,i;const{data:s,error:r}=e;if(r)throw r;return await Ve(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(i=null===(n=s.session)||void 0===n?void 0:n.access_token)&&void 0!==i?i:void 0})})}catch(e){if(ee(e))return{data:null,error:e};throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const s=Date.now();return await(n=async n=>(n>0&&await async function(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}(200*Math.pow(2,n-1)),this._debug(e,"refreshing attempt",n),await Ve(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ge})),i=(t,e)=>{const n=200*Math.pow(2,t);return e&&ue(e)&&Date.now()+n-s<Zt},new Promise((t,e)=>{(async()=>{for(let r=0;r<1/0;r++)try{const e=await n(r);if(!i(r,null,e))return void t(e)}catch(s){if(!i(r,s))return void e(s)}})()}))}catch(s){if(this._debug(e,"error",s),ee(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(e,"end")}var n,i}_isValidSession(t){return"object"===typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",n),Ae()&&!e.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,e;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Pe(this.storage,this.storageKey);if(s&&this.userStorage){let e=await Pe(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:s.user},await Te(this.userStorage,this.storageKey+"-user",e)),s.user=null!==(t=null===e||void 0===e?void 0:e.user)&&void 0!==t?t:je()}else if(s&&!s.user&&!s.user){const t=await Pe(this.storage,this.storageKey+"-user");t&&(null===t||void 0===t?void 0:t.user)?(s.user=t.user,await Le(this.storage,this.storageKey+"-user"),await Te(this.storage,this.storageKey,s)):s.user=je()}if(this._debug(n,"session from storage",s),!this._isValidSession(s))return this._debug(n,"session is not valid"),void(null!==s&&await this._removeSession());const r=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<Kt;if(this._debug(n,`session has${r?"":" not"} expired with margin of 90000s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:t}=await this._callRefreshToken(s.refresh_token);t&&(console.error(t),ue(t)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",t),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{const{data:t,error:e}=await this._getUser(s.access_token);!e&&(null===t||void 0===t?void 0:t.user)?(s.user=t.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(n,"error",s),void console.error(s)}finally{this._debug(n,"end")}}async _callRefreshToken(t){var e,n;if(!t)throw new re;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Me;const{data:e,error:n}=await this._refreshAccessToken(t);if(n)throw n;if(!e.session)throw new re;await this._saveSession(e.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",e.session);const i={session:e.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(s){if(this._debug(i,"error",s),ee(s)){const t={session:null,error:s};return ue(s)||await this._removeSession(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=`#_notifyAllSubscribers(${t})`;this._debug(i,"begin",e,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:e});const i=[],s=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(t,e)}catch(s){i.push(s)}});if(await Promise.all(s),i.length>0){for(let t=0;t<i.length;t+=1)console.error(i[t]);throw i[0]}}finally{this._debug(i,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),n=e.user&&!0===e.user.__isUserNotAvailableProxy;if(this.userStorage){!n&&e.user&&await Te(this.userStorage,this.storageKey+"-user",{user:e.user});const t=Object.assign({},e);delete t.user;const i=Be(t);await Te(this.storage,this.storageKey,i)}else{const t=Be(e);await Te(this.storage,this.storageKey,t)}}async _removeSession(){this._debug("#_removeSession()"),await Le(this.storage,this.storageKey),await Le(this.storage,this.storageKey+"-code-verifier"),await Le(this.storage,this.storageKey+"-user"),this.userStorage&&await Le(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Ae()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Zt);this.autoRefreshTicker=t,t&&"object"===typeof t&&"function"===typeof t.unref?t.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const i=Math.floor((1e3*n.expires_at-e)/Zt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),i<=3&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(!(t.isAcquireTimeout||t instanceof sn))throw t;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ae()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,n){const i=[`provider=${encodeURIComponent(e)}`];if((null===n||void 0===n?void 0:n.redirectTo)&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),(null===n||void 0===n?void 0:n.scopes)&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===this.flowType){const[t,e]=await Oe(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(e)}`});i.push(n.toString())}if(null===n||void 0===n?void 0:n.queryParams){const t=new URLSearchParams(n.queryParams);i.push(t.toString())}return(null===n||void 0===n?void 0:n.skipBrowserRedirect)&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${i.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var n;const{data:i,error:s}=e;return s?{data:null,error:s}:await Ve(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(n=null===i||void 0===i?void 0:i.session)||void 0===n?void 0:n.access_token})})}catch(e){if(ee(e))return{data:null,error:e};throw e}}async _enroll(t){try{return await this._useSession(async e=>{var n,i;const{data:s,error:r}=e;if(r)return{data:null,error:r};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:{issuer:t.issuer}),{data:a,error:l}=await Ve(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(n=null===s||void 0===s?void 0:s.session)||void 0===n?void 0:n.access_token});return l?{data:null,error:l}:("totp"===t.factorType&&(null===(i=null===a||void 0===a?void 0:a.totp)||void 0===i?void 0:i.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(e){if(ee(e))return{data:null,error:e};throw e}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async e=>{var n;const{data:i,error:s}=e;if(s)return{data:null,error:s};const{data:r,error:o}=await Ve(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(n=null===i||void 0===i?void 0:i.session)||void 0===n?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+r.expires_in},r)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",r),{data:r,error:o})})}catch(e){if(ee(e))return{data:null,error:e};throw e}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async e=>{var n;const{data:i,error:s}=e;return s?{data:null,error:s}:await Ve(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:null===(n=null===i||void 0===i?void 0:i.session)||void 0===n?void 0:n.access_token})})}catch(e){if(ee(e))return{data:null,error:e};throw e}})}async _challengeAndVerify(t){const{data:e,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){const{data:{user:t},error:e}=await this.getUser();if(e)return{data:null,error:e};const n=(null===t||void 0===t?void 0:t.factors)||[],i=n.filter(t=>"totp"===t.factor_type&&"verified"===t.status),s=n.filter(t=>"phone"===t.factor_type&&"verified"===t.status);return{data:{all:n,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var e,n;const{data:{session:i},error:s}=t;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:r}=Ie(i.access_token);let o=null;r.aal&&(o=r.aal);let a=o;(null!==(n=null===(e=i.user.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==n?n:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:r.amr||[]},error:null}}))}async fetchJwk(t){let e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(e=>e.kid===t);if(e)return e;const n=Date.now();if(e=this.jwks.keys.find(e=>e.kid===t),e&&this.jwks_cached_at+6e5>n)return e;const{data:i,error:s}=await Ve(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(s)throw s;return i.keys&&0!==i.keys.length?(this.jwks=i,this.jwks_cached_at=n,e=i.keys.find(e=>e.kid===t),e||null):null}async getClaims(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=t;if(!n){const{data:t,error:e}=await this.getSession();if(e||!t.session)return{data:null,error:e};n=t.session.access_token}const{header:i,payload:s,signature:r,raw:{header:o,payload:a}}=Ie(n);(null===e||void 0===e?void 0:e.allowExpired)||function(t){if(!t)throw new Error("Missing exp claim");if(t<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const l=i.alg&&!i.alg.startsWith("HS")&&i.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(i.kid,(null===e||void 0===e?void 0:e.keys)?{keys:e.keys}:null===e||void 0===e?void 0:e.jwks):null;if(!l){const{error:t}=await this.getUser(n);if(t)throw t;return{data:{claims:s,header:i,signature:r},error:null}}const c=function(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(i.alg),h=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,h,r,function(t){const e=[];return we(t,t=>e.push(t)),new Uint8Array(e)}(`${o}.${a}`)))throw new pe("Invalid JWT signature");return{data:{claims:s,header:i,signature:r},error:null}}catch(n){if(ee(n))return{data:null,error:n};throw n}}}hn.nextInstanceID=0;const un=hn;class dn extends un{constructor(t){super(t)}}var pn=function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class fn{constructor(t,e,n){var i,s,r;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const o=(a=t).endsWith("/")?a:a+"/";var a;const l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,h=function(t,e){var n,i;const{db:s,auth:r,realtime:o,global:a}=t,{db:l,auth:c,realtime:h,global:u}=e,d={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),r),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},null!==(n=null===u||void 0===u?void 0:u.headers)&&void 0!==n?n:{}),null!==(i=null===a||void 0===a?void 0:a.headers)&&void 0!==i?i:{})}),accessToken:()=>Gt(this,void 0,void 0,function*(){return""})};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}(null!==n&&void 0!==n?n:{},{db:jt,realtime:Ut,auth:Object.assign(Object.assign({},Bt),{storageKey:c}),global:Ft});this.storageKey=null!==(i=h.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(s=h.global.headers)&&void 0!==s?s:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(t,e)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(e)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(r=h.auth)&&void 0!==r?r:{},this.headers,h.global.fetch),this.fetch=Vt(e,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new R(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new Nt(this.storageUrl.href,this.headers,this.fetch,null===n||void 0===n?void 0:n.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new M(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.rest.rpc(t,e,n)}channel(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return pn(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return null!==(e=null===(t=n.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:null})}_initSupabaseAuthClient(t,e,n){let{autoRefreshToken:i,persistSession:s,detectSessionInUrl:r,storage:o,storageKey:a,flowType:l,lock:c,debug:h}=t;const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new dn({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),e),storageKey:a,autoRefreshToken:i,persistSession:s,detectSessionInUrl:r,storage:o,flowType:l,lock:c,debug:h,fetch:n,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new dt(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null===t||void 0===t?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",null===e||void 0===e?void 0:e.access_token)})}_handleTokenChanged(t,e,n){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===n?"SIGNED_OUT"===t&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=n}}(function(){if("undefined"!==typeof window||"undefined"===typeof process||void 0===process.version||null===process.version)return!1;const t=process.version.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const gn="https://dnzbvilsuavvtthdwega.supabase.co",mn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRuemJ2aWxzdWF2dnR0aGR3ZWdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwODE4MzcsImV4cCI6MjA2OTY1NzgzN30.zY4Sfw3CaEk_neBlUza7OnC8nwtJdexSf9dLLhteXLg";const vn=((t,e,n)=>new fn(t,e,n))(gn||"https://placeholder.supabase.co",mn||"placeholder-key"),yn={async getUserOverlays(t){const{data:e,error:n}=await vn.from("overlays").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(n)throw console.error("Error fetching overlays:",n),n;return(e||[]).map(t=>({id:t.id,name:t.name,imageUrl:t.image_url,opacity:t.opacity,scale:t.scale,rotation:t.rotation,position:t.position,anchorPoints:t.anchor_points,createdAt:t.created_at,updatedAt:t.updated_at,userId:t.user_id}))},async createOverlay(t){let e=t.position;t.anchorPoints&&(e={lat:(t.anchorPoints.topLeft.lat+t.anchorPoints.bottomRight.lat)/2,lng:(t.anchorPoints.topLeft.lng+t.anchorPoints.bottomRight.lng)/2});const n={name:t.name,image_url:t.imageUrl,opacity:t.opacity,scale:t.scale,rotation:t.rotation,position:e,anchor_points:t.anchorPoints,user_id:t.userId},{data:i,error:s}=await vn.from("overlays").insert([n]).select().single();if(s)throw console.error("Error creating overlay:",s),s;return{id:i.id,name:i.name,imageUrl:i.image_url,opacity:i.opacity,scale:i.scale,rotation:i.rotation,position:i.position,anchorPoints:i.anchor_points,createdAt:i.created_at,updatedAt:i.updated_at,userId:i.user_id}},async updateOverlay(t,e){let n=e.position;e.anchorPoints&&(n={lat:(e.anchorPoints.topLeft.lat+e.anchorPoints.bottomRight.lat)/2,lng:(e.anchorPoints.topLeft.lng+e.anchorPoints.bottomRight.lng)/2});const i={name:e.name,opacity:e.opacity,scale:e.scale,rotation:e.rotation,position:n,anchor_points:e.anchorPoints,updated_at:(new Date).toISOString()},{data:s,error:r}=await vn.from("overlays").update(i).eq("id",t).select().single();if(r)throw console.error("Error updating overlay:",r),r;return s},async deleteOverlay(t){const{error:e}=await vn.from("overlays").delete().eq("id",t);if(e)throw console.error("Error deleting overlay:",e),e}},bn={async uploadImage(t,e){const n=`${e}/${Date.now()}-${t.name}`,{data:i,error:s}=await vn.storage.from("overlay-images").upload(n,t);if(s)throw console.error("Error uploading image:",s),s;const{data:r}=vn.storage.from("overlay-images").getPublicUrl(n);return r.publicUrl},async deleteImage(t){const{error:e}=await vn.storage.from("overlay-images").remove([t]);if(e)throw console.error("Error deleting image:",e),e}},_n={async getCurrentUser(){var t,e,n;const{data:{user:i}}=await vn.auth.getUser();return i?(await this.ensureUserExists(i),{id:i.id,email:i.email||"",name:(null===(t=i.user_metadata)||void 0===t?void 0:t.full_name)||(null===(e=i.user_metadata)||void 0===e?void 0:e.name),avatar_url:null===(n=i.user_metadata)||void 0===n?void 0:n.avatar_url}):null},async ensureUserExists(t){try{var e,n,i,s;const r=(null===(e=t.user_metadata)||void 0===e?void 0:e.full_name)||(null===(n=t.user_metadata)||void 0===n?void 0:n.name)||(null===(i=t.user_metadata)||void 0===i?void 0:i.display_name)||(null===(s=t.email)||void 0===s?void 0:s.split("@")[0]),o={id:t.id,email:t.email||"",name:r,updated_at:(new Date).toISOString()},a=new Promise((t,e)=>{setTimeout(()=>e(new Error("ensureUserExists timeout")),5e3)}),l=vn.from("users").upsert([o],{onConflict:"id"}).select(),{error:c}=await Promise.race([l,a]);c&&console.error("Error ensuring user exists:",c)}catch(r){console.error("Exception ensuring user exists:",r)}},async signInWithEmail(t,e){var n,i,s;const{data:r,error:o}=await vn.auth.signInWithPassword({email:t,password:e});if(o)throw console.error("Error signing in with email:",o),o;if(!r.user)throw new Error("No user data returned");return{id:r.user.id,email:r.user.email||"",name:(null===(n=r.user.user_metadata)||void 0===n?void 0:n.full_name)||(null===(i=r.user.user_metadata)||void 0===i?void 0:i.name),avatar_url:null===(s=r.user.user_metadata)||void 0===s?void 0:s.avatar_url}},async signUpWithEmail(t,e,n){var i,s,r;const{data:o,error:a}=await vn.auth.signUp({email:t,password:e,options:{data:{full_name:n,name:n}}});if(a)throw console.error("Error signing up with email:",a),a;if(!o.user)throw new Error("No user data returned");return{id:o.user.id,email:o.user.email||"",name:(null===(i=o.user.user_metadata)||void 0===i?void 0:i.full_name)||(null===(s=o.user.user_metadata)||void 0===s?void 0:s.name),avatar_url:null===(r=o.user.user_metadata)||void 0===r?void 0:r.avatar_url}},async signInWithGoogle(){const{error:t}=await vn.auth.signInWithOAuth({provider:"google",options:{redirectTo:(()=>{const t=window.location.hostname,e=window.location.port;return"localhost"===t||"127.0.0.1"===t?`http://192.168.75.191:${e}`:window.location.origin})()}});if(t)throw console.error("Error signing in with Google:",t),t},async handleOAuthCallback(){var t,e,n;const{data:{user:i}}=await vn.auth.getUser();return i?(await this.ensureUserExists(i),{id:i.id,email:i.email||"",name:(null===(t=i.user_metadata)||void 0===t?void 0:t.full_name)||(null===(e=i.user_metadata)||void 0===e?void 0:e.name),avatar_url:null===(n=i.user_metadata)||void 0===n?void 0:n.avatar_url}):null},async signOut(){const{error:t}=await vn.auth.signOut();if(t)throw console.error("Error signing out:",t),t},onAuthStateChange(t){return vn.auth.onAuthStateChange(async(e,n)=>{if("SIGNED_IN"===e&&null!==n&&void 0!==n&&n.user){var i,s,r,o,a;await this.ensureUserExists(n.user);const e={id:n.user.id,email:n.user.email||"",name:(null===(i=n.user.user_metadata)||void 0===i?void 0:i.full_name)||(null===(s=n.user.user_metadata)||void 0===s?void 0:s.name)||(null===(r=n.user.user_metadata)||void 0===r?void 0:r.display_name)||(null===(o=n.user.email)||void 0===o?void 0:o.split("@")[0]),avatar_url:null===(a=n.user.user_metadata)||void 0===a?void 0:a.avatar_url};t(e)}else if("TOKEN_REFRESHED"===e&&null!==n&&void 0!==n&&n.user){var l,c,h,u,d;await this.ensureUserExists(n.user);const e={id:n.user.id,email:n.user.email||"",name:(null===(l=n.user.user_metadata)||void 0===l?void 0:l.full_name)||(null===(c=n.user.user_metadata)||void 0===c?void 0:c.name)||(null===(h=n.user.user_metadata)||void 0===h?void 0:h.display_name)||(null===(u=n.user.email)||void 0===u?void 0:u.split("@")[0]),avatar_url:null===(d=n.user.user_metadata)||void 0===d?void 0:d.avatar_url};t(e)}else"SIGNED_OUT"===e&&t(null)})}},wn=e=>{let{isOpen:n,onClose:i,onLoginSuccess:s}=e;const[r,o]=(0,t.useState)(!1),[a,l]=(0,t.useState)(""),[c,h]=(0,t.useState)(""),[u,d]=(0,t.useState)(""),[p,f]=(0,t.useState)(!1),[g,v]=(0,t.useState)("");return n?(0,m.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:(0,m.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"32px",width:"90%",maxWidth:"400px",boxShadow:"0 20px 40px rgba(0,0,0,0.3)"},children:[(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[(0,m.jsx)("h2",{style:{margin:0,color:"#3A5F76",fontFamily:"Inter, sans-serif",fontSize:"24px",fontWeight:"600"},children:r?"Create Account":"Sign In"}),(0,m.jsx)("button",{onClick:i,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#666",padding:"4px"},children:"\xd7"})]}),(0,m.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),f(!0),v("");try{let t;t=r?await _n.signUpWithEmail(a,c,u):await _n.signInWithEmail(a,c),s(t),i()}catch(e){v(e instanceof Error?e.message:"An error occurred")}finally{f(!1)}},children:[r&&(0,m.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#333",fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"500"},children:"Name"}),(0,m.jsx)("input",{type:"text",value:u,onChange:t=>d(t.target.value),style:{width:"100%",padding:"12px",border:"2px solid #E0E0E0",borderRadius:"8px",fontSize:"16px",fontFamily:"Inter, sans-serif",boxSizing:"border-box"},placeholder:"Enter your name",required:r})]}),(0,m.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#333",fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"500"},children:"Email"}),(0,m.jsx)("input",{type:"email",value:a,onChange:t=>l(t.target.value),style:{width:"100%",padding:"12px",border:"2px solid #E0E0E0",borderRadius:"8px",fontSize:"16px",fontFamily:"Inter, sans-serif",boxSizing:"border-box"},placeholder:"Enter your email",required:!0})]}),(0,m.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#333",fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"500"},children:"Password"}),(0,m.jsx)("input",{type:"password",value:c,onChange:t=>h(t.target.value),style:{width:"100%",padding:"12px",border:"2px solid #E0E0E0",borderRadius:"8px",fontSize:"16px",fontFamily:"Inter, sans-serif",boxSizing:"border-box"},placeholder:"Enter your password",required:!0})]}),g&&(0,m.jsx)("div",{style:{backgroundColor:"#FEE",color:"#C53030",padding:"12px",borderRadius:"8px",marginBottom:"16px",fontSize:"14px",fontFamily:"Inter, sans-serif"},children:g}),(0,m.jsx)("button",{type:"submit",disabled:p,style:{width:"100%",padding:"14px",backgroundColor:"#3A5F76",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:p?"not-allowed":"pointer",opacity:p?.7:1,marginBottom:"16px",fontFamily:"Inter, sans-serif"},children:p?"Loading...":r?"Create Account":"Sign In"})]}),(0,m.jsx)("div",{style:{textAlign:"center",marginBottom:"16px",color:"#666",fontFamily:"Inter, sans-serif"},children:"or"}),(0,m.jsxs)("button",{onClick:async()=>{f(!0),v("");try{await _n.signInWithGoogle()}catch(t){v(t instanceof Error?t.message:"An error occurred"),f(!1)}},disabled:p,style:{width:"100%",padding:"14px",backgroundColor:"white",color:"#333",border:"2px solid #E0E0E0",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:p?"not-allowed":"pointer",opacity:p?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontFamily:"Inter, sans-serif"},children:[(0,m.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[(0,m.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,m.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,m.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,m.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),(0,m.jsxs)("div",{style:{textAlign:"center",marginTop:"24px",fontFamily:"Inter, sans-serif"},children:[(0,m.jsx)("span",{style:{color:"#666"},children:r?"Already have an account?":"Don't have an account?"}),(0,m.jsx)("button",{onClick:()=>{o(!r),v("")},style:{background:"none",border:"none",color:"#3A5F76",cursor:"pointer",marginLeft:"8px",fontWeight:"600",fontFamily:"Inter, sans-serif"},children:r?"Sign In":"Sign Up"})]})]})}):null},xn="object"===typeof process&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),Sn=[.001,0,0,.001,0,0],An=1.35,kn=1,En=2,Cn=4,Tn=16,Pn=32,Ln=64,Mn=128,In=256,Rn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Dn="pdfjs_internal_editor_",On={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101,COMMENT:102},Nn={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},zn=0,Fn=1,jn=2,Bn=3,Un=3,Hn=4,$n={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Wn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Vn=1,Gn=2,qn=3,Zn=4,Kn=5,Xn={ERRORS:0,WARNINGS:1,INFOS:5},Yn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Jn=0,Qn=1,ti=2,ei=3;let ni=Xn.WARNINGS;function ii(t){Number.isInteger(t)&&(ni=t)}function si(){return ni}function ri(t){ni>=Xn.INFOS&&console.log(`Info: ${t}`)}function oi(t){ni>=Xn.WARNINGS&&console.log(`Warning: ${t}`)}function ai(t){throw new Error(t)}function li(t,e){t||ai(e)}function ci(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;if(n&&"string"===typeof t){if(n.addDefaultProtocol&&t.startsWith("www.")){const e=t.match(/\./g);e?.length>=2&&(t=`http://${t}`)}if(n.tryConvertEncoding)try{t=decodeURIComponent(escape(t))}catch{}}const i=e?URL.parse(t,e):URL.parse(t);return function(t){switch(t?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i)?i:null}function hi(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=URL.parse(t);return i?(i.hash=e,i.href):n&&ci(t,"http://example.com")?t.split("#",1)[0]+""+(e?`#${e}`:""):""}function ui(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!0,writable:!1}),n}const di=function(){function t(t,e){this.message=t,this.name=e}return t.prototype=new Error,t.constructor=t,t}();class pi extends di{constructor(t,e){super(t,"PasswordException"),this.code=e}}class fi extends di{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class gi extends di{constructor(t){super(t,"InvalidPDFException")}}class mi extends di{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class vi extends di{constructor(t){super(t,"FormatError")}}class yi extends di{constructor(t){super(t,"AbortException")}}function bi(t){"object"===typeof t&&void 0!==t?.length||ai("Invalid argument for bytesToString");const e=t.length,n=8192;if(e<n)return String.fromCharCode.apply(null,t);const i=[];for(let s=0;s<e;s+=n){const r=Math.min(s+n,e),o=t.subarray(s,r);i.push(String.fromCharCode.apply(null,o))}return i.join("")}function _i(t){"string"!==typeof t&&ai("Invalid argument for stringToBytes");const e=t.length,n=new Uint8Array(e);for(let i=0;i<e;++i)n[i]=255&t.charCodeAt(i);return n}class wi{static get isLittleEndian(){return ui(this,"isLittleEndian",function(){const t=new Uint8Array(4);return t[0]=1,1===new Uint32Array(t.buffer,0,1)[0]}())}static get isEvalSupported(){return ui(this,"isEvalSupported",function(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return ui(this,"isOffscreenCanvasSupported","undefined"!==typeof OffscreenCanvas)}static get isImageDecoderSupported(){return ui(this,"isImageDecoderSupported","undefined"!==typeof ImageDecoder)}static get platform(){const{platform:t,userAgent:e}=navigator;return ui(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return ui(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const xi=Array.from(Array(256).keys(),t=>t.toString(16).padStart(2,"0"));class Si{static makeHexColor(t,e,n){return`#${xi[t]}${xi[e]}${xi[n]}`}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=t[n],s=t[n+1];t[n]=i*e[0]+s*e[2]+e[4],t[n+1]=i*e[1]+s*e[3]+e[5]}static applyTransformToBezier(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5];for(let c=0;c<6;c+=2){const e=t[n+c],h=t[n+c+1];t[n+c]=e*i+h*r+a,t[n+c+1]=e*s+h*o+l}}static applyInverseTransform(t,e){const n=t[0],i=t[1],s=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/s,t[1]=(-n*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/s}static axialAlignedBoundingBox(t,e,n){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=t[0],h=t[1],u=t[2],d=t[3];let p=i*c+a,f=p,g=i*u+a,m=g,v=o*h+l,y=v,b=o*d+l,_=b;if(0!==s||0!==r){const t=s*c,e=s*u,n=r*h,i=r*d;p+=n,m+=n,g+=i,f+=i,v+=t,_+=t,b+=e,y+=e}n[0]=Math.min(n[0],p,g,f,m),n[1]=Math.min(n[1],v,b,y,_),n[2]=Math.max(n[2],p,g,f,m),n[3]=Math.max(n[3],v,b,y,_)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],i=t[1],s=t[2],r=t[3],o=n**2+i**2,a=n*s+i*r,l=s**2+r**2,c=(o+l)/2,h=Math.sqrt(c**2-(o*l-a**2));e[0]=Math.sqrt(c+h||1),e[1]=Math.sqrt(c-h||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>i)return null;const s=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return s>r?null:[n,s,i,r]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,i,s){s[0]=Math.min(s[0],t,n),s[1]=Math.min(s[1],e,i),s[2]=Math.max(s[2],t,n),s[3]=Math.max(s[3],e,i)}static#t(t,e,n,i,s,r,o,a,l,c){if(l<=0||l>=1)return;const h=1-l,u=l*l,d=u*l,p=h*(h*(h*t+3*l*e)+3*u*n)+d*i,f=h*(h*(h*s+3*l*r)+3*u*o)+d*a;c[0]=Math.min(c[0],p),c[1]=Math.min(c[1],f),c[2]=Math.max(c[2],p),c[3]=Math.max(c[3],f)}static#e(t,e,n,i,s,r,o,a,l,c,h,u){if(Math.abs(l)<1e-12)return void(Math.abs(c)>=1e-12&&this.#t(t,e,n,i,s,r,o,a,-h/c,u));const d=c**2-4*h*l;if(d<0)return;const p=Math.sqrt(d),f=2*l;this.#t(t,e,n,i,s,r,o,a,(-c+p)/f,u),this.#t(t,e,n,i,s,r,o,a,(-c-p)/f,u)}static bezierBoundingBox(t,e,n,i,s,r,o,a,l){l[0]=Math.min(l[0],t,o),l[1]=Math.min(l[1],e,a),l[2]=Math.max(l[2],t,o),l[3]=Math.max(l[3],e,a),this.#e(t,n,s,o,e,i,r,a,3*(3*(n-s)-t+o),6*(t-2*n+s),3*(n-t),l),this.#e(t,n,s,o,e,i,r,a,3*(3*(i-r)-e+a),6*(e-2*i+r),3*(i-e),l)}}let Ai=null,ki=null;function Ei(){if("function"===typeof crypto.randomUUID)return crypto.randomUUID();const t=new Uint8Array(32);return crypto.getRandomValues(t),bi(t)}const Ci="pdfjs_internal_id_";function Ti(t,e,n){return Math.min(Math.max(t,e),n)}function Pi(t){return Uint8Array.prototype.toBase64?t.toBase64():btoa(bi(t))}"function"!==typeof Promise.try&&(Promise.try=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return new Promise(e=>{e(t(...n))})}),"function"!==typeof Math.sumPrecise&&(Math.sumPrecise=function(t){return t.reduce((t,e)=>t+e,0)});const Li="http://www.w3.org/2000/svg";class Mi{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=(()=>this.CSS/this.PDF)()}async function Ii(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(Fi(t,document.baseURI)){const n=await fetch(t);if(!n.ok)throw new Error(n.statusText);switch(e){case"arraybuffer":return n.arrayBuffer();case"blob":return n.blob();case"json":return n.json()}return n.text()}return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE)if(200!==s.status&&0!==s.status)i(new Error(s.statusText));else{switch(e){case"arraybuffer":case"blob":case"json":return void n(s.response)}n(s.responseText)}},s.send(null)})}class Ri{constructor(t){let{viewBox:e,userUnit:n,scale:i,rotation:s,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}=t;this.viewBox=e,this.userUnit=n,this.scale=i,this.rotation=s,this.offsetX=r,this.offsetY=o,i*=n;const l=(e[2]+e[0])/2,c=(e[3]+e[1])/2;let h,u,d,p,f,g,m,v;switch(s%=360,s<0&&(s+=360),s){case 180:h=-1,u=0,d=0,p=1;break;case 90:h=0,u=1,d=1,p=0;break;case 270:h=0,u=-1,d=-1,p=0;break;case 0:h=1,u=0,d=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(d=-d,p=-p),0===h?(f=Math.abs(c-e[1])*i+r,g=Math.abs(l-e[0])*i+o,m=(e[3]-e[1])*i,v=(e[2]-e[0])*i):(f=Math.abs(l-e[0])*i+r,g=Math.abs(c-e[1])*i+o,m=(e[2]-e[0])*i,v=(e[3]-e[1])*i),this.transform=[h*i,u*i,d*i,p*i,f-h*i*l-d*i*c,g-u*i*l-p*i*c],this.width=m,this.height=v}get rawDims(){const t=this.viewBox;return ui(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone(){let{scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ri({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:s})}convertToViewportPoint(t,e){const n=[t,e];return Si.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];Si.applyTransform(e,this.transform);const n=[t[2],t[3]];return Si.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return Si.applyInverseTransform(n,this.transform),n}}class Di extends di{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super(t,"RenderingCancelledException"),this.extraDelay=e}}function Oi(t){const e=t.length;let n=0;for(;n<e&&""===t[n].trim();)n++;return"data:"===t.substring(n,n+5).toLowerCase()}function Ni(t){return"string"===typeof t&&/\.pdf$/i.test(t)}class zi{started=(()=>Object.create(null))();times=[];time(t){t in this.started&&oi(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||oi(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:i,end:s}of this.times)t.push(`${n.padEnd(e)} ${s-i}ms\n`);return t.join("")}}function Fi(t,e){const n=e?URL.parse(t,e):URL.parse(t);return"http:"===n?.protocol||"https:"===n?.protocol}function ji(t){t.preventDefault()}function Bi(t){t.preventDefault(),t.stopPropagation()}class Ui{static#n;static toDateObject(t){if(t instanceof Date)return t;if(!t||"string"!==typeof t)return null;this.#n||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#n.exec(t);if(!e)return null;const n=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(e[3],10);s=s>=1&&s<=31?s:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let a=parseInt(e[6],10);a=a>=0&&a<=59?a:0;const l=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(e[9],10)||0;return h=h>=0&&h<=59?h:0,"-"===l?(r+=c,o+=h):"+"===l&&(r-=c,o-=h),new Date(Date.UTC(n,i,s,r,o,a))}}function Hi(t){if(t.startsWith("#")){const e=parseInt(t.slice(1),16);return[(16711680&e)>>16,(65280&e)>>8,255&e]}return t.startsWith("rgb(")?t.slice(4,-1).split(",").map(t=>parseInt(t)):t.startsWith("rgba(")?t.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(oi(`Not a valid color format: "${t}"`),[0,0,0])}function $i(t){const{a:e,b:n,c:i,d:s,e:r,f:o}=t.getTransform();return[e,n,i,s,r,o]}function Wi(t){const{a:e,b:n,c:i,d:s,e:r,f:o}=t.getTransform().invertSelf();return[e,n,i,s,r,o]}function Vi(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e instanceof Ri){const{pageWidth:i,pageHeight:s}=e.rawDims,{style:r}=t,o=wi.isCSSRoundSupported,a=`var(--total-scale-factor) * ${i}px`,l=`var(--total-scale-factor) * ${s}px`,c=o?`round(down, ${a}, var(--scale-round-x))`:`calc(${a})`,h=o?`round(down, ${l}, var(--scale-round-y))`:`calc(${l})`;n&&e.rotation%180!==0?(r.width=h,r.height=c):(r.width=c,r.height=h)}i&&t.setAttribute("data-main-rotation",e.rotation)}class Gi{constructor(){const{pixelRatio:t}=Gi;this.sx=t,this.sy=t}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,r=1/0,o=1/0,a=1/0;(n=Gi.capPixels(n,s))>0&&(r=Math.sqrt(n/(t*e))),-1!==i&&(o=i/t,a=i/e);const l=Math.min(r,o,a);return(this.sx>l||this.sy>l)&&(this.sx=l,this.sy=l,!0)}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const qi=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Zi{#i=null;#s=null;#r;#o=null;#a=null;#l=null;#c=null;static#h=null;constructor(t){this.#r=t,Zi.#h||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#i=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#r._uiManager._signal;t.addEventListener("contextmenu",ji,{signal:e}),t.addEventListener("pointerdown",Zi.#u,{signal:e});const n=this.#o=document.createElement("div");n.className="buttons",t.append(n);const i=this.#r.toolbarPosition;if(i){const{style:e}=t,n="ltr"===this.#r._uiManager.direction?1-i[0]:i[0];e.insetInlineEnd=100*n+"%",e.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#i}static#u(t){t.stopPropagation()}#d(t){this.#r._focusEventsAllowed=!1,Bi(t)}#p(t){this.#r._focusEventsAllowed=!0,Bi(t)}#f(t){const e=this.#r._uiManager._signal;t.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#p.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ji,{signal:e})}hide(){this.#i.classList.add("hidden"),this.#s?.hideDropdown()}show(){this.#i.classList.remove("hidden"),this.#a?.shown(),this.#l?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#r,n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",Zi.#h[t]),this.#f(n),n.addEventListener("click",t=>{e.delete()},{signal:e._signal}),this.#o.append(n)}get#g(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#o.append(e,this.#g),this.#a=t}addComment(t){if(this.#l)return;const e=t.render();e&&(this.#f(e),this.#o.prepend(e,this.#g),this.#l=t,t.toolbar=this)}addColorPicker(t){if(this.#s)return;this.#s=t;const e=t.renderButton();this.#f(e),this.#o.append(e,this.#g)}async addEditSignatureButton(t){const e=this.#c=await t.renderEditButton(this.#r);this.#f(e),this.#o.append(e,this.#g)}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e)}}updateEditSignatureButton(t){this.#c&&(this.#c.title=t)}remove(){this.#i.remove(),this.#s?.destroy(),this.#s=null}}class Ki{#o=null;#i=null;#m;constructor(t){this.#m=t}#v(){const t=this.#i=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",ji,{signal:this.#m._signal});const e=this.#o=document.createElement("div");return e.className="buttons",t.append(e),this.#y(),t}#b(t,e){let n=0,i=0;for(const s of t){const t=s.y+s.height;if(t<n)continue;const r=s.x+(e?s.width:0);t>n?(i=r,n=t):e?r>i&&(i=r):r<i&&(i=r)}return[e?1-i:i,n]}show(t,e,n){const[i,s]=this.#b(e,n),{style:r}=this.#i||=this.#v();t.append(this.#i),r.insetInlineEnd=100*i+"%",r.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#i.remove()}#y(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=this.#m._signal;t.addEventListener("contextmenu",ji,{signal:n}),t.addEventListener("click",()=>{this.#m.highlightSelection("floating_button")},{signal:n}),this.#o.append(t)}}function Xi(t,e,n){for(const i of n)e.addEventListener(i,t[i].bind(t))}class Yi{#_=0;get id(){return`${Dn}${this.#_++}`}}class Ji{#w=(()=>Ei())();#_=0;#x=null;static get _isSVGFittingCanvas(){const t=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),e=new Image;e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';return ui(this,"_isSVGFittingCanvas",e.decode().then(()=>(t.drawImage(e,0,0,1,1,0,0,1,3),0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0])))}async#S(t,e){this.#x||=new Map;let n=this.#x.get(t);if(null===n)return null;if(n?.bitmap)return n.refCounter+=1,n;try{let t;if(n||={bitmap:null,id:`image_${this.#w}_${this.#_++}`,refCounter:0,isSvg:!1},"string"===typeof e?(n.url=e,t=await Ii(e,"blob")):e instanceof File?t=n.file=e:e instanceof Blob&&(t=e),"image/svg+xml"===t.type){const e=Ji._isSVGFittingCanvas,i=new FileReader,s=new Image,r=new Promise((t,r)=>{s.onload=()=>{n.bitmap=s,n.isSvg=!0,t()},i.onload=async()=>{const t=n.svgUrl=i.result;s.src=await e?`${t}#svgView(preserveAspectRatio(none))`:t},s.onerror=i.onerror=r});i.readAsDataURL(t),await r}else n.bitmap=await createImageBitmap(t);n.refCounter=1}catch(i){oi(i),n=null}return this.#x.set(t,n),n&&this.#x.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:i,type:s}=t;return this.#S(`${e}_${n}_${i}_${s}`,t)}async getFromUrl(t){return this.#S(t,t)}async getFromBlob(t,e){const n=await e;return this.#S(t,n)}async getFromId(t){this.#x||=new Map;const e=this.#x.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:t}=e;return delete e.blobPromise,this.getFromBlob(e.id,t)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#x||=new Map;let n=this.#x.get(t);if(n?.bitmap)return n.refCounter+=1,n;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${this.#w}_${this.#_++}`,refCounter:1,isSvg:!1},this.#x.set(t,n),this.#x.set(n.id,n),n}getSvgUrl(t){const e=this.#x.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#x||=new Map;const e=this.#x.get(t);if(!e)return;if(e.refCounter-=1,0!==e.refCounter)return;const{bitmap:n}=e;if(!e.url&&!e.file){const t=new OffscreenCanvas(n.width,n.height);t.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=t.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#w}_`)}}class Qi{#A=[];#k=!1;#E;#C=-1;constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;this.#E=t}add(t){let{cmd:e,undo:n,post:i,mustExec:s,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}=t;if(s&&e(),this.#k)return;const l={cmd:e,undo:n,post:i,type:r};if(-1===this.#C)return this.#A.length>0&&(this.#A.length=0),this.#C=0,void this.#A.push(l);if(o&&this.#A[this.#C].type===r)return a&&(l.undo=this.#A[this.#C].undo),void(this.#A[this.#C]=l);const c=this.#C+1;c===this.#E?this.#A.splice(0,1):(this.#C=c,c<this.#A.length&&this.#A.splice(c)),this.#A.push(l)}undo(){if(-1===this.#C)return;this.#k=!0;const{undo:t,post:e}=this.#A[this.#C];t(),e?.(),this.#k=!1,this.#C-=1}redo(){if(this.#C<this.#A.length-1){this.#C+=1,this.#k=!0;const{cmd:t,post:e}=this.#A[this.#C];t(),e?.(),this.#k=!1}}hasSomethingToUndo(){return-1!==this.#C}hasSomethingToRedo(){return this.#C<this.#A.length-1}cleanType(t){if(-1!==this.#C){for(let e=this.#C;e>=0;e--)if(this.#A[e].type!==t)return this.#A.splice(e+1,this.#C-e),void(this.#C=e);this.#A.length=0,this.#C=-1}}destroy(){this.#A=null}}class ts{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=wi.platform;for(const[n,i,s={}]of t)for(const t of n){const n=t.startsWith("mac+");e&&n?(this.callbacks.set(t.slice(4),{callback:i,options:s}),this.allKeys.add(t.split("+").at(-1))):e||n||(this.callbacks.set(t,{callback:i,options:s}),this.allKeys.add(t.split("+").at(-1)))}}#T(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#T(e));if(!n)return;const{callback:i,options:{bubbles:s=!1,args:r=[],checker:o=null}}=n;o&&!o(t,e)||(i.bind(t,...r,e)(),s||Bi(e))}}class es{static _colorsMapping=(()=>new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]))();get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return function(t){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const n of t.keys()){e.style.color=n;const i=window.getComputedStyle(e).color;t.set(n,Hi(i))}e.remove()}(t),ui(this,"_colors",t)}convert(t){const e=Hi(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,i]of this._colors)if(i.every((t,n)=>t===e[n]))return es._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?Si.makeHexColor(...e):t}}class ns{#P=(()=>new AbortController)();#L=null;#M=(()=>new Map)();#I=(()=>new Map)();#R=null;#D=null;#O=null;#N=(()=>new Qi)();#z=null;#F=null;#j=null;#B=0;#U=(()=>new Set)();#H=null;#$=null;#W=(()=>new Set)();_editorUndoBar=null;#V=!1;#G=!1;#q=!1;#Z=null;#K=null;#X=null;#Y=null;#J=!1;#Q=null;#tt=(()=>new Yi)();#et=!1;#nt=!1;#it=null;#st=null;#rt=null;#ot=null;#at=null;#lt=(()=>On.NONE)();#ct=(()=>new Set)();#ht=null;#ut=null;#dt=null;#pt=null;#ft={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#gt=[0,0];#mt=null;#vt=null;#yt=null;#bt=null;#_t=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ns.prototype,e=t=>t.#vt.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl(),n=(t,e)=>{let{target:n}=e;if(n instanceof HTMLInputElement){const{type:t}=n;return"text"!==t&&"number"!==t}return!0},i=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return ui(this,"_keyboardManager",new ts([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(t,e)=>{let{target:n}=e;return!(n instanceof HTMLButtonElement)&&t.#vt.contains(n)&&!t.isEnterHandled}}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(t,e)=>{let{target:n}=e;return!(n instanceof HTMLButtonElement)&&t.#vt.contains(document.activeElement)}}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}]]))}constructor(t,e,n,i,s,r,o,a,l,c,h,u,d,p,f,g){const m=this._signal=this.#P.signal;this.#vt=t,this.#yt=e,this.#bt=n,this.#R=i,this.#z=s,this.#ut=r,this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:m}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),o._on("setpreference",this.onSetPreference.bind(this),{signal:m}),o._on("switchannotationeditorparams",t=>this.updateParams(t.type,t.value),{signal:m}),this.#wt(),this.#xt(),this.#St(),this.#D=a.annotationStorage,this.#Z=a.filterFactory,this.#dt=l,this.#Y=c||null,this.#V=h,this.#G=u,this.#q=d,this.#at=p||null,this.viewParameters={realScale:Mi.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=!1!==g}destroy(){this.#_t?.resolve(),this.#_t=null,this.#P?.abort(),this.#P=null,this._signal=null;for(const t of this.#I.values())t.destroy();this.#I.clear(),this.#M.clear(),this.#W.clear(),this.#ot?.clear(),this.#L=null,this.#ct.clear(),this.#N.destroy(),this.#R?.destroy(),this.#z?.destroy(),this.#ut?.destroy(),this.#Q?.hide(),this.#Q=null,this.#rt?.destroy(),this.#rt=null,this.#K&&(clearTimeout(this.#K),this.#K=null),this.#mt&&(clearTimeout(this.#mt),this.#mt=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#at}get useNewAltTextFlow(){return this.#G}get useNewAltTextWhenAddingImage(){return this.#q}get hcmFilter(){return ui(this,"hcmFilter",this.#dt?this.#Z.addHCMFilter(this.#dt.foreground,this.#dt.background):"none")}get direction(){return ui(this,"direction",getComputedStyle(this.#vt).direction)}get _highlightColors(){return ui(this,"_highlightColors",this.#Y?new Map(this.#Y.split(",").map(t=>((t=t.split("=").map(t=>t.trim()))[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return ui(this,"highlightColors",null);const e=new Map,n=!!this.#dt;for(const[i,s]of t){const t=i.endsWith("_HCM");n&&t?e.set(i.replace("_HCM",""),s):n||t||e.set(i,s)}return ui(this,"highlightColors",e)}get highlightColorNames(){return ui(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#j=t}setMainHighlightColorPicker(t){this.#rt=t}editAltText(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.#R?.editAltText(this,t,e)}hasCommentManager(){return!!this.#z}editComment(t,e){this.#z?.open(this,t,e)}getSignature(t){this.#ut?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#ut}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference(t){let{name:e,value:n}=t;if("enableNewAltTextWhenAddingImage"===e)this.#q=n}onPageChanging(t){let{pageNumber:e}=t;this.#B=e-1}focusMainContainer(){this.#vt.focus()}findParent(t,e){for(const n of this.#I.values()){const{x:i,y:s,width:r,height:o}=n.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=s&&e<=s+o)return n}return null}disableUserSelect(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#yt.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#W.add(t)}removeShouldRescale(t){this.#W.delete(t)}onScaleChanging(t){let{scale:e}=t;this.commitOrRemove(),this.viewParameters.realScale=e*Mi.PDF_TO_CSS_UNITS;for(const n of this.#W)n.onScaleChanging();this.#j?.onScaleChanging()}onRotationChanging(t){let{pagesRotation:e}=t;this.commitOrRemove(),this.viewParameters.rotation=e}#At(t){let{anchorNode:e}=t;return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#kt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of this.#I.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:n,anchorOffset:i,focusNode:s,focusOffset:r}=e,o=e.toString(),a=this.#At(e).closest(".textLayer"),l=this.getSelectionBoxes(a);if(!l)return;e.empty();const c=this.#kt(a),h=this.#lt===On.NONE,u=()=>{c?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:l,anchorNode:n,anchorOffset:i,focusNode:s,focusOffset:r,text:o}),h&&this.showAllEditors("highlight",!0,!0)};h?this.switchToMode(On.HIGHLIGHT,u):u()}#Et(){const t=document.getSelection();if(!t||t.isCollapsed)return;const e=this.#At(t).closest(".textLayer"),n=this.getSelectionBoxes(e);n&&(this.#Q||=new Ki(this),this.#Q.show(e,n,"ltr"===this.direction))}addToAnnotationStorage(t){t.isEmpty()||!this.#D||this.#D.has(t.id)||this.#D.setValue(t.id,t)}a11yAlert(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#bt;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#Ct(){const t=document.getSelection();if(!t||t.isCollapsed)return void(this.#ht&&(this.#Q?.hide(),this.#ht=null,this.#Tt({hasSelectedText:!1})));const{anchorNode:e}=t;if(e===this.#ht)return;const n=this.#At(t).closest(".textLayer");if(n){if(this.#Q?.hide(),this.#ht=e,this.#Tt({hasSelectedText:!0}),(this.#lt===On.HIGHLIGHT||this.#lt===On.NONE)&&(this.#lt===On.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#J=this.isShiftKeyDown,!this.isShiftKeyDown)){const t=this.#lt===On.HIGHLIGHT?this.#kt(n):null;t?.toggleDrawing();const e=new AbortController,i=this.combinedSignal(e),s=n=>{"pointerup"===n.type&&0!==n.button||(e.abort(),t?.toggleDrawing(!0),"pointerup"===n.type&&this.#Pt("main_toolbar"))};window.addEventListener("pointerup",s,{signal:i}),window.addEventListener("blur",s,{signal:i})}}else this.#ht&&(this.#Q?.hide(),this.#ht=null,this.#Tt({hasSelectedText:!1}))}#Pt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.#lt===On.HIGHLIGHT?this.highlightSelection(t):this.#V&&this.#Et()}#wt(){document.addEventListener("selectionchange",this.#Ct.bind(this),{signal:this._signal})}#Lt(){if(this.#X)return;this.#X=new AbortController;const t=this.combinedSignal(this.#X);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#Mt(){this.#X?.abort(),this.#X=null}blur(){if(this.isShiftKeyDown=!1,this.#J&&(this.#J=!1,this.#Pt("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#ct)if(e.div.contains(t)){this.#st=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#st)return;const[t,e]=this.#st;this.#st=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#St(){if(this.#it)return;this.#it=new AbortController;const t=this.combinedSignal(this.#it);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#It(){this.#it?.abort(),this.#it=null}#Rt(){if(this.#F)return;this.#F=new AbortController;const t=this.combinedSignal(this.#F);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#Dt(){this.#F?.abort(),this.#F=null}#xt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#St(),this.#Rt()}removeEditListeners(){this.#It(),this.#Dt()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#$)if(n.isHandlingMimeForPasting(e))return t.dataTransfer.dropEffect="copy",void t.preventDefault()}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#$)if(n.isHandlingMimeForPasting(e.type))return n.paste(e,this.currentLayer),void t.preventDefault()}copy(t){if(t.preventDefault(),this.#L?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of this.#ct){const t=n.serialize(!0);t&&e.push(t)}0!==e.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const r of e.items)for(const t of this.#$)if(t.isHandlingMimeForPasting(r.type))return void t.paste(r,this.currentLayer);let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(s){return void oi(`paste: "${s.message}".`)}if(!Array.isArray(n))return;this.unselectAll();const i=this.currentLayer;try{const t=[];for(const r of n){const e=await i.deserialize(r);if(!e)return;t.push(e)}const e=()=>{for(const e of t)this.#Ot(e);this.#Nt(t)},s=()=>{for(const e of t)e.remove()};this.addCommands({cmd:e,undo:s,mustExec:!0})}catch(s){oi(`paste: "${s.message}".`)}}keydown(t){this.isShiftKeyDown||"Shift"!==t.key||(this.isShiftKeyDown=!0),this.#lt===On.NONE||this.isEditorHandlingKeyboard||ns._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!1,this.#J&&(this.#J=!1,this.#Pt("main_toolbar")))}onEditingAction(t){let{name:e}=t;switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu")}}#Tt(t){Object.entries(t).some(t=>{let[e,n]=t;return this.#ft[e]!==n})&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#ft,t)}),this.#lt===On.HIGHLIGHT&&!1===t.hasSelectedEditor&&this.#zt([[Nn.HIGHLIGHT_FREE,!0]]))}#zt(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#Lt(),this.#Rt(),this.#Tt({isEditing:this.#lt!==On.NONE,isEmpty:this.#Ft(),hasSomethingToUndo:this.#N.hasSomethingToUndo(),hasSomethingToRedo:this.#N.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#Mt(),this.#Dt(),this.#Tt({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#$){this.#$=t;for(const t of this.#$)this.#zt(t.defaultPropertiesToUpdate)}}getId(){return this.#tt.id}get currentLayer(){return this.#I.get(this.#B)}getLayer(t){return this.#I.get(t)}get currentPageIndex(){return this.#B}addLayer(t){this.#I.set(t.pageIndex,t),this.#et?t.enable():t.disable()}removeLayer(t){this.#I.delete(t.pageIndex)}async updateMode(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.#lt!==t&&(!this.#_t||(await this.#_t.promise,this.#_t))){if(this.#_t=Promise.withResolvers(),this.#j?.commitOrRemove(),this.#lt=t,t===On.NONE)return this.setEditingState(!1),this.#jt(),this._editorUndoBar?.hide(),void this.#_t.resolve();t===On.SIGNATURE&&await(this.#ut?.loadSignatures()),this.setEditingState(!0),await this.#Bt(),this.unselectAll();for(const e of this.#I.values())e.updateMode(t);if(!e)return n&&this.addNewEditorFromKeyboard(),void this.#_t.resolve();for(const t of this.#M.values())t.annotationElementId===e||t.id===e?(this.setSelected(t),s?t.editComment():i&&t.enterInEditMode()):t.unselect();this.#_t.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#lt&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#$){switch(t){case Nn.CREATE:return void this.currentLayer.addNewEditor(e);case Nn.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#pt||=new Map).set(t,e),this.showAllEditors("highlight",e)}if(this.hasSelection)for(const n of this.#ct)n.updateParams(t,e);else for(const n of this.#$)n.updateDefaultParams(t,e)}}showAllEditors(t,e){for(const n of this.#M.values())n.editorType===t&&n.show(e);(this.#pt?.get(Nn.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#zt([[Nn.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.#nt!==t){this.#nt=t;for(const e of this.#I.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#Bt(){if(!this.#et){this.#et=!0;const t=[];for(const e of this.#I.values())t.push(e.enable());await Promise.all(t);for(const e of this.#M.values())e.enable()}}#jt(){if(this.unselectAll(),this.#et){this.#et=!1;for(const t of this.#I.values())t.disable();for(const t of this.#M.values())t.disable()}}getEditors(t){const e=[];for(const n of this.#M.values())n.pageIndex===t&&e.push(n);return e}getEditor(t){return this.#M.get(t)}addEditor(t){this.#M.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#K&&clearTimeout(this.#K),this.#K=setTimeout(()=>{this.focusMainContainer(),this.#K=null},0)),this.#M.delete(t.id),t.annotationElementId&&this.#ot?.delete(t.annotationElementId),this.unselect(t),t.annotationElementId&&this.#U.has(t.annotationElementId)||this.#D?.remove(t.id)}addDeletedAnnotationElement(t){this.#U.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#U.has(t)}removeDeletedAnnotationElement(t){this.#U.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#Ot(t){const e=this.#I.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#L!==t&&(this.#L=t,t&&this.#zt(t.propertiesToUpdate))}get#Ut(){let t=null;for(t of this.#ct);return t}updateUI(t){this.#Ut===t&&this.#zt(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#zt(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#ct.has(t))return this.#ct.delete(t),t.unselect(),void this.#Tt({hasSelectedEditor:this.hasSelection});this.#ct.add(t),t.select(),this.#zt(t.propertiesToUpdate),this.#Tt({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#j?.commitOrRemove();for(const e of this.#ct)e!==t&&e.unselect();this.#ct.clear(),this.#ct.add(t),t.select(),this.#zt(t.propertiesToUpdate),this.#Tt({hasSelectedEditor:!0})}isSelected(t){return this.#ct.has(t)}get firstSelectedEditor(){return this.#ct.values().next().value}unselect(t){t.unselect(),this.#ct.delete(t),this.#Tt({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#ct.size}get isEnterHandled(){return 1===this.#ct.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#N.undo(),this.#Tt({hasSomethingToUndo:this.#N.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Ft()}),this._editorUndoBar?.hide()}redo(){this.#N.redo(),this.#Tt({hasSomethingToUndo:!0,hasSomethingToRedo:this.#N.hasSomethingToRedo(),isEmpty:this.#Ft()})}addCommands(t){this.#N.add(t),this.#Tt({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Ft()})}cleanUndoStack(t){this.#N.cleanType(t)}#Ft(){if(0===this.#M.size)return!0;if(1===this.#M.size)for(const t of this.#M.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#ct],n=()=>{for(const t of e)this.#Ot(t)};this.addCommands({cmd:()=>{this._editorUndoBar?.show(n,1===e.length?e[0].editorType:e.length);for(const t of e)t.remove()},undo:n,mustExec:!0})}commitOrRemove(){this.#L?.commitOrRemove()}hasSomethingToControl(){return this.#L||this.hasSelection}#Nt(t){for(const e of this.#ct)e.unselect();this.#ct.clear();for(const e of t)e.isEmpty()||(this.#ct.add(e),e.select());this.#Tt({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#ct)t.commit();this.#Nt(this.#M.values())}unselectAll(){if((!this.#L||(this.#L.commitOrRemove(),this.#lt===On.NONE))&&!this.#j?.commitOrRemove()&&this.hasSelection){for(const t of this.#ct)t.unselect();this.#ct.clear(),this.#Tt({hasSelectedEditor:!1})}}translateSelectedEditors(t,e){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||this.commitOrRemove(),!this.hasSelection)return;this.#gt[0]+=t,this.#gt[1]+=e;const[n,i]=this.#gt,s=[...this.#ct];this.#mt&&clearTimeout(this.#mt),this.#mt=setTimeout(()=>{this.#mt=null,this.#gt[0]=this.#gt[1]=0,this.addCommands({cmd:()=>{for(const t of s)this.#M.has(t.id)&&(t.translateInPage(n,i),t.translationDone())},undo:()=>{for(const t of s)this.#M.has(t.id)&&(t.translateInPage(-n,-i),t.translationDone())},mustExec:!1})},1e3);for(const r of s)r.translateInPage(t,e),r.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#H=new Map;for(const t of this.#ct)this.#H.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#H)return!1;this.disableUserSelect(!1);const t=this.#H;this.#H=null;let e=!1;for(const[{x:i,y:s,pageIndex:r},o]of t)o.newX=i,o.newY=s,o.newPageIndex=r,e||=i!==o.savedX||s!==o.savedY||r!==o.savedPageIndex;if(!e)return!1;const n=(t,e,n,i)=>{if(this.#M.has(t.id)){const s=this.#I.get(i);s?t._setParentAndPosition(s,e,n):(t.pageIndex=i,t.x=e,t.y=n)}};return this.addCommands({cmd:()=>{for(const[e,{newX:i,newY:s,newPageIndex:r}]of t)n(e,i,s,r)},undo:()=>{for(const[e,{savedX:i,savedY:s,savedPageIndex:r}]of t)n(e,i,s,r)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#H)for(const n of this.#H.keys())n.drag(t,e)}rebuild(t){if(null===t.parent){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#ct.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#L===t}getActive(){return this.#L}getMode(){return this.#lt}get imageManager(){return ui(this,"imageManager",new Ji)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let l=0,c=e.rangeCount;l<c;l++)if(!t.contains(e.getRangeAt(l).commonAncestorContainer))return null;const{x:n,y:i,width:s,height:r}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(t,e,o,a)=>({x:(e-i)/r,y:1-(t+o-n)/s,width:a/r,height:o/s});break;case"180":o=(t,e,o,a)=>({x:1-(t+o-n)/s,y:1-(e+a-i)/r,width:o/s,height:a/r});break;case"270":o=(t,e,o,a)=>({x:1-(e+a-i)/r,y:(t-n)/s,width:a/r,height:o/s});break;default:o=(t,e,o,a)=>({x:(t-n)/s,y:(e-i)/r,width:o/s,height:a/r})}const a=[];for(let l=0,c=e.rangeCount;l<c;l++){const t=e.getRangeAt(l);if(!t.collapsed)for(const{x:e,y:n,width:i,height:s}of t.getClientRects())0!==i&&0!==s&&a.push(o(e,n,i,s))}return 0===a.length?null:a}addChangedExistingAnnotation(t){let{annotationElementId:e,id:n}=t;(this.#O||=new Map).set(e,n)}removeChangedExistingAnnotation(t){let{annotationElementId:e}=t;this.#O?.delete(e)}renderAnnotationElement(t){const e=this.#O?.get(t.data.id);if(!e)return;const n=this.#D.getRawValue(e);n&&(this.#lt!==On.NONE||n.hasBeenModified)&&n.renderAnnotationElement(t)}setMissingCanvas(t,e,n){const i=this.#ot?.get(t);i&&(i.setCanvas(e,n),this.#ot.delete(t))}addMissingCanvas(t,e){(this.#ot||=new Map).set(t,e)}}class is{#a=null;#Ht=!1;#$t=null;#Wt=null;#Vt=null;#Gt=null;#qt=!1;#Zt=null;#r=null;#Kt=null;#Xt=null;#Yt=!1;static#Jt=null;static _l10n=null;constructor(t){this.#r=t,this.#Yt=t._uiManager.useNewAltTextFlow,is.#Jt||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){is._l10n??=t}async render(){const t=this.#$t=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#Wt=document.createElement("span");t.append(e),this.#Yt?(t.classList.add("new"),t.setAttribute("data-l10n-id",is.#Jt.missing),e.setAttribute("data-l10n-id",is.#Jt["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#r._uiManager._signal;t.addEventListener("contextmenu",ji,{signal:n}),t.addEventListener("pointerdown",t=>t.stopPropagation(),{signal:n});const i=t=>{t.preventDefault(),this.#r._uiManager.editAltText(this.#r),this.#Yt&&this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#Qt}})};return t.addEventListener("click",i,{capture:!0,signal:n}),t.addEventListener("keydown",e=>{e.target===t&&"Enter"===e.key&&(this.#qt=!0,i(e))},{signal:n}),await this.#te(),t}get#Qt(){return(this.#a?"added":null===this.#a&&this.guessedText&&"review")||"missing"}finish(){this.#$t&&(this.#$t.focus({focusVisible:this.#qt}),this.#qt=!1)}isEmpty(){return this.#Yt?null===this.#a:!this.#a&&!this.#Ht}hasData(){return this.#Yt?null!==this.#a||!!this.#Kt:this.isEmpty()}get guessedText(){return this.#Kt}async setGuessedText(t){null===this.#a&&(this.#Kt=t,this.#Xt=await is._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#te())}toggleAltTextBadge(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.#Yt||this.#a)return this.#Zt?.remove(),void(this.#Zt=null);if(!this.#Zt){const t=this.#Zt=document.createElement("div");t.className="noAltTextBadge",this.#r.div.append(t)}this.#Zt.classList.toggle("hidden",!t)}serialize(t){let e=this.#a;return t||this.#Kt!==e||(e=this.#Xt),{altText:e,decorative:this.#Ht,guessedText:this.#Kt,textWithDisclaimer:this.#Xt}}get data(){return{altText:this.#a,decorative:this.#Ht}}set data(t){let{altText:e,decorative:n,guessedText:i,textWithDisclaimer:s,cancel:r=!1}=t;i&&(this.#Kt=i,this.#Xt=s),this.#a===e&&this.#Ht===n||(r||(this.#a=e,this.#Ht=n),this.#te())}toggle(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#$t&&(!t&&this.#Gt&&(clearTimeout(this.#Gt),this.#Gt=null),this.#$t.disabled=!t)}shown(){this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#Qt}})}destroy(){this.#$t?.remove(),this.#$t=null,this.#Wt=null,this.#Vt=null,this.#Zt?.remove(),this.#Zt=null}async#te(){const t=this.#$t;if(!t)return;if(this.#Yt){if(t.classList.toggle("done",!!this.#a),t.setAttribute("data-l10n-id",is.#Jt[this.#Qt]),this.#Wt?.setAttribute("data-l10n-id",is.#Jt[`${this.#Qt}-label`]),!this.#a)return void this.#Vt?.remove()}else{if(!this.#a&&!this.#Ht)return t.classList.remove("done"),void this.#Vt?.remove();t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#Vt;if(!e){this.#Vt=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#r.id}`;const n=100,i=this.#r._uiManager._signal;i.addEventListener("abort",()=>{clearTimeout(this.#Gt),this.#Gt=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#Gt=setTimeout(()=>{this.#Gt=null,this.#Vt.classList.add("show"),this.#r._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:i}),t.addEventListener("mouseleave",()=>{this.#Gt&&(clearTimeout(this.#Gt),this.#Gt=null),this.#Vt?.classList.remove("show")},{signal:i})}this.#Ht?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#a),e.parentNode||t.append(e);const n=this.#r.getElementForAltText();n?.setAttribute("aria-describedby",e.id)}}class ss{#ee=null;#ne=!1;#r=null;#ie=null;#se=null;#re=null;#oe=!1;constructor(t){this.#r=t,this.toolbar=null}render(){if(!this.#r._uiManager.hasCommentManager())return null;const t=this.#ee=document.createElement("button");t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=this.#r._uiManager._signal;t.addEventListener("contextmenu",ji,{signal:e}),t.addEventListener("pointerdown",t=>t.stopPropagation(),{signal:e});const n=t=>{t.preventDefault(),this.edit()};return t.addEventListener("click",n,{capture:!0,signal:e}),t.addEventListener("keydown",e=>{e.target===t&&"Enter"===e.key&&(this.#ne=!0,n(e))},{signal:e}),t}edit(){const{bottom:t,left:e,right:n}=this.#r.getClientDimensions(),i={top:t};"ltr"===this.#r._uiManager.direction?i.right=n:i.left=e,this.#r._uiManager.editComment(this.#r,i)}finish(){this.#ee&&(this.#ee.focus({focusVisible:this.#ne}),this.#ne=!1)}isDeleted(){return this.#oe||""===this.#se}hasBeenEdited(){return this.isDeleted()||this.#se!==this.#ie}serialize(){return this.data}get data(){return{text:this.#se,date:this.#re,deleted:this.#oe}}set data(t){if(null===t)return this.#se="",void(this.#oe=!0);this.#se=t,this.#re=new Date,this.#oe=!1}setInitialText(t){this.#ie=t,this.data=t}toggle(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#ee&&(this.#ee.disabled=!t)}shown(){}destroy(){this.#ee?.remove(),this.#ee=null,this.#se="",this.#re=null,this.#r=null,this.#ne=!1,this.#oe=!1}}class rs{#vt;#ae=!1;#le=null;#ce;#he;#ue;#de;#pe=null;#fe;#ge=null;#me;#ve=null;constructor(t){let{container:e,isPinchingDisabled:n=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:o=null,signal:a}=t;this.#vt=e,this.#le=i,this.#ce=n,this.#he=s,this.#ue=r,this.#de=o,this.#me=new AbortController,this.#fe=AbortSignal.any([a,this.#me.signal]),e.addEventListener("touchstart",this.#ye.bind(this),{passive:!1,signal:this.#fe})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Gi.pixelRatio}#ye(t){if(this.#ce?.())return;if(1===t.touches.length){if(this.#pe)return;const t=this.#pe=new AbortController,e=AbortSignal.any([this.#fe,t.signal]),n=this.#vt,i={capture:!0,signal:e,passive:!1},s=t=>{"touch"===t.pointerType&&(this.#pe?.abort(),this.#pe=null)};return n.addEventListener("pointerdown",t=>{"touch"===t.pointerType&&(Bi(t),s(t))},i),n.addEventListener("pointerup",s,i),void n.addEventListener("pointercancel",s,i)}if(!this.#ve){this.#ve=new AbortController;const t=AbortSignal.any([this.#fe,this.#ve.signal]),e=this.#vt,n={signal:t,capture:!1,passive:!1};e.addEventListener("touchmove",this.#be.bind(this),n);const i=this.#_e.bind(this);e.addEventListener("touchend",i,n),e.addEventListener("touchcancel",i,n),n.capture=!0,e.addEventListener("pointerdown",Bi,n),e.addEventListener("pointermove",Bi,n),e.addEventListener("pointercancel",Bi,n),e.addEventListener("pointerup",Bi,n),this.#he?.()}if(Bi(t),2!==t.touches.length||this.#le?.())return void(this.#ge=null);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#ge={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#be(t){if(!this.#ge||2!==t.touches.length)return;Bi(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:i,screenY:s}=e,{screenX:r,screenY:o}=n,a=this.#ge,{touch0X:l,touch0Y:c,touch1X:h,touch1Y:u}=a,d=h-l,p=u-c,f=r-i,g=o-s,m=Math.hypot(f,g)||1,v=Math.hypot(d,p)||1;if(!this.#ae&&Math.abs(v-m)<=rs.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(a.touch0X=i,a.touch0Y=s,a.touch1X=r,a.touch1Y=o,!this.#ae)return void(this.#ae=!0);const y=[(i+r)/2,(s+o)/2];this.#ue?.(y,v,m)}#_e(t){t.touches.length>=2||(this.#ve&&(this.#ve.abort(),this.#ve=null,this.#de?.()),this.#ge&&(Bi(t),this.#ge=null,this.#ae=!1))}destroy(){this.#me?.abort(),this.#me=null,this.#pe?.abort(),this.#pe=null}}class os{#we=null;#xe=null;#a=null;#l=null;#Se=!1;#Ae=null;#ke="";#Ee=!1;#Ce=null;#Te=null;#Pe=null;#Le=null;#Me="";#Ie=!1;#Re=null;#De=!1;#Oe=!1;#Ne=!1;#ze=null;#Fe=0;#je=0;#Be=null;#Ue=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=(()=>Object.create(null))();_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#He=!1;#$e=(()=>os._zIndex++)();static _borderLineWidth=-1;static _colorManager=(()=>new es)();static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=os.prototype._resizeWithKeyboard,e=ns.TRANSLATE_SMALL,n=ns.TRANSLATE_BIG;return ui(this,"_resizerKeyboardManager",new ts([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],os.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:n,pageHeight:i,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[s,r];const[o,a]=this.parentDimensions;this.x=t.x/o,this.y=t.y/a,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ui(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new as({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(os._l10n??=t,os._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==os._borderLineWidth)return;const n=getComputedStyle(document.documentElement);os._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){ai("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#He}set _isDraggable(t){this.#He=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(2*t),this.y+=this.width*t/(2*e);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(2*t),this.y-=this.width*t/(2*e);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#$e}setParent(t){null!==t?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#We(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#Ie?this.#Ie=!1:this.parent.setSelected(this))}focusout(t){if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const e=t.relatedTarget;e?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,i){const[s,r]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(t+n)/s,this.y=(e+i)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,i]=this.parentDimensions;this.setAt(t*n,e*i,this.width*n,this.height*i),this._onTranslated()}#Ve(t,e,n){let[i,s]=t;[e,n]=this.screenToPageTranslation(e,n),this.x+=e/i,this.y+=n/s,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#Ve(this.parentDimensions,t,e)}translateInPage(t,e){this.#Re||=[this.x,this.y,this.width,this.height],this.#Ve(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#Re||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[i,s]}=this;if(this.x+=t/i,this.y+=e/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:t,y:e}=this.div.getBoundingClientRect();this.parent.findNewParent(this,t,e)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[a,l]=this.getBaseTranslation();r+=a,o+=l;const{style:c}=n;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#Re&&(this.#Re[0]!==this.x||this.#Re[1]!==this.y)}get _hasBeenResized(){return!!this.#Re&&(this.#Re[2]!==this.width||this.#Re[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=os,i=n/t,s=n/e;switch(this.rotation){case 90:return[-i,s];case 180:return[i,s];case 270:return[i,-s];default:return[-i,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation;const{div:{style:e},pageDimensions:[n,i]}=this;let{x:s,y:r,width:o,height:a}=this;if(o*=n,a*=i,s*=n,r*=i,this._mustFixPosition)switch(t){case 0:s=Ti(s,0,n-o),r=Ti(r,0,i-a);break;case 90:s=Ti(s,0,n-a),r=Ti(r,o,i);break;case 180:s=Ti(s,o,n),r=Ti(r,a,i);break;case 270:s=Ti(s,a,n),r=Ti(r,0,i-o)}this.x=s/=n,this.y=r/=i;const[l,c]=this.getBaseTranslation();s+=l,r+=c,e.left=`${(100*s).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#Ge(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return os.#Ge(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return os.#Ge(t,e,360-this.parentRotation)}#qe(t){switch(t){case 90:{const[t,e]=this.pageDimensions;return[0,-t/e,e/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,e]=this.pageDimensions;return[0,t/e,-e/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(t,e){const[n,i]=this.parentDimensions,{style:s}=this.div;s.width=`${(100*t/n).toFixed(2)}%`,this.#Ee||(s.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:n}=t,i=n.endsWith("%"),s=!this.#Ee&&e.endsWith("%");if(i&&s)return;const[r,o]=this.parentDimensions;i||(t.width=`${(100*parseFloat(n)/r).toFixed(2)}%`),this.#Ee||s||(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#Ze(){if(this.#Ce)return;this.#Ce=document.createElement("div"),this.#Ce.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const t=document.createElement("div");this.#Ce.append(t),t.classList.add("resizer",n),t.setAttribute("data-resizer-name",n),t.addEventListener("pointerdown",this.#Ke.bind(this,n),{signal:e}),t.addEventListener("contextmenu",ji,{signal:e}),t.tabIndex=-1}this.div.prepend(this.#Ce)}#Ke(t,e){e.preventDefault();const{isMac:n}=wi.platform;if(0!==e.button||e.ctrlKey&&n)return;this.#a?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#Te=[e.screenX,e.screenY];const s=new AbortController,r=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#Xe.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Bi,{passive:!1,signal:r}),window.addEventListener("contextmenu",ji,{signal:r}),this.#Pe={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const o=this.parent.div.style.cursor,a=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const l=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#a?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=a,this.#Ye()};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})}#Je(t,e,n,i){this.width=n,this.height=i,this.x=t,this.y=e;const[s,r]=this.parentDimensions;this.setDims(s*n,r*i),this.fixAndSetPosition(),this._onResized()}_onResized(){}#Ye(){if(!this.#Pe)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:i}=this.#Pe;this.#Pe=null;const s=this.x,r=this.y,o=this.width,a=this.height;s===t&&r===e&&o===n&&a===i||this.addCommands({cmd:this.#Je.bind(this,s,r,o,a),undo:this.#Je.bind(this,t,e,n,i),mustExec:!0})}static _round(t){return Math.round(1e4*t)/1e4}#Xe(t,e){const[n,i]=this.parentDimensions,s=this.x,r=this.y,o=this.width,a=this.height,l=os.MIN_SIZE/n,c=os.MIN_SIZE/i,h=this.#qe(this.rotation),u=(t,e)=>[h[0]*t+h[2]*e,h[1]*t+h[3]*e],d=this.#qe(360-this.rotation);let p,f,g=!1,m=!1;switch(t){case"topLeft":g=!0,p=(t,e)=>[0,0],f=(t,e)=>[t,e];break;case"topMiddle":p=(t,e)=>[t/2,0],f=(t,e)=>[t/2,e];break;case"topRight":g=!0,p=(t,e)=>[t,0],f=(t,e)=>[0,e];break;case"middleRight":m=!0,p=(t,e)=>[t,e/2],f=(t,e)=>[0,e/2];break;case"bottomRight":g=!0,p=(t,e)=>[t,e],f=(t,e)=>[0,0];break;case"bottomMiddle":p=(t,e)=>[t/2,e],f=(t,e)=>[t/2,0];break;case"bottomLeft":g=!0,p=(t,e)=>[0,e],f=(t,e)=>[t,0];break;case"middleLeft":m=!0,p=(t,e)=>[0,e/2],f=(t,e)=>[t,e/2]}const v=p(o,a),y=f(o,a);let b=u(...y);const _=os._round(s+b[0]),w=os._round(r+b[1]);let x,S,A=1,k=1;if(e.fromKeyboard)({deltaX:x,deltaY:S}=e);else{const{screenX:t,screenY:n}=e,[i,s]=this.#Te;[x,S]=this.screenToPageTranslation(t-i,n-s),this.#Te[0]=t,this.#Te[1]=n}var E,C;if([x,S]=(E=x/n,C=S/i,[d[0]*E+d[2]*C,d[1]*E+d[3]*C]),g){const t=Math.hypot(o,a);A=k=Math.max(Math.min(Math.hypot(y[0]-v[0]-x,y[1]-v[1]-S)/t,1/o,1/a),l/o,c/a)}else m?A=Ti(Math.abs(y[0]-v[0]-x),l,1)/o:k=Ti(Math.abs(y[1]-v[1]-S),c,1)/a;const T=os._round(o*A),P=os._round(a*k);b=u(...f(T,P));const L=_-b[0],M=w-b[1];this.#Re||=[this.x,this.y,this.width,this.height],this.width=T,this.height=P,this.x=L,this.y=M,this.setDims(n*T,i*P),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#a?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#Oe)return this._editToolbar;this._editToolbar=new Zi(this),this.div.append(this._editToolbar.render()),this._editToolbar.addButton("comment",this.addCommentButton());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#a?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#a||(is.initialize(os._l10n),this.#a=new is(this),this.#we&&(this.#a.data=this.#we,this.#we=null)),this.#a}get altTextData(){return this.#a?.data}set altTextData(t){this.#a&&(this.#a.data=t)}get guessedAltText(){return this.#a?.guessedText}async setGuessedAltText(t){await(this.#a?.setGuessedText(t))}serializeAltText(t){return this.#a?.serialize(t)}hasAltText(){return!!this.#a&&!this.#a.isEmpty()}hasAltTextData(){return this.#a?.hasData()??!1}addCommentButton(){return this.#l?this.#l:this.#l=new ss(this)}get commentColor(){return null}get comment(){const t=this.#l;return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){this.#l||(this.#l=new ss(this)),this.#l.data=t}setCommentData(t){this.#l||(this.#l=new ss(this)),this.#l.setInitialText(t)}get hasEditedComment(){return this.#l?.hasBeenEdited()}async editComment(){this.#l||(this.#l=new ss(this)),this.#l.edit()}addComment(t){this.hasEditedComment&&(t.popup={contents:this.comment.text,deleted:this.comment.deleted})}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#Se?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#Qe();const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),Xi(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#Ue||=new rs({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#tn.bind(this),onPinching:this.#en.bind(this),onPinchEnd:this.#nn.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),t}#tn(){this.#Pe={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#a?.toggle(!1),this.parent.togglePointerEvents(!1)}#en(t,e,n){let i=n/e*.7+1-.7;if(1===i)return;const s=this.#qe(this.rotation),r=(t,e)=>[s[0]*t+s[2]*e,s[1]*t+s[3]*e],[o,a]=this.parentDimensions,l=this.x,c=this.y,h=this.width,u=this.height,d=os.MIN_SIZE/o,p=os.MIN_SIZE/a;i=Math.max(Math.min(i,1/h,1/u),d/h,p/u);const f=os._round(h*i),g=os._round(u*i);if(f===h&&g===u)return;this.#Re||=[l,c,h,u];const m=r(h/2,u/2),v=os._round(l+m[0]),y=os._round(c+m[1]),b=r(f/2,g/2);this.x=v-b[0],this.y=y-b[1],this.width=f,this.height=g,this.setDims(o*f,a*g),this.fixAndSetPosition(),this._onResizing()}#nn(){this.#a?.toggle(!0),this.parent.togglePointerEvents(!0),this.#Ye()}pointerdown(t){const{isMac:e}=wi.platform;0!==t.button||t.ctrlKey&&e?t.preventDefault():(this.#Ie=!0,this._isDraggable?this.#in(t):this.#sn(t))}#sn(t){const{isMac:e}=wi.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#in(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const i=new AbortController,s=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:s},o=t=>{i.abort(),this.#Ae=null,this.#Ie=!1,this._uiManager.endDragSession()||this.#sn(t),n&&this._onStopDragging()};e&&(this.#Fe=t.clientX,this.#je=t.clientY,this.#Ae=t.pointerId,this.#ke=t.pointerType,window.addEventListener("pointermove",t=>{n||(n=!0,this._onStartDragging());const{clientX:e,clientY:i,pointerId:s}=t;if(s!==this.#Ae)return void Bi(t);const[r,o]=this.screenToPageTranslation(e-this.#Fe,i-this.#je);this.#Fe=e,this.#je=i,this._uiManager.dragSelectedEditors(r,o)},r),window.addEventListener("touchmove",Bi,r),window.addEventListener("pointerdown",t=>{t.pointerType===this.#ke&&(this.#Ue||t.isPrimary)&&o(t),Bi(t)},r));const a=t=>{this.#Ae&&this.#Ae!==t.pointerId?Bi(t):o(t)};window.addEventListener("pointerup",a,{signal:s}),window.addEventListener("blur",a,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#ze&&clearTimeout(this.#ze),this.#ze=setTimeout(()=>{this.#ze=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation;const i=this.parentScale,[s,r]=this.pageDimensions,[o,a]=this.pageTranslation,l=t/i,c=e/i,h=this.x*s,u=this.y*r,d=this.width*s,p=this.height*r;switch(n){case 0:return[h+l+o,r-u-c-p+a,h+l+d+o,r-u-c+a];case 90:return[h+c+o,r-u+l+a,h+c+p+o,r-u+l+d+a];case 180:return[h-l-d+o,r-u+c+a,h-l+o,r-u+c+p+a];case 270:return[h-c-p+o,r-u-l-d+a,h-c+o,r-u-l+a];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,i,s,r]=t,o=s-n,a=r-i;switch(this.rotation){case 0:return[n,e-r,o,a];case 90:return[n,e-i,a,o];case 180:return[s,e-i,o,a];case 270:return[s,e-r,a,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return!this.isInEditMode()&&(this.parent.setEditingState(!1),this.#Oe=!0,!0)}disableEditMode(){return!!this.isInEditMode()&&(this.parent.setEditingState(!0),this.#Oe=!1,!0)}isInEditMode(){return this.#Oe}shouldGetKeyboardEvents(){return this.#Ne}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:s,innerWidth:r}=window;return e<r&&i>0&&t<s&&n>0}#Qe(){if(this.#Le||!this.div)return;this.#Le=new AbortController;const t=this._uiManager.combinedSignal(this.#Le);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#Qe()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(){ai("An editor must be serializable")}static async deserialize(t,e,n){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId});i.rotation=t.rotation,i.#we=t.accessibilityData,i._isCopy=t.isCopy||!1;const[s,r]=i.pageDimensions,[o,a,l,c]=i.getRectInCurrentCoords(t.rect,r);return i.x=o/s,i.y=a/r,i.width=l/s,i.height=c/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#Le?.abort(),this.#Le=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#ze&&(clearTimeout(this.#ze),this.#ze=null),this.#We(),this.removeEditToolbar(),this.#Be){for(const t of this.#Be.values())clearTimeout(t);this.#Be=null}this.parent=null,this.#Ue?.destroy(),this.#Ue=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#Ze(),this.#Ce.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||"Enter"!==t.key)return;this._uiManager.setSelected(this),this.#Pe={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#Ce.children;if(!this.#xe){this.#xe=Array.from(e);const t=this.#rn.bind(this),n=this.#on.bind(this),i=this._uiManager._signal;for(const e of this.#xe){const s=e.getAttribute("data-resizer-name");e.setAttribute("role","spinbutton"),e.addEventListener("keydown",t,{signal:i}),e.addEventListener("blur",n,{signal:i}),e.addEventListener("focus",this.#an.bind(this,s),{signal:i}),e.setAttribute("data-l10n-id",os._l10nResizer[s])}}const n=this.#xe[0];let i=0;for(const r of e){if(r===n)break;i++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#xe.length/4);if(s!==i){if(s<i)for(let e=0;e<i-s;e++)this.#Ce.append(this.#Ce.firstChild);else if(s>i)for(let e=0;e<s-i;e++)this.#Ce.firstChild.before(this.#Ce.lastChild);let t=0;for(const n of e){const e=this.#xe[t++].getAttribute("data-resizer-name");n.setAttribute("data-l10n-id",os._l10nResizer[e])}}this.#ln(0),this.#Ne=!0,this.#Ce.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#rn(t){os._resizerKeyboardManager.exec(this,t)}#on(t){this.#Ne&&t.relatedTarget?.parentNode!==this.#Ce&&this.#We()}#an(t){this.#Me=this.#Ne?t:""}#ln(t){if(this.#xe)for(const e of this.#xe)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#Ne&&this.#Xe(this.#Me,{deltaX:t,deltaY:e,fromKeyboard:!0})}#We(){this.#Ne=!1,this.#ln(-1),this.#Ye()}_stopResizingWithKeyboard(){this.#We(),this.div.focus()}select(){this.isSelected&&this._editToolbar||(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar?(this._editToolbar?.show(),this.#a?.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()}))}unselect(){this.isSelected&&(this.isSelected=!1,this.#Ce?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#a?.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#De}set isEditing(t){this.#De=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#Ee=!0;const n=t/e,{style:i}=this.div;i.aspectRatio=n,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){this.#Be||=new Map;const{action:e}=t;let n=this.#Be.get(e);return n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(t),this.#Be.delete(e),0===this.#Be.size&&(this.#Be=null)},os._telemetryTimeout),void this.#Be.set(e,n)}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#Se=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#Se=!0}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(e){if("CANVAS"===e.nodeName){const t=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.before(e)}}else e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);return e}resetAnnotationElement(t){const{firstChild:e}=t.container;"DIV"===e?.nodeName&&e.classList.contains("annotationContent")&&e.remove()}}class as extends os{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const ls=3285377520,cs=4294901760,hs=65535;class us{constructor(t){this.h1=t?4294967295&t:ls,this.h2=t?4294967295&t:ls}update(t){let e,n;if("string"===typeof t){e=new Uint8Array(2*t.length),n=0;for(let i=0,s=t.length;i<s;i++){const s=t.charCodeAt(i);s<=255?e[n++]=s:(e[n++]=s>>>8,e[n++]=255&s)}}else{if(!ArrayBuffer.isView(t))throw new Error("Invalid data format, must be a string or TypedArray.");e=t.slice(),n=e.byteLength}const i=n>>2,s=n-4*i,r=new Uint32Array(e.buffer,0,i);let o=0,a=0,l=this.h1,c=this.h2;const h=3432918353,u=461845907,d=11601,p=13715;for(let f=0;f<i;f++)1&f?(o=r[f],o=o*h&cs|o*d&hs,o=o<<15|o>>>17,o=o*u&cs|o*p&hs,l^=o,l=l<<13|l>>>19,l=5*l+3864292196):(a=r[f],a=a*h&cs|a*d&hs,a=a<<15|a>>>17,a=a*u&cs|a*p&hs,c^=a,c=c<<13|c>>>19,c=5*c+3864292196);switch(o=0,s){case 3:o^=e[4*i+2]<<16;case 2:o^=e[4*i+1]<<8;case 1:o^=e[4*i],o=o*h&cs|o*d&hs,o=o<<15|o>>>17,o=o*u&cs|o*p&hs,1&i?l^=o:c^=o}this.h1=l,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=3981806797*t&cs|36045*t&hs,e=4283543511*e&cs|(2950163797*(e<<16|t>>>16)&cs)>>>16,t^=e>>>1,t=444984403*t&cs|60499*t&hs,e=3301882366*e&cs|(3120437893*(e<<16|t>>>16)&cs)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const ds=Object.freeze({map:null,hash:"",transfer:void 0});class ps{#cn=!1;#hn=null;#un=(()=>new Map)();constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#un.get(t);return void 0===n?e:Object.assign(e,n)}getRawValue(t){return this.#un.get(t)}remove(t){if(this.#un.delete(t),0===this.#un.size&&this.resetModified(),"function"===typeof this.onAnnotationEditor){for(const t of this.#un.values())if(t instanceof os)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#un.get(t);let i=!1;if(void 0!==n)for(const[s,r]of Object.entries(e))n[s]!==r&&(i=!0,n[s]=r);else i=!0,this.#un.set(t,e);i&&this.#dn(),e instanceof os&&"function"===typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#un.has(t)}get size(){return this.#un.size}#dn(){this.#cn||(this.#cn=!0,"function"===typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#cn&&(this.#cn=!1,"function"===typeof this.onResetModified&&this.onResetModified())}get print(){return new fs(this)}get serializable(){if(0===this.#un.size)return ds;const t=new Map,e=new us,n=[],i=Object.create(null);let s=!1;for(const[r,o]of this.#un){const n=o instanceof os?o.serialize(!1,i):o;n&&(t.set(r,n),e.update(`${r}:${JSON.stringify(n)}`),s||=!!n.bitmap)}if(s)for(const r of t.values())r.bitmap&&n.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:ds}get editorStats(){let t=null;const e=new Map;for(const n of this.#un.values()){if(!(n instanceof os))continue;const i=n.telemetryFinalData;if(!i)continue;const{type:s}=i;e.has(s)||e.set(s,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const r=t[s]||=new Map;for(const[t,e]of Object.entries(i)){if("type"===t)continue;let n=r.get(t);n||(n=new Map,r.set(t,n));const i=n.get(e)??0;n.set(e,i+1)}}for(const[n,i]of e)t[n]=i.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#hn=null}get modifiedIds(){if(this.#hn)return this.#hn;const t=[];for(const e of this.#un.values())e instanceof os&&e.annotationElementId&&e.serialize()&&t.push(e.annotationElementId);return this.#hn={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#un.entries()}}class fs extends ps{#pn;constructor(t){super();const{map:e,hash:n,transfer:i}=t.serializable,s=structuredClone(e,i?{transfer:i}:null);this.#pn={map:s,hash:n,transfer:i}}get print(){ai("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#pn}get modifiedIds(){return ui(this,"modifiedIds",{ids:new Set,hash:""})}}class gs{#fn=(()=>new Set)();constructor(t){let{ownerDocument:e=globalThis.document,styleElement:n=null}=t;this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#fn.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(t){let{systemFontInfo:e,disableFontFace:n,_inspectFont:i}=t;if(e&&!this.#fn.has(e.loadedName)){if(li(!n,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:t,src:n,style:s}=e,r=new FontFace(t,n,s);this.addNativeFontFace(r);try{await r.load(),this.#fn.add(t),i?.(e)}catch{oi(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}ai("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo)return void await this.loadSystemFont(t);if(this.isFontLoadingAPISupported){const e=t.createNativeFontFace();if(e){this.addNativeFontFace(e);try{await e.loaded}catch(n){throw oi(`Failed to load font '${e.family}': '${n}'.`),t.disableFontFace=!0,n}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(e=>{const n=this._queueLoadingCallback(e);this._prepareFontLoadEvent(t,n)})}}get isFontLoadingAPISupported(){return ui(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){return ui(this,"isSyncFontLoadingSupported",xn||wi.platform.isFirefox)}_queueLoadingCallback(t){const{loadingRequests:e}=this,n={done:!1,complete:function(){for(li(!n.done,"completeRequest() cannot be called twice."),n.done=!0;e.length>0&&e[0].done;){const t=e.shift();setTimeout(t.callback,0)}},callback:t};return e.push(n),n}get _loadTestFont(){return ui(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(t,e){function n(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function i(t,e,n,i){return t.substring(0,e)+i+t.substring(e+n)}let s,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const a=o.getContext("2d");let l=0;const c=`lt${Date.now()}${this.loadTestFontId++}`;let h=this._loadTestFont;h=i(h,976,c.length,c);const u=1482184792;let d=n(h,16);for(s=0,r=c.length-3;s<r;s+=4)d=d-u+n(c,s)|0;var p;s<c.length&&(d=d-u+n(c+"XXX",s)|0),h=i(h,16,4,(p=d,String.fromCharCode(p>>24&255,p>>16&255,p>>8&255,255&p)));const f=`@font-face {font-family:"${c}";src:${`url(data:font/opentype;base64,${btoa(h)});`}}`;this.insertRule(f);const g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(const m of[t.loadedName,c]){const t=this._document.createElement("span");t.textContent="Hi",t.style.fontFamily=m,g.append(t)}this._document.body.append(g),function t(e,n){if(++l>30)return oi("Load test font never loaded."),void n();a.font="30px "+e,a.fillText(".",0,20),a.getImageData(0,0,1,1).data[3]>0?n():setTimeout(t.bind(null,e,n))}(c,()=>{g.remove(),e.complete()})}}class ms{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.compiledGlyphs=Object.create(null);for(const n in t)this[n]=t[n];this._inspectFont=e}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(this.cssFontInfo){const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}else t=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Pi(this.data)});`;let e;if(this.cssFontInfo){let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}else e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let i;try{i=t.get(n)}catch(r){oi(`getPathGenerator - ignoring character: "${r}".`)}const s=new Path2D(i||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=s}}function vs(t){if("string"!==typeof t)return null;if(t.endsWith("/"))return t;throw new Error(`Invalid factory url: "${t}" must include trailing slash.`)}const ys=t=>"object"===typeof t&&Number.isInteger(t?.num)&&t.num>=0&&Number.isInteger(t?.gen)&&t.gen>=0,bs=function(t,e,n){if(!Array.isArray(n)||n.length<2)return!1;const[i,s,...r]=n;if(!t(i)&&!Number.isInteger(i))return!1;if(!e(s))return!1;const o=r.length;let a=!0;switch(s.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return 0===o;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(4!==o)return!1;a=!1;break;default:return!1}for(const l of r)if(!("number"===typeof l||a&&null===l))return!1;return!0}.bind(null,ys,t=>"object"===typeof t&&"string"===typeof t?.name);class _s{#gn=(()=>new Map)();#mn=(()=>Promise.resolve())();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#mn.then(()=>{for(const[t]of this.#gn)t.call(this,n)})}addEventListener(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=null;if(n?.signal instanceof AbortSignal){const{signal:s}=n;if(s.aborted)return void oi("LoopbackPort - cannot use an `aborted` signal.");const r=()=>this.removeEventListener(t,e);i=()=>s.removeEventListener("abort",r),s.addEventListener("abort",r)}this.#gn.set(e,i)}removeEventListener(t,e){const n=this.#gn.get(e);n?.(),this.#gn.delete(e)}terminate(){for(const[,t]of this.#gn)t?.();this.#gn.clear()}}const ws=1,xs=2,Ss=1,As=2,ks=3,Es=4,Cs=5,Ts=6,Ps=7,Ls=8;function Ms(){}function Is(t){if(t instanceof yi||t instanceof gi||t instanceof pi||t instanceof mi||t instanceof fi)return t;switch(t instanceof Error||"object"===typeof t&&null!==t||ai('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),t.name){case"AbortException":return new yi(t.message);case"InvalidPDFException":return new gi(t.message);case"PasswordException":return new pi(t.message,t.code);case"ResponseException":return new mi(t.message,t.status,t.missing);case"UnknownErrorException":return new fi(t.message,t.details)}return new fi(t.message,t.toString())}class Rs{#vn=(()=>new AbortController)();constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#yn.bind(this),{signal:this.#vn.signal})}#yn(t){let{data:e}=t;if(e.targetName!==this.sourceName)return;if(e.stream)return void this.#bn(e);if(e.callback){const t=e.callbackId,n=this.callbackCapabilities[t];if(!n)throw new Error(`Cannot resolve callback ${t}`);if(delete this.callbackCapabilities[t],e.callback===ws)n.resolve(e.data);else{if(e.callback!==xs)throw new Error("Unexpected callback case");n.reject(Is(e.reason))}return}const n=this.actionHandler[e.action];if(!n)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const t=this.sourceName,i=e.sourceName,s=this.comObj;return void Promise.try(n,e.data).then(function(n){s.postMessage({sourceName:t,targetName:i,callback:ws,callbackId:e.callbackId,data:n})},function(n){s.postMessage({sourceName:t,targetName:i,callback:xs,callbackId:e.callbackId,reason:Is(n)})})}e.streamId?this.#_n(e):n(e.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const i=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},n)}catch(r){s.reject(r)}return s.promise}sendWithStream(t,e,n,i){const s=this.streamId++,r=this.sourceName,o=this.targetName,a=this.comObj;return new ReadableStream({start:n=>{const l=Promise.withResolvers();return this.streamControllers[s]={controller:n,startCall:l,pullCall:null,cancelCall:null,isClosed:!1},a.postMessage({sourceName:r,targetName:o,action:t,streamId:s,data:e,desiredSize:n.desiredSize},i),l.promise},pull:t=>{const e=Promise.withResolvers();return this.streamControllers[s].pullCall=e,a.postMessage({sourceName:r,targetName:o,stream:Ts,streamId:s,desiredSize:t.desiredSize}),e.promise},cancel:t=>{li(t instanceof Error,"cancel must have a valid reason");const e=Promise.withResolvers();return this.streamControllers[s].cancelCall=e,this.streamControllers[s].isClosed=!0,a.postMessage({sourceName:r,targetName:o,stream:Ss,streamId:s,reason:Is(t)}),e.promise}},n)}#_n(t){const e=t.streamId,n=this.sourceName,i=t.sourceName,s=this.comObj,r=this,o=this.actionHandler[t.action],a={enqueue(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const a=this.desiredSize;this.desiredSize-=r,a>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:n,targetName:i,stream:Es,streamId:e,chunk:t},o)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:ks,streamId:e}),delete r.streamSinks[e])},error(t){li(t instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:Cs,streamId:e,reason:Is(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};a.sinkCapability.resolve(),a.ready=a.sinkCapability.promise,this.streamSinks[e]=a,Promise.try(o,t.data,a).then(function(){s.postMessage({sourceName:n,targetName:i,stream:Ls,streamId:e,success:!0})},function(t){s.postMessage({sourceName:n,targetName:i,stream:Ls,streamId:e,reason:Is(t)})})}#bn(t){const e=t.streamId,n=this.sourceName,i=t.sourceName,s=this.comObj,r=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case Ls:t.success?r.startCall.resolve():r.startCall.reject(Is(t.reason));break;case Ps:t.success?r.pullCall.resolve():r.pullCall.reject(Is(t.reason));break;case Ts:if(!o){s.postMessage({sourceName:n,targetName:i,stream:Ps,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||Ms).then(function(){s.postMessage({sourceName:n,targetName:i,stream:Ps,streamId:e,success:!0})},function(t){s.postMessage({sourceName:n,targetName:i,stream:Ps,streamId:e,reason:Is(t)})});break;case Es:if(li(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case ks:if(li(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#wn(r,e);break;case Cs:li(r,"error should have stream controller"),r.controller.error(Is(t.reason)),this.#wn(r,e);break;case As:t.success?r.cancelCall.resolve():r.cancelCall.reject(Is(t.reason)),this.#wn(r,e);break;case Ss:if(!o)break;const a=Is(t.reason);Promise.try(o.onCancel||Ms,a).then(function(){s.postMessage({sourceName:n,targetName:i,stream:As,streamId:e,success:!0})},function(t){s.postMessage({sourceName:n,targetName:i,stream:As,streamId:e,reason:Is(t)})}),o.sinkCapability.reject(a),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#wn(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#vn?.abort(),this.#vn=null}}class Ds{#xn=!1;constructor(t){let{enableHWA:e=!1}=t;this.#xn=e}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#xn})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){ai("Abstract method `_createCanvas` called.")}}class Os extends Ds{constructor(t){let{ownerDocument:e=globalThis.document,enableHWA:n=!1}=t;super({enableHWA:n}),this._document=e}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class Ns{constructor(t){let{baseUrl:e=null,isCompressed:n=!0}=t;this.baseUrl=e,this.isCompressed=n}async fetch(t){let{name:e}=t;if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const n=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(n).then(t=>({cMapData:t,isCompressed:this.isCompressed})).catch(t=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${n}`)})}async _fetch(t){ai("Abstract method `_fetch` called.")}}class zs extends Ns{async _fetch(t){const e=await Ii(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):_i(e)}}class Fs{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,i,s){return"none"}destroy(){}}class js extends Fs{#Sn;#An;#kn;#En;#Cn;#Tn;#_=0;constructor(t){let{docId:e,ownerDocument:n=globalThis.document}=t;super(),this.#En=e,this.#Cn=n}get#x(){return this.#An||=new Map}get#Pn(){return this.#Tn||=new Map}get#Ln(){if(!this.#kn){const t=this.#Cn.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#Cn.createElementNS(Li,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#kn=this.#Cn.createElementNS(Li,"defs"),t.append(n),n.append(this.#kn),this.#Cn.body.append(t)}return this.#kn}#Mn(t){if(1===t.length){const e=t[0],n=new Array(256);for(let t=0;t<256;t++)n[t]=e[t]/255;const i=n.join(",");return[i,i,i]}const[e,n,i]=t,s=new Array(256),r=new Array(256),o=new Array(256);for(let a=0;a<256;a++)s[a]=e[a]/255,r[a]=n[a]/255,o[a]=i[a]/255;return[s.join(","),r.join(","),o.join(",")]}#In(t){if(void 0===this.#Sn){this.#Sn="";const t=this.#Cn.URL;t!==this.#Cn.baseURI&&(Oi(t)?oi('#createUrl: ignore "data:"-URL for performance reasons.'):this.#Sn=hi(t,""))}return`url(${this.#Sn}#${t})`}addFilter(t){if(!t)return"none";let e=this.#x.get(t);if(e)return e;const[n,i,s]=this.#Mn(t),r=1===t.length?n:`${n}${i}${s}`;if(e=this.#x.get(r),e)return this.#x.set(t,e),e;const o=`g_${this.#En}_transfer_map_${this.#_++}`,a=this.#In(o);this.#x.set(t,a),this.#x.set(r,a);const l=this.#Rn(o);return this.#Dn(n,i,s,l),a}addHCMFilter(t,e){const n=`${t}-${e}`,i="base";let s=this.#Pn.get(i);if(s?.key===n)return s.url;if(s?(s.filter?.remove(),s.key=n,s.url="none",s.filter=null):(s={key:n,url:"none",filter:null},this.#Pn.set(i,s)),!t||!e)return s.url;const r=this.#On(t);t=Si.makeHexColor(...r);const o=this.#On(e);if(e=Si.makeHexColor(...o),this.#Ln.style.color="","#000000"===t&&"#ffffff"===e||t===e)return s.url;const a=new Array(256);for(let d=0;d<=255;d++){const t=d/255;a[d]=t<=.03928?t/12.92:((t+.055)/1.055)**2.4}const l=a.join(","),c=`g_${this.#En}_hcm_filter`,h=s.filter=this.#Rn(c);this.#Dn(l,l,l,h),this.#Nn(h);const u=(t,e)=>{const n=r[t]/255,i=o[t]/255,s=new Array(e+1);for(let r=0;r<=e;r++)s[r]=n+r/e*(i-n);return s.join(",")};return this.#Dn(u(0,5),u(1,5),u(2,5),h),s.url=this.#In(c),s.url}addAlphaFilter(t){let e=this.#x.get(t);if(e)return e;const[n]=this.#Mn([t]),i=`alpha_${n}`;if(e=this.#x.get(i),e)return this.#x.set(t,e),e;const s=`g_${this.#En}_alpha_map_${this.#_++}`,r=this.#In(s);this.#x.set(t,r),this.#x.set(i,r);const o=this.#Rn(s);return this.#zn(n,o),r}addLuminosityFilter(t){let e,n,i=this.#x.get(t||"luminosity");if(i)return i;if(t?([e]=this.#Mn([t]),n=`luminosity_${e}`):n="luminosity",i=this.#x.get(n),i)return this.#x.set(t,i),i;const s=`g_${this.#En}_luminosity_map_${this.#_++}`,r=this.#In(s);this.#x.set(t,r),this.#x.set(n,r);const o=this.#Rn(s);return this.#Fn(o),t&&this.#zn(e,o),r}addHighlightHCMFilter(t,e,n,i,s){const r=`${e}-${n}-${i}-${s}`;let o=this.#Pn.get(t);if(o?.key===r)return o.url;if(o?(o.filter?.remove(),o.key=r,o.url="none",o.filter=null):(o={key:r,url:"none",filter:null},this.#Pn.set(t,o)),!e||!n)return o.url;const[a,l]=[e,n].map(this.#On.bind(this));let c=Math.round(.2126*a[0]+.7152*a[1]+.0722*a[2]),h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[u,d]=[i,s].map(this.#On.bind(this));h<c&&([c,h,u,d]=[h,c,d,u]),this.#Ln.style.color="";const p=(t,e,n)=>{const i=new Array(256),s=(h-c)/n,r=t/255,o=(e-t)/(255*n);let a=0;for(let l=0;l<=n;l++){const t=Math.round(c+l*s),e=r+l*o;for(let n=a;n<=t;n++)i[n]=e;a=t+1}for(let l=a;l<256;l++)i[l]=i[a-1];return i.join(",")},f=`g_${this.#En}_hcm_${t}_filter`,g=o.filter=this.#Rn(f);return this.#Nn(g),this.#Dn(p(u[0],d[0],5),p(u[1],d[1],5),p(u[2],d[2],5),g),o.url=this.#In(f),o.url}destroy(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.#Tn?.size||(this.#kn?.parentNode.parentNode.remove(),this.#kn=null,this.#An?.clear(),this.#An=null,this.#Tn?.clear(),this.#Tn=null,this.#_=0)}#Fn(t){const e=this.#Cn.createElementNS(Li,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#Nn(t){const e=this.#Cn.createElementNS(Li,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#Rn(t){const e=this.#Cn.createElementNS(Li,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#Ln.append(e),e}#jn(t,e,n){const i=this.#Cn.createElementNS(Li,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",n),t.append(i)}#Dn(t,e,n,i){const s=this.#Cn.createElementNS(Li,"feComponentTransfer");i.append(s),this.#jn(s,"feFuncR",t),this.#jn(s,"feFuncG",e),this.#jn(s,"feFuncB",n)}#zn(t,e){const n=this.#Cn.createElementNS(Li,"feComponentTransfer");e.append(n),this.#jn(n,"feFuncA",t)}#On(t){return this.#Ln.style.color=t,Hi(getComputedStyle(this.#Ln).getPropertyValue("color"))}}class Bs{constructor(t){let{baseUrl:e=null}=t;this.baseUrl=e}async fetch(t){let{filename:e}=t;if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const n=`${this.baseUrl}${e}`;return this._fetch(n).catch(t=>{throw new Error(`Unable to load font data at: ${n}`)})}async _fetch(t){ai("Abstract method `_fetch` called.")}}class Us extends Bs{async _fetch(t){const e=await Ii(t,"arraybuffer");return new Uint8Array(e)}}class Hs{constructor(t){let{baseUrl:e=null}=t;this.baseUrl=e}async fetch(t){let{filename:e}=t;if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const n=`${this.baseUrl}${e}`;return this._fetch(n).catch(t=>{throw new Error(`Unable to load wasm data at: ${n}`)})}async _fetch(t){ai("Abstract method `_fetch` called.")}}class $s extends Hs{async _fetch(t){const e=await Ii(t,"arraybuffer");return new Uint8Array(e)}}async function Ws(t){const e=process.getBuiltinModule("fs"),n=await e.promises.readFile(t);return new Uint8Array(n)}xn&&oi("Please use the `legacy` build in Node.js environments.");class Vs extends Fs{}class Gs extends Ds{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire("file:///home/david-bonillo/Documentos/MapOverlay/map-overlay/node_modules/pdfjs-dist/build/pdf.mjs")("@napi-rs/canvas").createCanvas(t,e)}}class qs extends Ns{async _fetch(t){return Ws(t)}}class Zs extends Bs{async _fetch(t){return Ws(t)}}class Ks extends Hs{async _fetch(t){return Ws(t)}}const Xs="Fill",Ys="Stroke",Js="Shading";function Qs(t,e){if(!e)return;const n=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],n,i),t.clip(s)}class tr{isModifyingCurrentTransform(){return!1}getPattern(){ai("Abstract method `getPattern` called.")}}class er extends tr{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,i){let s;if(i===Ys||i===Xs){const r=e.current.getClippedPathBoundingBox(i,$i(t))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,a=Math.ceil(r[3]-r[1])||1,l=e.cachedCanvases.getCanvas("pattern",o,a),c=l.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),n=Si.transform(n,[1,0,0,1,r[0],r[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),Qs(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=t.createPattern(l.canvas,"no-repeat");const h=new DOMMatrix(n);s.setTransform(h)}else Qs(t,this._bbox),s=this._createGradient(t);return s}}function nr(t,e,n,i,s,r,o,a){const l=e.coords,c=e.colors,h=t.data,u=4*t.width;let d;l[n+1]>l[i+1]&&(d=n,n=i,i=d,d=r,r=o,o=d),l[i+1]>l[s+1]&&(d=i,i=s,s=d,d=o,o=a,a=d),l[n+1]>l[i+1]&&(d=n,n=i,i=d,d=r,r=o,o=d);const p=(l[n]+e.offsetX)*e.scaleX,f=(l[n+1]+e.offsetY)*e.scaleY,g=(l[i]+e.offsetX)*e.scaleX,m=(l[i+1]+e.offsetY)*e.scaleY,v=(l[s]+e.offsetX)*e.scaleX,y=(l[s+1]+e.offsetY)*e.scaleY;if(f>=y)return;const b=c[r],_=c[r+1],w=c[r+2],x=c[o],S=c[o+1],A=c[o+2],k=c[a],E=c[a+1],C=c[a+2],T=Math.round(f),P=Math.round(y);let L,M,I,R,D,O,N,z;for(let F=T;F<=P;F++){if(F<m){const t=F<f?0:(f-F)/(f-m);L=p-(p-g)*t,M=b-(b-x)*t,I=_-(_-S)*t,R=w-(w-A)*t}else{let t;t=F>y?1:m===y?0:(m-F)/(m-y),L=g-(g-v)*t,M=x-(x-k)*t,I=S-(S-E)*t,R=A-(A-C)*t}let t;t=F<f?0:F>y?1:(f-F)/(f-y),D=p-(p-v)*t,O=b-(b-k)*t,N=_-(_-E)*t,z=w-(w-C)*t;const e=Math.round(Math.min(L,D)),n=Math.round(Math.max(L,D));let i=u*F+4*e;for(let s=e;s<=n;s++)t=(L-s)/(L-D),t<0?t=0:t>1&&(t=1),h[i++]=M-(M-O)*t|0,h[i++]=I-(I-N)*t|0,h[i++]=R-(R-z)*t|0,h[i++]=255}}function ir(t,e,n){const i=e.coords,s=e.colors;let r,o;switch(e.type){case"lattice":const a=e.verticesPerRow,l=Math.floor(i.length/a)-1,c=a-1;for(r=0;r<l;r++){let e=r*a;for(let r=0;r<c;r++,e++)nr(t,n,i[e],i[e+1],i[e+a],s[e],s[e+1],s[e+a]),nr(t,n,i[e+a+1],i[e+1],i[e+a],s[e+a+1],s[e+1],s[e+a])}break;case"triangles":for(r=0,o=i.length;r<o;r+=3)nr(t,n,i[r],i[r+1],i[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class sr extends tr{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const i=Math.floor(this._bounds[0]),s=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-i,o=Math.ceil(this._bounds[3])-s,a=Math.min(Math.ceil(Math.abs(r*t[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(o*t[1]*1.1)),3e3),c=r/a,h=o/l,u={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-s,scaleX:1/c,scaleY:1/h},d=a+4,p=l+4,f=n.getCanvas("mesh",d,p),g=f.context,m=g.createImageData(a,l);if(e){const t=m.data;for(let n=0,i=t.length;n<i;n+=4)t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=255}for(const v of this._figures)ir(m,v,u);g.putImageData(m,2,2);return{canvas:f.canvas,offsetX:i-2*c,offsetY:s-2*h,scaleX:c,scaleY:h}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,i){Qs(t,this._bbox);const s=new Float32Array(2);if(i===Js)Si.singularValueDecompose2dScale($i(t),s);else if(this.matrix){Si.singularValueDecompose2dScale(this.matrix,s);const[t,n]=s;Si.singularValueDecompose2dScale(e.baseTransform,s),s[0]*=t,s[1]*=n}else Si.singularValueDecompose2dScale(e.baseTransform,s);const r=this._createMeshCanvas(s,i===Js?null:this._background,e.cachedCanvases);return i!==Js&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class rr extends tr{getPattern(){return"hotpink"}}const or=1,ar=2;class lr{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=i}createPatternCanvas(t){const{bbox:e,operatorList:n,paintType:i,tilingType:s,color:r,canvasGraphicsFactory:o}=this;let{xstep:a,ystep:l}=this;a=Math.abs(a),l=Math.abs(l),ri("TilingType: "+s);const c=e[0],h=e[1],u=e[2],d=e[3],p=u-c,f=d-h,g=new Float32Array(2);Si.singularValueDecompose2dScale(this.matrix,g);const[m,v]=g;Si.singularValueDecompose2dScale(this.baseTransform,g);const y=m*g[0],b=v*g[1];let _=p,w=f,x=!1,S=!1;const A=Math.ceil(a*y),k=Math.ceil(l*b);A>=Math.ceil(p*y)?_=a:x=!0,k>=Math.ceil(f*b)?w=l:S=!0;const E=this.getSizeAndScale(_,this.ctx.canvas.width,y),C=this.getSizeAndScale(w,this.ctx.canvas.height,b),T=t.cachedCanvases.getCanvas("pattern",E.size,C.size),P=T.context,L=o.createCanvasGraphics(P);if(L.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(L,i,r),P.translate(-E.scale*c,-C.scale*h),L.transform(E.scale,0,0,C.scale,0,0),P.save(),this.clipBbox(L,c,h,u,d),L.baseTransform=$i(L.ctx),L.executeOperatorList(n),L.endDrawing(),P.restore(),x||S){const e=T.canvas;x&&(_=a),S&&(w=l);const n=this.getSizeAndScale(_,this.ctx.canvas.width,y),i=this.getSizeAndScale(w,this.ctx.canvas.height,b),s=n.size,r=i.size,o=t.cachedCanvases.getCanvas("pattern-workaround",s,r),u=o.context,d=x?Math.floor(p/a):0,g=S?Math.floor(f/l):0;for(let t=0;t<=d;t++)for(let n=0;n<=g;n++)u.drawImage(e,s*t,r*n,s,r,0,0,s,r);return{canvas:o.canvas,scaleX:n.scale,scaleY:i.scale,offsetX:c,offsetY:h}}return{canvas:T.canvas,scaleX:E.scale,scaleY:C.scale,offsetX:c,offsetY:h}}getSizeAndScale(t,e,n){const i=Math.max(lr.MAX_PATTERN_SIZE,e);let s=Math.ceil(t*n);return s>=i?s=i:n=s/t,{scale:n,size:s}}clipBbox(t,e,n,i,s){const r=i-e,o=s-n;t.ctx.rect(e,n,r,o),Si.axialAlignedBoundingBox([e,n,i,s],$i(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const i=t.ctx,s=t.current;switch(e){case or:const{fillStyle:t,strokeStyle:r}=this.ctx;i.fillStyle=s.fillColor=t,i.strokeStyle=s.strokeColor=r;break;case ar:i.fillStyle=i.strokeStyle=n,s.fillColor=s.strokeColor=n;break;default:throw new vi(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,i){let s=n;i!==Js&&(s=Si.transform(s,e.baseTransform),this.matrix&&(s=Si.transform(s,this.matrix)));const r=this.createPatternCanvas(e);let o=new DOMMatrix(s);o=o.translate(r.offsetX,r.offsetY),o=o.scale(1/r.scaleX,1/r.scaleY);const a=t.createPattern(r.canvas,"repeat");return a.setTransform(o),a}}function cr(t){let{src:e,srcPos:n=0,dest:i,width:s,height:r,nonBlackColor:o=4294967295,inverseDecode:a=!1}=t;const l=wi.isLittleEndian?4278190080:255,[c,h]=a?[o,l]:[l,o],u=s>>3,d=7&s,p=e.length;i=new Uint32Array(i.buffer);let f=0;for(let g=0;g<r;g++){for(const s=n+u;n<s;n++){const t=n<p?e[n]:255;i[f++]=128&t?h:c,i[f++]=64&t?h:c,i[f++]=32&t?h:c,i[f++]=16&t?h:c,i[f++]=8&t?h:c,i[f++]=4&t?h:c,i[f++]=2&t?h:c,i[f++]=1&t?h:c}if(0===d)continue;const t=n<p?e[n++]:255;for(let e=0;e<d;e++)i[f++]=t&1<<7-e?h:c}return{srcPos:n,destPos:f}}const hr=16,ur=new DOMMatrix,dr=new Float32Array(2),pr=new Float32Array([1/0,1/0,-1/0,-1/0]);class fr{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let i;return void 0!==this.cache[t]?(i=this.cache[t],this.canvasFactory.reset(i,e,n)):(i=this.canvasFactory.create(e,n),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function gr(t,e,n,i,s,r,o,a,l,c){const[h,u,d,p,f,g]=$i(t);if(0===u&&0===d){const m=o*h+f,v=Math.round(m),y=a*p+g,b=Math.round(y),_=(o+l)*h+f,w=Math.abs(Math.round(_)-v)||1,x=(a+c)*p+g,S=Math.abs(Math.round(x)-b)||1;return t.setTransform(Math.sign(h),0,0,Math.sign(p),v,b),t.drawImage(e,n,i,s,r,0,0,w,S),t.setTransform(h,u,d,p,f,g),[w,S]}if(0===h&&0===p){const m=a*d+f,v=Math.round(m),y=o*u+g,b=Math.round(y),_=(a+c)*d+f,w=Math.abs(Math.round(_)-v)||1,x=(o+l)*u+g,S=Math.abs(Math.round(x)-b)||1;return t.setTransform(0,Math.sign(u),Math.sign(d),0,v,b),t.drawImage(e,n,i,s,r,0,0,S,w),t.setTransform(h,u,d,p,f,g),[S,w]}t.drawImage(e,n,i,s,r,o,a,l,c);return[Math.hypot(h,u)*l,Math.hypot(d,p)*c]}class mr{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=(()=>Sn)();leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=(()=>zn)();textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e){this.clipBox=new Float32Array([0,0,t,e]),this.minMax=pr.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xs,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.minMax.slice();if(t===Ys){e||ai("Stroke bounding box must include transform."),Si.singularValueDecompose2dScale(e,dr);const t=dr[0]*this.lineWidth/2,i=dr[1]*this.lineWidth/2;n[0]-=t,n[1]-=i,n[2]+=t,n[3]+=i}return n}updateClipFromPath(){const t=Si.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(pr,0)}getClippedPathBoundingBox(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xs,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Si.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function vr(t,e){if(e instanceof ImageData)return void t.putImageData(e,0,0);const n=e.height,i=e.width,s=n%hr,r=(n-s)/hr,o=0===s?r:r+1,a=t.createImageData(i,hr);let l,c=0;const h=e.data,u=a.data;let d,p,f,g;if(e.kind===$n.GRAYSCALE_1BPP){const e=h.byteLength,n=new Uint32Array(u.buffer,0,u.byteLength>>2),g=n.length,m=i+7>>3,v=4294967295,y=wi.isLittleEndian?4278190080:255;for(d=0;d<o;d++){for(f=d<r?hr:s,l=0,p=0;p<f;p++){const t=e-c;let s=0;const r=t>m?i:8*t-7,o=-8&r;let a=0,u=0;for(;s<o;s+=8)u=h[c++],n[l++]=128&u?v:y,n[l++]=64&u?v:y,n[l++]=32&u?v:y,n[l++]=16&u?v:y,n[l++]=8&u?v:y,n[l++]=4&u?v:y,n[l++]=2&u?v:y,n[l++]=1&u?v:y;for(;s<r;s++)0===a&&(u=h[c++],a=128),n[l++]=u&a?v:y,a>>=1}for(;l<g;)n[l++]=0;t.putImageData(a,0,d*hr)}}else if(e.kind===$n.RGBA_32BPP){for(p=0,g=i*hr*4,d=0;d<r;d++)u.set(h.subarray(c,c+g)),c+=g,t.putImageData(a,0,p),p+=hr;d<o&&(g=i*s*4,u.set(h.subarray(c,c+g)),t.putImageData(a,0,p))}else{if(e.kind!==$n.RGB_24BPP)throw new Error(`bad image kind: ${e.kind}`);for(f=hr,g=i*f,d=0;d<o;d++){for(d>=r&&(f=s,g=i*f),l=0,p=g;p--;)u[l++]=h[c++],u[l++]=h[c++],u[l++]=h[c++],u[l++]=255;t.putImageData(a,0,d*hr)}}}function yr(t,e){if(e.bitmap)return void t.drawImage(e.bitmap,0,0);const n=e.height,i=e.width,s=n%hr,r=(n-s)/hr,o=0===s?r:r+1,a=t.createImageData(i,hr);let l=0;const c=e.data,h=a.data;for(let u=0;u<o;u++){const e=u<r?hr:s;({srcPos:l}=cr({src:c,srcPos:l,dest:h,width:i,height:e,nonBlackColor:0})),t.putImageData(a,0,u*hr)}}function br(t,e){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of n)void 0!==t[i]&&(e[i]=t[i]);void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function _r(t){t.strokeStyle=t.fillStyle="#000000",t.fillRule="nonzero",t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.globalCompositeOperation="source-over",t.font="10px sans-serif",void 0!==t.setLineDash&&(t.setLineDash([]),t.lineDashOffset=0);const{filter:e}=t;"none"!==e&&""!==e&&(t.filter="none")}function wr(t,e){if(e)return!0;Si.singularValueDecompose2dScale(t,dr);const n=Math.fround(Gi.pixelRatio*Mi.PDF_TO_CSS_UNITS);return dr[0]<=n&&dr[1]<=n}const xr=["butt","round","square"],Sr=["miter","round","bevel"],Ar={},kr={};class Er{constructor(t,e,n,i,s,r,o,a){let{optionalContentConfig:l,markedContentStack:c=null}=r;this.ctx=t,this.current=new mr(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=l,this.cachedCanvases=new fr(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=a,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"===typeof t?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing(t){let{transform:e,viewport:n,transparency:i=!1,background:s=null}=t;const r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,i){const t=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=t.canvas,this.ctx=t.context,this.ctx.save(),this.ctx.transform(...$i(this.compositeCtx))}this.ctx.save(),_r(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=$i(this.ctx)}executeOperatorList(t,e,n,i){const s=t.argsArray,r=t.fnArray;let o=e||0;const a=s.length;if(a===o)return o;const l=a-o>10&&"function"===typeof n,c=l?Date.now()+15:0;let h=0;const u=this.commonObjs,d=this.objs;let p;for(;;){if(void 0!==i&&o===i.nextBreakPoint)return i.breakIt(o,n),o;if(p=r[o],p!==Yn.dependency)this[p].apply(this,s[o]);else for(const t of s[o]){const e=t.startsWith("g_")?u:d;if(!e.has(t))return e.get(t,n),o}if(o++,o===a)return o;if(l&&++h>10){if(Date.now()>c)return n(),o;h=0}}}#Bn(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#Bn(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#Un()}#Un(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==t){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,i=t.height??t.displayHeight;let s,r,o=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),l=n,c=i,h="prescale1";for(;o>2&&l>1||a>2&&c>1;){let e=l,n=c;o>2&&l>1&&(e=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),o/=l/e),a>2&&c>1&&(n=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,a/=c/n),s=this.cachedCanvases.getCanvas(h,e,n),r=s.context,r.clearRect(0,0,e,n),r.drawImage(t,0,0,l,c,0,0,e,n),t=s.canvas,l=e,c=n,h="prescale1"===h?"prescale2":"prescale1"}return{img:t,paintWidth:l,paintHeight:c}}_createMaskCanvas(t){const e=this.ctx,{width:n,height:i}=t,s=this.current.fillColor,r=this.current.patternFill,o=$i(e);let a,l,c,h;if((t.bitmap||t.data)&&t.count>1){const e=t.bitmap||t.data.buffer;l=JSON.stringify(r?o:[o.slice(0,4),s]),a=this._cachedBitmapsMap.get(e),a||(a=new Map,this._cachedBitmapsMap.set(e,a));const n=a.get(l);if(n&&!r){return{canvas:n,offsetX:Math.round(Math.min(o[0],o[2])+o[4]),offsetY:Math.round(Math.min(o[1],o[3])+o[5])}}c=n}c||(h=this.cachedCanvases.getCanvas("maskCanvas",n,i),yr(h.context,t));let u=Si.transform(o,[1/n,0,0,-1/i,0,0]);u=Si.transform(u,[1,0,0,1,0,-i]);const d=pr.slice();Si.axialAlignedBoundingBox([0,0,n,i],u,d);const[p,f,g,m]=d,v=Math.round(g-p)||1,y=Math.round(m-f)||1,b=this.cachedCanvases.getCanvas("fillCanvas",v,y),_=b.context,w=p,x=f;_.translate(-w,-x),_.transform(...u),c||(c=this._scaleImage(h.canvas,Wi(_)),c=c.img,a&&r&&a.set(l,c)),_.imageSmoothingEnabled=wr($i(_),t.interpolate),gr(_,c,0,0,c.width,c.height,0,0,n,i),_.globalCompositeOperation="source-in";const S=Si.transform(Wi(_),[1,0,0,1,-w,-x]);return _.fillStyle=r?s.getPattern(e,this,S,Xs):s,_.fillRect(0,0,n,i),a&&!r&&(this.cachedCanvases.delete("fillCanvas"),a.set(l,b.canvas)),{canvas:b.canvas,offsetX:Math.round(w),offsetY:Math.round(x)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=xr[t]}setLineJoin(t){this.ctx.lineJoin=Sr[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(t),n.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,n]of t)switch(e){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,t,e);this.suspendedCtx=this.ctx;const s=this.ctx=i.context;s.setTransform(this.suspendedCtx.getTransform()),br(this.suspendedCtx,s),function(t,e){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save,t.__originalRestore=t.restore,t.__originalRotate=t.rotate,t.__originalScale=t.scale,t.__originalTranslate=t.translate,t.__originalTransform=t.transform,t.__originalSetTransform=t.setTransform,t.__originalResetTransform=t.resetTransform,t.__originalClip=t.clip,t.__originalMoveTo=t.moveTo,t.__originalLineTo=t.lineTo,t.__originalBezierCurveTo=t.bezierCurveTo,t.__originalRect=t.rect,t.__originalClosePath=t.closePath,t.__originalBeginPath=t.beginPath,t._removeMirroring=()=>{t.save=t.__originalSave,t.restore=t.__originalRestore,t.rotate=t.__originalRotate,t.scale=t.__originalScale,t.translate=t.__originalTranslate,t.transform=t.__originalTransform,t.setTransform=t.__originalSetTransform,t.resetTransform=t.__originalResetTransform,t.clip=t.__originalClip,t.moveTo=t.__originalMoveTo,t.lineTo=t.__originalLineTo,t.bezierCurveTo=t.__originalBezierCurveTo,t.rect=t.__originalRect,t.closePath=t.__originalClosePath,t.beginPath=t.__originalBeginPath,delete t._removeMirroring},t.save=function(){e.save(),this.__originalSave()},t.restore=function(){e.restore(),this.__originalRestore()},t.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},t.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},t.transform=function(t,n,i,s,r,o){e.transform(t,n,i,s,r,o),this.__originalTransform(t,n,i,s,r,o)},t.setTransform=function(t,n,i,s,r,o){e.setTransform(t,n,i,s,r,o),this.__originalSetTransform(t,n,i,s,r,o)},t.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},t.rotate=function(t){e.rotate(t),this.__originalRotate(t)},t.clip=function(t){e.clip(t),this.__originalClip(t)},t.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},t.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},t.bezierCurveTo=function(t,n,i,s,r,o){e.bezierCurveTo(t,n,i,s,r,o),this.__originalBezierCurveTo(t,n,i,s,r,o)},t.rect=function(t,n,i,s){e.rect(t,n,i,s),this.__originalRect(t,n,i,s)},t.closePath=function(){e.closePath(),this.__originalClosePath()},t.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}(s,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),br(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,i){const s=i[0],r=i[1],o=i[2]-s,a=i[3]-r;0!==o&&0!==a&&(this.genericComposeSMask(e.context,n,o,a,e.subtype,e.backdrop,e.transferMap,s,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,i,s,r,o,a,l,c,h){let u=t.canvas,d=a-c,p=l-h;if(r)if(d<0||p<0||d+n>u.width||p+i>u.height){const t=this.cachedCanvases.getCanvas("maskExtension",n,i),e=t.context;e.drawImage(u,-d,-p),e.globalCompositeOperation="destination-atop",e.fillStyle=r,e.fillRect(0,0,n,i),e.globalCompositeOperation="source-over",u=t.canvas,d=p=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const e=new Path2D;e.rect(d,p,n,i),t.clip(e),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(d,p,n,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),"Alpha"===s&&o?e.filter=this.filterFactory.addAlphaFilter(o):"Luminosity"===s&&(e.filter=this.filterFactory.addLuminosityFilter(o));const f=new Path2D;f.rect(a,l,n,i),e.clip(f),e.globalCompositeOperation="destination-in",e.drawImage(u,d,p,n,i,a,l,n,i),e.restore()}save(){this.inSMaskMode&&br(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&br(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null):this.inSMaskMode&&this.endSMaskMode()}transform(t,e,n,i,s,r){this.ctx.transform(t,e,n,i,s,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n){let[i]=e;if(!n)return i||=e[0]=new Path2D,void this[t](i);if(!(i instanceof Path2D)){const t=e[0]=new Path2D;for(let e=0,n=i.length;e<n;)switch(i[e++]){case Jn:t.moveTo(i[e++],i[e++]);break;case Qn:t.lineTo(i[e++],i[e++]);break;case ti:t.bezierCurveTo(i[e++],i[e++],i[e++],i[e++],i[e++],i[e++]);break;case ei:t.closePath();break;default:oi(`Unrecognized drawing path operator: ${i[e-1]}`)}i=t}Si.axialAlignedBoundingBox(n,$i(this.ctx),this.current.minMax),this[t](i)}closePath(){this.ctx.closePath()}stroke(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.ctx,i=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"===typeof i&&i?.getPattern){const e=i.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=i.getPattern(n,this,Wi(n),Ys),e){const i=new Path2D;i.addPath(t,n.getTransform().invertSelf().multiplySelf(e)),t=i}this.rescaleAndStroke(t,!1),n.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(Ys,$i(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.ctx,i=this.current.fillColor;let s=!1;if(this.current.patternFill){const e=i.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.fillStyle=i.getPattern(n,this,Wi(n),Xs),e){const i=new Path2D;i.addPath(t,n.getTransform().invertSelf().multiplySelf(e)),t=i}s=!0}const r=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==r&&(this.pendingEOFill?(n.fill(t,"evenodd"),this.pendingEOFill=!1):n.fill(t)),s&&n.restore(),e&&this.consumePath(t,r)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}rawFillPath(t){this.ctx.fill(t)}clip(){this.pendingClip=Ar}eoClip(){this.pendingClip=kr}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(void 0===t)return;const n=new Path2D,i=e.getTransform().invertSelf();for(const{transform:s,x:r,y:o,fontSize:a,path:l}of t)l&&n.addPath(l,new DOMMatrix(s).preMultiplySelf(i).translate(r,o).scale(a,-a));e.clip(n),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){const n=this.commonObjs.get(t),i=this.current;if(!n)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=n.fontMatrix||Sn,0!==i.fontMatrix[0]&&0!==i.fontMatrix[3]||oi("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=e,n.isType3Font)return;const s=n.loadedName||"sans-serif",r=n.systemFontInfo?.css||`"${s}", ${n.fallbackName}`;let o="normal";n.black?o="900":n.bold&&(o="bold");const a=n.italic?"italic":"normal";let l=e;e<16?l=16:e>100&&(l=100),this.current.fontSizeScale=e/l,this.ctx.font=`${a} ${o} ${l}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t){const{current:e}=this;e.textMatrix=t,e.textMatrixScale=Math.hypot(t[0],t[1]),e.x=e.lineX=0,e.y=e.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#Hn(t,e,n){const i=new Path2D;return i.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),i}paintChar(t,e,n,i,s){const r=this.ctx,o=this.current,a=o.font,l=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,h=l&Un,u=!!(l&Hn),d=o.patternFill&&!a.missingFile,p=o.patternStroke&&!a.missingFile;let f;if((a.disableFontFace||u||d||p)&&!a.missingFile&&(f=a.getPathGenerator(this.commonObjs,t)),f&&(a.disableFontFace||d||p)){let t;if(r.save(),r.translate(e,n),r.scale(c,-c),h!==zn&&h!==jn||(i?(t=r.getTransform(),r.setTransform(...i),r.fill(this.#Hn(f,t,i))):r.fill(f)),h===Fn||h===jn)if(s){t||=r.getTransform(),r.setTransform(...s);const{a:e,b:n,c:i,d:o}=t,a=Si.inverseTransform(s),l=Si.transform([e,n,i,o,0,0],a);Si.singularValueDecompose2dScale(l,dr),r.lineWidth*=Math.max(dr[0],dr[1])/c,r.stroke(this.#Hn(f,t,s))}else r.lineWidth/=c,r.stroke(f);r.restore()}else h!==zn&&h!==jn||r.fillText(t,e,n),h!==Fn&&h!==jn||r.strokeText(t,e,n);if(u){(this.pendingTextPaths||=[]).push({transform:$i(r),x:e,y:n,fontSize:c,path:f})}}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){n=!0;break}return ui(this,"isFontSubpixelAAEnabled",n)}showText(t){const e=this.current,n=e.font;if(n.isType3Font)return this.showType3Text(t);const i=e.fontSize;if(0===i)return;const s=this.ctx,r=e.fontSizeScale,o=e.charSpacing,a=e.wordSpacing,l=e.fontDirection,c=e.textHScale*l,h=t.length,u=n.vertical,d=u?1:-1,p=n.defaultVMetrics,f=i*e.fontMatrix[0],g=e.textRenderingMode===zn&&!n.disableFontFace&&!e.patternFill;let m,v;if(s.save(),e.textMatrix&&s.transform(...e.textMatrix),s.translate(e.x,e.y+e.textRise),l>0?s.scale(c,-1):s.scale(c,1),e.patternFill){s.save();const t=e.fillColor.getPattern(s,this,Wi(s),Xs);m=$i(s),s.restore(),s.fillStyle=t}if(e.patternStroke){s.save();const t=e.strokeColor.getPattern(s,this,Wi(s),Ys);v=$i(s),s.restore(),s.strokeStyle=t}let y=e.lineWidth;const b=e.textMatrixScale;if(0===b||0===y){const t=e.textRenderingMode&Un;t!==Fn&&t!==jn||(y=this.getSinglePixelWidth())}else y/=b;if(1!==r&&(s.scale(r,r),y/=r),s.lineWidth=y,n.isInvalidPDFjsFont){const n=[];let i=0;for(const e of t)n.push(e.unicode),i+=e.width;return s.fillText(n.join(""),0,0),e.x+=i*f*c,s.restore(),void this.compose()}let _,w=0;for(_=0;_<h;++_){const e=t[_];if("number"===typeof e){w+=d*e*i/1e3;continue}let c=!1;const h=(e.isSpace?a:0)+o,y=e.fontChar,b=e.accent;let x,S,A=e.width;if(u){const t=e.vmetric||p,n=-(e.vmetric?t[1]:.5*A)*f,i=t[2]*f;A=t?-t[0]:A,x=n/r,S=(w+i)/r}else x=w/r,S=0;if(n.remeasure&&A>0){const t=1e3*s.measureText(y).width/i*r;if(A<t&&this.isFontSubpixelAAEnabled){const e=A/t;c=!0,s.save(),s.scale(e,1),x/=e}else A!==t&&(x+=(A-t)/2e3*i/r)}if(this.contentVisible&&(e.isInFont||n.missingFile))if(g&&!b)s.fillText(y,x,S);else if(this.paintChar(y,x,S,m,v),b){const t=x+i*b.offset.x/r,e=S-i*b.offset.y/r;this.paintChar(b.fontChar,t,e,m,v)}w+=u?A*f-h*l:A*f+h*l,c&&s.restore()}u?e.y-=w:e.x+=w*c,s.restore(),this.compose()}showType3Text(t){const e=this.ctx,n=this.current,i=n.font,s=n.fontSize,r=n.fontDirection,o=i.vertical?1:-1,a=n.charSpacing,l=n.wordSpacing,c=n.textHScale*r,h=n.fontMatrix||Sn,u=t.length;let d,p,f,g;if(!(n.textRenderingMode===Bn)&&0!==s){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),n.textMatrix&&e.transform(...n.textMatrix),e.translate(n.x,n.y+n.textRise),e.scale(c,r),d=0;d<u;++d){if(p=t[d],"number"===typeof p){g=o*p*s/1e3,this.ctx.translate(g,0),n.x+=g*c;continue}const r=(p.isSpace?l:0)+a,u=i.charProcOperatorList[p.operatorListId];u?this.contentVisible&&(this.save(),e.scale(s,s),e.transform(...h),this.executeOperatorList(u),this.restore()):oi(`Type3 character "${p.operatorListId}" is not available.`);const m=[p.width,0];Si.applyTransform(m,h),f=m[0]*s+r,e.translate(f,0),n.x+=f*c}e.restore()}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,n,i,s,r){const o=new Path2D;o.rect(n,i,s-n,r-i),this.ctx.clip(o),this.endPath()}getColorN_Pattern(t){let e;if("TilingPattern"===t[0]){const n=this.baseTransform||$i(this.ctx),i={createCanvasGraphics:t=>new Er(t,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new lr(t,this.ctx,i,n)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t){this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t){this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(t)?e=this.cachedPatterns.get(t):(e=function(t){switch(t[0]){case"RadialAxial":return new er(t);case"Mesh":return new sr(t);case"Dummy":return new rr}throw new Error(`Unknown IR type: ${t[0]}`)}(this.getObject(t)),this.cachedPatterns.set(t,e)),n&&(e.matrix=n),e}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const n=this._getPattern(t);e.fillStyle=n.getPattern(e,this,Wi(e),Js);const i=Wi(e);if(i){const{width:t,height:n}=e.canvas,s=pr.slice();Si.axialAlignedBoundingBox([0,0,t,n],i,s);const[r,o,a,l]=s;this.ctx.fillRect(r,o,a-r,l-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ai("Should not call beginInlineImage")}beginImageData(){ai("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=$i(this.ctx),e)){Si.axialAlignedBoundingBox(e,this.baseTransform,this.current.minMax);const[t,n,i,s]=e,r=new Path2D;r.rect(t,n,i-t,s-n),this.ctx.clip(r),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||ri("TODO: Support non-isolated groups."),t.knockout&&oi("Knockout groups not supported.");const n=$i(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=pr.slice();Si.axialAlignedBoundingBox(t.bbox,$i(e),i);const s=[0,0,e.canvas.width,e.canvas.height];i=Si.intersect(i,s)||[0,0,0,0];const r=Math.floor(i[0]),o=Math.floor(i[1]),a=Math.max(Math.ceil(i[2])-r,1),l=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,a,l]);let c="groupAt"+this.groupLevel;t.smask&&(c+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(c,a,l),u=h.context;u.translate(-r,-o),u.transform(...n);let d=new Path2D;const[p,f,g,m]=t.bbox;if(d.rect(p,f,g-p,m-f),t.matrix){const e=new Path2D;e.addPath(d,new DOMMatrix(t.matrix)),d=e}u.clip(d),t.smask?this.smaskStack.push({canvas:h.canvas,context:u,offsetX:r,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,o),e.save()),br(e,u),this.ctx=u,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const t=$i(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...t);const n=pr.slice();Si.axialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],t,n),this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,n,i,s){if(this.#Bn(),_r(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const i=e[2]-e[0],r=e[3]-e[1];if(s&&this.annotationCanvasMap){(n=n.slice())[4]-=e[0],n[5]-=e[1],(e=e.slice())[0]=e[1]=0,e[2]=i,e[3]=r,Si.singularValueDecompose2dScale($i(this.ctx),dr);const{viewportScale:s}=this,o=Math.ceil(i*this.outputScaleX*s),a=Math.ceil(r*this.outputScaleY*s);this.annotationCanvas=this.canvasFactory.create(o,a);const{canvas:l,context:c}=this.annotationCanvas;this.annotationCanvasMap.set(t,l),this.annotationCanvas.savedCtx=this.ctx,this.ctx=c,this.ctx.save(),this.ctx.setTransform(dr[0],0,0,-dr[1],0,r*dr[1]),_r(this.ctx)}else{_r(this.ctx),this.endPath();const t=new Path2D;t.rect(e[0],e[1],i,r),this.ctx.clip(t)}}this.current=new mr(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#Un(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;(t=this.getObject(t.data,t)).count=e;const n=this.ctx,i=this._createMaskCanvas(t),s=i.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(s,i.offsetX,i.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;t=this.getObject(t.data,t);const o=this.ctx;o.save();const a=$i(o);o.transform(e,n,i,s,0,0);const l=this._createMaskCanvas(t);o.setTransform(1,0,0,1,l.offsetX-a[4],l.offsetY-a[5]);for(let c=0,h=r.length;c<h;c+=2){const t=Si.transform(a,[e,n,i,s,r[c],r[c+1]]);o.drawImage(l.canvas,t[4],t[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,n=this.current.fillColor,i=this.current.patternFill;for(const s of t){const{data:t,width:r,height:o,transform:a}=s,l=this.cachedCanvases.getCanvas("maskCanvas",r,o),c=l.context;c.save();yr(c,this.getObject(t,s)),c.globalCompositeOperation="source-in",c.fillStyle=i?n.getPattern(c,this,Wi(e),Xs):n,c.fillRect(0,0,r,o),c.restore(),e.save(),e.transform(...a),e.scale(1,-1),gr(e,l.canvas,0,0,r,o,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);e?this.paintInlineImageXObject(e):oi("Dependent image isn't ready yet")}paintImageXObjectRepeat(t,e,n,i){if(!this.contentVisible)return;const s=this.getObject(t);if(!s)return void oi("Dependent image isn't ready yet");const r=s.width,o=s.height,a=[];for(let l=0,c=i.length;l<c;l+=2)a.push({transform:[e,0,0,n,i[l],i[l+1]],x:0,y:0,w:r,h:o});this.paintInlineImageXObjectGroup(s,a)}applyTransferMapsToCanvas(t){return"none"!==this.current.transferMaps&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if("none"===this.current.transferMaps)return t.bitmap;const{bitmap:e,width:n,height:i}=t,s=this.cachedCanvases.getCanvas("inlineImage",n,i),r=s.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",s.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,n=t.height,i=this.ctx;this.save();const{filter:s}=i;let r;if("none"!==s&&""!==s&&(i.filter="none"),i.scale(1/e,-1/n),t.bitmap)r=this.applyTransferMapsToBitmap(t);else if("function"===typeof HTMLElement&&t instanceof HTMLElement||!t.data)r=t;else{const i=this.cachedCanvases.getCanvas("inlineImage",e,n).context;vr(i,t),r=this.applyTransferMapsToCanvas(i)}const o=this._scaleImage(r,Wi(i));i.imageSmoothingEnabled=wr($i(i),t.interpolate),gr(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,e,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const e=t.width,n=t.height,s=this.cachedCanvases.getCanvas("inlineImage",e,n).context;vr(s,t),i=this.applyTransferMapsToCanvas(s)}for(const s of e)n.save(),n.transform(...s.transform),n.scale(1,-1),gr(n,i,s.x,s.y,s.w,s.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(n||(this.pendingClip===kr?i.clip(t,"evenodd"):i.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=$i(this.ctx);if(0===t[1]&&0===t[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:t}=this.current,{a:e,b:n,c:i,d:s}=this.ctx.getTransform();let r,o;if(0===n&&0===i){const n=Math.abs(e),i=Math.abs(s);if(n===i)if(0===t)r=o=1/n;else{const e=n*t;r=o=e<1?1/e:1}else if(0===t)r=1/n,o=1/i;else{const e=n*t,s=i*t;r=e<1?1/e:1,o=s<1?1/s:1}}else{const a=Math.abs(e*s-n*i),l=Math.hypot(e,n),c=Math.hypot(i,s);if(0===t)r=c/a,o=l/a;else{const e=t*a;r=c>e?c/e:1,o=l>e?l/e:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:i}}=this,[s,r]=this.getScaleForStroking();if(s===r)return n.lineWidth=(i||1)*s,void n.stroke(t);const o=n.getLineDash();e&&n.save(),n.scale(s,r),ur.a=1/s,ur.d=1/r;const a=new Path2D;if(a.addPath(t,ur),o.length>0){const t=Math.max(s,r);n.setLineDash(o.map(e=>e/t)),n.lineDashOffset/=t}n.lineWidth=i||1,n.stroke(a),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const n in Yn)void 0!==Er.prototype[n]&&(Er.prototype[Yn[n]]=Er.prototype[n]);class Cr{static#$n=null;static#Wn="";static get workerPort(){return this.#$n}static set workerPort(t){if(!("undefined"!==typeof Worker&&t instanceof Worker)&&null!==t)throw new Error("Invalid `workerPort` type.");this.#$n=t}static get workerSrc(){return this.#Wn}static set workerSrc(t){if("string"!==typeof t)throw new Error("Invalid `workerSrc` type.");this.#Wn=t}}class Tr{#Vn;#Gn;constructor(t){let{parsedData:e,rawData:n}=t;this.#Vn=e,this.#Gn=n}getRaw(){return this.#Gn}get(t){return this.#Vn.get(t)??null}[Symbol.iterator](){return this.#Vn.entries()}}const Pr=Symbol("INTERNAL");class Lr{#qn=!1;#Zn=!1;#Kn=!1;#Xn=!0;constructor(t,e){let{name:n,intent:i,usage:s,rbGroups:r}=e;this.#qn=!!(t&En),this.#Zn=!!(t&Cn),this.name=n,this.intent=i,this.usage=s,this.rbGroups=r}get visible(){if(this.#Kn)return this.#Xn;if(!this.#Xn)return!1;const{print:t,view:e}=this.usage;return this.#qn?"OFF"!==e?.viewState:!this.#Zn||"OFF"!==t?.printState}_setVisible(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t!==Pr&&ai("Internal method `_setVisible` called."),this.#Kn=n,this.#Xn=e}}class Mr{#Yn=null;#Jn=(()=>new Map)();#Qn=null;#ti=null;constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:En;if(this.renderingIntent=e,this.name=null,this.creator=null,null!==t){this.name=t.name,this.creator=t.creator,this.#ti=t.order;for(const n of t.groups)this.#Jn.set(n.id,new Lr(e,n));if("OFF"===t.baseState)for(const t of this.#Jn.values())t._setVisible(Pr,!1);for(const e of t.on)this.#Jn.get(e)._setVisible(Pr,!0);for(const e of t.off)this.#Jn.get(e)._setVisible(Pr,!1);this.#Qn=this.getHash()}}#ei(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let i=1;i<e;i++){const e=t[i];let s;if(Array.isArray(e))s=this.#ei(e);else{if(!this.#Jn.has(e))return oi(`Optional content group not found: ${e}`),!0;s=this.#Jn.get(e).visible}switch(n){case"And":if(!s)return!1;break;case"Or":if(s)return!0;break;case"Not":return!s;default:return!0}}return"And"===n}isVisible(t){if(0===this.#Jn.size)return!0;if(!t)return ri("Optional content group not defined."),!0;if("OCG"===t.type)return this.#Jn.has(t.id)?this.#Jn.get(t.id).visible:(oi(`Optional content group not found: ${t.id}`),!0);if("OCMD"===t.type){if(t.expression)return this.#ei(t.expression);if(!t.policy||"AnyOn"===t.policy){for(const e of t.ids){if(!this.#Jn.has(e))return oi(`Optional content group not found: ${e}`),!0;if(this.#Jn.get(e).visible)return!0}return!1}if("AllOn"===t.policy){for(const e of t.ids){if(!this.#Jn.has(e))return oi(`Optional content group not found: ${e}`),!0;if(!this.#Jn.get(e).visible)return!1}return!0}if("AnyOff"===t.policy){for(const e of t.ids){if(!this.#Jn.has(e))return oi(`Optional content group not found: ${e}`),!0;if(!this.#Jn.get(e).visible)return!0}return!1}if("AllOff"===t.policy){for(const e of t.ids){if(!this.#Jn.has(e))return oi(`Optional content group not found: ${e}`),!0;if(this.#Jn.get(e).visible)return!1}return!0}return oi(`Unknown optional content policy ${t.policy}.`),!0}return oi(`Unknown group type ${t.type}.`),!0}setVisibility(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this.#Jn.get(t);if(i){if(n&&e&&i.rbGroups.length)for(const e of i.rbGroups)for(const n of e)n!==t&&this.#Jn.get(n)?._setVisible(Pr,!1,!0);i._setVisible(Pr,!!e,!0),this.#Yn=null}else oi(`Optional content group not found: ${t}`)}setOCGState(t){let e,{state:n,preserveRB:i}=t;for(const s of n){switch(s){case"ON":case"OFF":case"Toggle":e=s;continue}const t=this.#Jn.get(s);if(t)switch(e){case"ON":this.setVisibility(s,!0,i);break;case"OFF":this.setVisibility(s,!1,i);break;case"Toggle":this.setVisibility(s,!t.visible,i)}}this.#Yn=null}get hasInitialVisibility(){return null===this.#Qn||this.getHash()===this.#Qn}getOrder(){return this.#Jn.size?this.#ti?this.#ti.slice():[...this.#Jn.keys()]:null}getGroup(t){return this.#Jn.get(t)||null}getHash(){if(null!==this.#Yn)return this.#Yn;const t=new us;for(const[e,n]of this.#Jn)t.update(`${e}:${n.visible}`);return this.#Yn=t.hexdigest()}[Symbol.iterator](){return this.#Jn.entries()}}class Ir{constructor(t,e){let{disableRange:n=!1,disableStream:i=!1}=e;li(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:o,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,r?.length>0){const t=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(t)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!n,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((t,e)=>{this._onReceiveData({begin:t,chunk:e})}),t.addProgressListener((t,e)=>{this._onProgress({loaded:t,total:e})}),t.addProgressiveReadListener(t=>{this._onReceiveData({chunk:t})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData(t){let{begin:e,chunk:n}=t;const i=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;if(void 0===e)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{li(this._rangeReaders.some(function(t){return t._begin===e&&(t._enqueue(i),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){void 0===t.total?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){li(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Rr(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new Dr(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class Rr{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._stream=t,this._done=n||!1,this._filename=Ni(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length>0){this._requests.shift().resolve({value:t,done:!1})}else this._queuedChunks.push(t);this._loaded+=t.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){return{value:this._queuedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Dr{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Or(t,e){const n=new Headers;if(!t||!e||"object"!==typeof e)return n;for(const i in e){const t=e[i];void 0!==t&&n.append(i,t)}return n}function Nr(t){return URL.parse(t)?.origin??null}function zr(t){let{responseHeaders:e,isHttp:n,rangeChunkSize:i,disableRange:s}=t;const r={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(e.get("Content-Length"),10);if(!Number.isInteger(o))return r;if(r.suggestedLength=o,o<=2*i)return r;if(s||!n)return r;if("bytes"!==e.get("Accept-Ranges"))return r;return"identity"!==(e.get("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r}function Fr(t){const e=t.get("Content-Disposition");if(e){let t=function(t){let e=!0,n=i("filename\\*","i").exec(t);if(n){n=n[1];let t=o(n);return t=unescape(t),t=a(t),t=l(t),r(t)}if(n=function(t){const e=[];let n;const s=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=s.exec(t));){let[,t,i,s]=n;if(t=parseInt(t,10),t in e){if(0===t)break}else e[t]=[i,s]}const r=[];for(let i=0;i<e.length&&i in e;++i){let[t,n]=e[i];n=o(n),t&&(n=unescape(n),0===i&&(n=a(n))),r.push(n)}return r.join("")}(t),n)return r(l(n));if(n=i("filename","i").exec(t),n){n=n[1];let t=o(n);return t=l(t),r(t)}function i(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function s(t,n){if(t){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const i=new TextDecoder(t,{fatal:!0}),s=_i(n);n=i.decode(s),e=!1}catch{}}return n}function r(t){return e&&/[\x80-\xff]/.test(t)&&(t=s("utf-8",t),e&&(t=s("iso-8859-1",t))),t}function o(t){if(t.startsWith('"')){const e=t.slice(1).split('\\"');for(let t=0;t<e.length;++t){const n=e[t].indexOf('"');-1!==n&&(e[t]=e[t].slice(0,n),e.length=t+1),e[t]=e[t].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function a(t){const e=t.indexOf("'");return-1===e?t:s(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function l(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(t,e,n,i){if("q"===n||"Q"===n)return s(e,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(t,e){return String.fromCharCode(parseInt(e,16))}));try{i=atob(i)}catch{}return s(e,i)})}return""}(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Ni(t))return t}return null}function jr(t,e){return new mi(`Unexpected server response (${t}) while retrieving PDF "${e}".`,t,404===t||0===t&&e.startsWith("file:"))}function Br(t){return 200===t||206===t}function Ur(t,e,n){return{method:"GET",headers:t,signal:n.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Hr(t){return t instanceof Uint8Array?t.buffer:t instanceof ArrayBuffer?t:(oi(`getArrayBuffer - unexpected data format: ${t}`),new Uint8Array(t).buffer)}class $r{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Or(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return li(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Wr(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new Vr(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Wr{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),i=e.url;fetch(i,Ur(n,this._withCredentials,this._abortController)).then(e=>{if(t._responseOrigin=Nr(e.url),!Br(e.status))throw jr(e.status,i);this._reader=e.body.getReader(),this._headersCapability.resolve();const n=e.headers,{allowRangeRequests:s,suggestedLength:r}=zr({responseHeaders:n,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=r||this._contentLength,this._filename=Fr(n),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new yi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Hr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Vr{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const s=new Headers(t.headers);s.append("Range",`bytes=${e}-${n-1}`);const r=i.url;fetch(r,Ur(s,this._withCredentials,this._abortController)).then(e=>{const n=Nr(e.url);if(n!==t._responseOrigin)throw new Error(`Expected range response-origin "${n}" to match "${t._responseOrigin}".`);if(!Br(e.status))throw jr(e.status,r);this._readCapability.resolve(),this._reader=e.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Hr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Gr{_responseOrigin=null;constructor(t){let{url:e,httpHeaders:n,withCredentials:i}=t;this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=Or(this.isHttp,n),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[s,r]of this.headers)e.setRequestHeader(s,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=206):i.expectedStatus=200,e.responseType="arraybuffer",li(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4!==i.readyState)return;if(!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],0===i.status&&this.isHttp)return void n.onError(i.status);const s=i.status||200;if(!(200===s&&206===n.expectedStatus)&&s!==n.expectedStatus)return void n.onError(i.status);const r=function(t){const e=t.response;return"string"!==typeof e?e:_i(e).buffer}(i);if(206===s){const t=i.getResponseHeader("Content-Range"),e=/bytes (\d+)-(\d+)\/(\d+)/.exec(t);e?n.onDone({begin:parseInt(e[1],10),chunk:r}):(oi('Missing or invalid "Content-Range" header.'),n.onError(0))}else r?n.onDone({begin:0,chunk:r}):n.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class qr{constructor(t){this._source=t,this._manager=new Gr(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return li(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Zr(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new Kr(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Zr{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Nr(e.responseURL);const n=e.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(t=>{const[e,...n]=t.split(": ");return[e,n.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:r}=zr({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Fr(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t)if(this._requests.length>0){this._requests.shift().resolve({value:t.chunk,done:!1})}else this._cachedChunks.push(t.chunk);if(this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=jr(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0){return{value:this._cachedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Kr{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Nr(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;if(this._requests.length>0){this._requests.shift().resolve({value:e,done:!1})}else this._queuedChunk=e;this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=jr(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Xr=/^[a-z][a-z0-9\-+.]+:/i;class Yr{constructor(t){this.source=t,this.url=function(t){if(Xr.test(t))return new URL(t);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(t))}(t.url),li("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return li(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Jr(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new Qr(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Jr{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(t=>{this._contentLength=t.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},t=>{"ENOENT"===t.code&&(t=jr(0,this._url.href)),this._storedError=t,this._headersCapability.reject(t)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();if(null===t)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:new Uint8Array(t).buffer,done:!1}}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new yi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Qr{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();if(null===t)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=t.length,this.onProgress?.({loaded:this._loaded});return{value:new Uint8Array(t).buffer,done:!1}}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const to=Symbol("INITIAL_DATA");class eo{#ni=(()=>Object.create(null))();#ii(t){return this.#ni[t]||={...Promise.withResolvers(),data:to}}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){const n=this.#ii(t);return n.promise.then(()=>e(n.data)),null}const n=this.#ni[t];if(!n||n.data===to)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#ni[t];return!!e&&e.data!==to}delete(t){const e=this.#ni[t];return!(!e||e.data===to)&&(delete this.#ni[t],!0)}resolve(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#ii(t);n.data=e,n.resolve()}clear(){for(const t in this.#ni){const{data:e}=this.#ni[t];e?.bitmap?.close()}this.#ni=Object.create(null)}*[Symbol.iterator](){for(const t in this.#ni){const{data:e}=this.#ni[t];e!==to&&(yield[t,e])}}}class no{#si=(()=>Promise.withResolvers())();#vt=null;#ri=!1;#oi=(()=>!!globalThis.FontInspector?.enabled)();#ai=null;#li=null;#ci=0;#hi=0;#ui=null;#di=null;#pi=0;#fi=0;#gi=(()=>Object.create(null))();#mi=[];#vi=null;#yi=[];#bi=(()=>new WeakMap)();#_i=null;static#wi=(()=>new Map)();static#xi=(()=>new Map)();static#Si=(()=>new WeakMap)();static#Ai=null;static#ki=(()=>new Set)();constructor(t){let{textContentSource:e,container:n,viewport:i}=t;if(e instanceof ReadableStream)this.#vi=e;else{if("object"!==typeof e)throw new Error('No "textContentSource" parameter specified.');this.#vi=new ReadableStream({start(t){t.enqueue(e),t.close()}})}this.#vt=this.#di=n,this.#fi=i.scale*Gi.pixelRatio,this.#pi=i.rotation,this.#li={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:r,pageX:o,pageY:a}=i.rawDims;this.#_i=[1,0,0,-1,-o,a+r],this.#hi=s,this.#ci=r,no.#Ei(),Vi(n,i),this.#si.promise.finally(()=>{no.#ki.delete(this),this.#li=null,this.#gi=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=wi.platform;return ui(this,"fontFamilyMap",new Map([["sans-serif",(t&&e?"Calibri, ":"")+"sans-serif"],["monospace",(t&&e?"Lucida Console, ":"")+"monospace"]]))}render(){const t=()=>{this.#ui.read().then(e=>{let{value:n,done:i}=e;i?this.#si.resolve():(this.#ai??=n.lang,Object.assign(this.#gi,n.styles),this.#Ci(n.items),t())},this.#si.reject)};return this.#ui=this.#vi.getReader(),no.#ki.add(this),t(),this.#si.promise}update(t){let{viewport:e,onBefore:n=null}=t;const i=e.scale*Gi.pixelRatio,s=e.rotation;if(s!==this.#pi&&(n?.(),this.#pi=s,Vi(this.#di,{rotation:s})),i!==this.#fi){n?.(),this.#fi=i;const t={div:null,properties:null,ctx:no.#Ti(this.#ai)};for(const e of this.#yi)t.properties=this.#bi.get(e),t.div=e,this.#Pi(t)}}cancel(){const t=new yi("TextLayer task cancelled.");this.#ui?.cancel(t).catch(()=>{}),this.#ui=null,this.#si.reject(t)}get textDivs(){return this.#yi}get textContentItemsStr(){return this.#mi}#Ci(t){if(this.#ri)return;this.#li.ctx??=no.#Ti(this.#ai);const e=this.#yi,n=this.#mi;for(const i of t){if(e.length>1e5)return oi("Ignoring additional textDivs for performance reasons."),void(this.#ri=!0);if(void 0!==i.str)n.push(i.str),this.#Li(i);else if("beginMarkedContentProps"===i.type||"beginMarkedContent"===i.type){const t=this.#vt;this.#vt=document.createElement("span"),this.#vt.classList.add("markedContent"),i.id&&this.#vt.setAttribute("id",`${i.id}`),t.append(this.#vt)}else"endMarkedContent"===i.type&&(this.#vt=this.#vt.parentNode)}}#Li(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};this.#yi.push(e);const i=Si.transform(this.#_i,t.transform);let s=Math.atan2(i[1],i[0]);const r=this.#gi[t.fontName];r.vertical&&(s+=Math.PI/2);let o=this.#oi&&r.fontSubstitution||r.fontFamily;o=no.fontFamilyMap.get(o)||o;const a=Math.hypot(i[2],i[3]),l=a*no.#Mi(o,r,this.#ai);let c,h;0===s?(c=i[4],h=i[5]-l):(c=i[4]+l*Math.sin(s),h=i[5]-l*Math.cos(s));const u="calc(var(--total-scale-factor) *",d=e.style;this.#vt===this.#di?(d.left=`${(100*c/this.#hi).toFixed(2)}%`,d.top=`${(100*h/this.#ci).toFixed(2)}%`):(d.left=`${u}${c.toFixed(2)}px)`,d.top=`${u}${h.toFixed(2)}px)`),d.fontSize=`${u}${(no.#Ai*a).toFixed(2)}px)`,d.fontFamily=o,n.fontSize=a,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#oi&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),0!==s&&(n.angle=s*(180/Math.PI));let p=!1;if(t.str.length>1)p=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){const e=Math.abs(t.transform[0]),n=Math.abs(t.transform[3]);e!==n&&Math.max(e,n)/Math.min(e,n)>1.5&&(p=!0)}if(p&&(n.canvasWidth=r.vertical?t.height:t.width),this.#bi.set(e,n),this.#li.div=e,this.#li.properties=n,this.#Pi(this.#li),n.hasText&&this.#vt.append(e),n.hasEOL){const t=document.createElement("br");t.setAttribute("role","presentation"),this.#vt.append(t)}}#Pi(t){const{div:e,properties:n,ctx:i}=t,{style:s}=e;let r="";if(no.#Ai>1&&(r=`scale(${1/no.#Ai})`),0!==n.canvasWidth&&n.hasText){const{fontFamily:t}=s,{canvasWidth:o,fontSize:a}=n;no.#Ii(i,a*this.#fi,t);const{width:l}=i.measureText(e.textContent);l>0&&(r=`scaleX(${o*this.#fi/l}) ${r}`)}0!==n.angle&&(r=`rotate(${n.angle}deg) ${r}`),r.length>0&&(s.transform=r)}static cleanup(){if(!(this.#ki.size>0)){this.#wi.clear();for(const{canvas:t}of this.#xi.values())t.remove();this.#xi.clear()}}static#Ti(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.#xi.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#xi.set(t,e),this.#Si.set(e,{size:0,family:""})}return e}static#Ii(t,e,n){const i=this.#Si.get(t);e===i.size&&n===i.family||(t.font=`${e}px ${n}`,i.size=e,i.family=n)}static#Ei(){if(null!==this.#Ai)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#Ai=t.getBoundingClientRect().height,t.remove()}static#Mi(t,e,n){const i=this.#wi.get(t);if(i)return i;const s=this.#Ti(n);s.canvas.width=s.canvas.height=30,this.#Ii(s,30,t);const r=s.measureText(""),o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let l=.8;return o?l=o/(o+a):(wi.platform.isFirefox&&oi("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?l=e.ascent:e.descent&&(l=1+e.descent)),this.#wi.set(t,l),l}}class io{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};return function t(n){if(!n)return;let i=null;const s=n.name;if("#text"===s)i=n.value;else{if(!io.shouldBuildText(s))return;n?.attributes?.textContent?i=n.attributes.textContent:n.value&&(i=n.value)}if(null!==i&&e.push({str:i}),n.children)for(const e of n.children)t(e)}(t),n}static shouldBuildText(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}function so(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"string"===typeof t||t instanceof URL?t={url:t}:(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e=new ro,{docId:n}=e,i=t.url?function(t){if(t instanceof URL)return t.href;if("string"===typeof t){if(xn)return t;const e=URL.parse(t,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(t.url):null,s=t.data?function(t){if(xn&&"undefined"!==typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"===typeof t)return _i(t);if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||"object"===typeof t&&!isNaN(t?.length))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(t.data):null,r=t.httpHeaders||null,o=!0===t.withCredentials,a=t.password??null,l=t.range instanceof oo?t.range:null,c=Number.isInteger(t.rangeChunkSize)&&t.rangeChunkSize>0?t.rangeChunkSize:65536;let h=t.worker instanceof co?t.worker:null;const u=t.verbosity,d="string"!==typeof t.docBaseUrl||Oi(t.docBaseUrl)?null:t.docBaseUrl,p=vs(t.cMapUrl),f=!1!==t.cMapPacked,g=t.CMapReaderFactory||(xn?qs:zs),m=vs(t.iccUrl),v=vs(t.standardFontDataUrl),y=t.StandardFontDataFactory||(xn?Zs:Us),b=vs(t.wasmUrl),_=t.WasmFactory||(xn?Ks:$s),w=!0!==t.stopAtErrors,x=Number.isInteger(t.maxImageSize)&&t.maxImageSize>-1?t.maxImageSize:-1,S=!1!==t.isEvalSupported,A="boolean"===typeof t.isOffscreenCanvasSupported?t.isOffscreenCanvasSupported:!xn,k="boolean"===typeof t.isImageDecoderSupported?t.isImageDecoderSupported:!xn&&(wi.platform.isFirefox||!globalThis.chrome),E=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1,C="boolean"===typeof t.disableFontFace?t.disableFontFace:xn,T=!0===t.fontExtraProperties,P=!0===t.enableXfa,L=t.ownerDocument||globalThis.document,M=!0===t.disableRange,I=!0===t.disableStream,R=!0===t.disableAutoFetch,D=!0===t.pdfBug,O=t.CanvasFactory||(xn?Gs:Os),N=t.FilterFactory||(xn?Vs:js),z=!0===t.enableHWA,F=!1!==t.useWasm,j=l?l.length:t.length??NaN,B="boolean"===typeof t.useSystemFonts?t.useSystemFonts:!xn&&!C,U="boolean"===typeof t.useWorkerFetch?t.useWorkerFetch:!!(g===zs&&y===Us&&_===$s&&p&&v&&b&&Fi(p,document.baseURI)&&Fi(v,document.baseURI)&&Fi(b,document.baseURI));ii(u);const H={canvasFactory:new O({ownerDocument:L,enableHWA:z}),filterFactory:new N({docId:n,ownerDocument:L}),cMapReaderFactory:U?null:new g({baseUrl:p,isCompressed:f}),standardFontDataFactory:U?null:new y({baseUrl:v}),wasmFactory:U?null:new _({baseUrl:b})};h||(h=co.create({verbosity:u,port:Cr.workerPort}),e._worker=h);const $={docId:n,apiVersion:"5.4.54",data:s,password:a,disableAutoFetch:R,rangeChunkSize:c,length:j,docBaseUrl:d,enableXfa:P,evaluatorOptions:{maxImageSize:x,disableFontFace:C,ignoreErrors:w,isEvalSupported:S,isOffscreenCanvasSupported:A,isImageDecoderSupported:k,canvasMaxAreaInBytes:E,fontExtraProperties:T,useSystemFonts:B,useWasm:F,useWorkerFetch:U,cMapUrl:p,iccUrl:m,standardFontDataUrl:v,wasmUrl:b}},W={ownerDocument:L,pdfBug:D,styleElement:null,loadingParams:{disableAutoFetch:R,enableXfa:P}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const t=h.messageHandler.sendWithPromise("GetDocRequest",$,s?[s.buffer]:null);let a;if(l)a=new Ir(l,{disableRange:M,disableStream:I});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const t=Fi(i)?$r:xn?Yr:qr;a=new t({url:i,length:j,httpHeaders:r,withCredentials:o,rangeChunkSize:c,disableRange:M,disableStream:I})}return t.then(t=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const i=new Rs(n,t,h.port),s=new ho(i,e,a,W,H,z);e._transport=s,i.send("Ready",null)})}).catch(e._capability.reject),e}class ro{static#En=0;_capability=(()=>Promise.withResolvers())();_transport=null;_worker=null;docId=(()=>"d"+ro.#En++)();destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await(this._transport?.destroy())}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class oo{#si=(()=>Promise.withResolvers())();#Ri=[];#Di=[];#Oi=[];#Ni=[];constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=i}addRangeListener(t){this.#Ni.push(t)}addProgressListener(t){this.#Oi.push(t)}addProgressiveReadListener(t){this.#Di.push(t)}addProgressiveDoneListener(t){this.#Ri.push(t)}onDataRange(t,e){for(const n of this.#Ni)n(t,e)}onDataProgress(t,e){this.#si.promise.then(()=>{for(const n of this.#Oi)n(t,e)})}onDataProgressiveRead(t){this.#si.promise.then(()=>{for(const e of this.#Di)e(t)})}onDataProgressiveDone(){this.#si.promise.then(()=>{for(const t of this.#Ri)t()})}transportReady(){this.#si.resolve()}requestDataRange(t,e){ai("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class ao{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ui(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){let{intent:t="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class lo{#zi=!1;constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=i?new zi:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new eo,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ri({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:s})}getAnnotations(){let{intent:t="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ui(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render(t){let{canvasContext:e,canvas:n=e.canvas,viewport:i,intent:s="display",annotationMode:r=Rn.ENABLE,transform:o=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:h=null,printAnnotationStorage:u=null,isEditing:d=!1}=t;this._stats?.time("Overall");const p=this._transport.getRenderingIntent(s,r,u,d),{renderingIntent:f,cacheKey:g}=p;this.#zi=!1,l||=this._transport.getOptionalContentConfig(f);let m=this._intentStates.get(g);m||(m=Object.create(null),this._intentStates.set(g,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);const v=!!(f&Cn);m.displayReadyCapability||(m.displayReadyCapability=Promise.withResolvers(),m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(p));const y=t=>{m.renderTasks.delete(b),v&&(this.#zi=!0),this.#Fi(),t?(b.capability.reject(t),this._abortOperatorList({intentState:m,reason:t instanceof Error?t:new Error(t)})):b.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},b=new po({callback:y,params:{canvas:n,canvasContext:e,viewport:i,transform:o,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA});(m.renderTasks||=new Set).add(b);const _=b.task;return Promise.all([m.displayReadyCapability.promise,l]).then(t=>{let[e,n]=t;if(this.destroyed)y();else{if(this._stats?.time("Rendering"),!(n.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");b.initializeGraphics({transparency:e,optionalContentConfig:n}),b.operatorListChanged()}}).catch(y),_}getOperatorList(){let{intent:t="display",annotationMode:e=Rn.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this._transport.getRenderingIntent(t,e,n,i,!0);let r,o=this._intentStates.get(s.cacheKey);return o||(o=Object.create(null),this._intentStates.set(s.cacheKey,o)),o.opListReadCapability||(r=Object.create(null),r.operatorListChanged=function(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(r))},o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(r),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s)),o.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:t=!1,disableNormalization:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===t,disableNormalization:!0===e},{highWaterMark:100,size:t=>t.items.length})}getTextContent(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(t=>io.textContent(t));const e=this.streamTextContent(t);return new Promise(function(t,n){const i=e.getReader(),s={items:[],styles:Object.create(null),lang:null};!function e(){i.read().then(function(n){let{value:i,done:r}=n;r?t(s):(s.lang??=i.lang,Object.assign(s.styles,i.styles),s.items.push(...i.items),e())},n)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#zi=!1,Promise.all(t)}cleanup(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#zi=!0;const e=this.#Fi();return t&&e&&(this._stats&&=new zi),e}#Fi(){if(!this.#zi||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#zi=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,i=t.length;n<i;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&this.#Fi()}_pumpOperatorList(t){let{renderingIntent:e,cacheKey:n,annotationStorageSerializable:i,modifiedIds:s}=t;const{map:r,transfer:o}=i,a=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:n,annotationStorage:r,modifiedIds:s},o).getReader(),l=this._intentStates.get(n);l.streamReader=a;const c=()=>{a.read().then(t=>{let{value:e,done:n}=t;n?l.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,l),c())},t=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const t of l.renderTasks)t.operatorListChanged();this.#Fi()}if(l.displayReadyCapability)l.displayReadyCapability.reject(t);else{if(!l.opListReadCapability)throw t;l.opListReadCapability.reject(t)}}})};c()}_abortOperatorList(t){let{intentState:e,reason:n,force:i=!1}=t;if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(n instanceof Di){let t=100;return n.extraDelay>0&&n.extraDelay<1e3&&(t+=n.extraDelay),void(e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:n,force:!0})},t))}}if(e.streamReader.cancel(new yi(n.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[t,n]of this._intentStates)if(n===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}class co{#si=(()=>Promise.withResolvers())();#ji=null;#$n=null;#Bi=null;static#Ui=0;static#Hi=!1;static#$i=(()=>new WeakMap)();static#Wi=(()=>{xn&&(this.#Hi=!0,Cr.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||"null"===n.origin)return!1;const i=new URL(e,n);return n.origin===i.origin},this._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},this.fromPort=t=>{var e;if(e="`PDFWorker.fromPort` - please use `PDFWorker.create` instead.",console.log("Deprecated API usage: "+e),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.create(t)}})();constructor(){let{name:t=null,port:e=null,verbosity:n=si()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(co.#$i.has(e))throw new Error("Cannot use more than one PDFWorker per port.");co.#$i.set(e,this),this.#Vi(e)}else this.#Gi()}get promise(){return this.#si.promise}#qi(){this.#si.resolve(),this.#ji.send("configure",{verbosity:this.verbosity})}get port(){return this.#$n}get messageHandler(){return this.#ji}#Vi(t){this.#$n=t,this.#ji=new Rs("main","worker",t),this.#ji.on("ready",()=>{}),this.#qi()}#Gi(){if(co.#Hi||co.#Zi)return void this.#Ki();let{workerSrc:t}=co;try{co._isSameOrigin(window.location,t)||(t=co._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new Rs("main","worker",e),i=()=>{s.abort(),n.destroy(),e.terminate(),this.destroyed?this.#si.reject(new Error("Worker was destroyed")):this.#Ki()},s=new AbortController;e.addEventListener("error",()=>{this.#Bi||i()},{signal:s.signal}),n.on("test",t=>{s.abort(),!this.destroyed&&t?(this.#ji=n,this.#$n=e,this.#Bi=e,this.#qi()):i()}),n.on("ready",t=>{if(s.abort(),this.destroyed)i();else try{r()}catch{this.#Ki()}});const r=()=>{const t=new Uint8Array;n.send("test",t,[t.buffer])};return void r()}catch{ri("The worker has been disabled.")}this.#Ki()}#Ki(){co.#Hi||(oi("Setting up fake worker."),co.#Hi=!0),co._setupFakeWorkerGlobal.then(t=>{if(this.destroyed)return void this.#si.reject(new Error("Worker was destroyed"));const e=new _s;this.#$n=e;const n="fake"+co.#Ui++,i=new Rs(n+"_worker",n,e);t.setup(i,e),this.#ji=new Rs(n,n+"_worker",e),this.#qi()}).catch(t=>{this.#si.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this.#Bi?.terminate(),this.#Bi=null,co.#$i.delete(this.#$n),this.#$n=null,this.#ji?.destroy(),this.#ji=null}static create(t){const e=this.#$i.get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new co(t)}static get workerSrc(){if(Cr.workerSrc)return Cr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#Zi(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return ui(this,"_setupFakeWorkerGlobal",(async()=>{if(this.#Zi)return this.#Zi;return(await import(this.workerSrc)).WorkerMessageHandler})())}}class ho{#Xi=(()=>new Map)();#Yi=(()=>new Map)();#Ji=(()=>new Map)();#Qi=(()=>new Map)();#ts=null;constructor(t,e,n,i,s,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new eo,this.fontLoader=new gs({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#es(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#Xi.get(t);if(n)return n;const i=this.messageHandler.sendWithPromise(t,e);return this.#Xi.set(t,i),i}get annotationStorage(){return ui(this,"annotationStorage",new ps)}getRenderingIntent(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rn.ENABLE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=En,o=ds;switch(t){case"any":r=kn;break;case"display":break;case"print":r=Cn;break;default:oi(`getRenderingIntent - invalid intent: ${t}`)}const a=r&Cn&&n instanceof fs?n:this.annotationStorage;switch(e){case Rn.DISABLE:r+=Ln;break;case Rn.ENABLE:break;case Rn.ENABLE_FORMS:r+=Tn;break;case Rn.ENABLE_STORAGE:r+=Pn,o=a.serializable;break;default:oi(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=Mn),s&&(r+=In);const{ids:l,hash:c}=a.modifiedIds;return{renderingIntent:r,cacheKey:[r,o.hash,c].join("_"),annotationStorageSerializable:o,modifiedIds:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#ts?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#Yi.values())t.push(n._destroy());this.#Yi.clear(),this.#Ji.clear(),this.#Qi.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#Xi.clear(),this.filterFactory.destroy(),no.cleanup(),this._networkStream?.cancelAllRequests(new yi("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(t,e)=>{li(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=t=>{this._lastProgress={loaded:t.loaded,total:t.total}},e.onPull=()=>{this._fullReader.read().then(function(t){let{value:n,done:i}=t;i?e.close():(li(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),e.enqueue(new Uint8Array(n),1,[n]))}).catch(t=>{e.error(t)})},e.onCancel=t=>{this._fullReader.cancel(t),e.ready.catch(t=>{if(!this.destroyed)throw t})}}),t.on("ReaderHeadersReady",async t=>{await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:i,contentLength:s}=this._fullReader;return n&&i||(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=t=>{e.onProgress?.({loaded:t.loaded,total:t.total})}),{isStreamingSupported:n,isRangeSupported:i,contentLength:s}}),t.on("GetRangeReader",(t,e)=>{li(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(t.begin,t.end);n?(e.onPull=()=>{n.read().then(function(t){let{value:n,done:i}=t;i?e.close():(li(n instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),e.enqueue(new Uint8Array(n),1,[n]))}).catch(t=>{e.error(t)})},e.onCancel=t=>{n.cancel(t),e.ready.catch(t=>{if(!this.destroyed)throw t})}):e.close()}),t.on("GetDoc",t=>{let{pdfInfo:n}=t;this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new ao(n,this))}),t.on("DocException",t=>{e._capability.reject(Is(t))}),t.on("PasswordRequest",t=>{this.#ts=Promise.withResolvers();try{if(!e.onPassword)throw Is(t);const n=t=>{t instanceof Error?this.#ts.reject(t):this.#ts.resolve({password:t})};e.onPassword(n,t.code)}catch(n){this.#ts.reject(n)}return this.#ts.promise}),t.on("DataLoaded",t=>{e.onProgress?.({loaded:t.length,total:t.length}),this.downloadInfoCapability.resolve(t)}),t.on("StartRenderPage",t=>{if(this.destroyed)return;this.#Yi.get(t.pageIndex)._startRenderPage(t.transparency,t.cacheKey)}),t.on("commonobj",e=>{let[n,i,s]=e;if(this.destroyed)return null;if(this.commonObjs.has(n))return null;switch(i){case"Font":if("error"in s){const t=s.error;oi(`Error during font loading: ${t}`),this.commonObjs.resolve(n,t);break}const e=this._params.pdfBug&&globalThis.FontInspector?.enabled?(t,e)=>globalThis.FontInspector.fontAdded(t,e):null,r=new ms(s,e);this.fontLoader.bind(r).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!r.fontExtraProperties&&r.data&&(r.data=null),this.commonObjs.resolve(n,r)});break;case"CopyLocalImage":const{imageRef:o}=s;li(o,"The imageRef must be defined.");for(const t of this.#Yi.values())for(const[,e]of t.objs)if(e?.ref===o)return e.dataLen?(this.commonObjs.resolve(n,structuredClone(e)),e.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,s);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",t=>{let[e,n,i,s]=t;if(this.destroyed)return;const r=this.#Yi.get(n);if(!r.objs.has(e))if(0!==r._intentStates.size)switch(i){case"Image":case"Pattern":r.objs.resolve(e,s);break;default:throw new Error(`Got unknown object type ${i}`)}else s?.bitmap?.close()}),t.on("DocProgress",t=>{this.destroyed||e.onProgress?.({loaded:t.loaded,total:t.total})}),t.on("FetchBinaryData",async t=>{if(this.destroyed)throw new Error("Worker was destroyed.");const e=this[t.type];if(!e)throw new Error(`${t.type} not initialized, see the \`useWorkerFetch\` parameter.`);return e.fetch(t)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&oi("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#Ji.get(e);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#Qi.set(n.refStr,t);const i=new lo(e,n,this,this._params.pdfBug);return this.#Yi.set(e,i),i});return this.#Ji.set(e,i),i}getPageIndex(t){return ys(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#es("GetFieldObjects")}hasJSActions(){return this.#es("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return"string"!==typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#es("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#es("GetOptionalContentConfig").then(e=>new Mr(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#Xi.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(t=>({info:t[0],metadata:t[1]?new Tr(t[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#Xi.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#Yi.values()){if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`)}this.commonObjs.clear(),t||this.fontLoader.clear(),this.#Xi.clear(),this.filterFactory.destroy(!0),no.cleanup()}}cachedPageNumber(t){if(!ys(t))return null;const e=0===t.gen?`${t.num}R`:`${t.num}R${t.gen}`;return this.#Qi.get(e)??null}}class uo{#ns=null;onContinue=null;onError=null;constructor(t){this.#ns=t}get promise(){return this.#ns.capability.promise}cancel(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.#ns.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#ns.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#ns;return t.form||t.canvas&&e?.size>0}}class po{#is=null;static#ss=(()=>new WeakSet)();constructor(t){let{callback:e,params:n,objs:i,commonObjs:s,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:u=!1,pageColors:d=null,enableHWA:p=!1}=t;this.callback=e,this.params=n,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===h&&"undefined"!==typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new uo(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=n.canvas,this._canvasContext=n.canvas?null:n.canvasContext,this._enableHWA=p}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(t){let{transparency:e=!1,optionalContentConfig:n}=t;if(this.cancelled)return;if(this._canvas){if(po.#ss.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");po.#ss.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:s,background:r}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Er(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:n},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:i,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#is&&(window.cancelAnimationFrame(this.#is),this.#is=null),po.#ss.delete(this._canvas),t||=new Di(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){this.graphicsReady?(this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#is=window.requestAnimationFrame(()=>{this.#is=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),po.#ss.delete(this._canvas),this.callback())))}}class fo{#rs=null;#os=null;#as;#ls=null;#cs=!1;#hs=!1;#r=null;#us;#ds=null;#m=null;static#ps=null;static get _keyboardManager(){return ui(this,"_keyboardManager",new ts([[["Escape","mac+Escape"],fo.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],fo.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],fo.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],fo.prototype._moveToPrevious],[["Home","mac+Home"],fo.prototype._moveToBeginning],[["End","mac+End"],fo.prototype._moveToEnd]]))}constructor(t){let{editor:e=null,uiManager:n=null}=t;e?(this.#hs=!1,this.#r=e):this.#hs=!0,this.#m=e?._uiManager||n,this.#us=this.#m._eventBus,this.#as=e?.color?.toUpperCase()||this.#m?.highlightColors.values().next().value||"#FFFF98",fo.#ps||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#rs=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#m._signal;t.addEventListener("click",this.#fs.bind(this),{signal:e}),t.addEventListener("keydown",this.#gs.bind(this),{signal:e});const n=this.#os=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#as,t.append(n),t}renderMainDropdown(){const t=this.#ls=this.#ms();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#ms(){const t=document.createElement("div"),e=this.#m._signal;t.addEventListener("contextmenu",ji,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,i]of this.#m.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",i),s.title=n,s.setAttribute("data-l10n-id",fo.#ps[n]);const r=document.createElement("span");s.append(r),r.className="swatch",r.style.backgroundColor=i,s.ariaSelected=i===this.#as,s.addEventListener("click",this.#vs.bind(this,i),{signal:e}),t.append(s)}return t.addEventListener("keydown",this.#gs.bind(this),{signal:e}),t}#vs(t,e){e.stopPropagation(),this.#us.dispatch("switchannotationeditorparams",{source:this,type:Nn.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#rs)return void this.#fs(t);const e=t.target.getAttribute("data-color");e&&this.#vs(e,t)}_moveToNext(t){this.#ys?t.target!==this.#rs?t.target.nextSibling?.focus():this.#ls.firstChild?.focus():this.#fs(t)}_moveToPrevious(t){t.target!==this.#ls?.firstChild&&t.target!==this.#rs?(this.#ys||this.#fs(t),t.target.previousSibling?.focus()):this.#ys&&this._hideDropdownFromKeyboard()}_moveToBeginning(t){this.#ys?this.#ls.firstChild?.focus():this.#fs(t)}_moveToEnd(t){this.#ys?this.#ls.lastChild?.focus():this.#fs(t)}#gs(t){fo._keyboardManager.exec(this,t)}#fs(t){if(this.#ys)return void this.hideDropdown();if(this.#cs=0===t.detail,this.#ds||(this.#ds=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#m.combinedSignal(this.#ds)})),this.#rs.ariaExpanded="true",this.#ls)return void this.#ls.classList.remove("hidden");const e=this.#ls=this.#ms();this.#rs.append(e)}#u(t){this.#ls?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#ls?.classList.add("hidden"),this.#rs.ariaExpanded="false",this.#ds?.abort(),this.#ds=null}get#ys(){return this.#ls&&!this.#ls.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#hs||(this.#ys?(this.hideDropdown(),this.#rs.focus({preventScroll:!0,focusVisible:this.#cs})):this.#r?.unselect())}updateColor(t){if(this.#os&&(this.#os.style.backgroundColor=t),!this.#ls)return;const e=this.#m.highlightColors.values();for(const n of this.#ls.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#rs?.remove(),this.#rs=null,this.#os=null,this.#ls?.remove(),this.#ls=null}}class go{#bs=null;#r=null;#m=null;static#ps=null;constructor(t){this.#r=t,this.#m=t._uiManager,go.#ps||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#bs)return this.#bs;const{editorType:t,colorType:e,colorValue:n}=this.#r,i=this.#bs=document.createElement("input");return i.type="color",i.value=n||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",go.#ps[t]),i.addEventListener("input",()=>{this.#m.updateParams(e,i.value)},{signal:this.#m._signal}),i}update(t){this.#bs&&(this.#bs.value=t)}destroy(){this.#bs?.remove(),this.#bs=null}hideDropdown(){}}function mo(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function vo(t){return Math.max(0,Math.min(255,255*t))}class yo{static CMYK_G(t){let[e,n,i,s]=t;return["G",1-Math.min(1,.3*e+.59*i+.11*n+s)]}static G_CMYK(t){let[e]=t;return["CMYK",0,0,0,1-e]}static G_RGB(t){let[e]=t;return["RGB",e,e,e]}static G_rgb(t){let[e]=t;return e=vo(e),[e,e,e]}static G_HTML(t){let[e]=t;const n=mo(e);return`#${n}${n}${n}`}static RGB_G(t){let[e,n,i]=t;return["G",.3*e+.59*n+.11*i]}static RGB_rgb(t){return t.map(vo)}static RGB_HTML(t){return`#${t.map(mo).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(t){let[e,n,i,s]=t;return["RGB",1-Math.min(1,e+s),1-Math.min(1,i+s),1-Math.min(1,n+s)]}static CMYK_rgb(t){let[e,n,i,s]=t;return[vo(1-Math.min(1,e+s)),vo(1-Math.min(1,i+s)),vo(1-Math.min(1,n+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK(t){let[e,n,i]=t;const s=1-e,r=1-n,o=1-i;return["CMYK",s,r,o,Math.min(s,r,o)]}}class bo{create(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if("string"!==typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){ai("Abstract method `_createSVG` called.")}}class _o extends bo{_createSVG(t){return document.createElementNS(Li,t)}}class wo{static setupStorage(t,e,n,i,s){const r=i.getValue(e,{value:null});switch(n.name){case"textarea":if(null!==r.value&&(t.textContent=r.value),"print"===s)break;t.addEventListener("input",t=>{i.setValue(e,{value:t.target.value})});break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(r.value===n.attributes.xfaOn?t.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&t.removeAttribute("checked"),"print"===s)break;t.addEventListener("change",t=>{i.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})})}else{if(null!==r.value&&t.setAttribute("value",r.value),"print"===s)break;t.addEventListener("input",t=>{i.setValue(e,{value:t.target.value})})}break;case"select":if(null!==r.value){t.setAttribute("value",r.value);for(const t of n.children)t.attributes.value===r.value?t.attributes.selected=!0:t.attributes.hasOwnProperty("selected")&&delete t.attributes.selected}t.addEventListener("input",t=>{const n=t.target.options,s=-1===n.selectedIndex?"":n[n.selectedIndex].value;i.setValue(e,{value:s})})}}static setAttributes(t){let{html:e,element:n,storage:i=null,intent:s,linkService:r}=t;const{attributes:o}=n,a=e instanceof HTMLAnchorElement;"radio"===o.type&&(o.name=`${o.name}-${s}`);for(const[l,c]of Object.entries(o))if(null!==c&&void 0!==c)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||"href"!==l&&"newWindow"!==l)&&e.setAttribute(l,c)}a&&r.addLinkAttributes(e,o.href,o.newWindow),i&&o.dataId&&this.setupStorage(e,o.dataId,n,i)}static render(t){const e=t.annotationStorage,n=t.linkService,i=t.xfaHtml,s=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:s,linkService:n});const o="richText"!==s,a=t.div;if(a.append(r),t.viewport){const e=`matrix(${t.viewport.transform.join(",")})`;a.style.transform=e}o&&a.setAttribute("class","xfaLayer xfaFont");const l=[];if(0===i.children.length){if(i.value){const t=document.createTextNode(i.value);r.append(t),o&&io.shouldBuildText(i.name)&&l.push(t)}return{textDivs:l}}const c=[[i,-1,r]];for(;c.length>0;){const[t,i,r]=c.at(-1);if(i+1===t.children.length){c.pop();continue}const a=t.children[++c.at(-1)[1]];if(null===a)continue;const{name:h}=a;if("#text"===h){const t=document.createTextNode(a.value);l.push(t),r.append(t);continue}const u=a?.attributes?.xmlns?document.createElementNS(a.attributes.xmlns,h):document.createElement(h);if(r.append(u),a.attributes&&this.setAttributes({html:u,element:a,storage:e,intent:s,linkService:n}),a.children?.length>0)c.push([a,-1,u]);else if(a.value){const t=document.createTextNode(a.value);o&&io.shouldBuildText(h)&&l.push(t),u.append(t)}}for(const h of a.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const xo=new WeakSet,So=60*(new Date).getTimezoneOffset()*1e3;class Ao{static create(t){switch(t.data.annotationType){case Wn.LINK:return new Eo(t);case Wn.TEXT:return new Co(t);case Wn.WIDGET:switch(t.data.fieldType){case"Tx":return new Po(t);case"Btn":return t.data.radioButton?new Io(t):t.data.checkBox?new Mo(t):new Ro(t);case"Ch":return new Do(t);case"Sig":return new Lo(t)}return new To(t);case Wn.POPUP:return new Oo(t);case Wn.FREETEXT:return new zo(t);case Wn.LINE:return new Fo(t);case Wn.SQUARE:return new jo(t);case Wn.CIRCLE:return new Bo(t);case Wn.POLYLINE:return new Uo(t);case Wn.CARET:return new $o(t);case Wn.INK:return new Wo(t);case Wn.POLYGON:return new Ho(t);case Wn.HIGHLIGHT:return new Vo(t);case Wn.UNDERLINE:return new Go(t);case Wn.SQUIGGLY:return new qo(t);case Wn.STRIKEOUT:return new Zo(t);case Wn.STAMP:return new Ko(t);case Wn.FILEATTACHMENT:return new Xo(t);default:return new ko(t)}}}class ko{#_s=null;#ws=!1;#xs=null;constructor(t){let{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData(t){let{contentsObj:e,richText:n}=t;return!(!e?.str&&!n?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return ko._hasPopupData(this.data)}updateEdited(t){if(!this.container)return;t.rect&&(this.#_s||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#Ss(e);let i=this.#xs?.popup||this.popup;!i&&n?.text&&(this._createPopup(n),i=this.#xs.popup),i&&(i.updateEdited(t),n?.deleted&&(i.remove(),this.#xs=null,this.popup=null))}resetEdited(){this.#_s&&(this.#Ss(this.#_s.rect),this.#xs?.popup.resetEdited(),this.#_s=null)}#Ss(t){const{container:{style:e},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:r,pageX:o,pageY:a}}}}=this;n?.splice(0,4,...t),e.left=100*(t[0]-o)/s+"%",e.top=100*(r-t[3]+a)/r+"%",0===i?(e.width=100*(t[2]-t[0])/s+"%",e.height=100*(t[3]-t[1])/r+"%"):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:n,viewport:i}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",e.id),this instanceof To||this instanceof Eo||(s.tabIndex=0);const{style:r}=s;if(r.zIndex=this.parent.zIndex++,e.alternativeText&&(s.title=e.alternativeText),e.noRotate&&s.classList.add("norotate"),!e.rect||this instanceof Oo){const{rotation:t}=e;return e.hasOwnCanvas||0===t||this.setRotation(t,s),s}const{width:o,height:a}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const t=e.borderStyle.horizontalCornerRadius,n=e.borderStyle.verticalCornerRadius;if(t>0||n>0){const e=`calc(${t}px * var(--total-scale-factor)) / calc(${n}px * var(--total-scale-factor))`;r.borderRadius=e}else if(this instanceof Io){const t=`calc(${o}px * var(--total-scale-factor)) / calc(${a}px * var(--total-scale-factor))`;r.borderRadius=t}switch(e.borderStyle.style){case Vn:r.borderStyle="solid";break;case Gn:r.borderStyle="dashed";break;case qn:oi("Unimplemented border style: beveled");break;case Zn:oi("Unimplemented border style: inset");break;case Kn:r.borderBottomStyle="solid"}const i=e.borderColor||null;i?(this.#ws=!0,r.borderColor=Si.makeHexColor(0|i[0],0|i[1],0|i[2])):r.borderWidth=0}const l=Si.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:c,pageHeight:h,pageX:u,pageY:d}=i.rawDims;r.left=100*(l[0]-u)/c+"%",r.top=100*(l[1]-d)/h+"%";const{rotation:p}=e;return e.hasOwnCanvas||0===p?(r.width=100*o/c+"%",r.height=100*a/h+"%"):this.setRotation(p,s),s}setRotation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims;let{width:s,height:r}=this;t%180!==0&&([s,r]=[r,s]),e.style.width=100*s/n+"%",e.style.height=100*r/i+"%",e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(t,e,n)=>{const i=n.detail[t],s=i[0],r=i.slice(1);n.target.style[e]=yo[`${s}_HTML`](r),this.annotationStorage.setValue(this.data.id,{[e]:yo[`${s}_rgb`](r)})};return ui(this,"_commonActions",{display:t=>{const{display:e}=t.detail,n=e%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:1===e||2===e})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:e}=t.detail;this.container.style.visibility=e?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:e,noView:e})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:t=>{const e=t.detail.rotation;this.setRotation(e),this.annotationStorage.setValue(this.data.id,{rotation:e})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const i of Object.keys(e.detail)){const s=t[i]||n[i];s?.(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[i,s]of Object.entries(e)){const r=n[i];if(r){r({detail:{[i]:s},target:t}),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,i,s]=this.data.rect.map(t=>Math.fround(t));if(8===t.length){const[r,o,a,l]=t.subarray(2,6);if(i===r&&s===o&&e===a&&n===l)return}const{style:r}=this.container;let o;if(this.#ws){const{borderColor:t,borderWidth:e}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${t}" stroke-width="${e}">`],this.container.classList.add("hasBorder")}const a=i-e,l=s-n,{svgFactory:c}=this,h=c.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),h.role="none";const u=c.createElement("defs");h.append(u);const d=c.createElement("clipPath"),p=`clippath_${this.data.id}`;d.setAttribute("id",p),d.setAttribute("clipPathUnits","objectBoundingBox"),u.append(d);for(let f=2,g=t.length;f<g;f+=8){const n=t[f],i=t[f+1],r=t[f+2],h=t[f+3],u=c.createElement("rect"),p=(r-e)/a,g=(s-i)/l,m=(n-r)/a,v=(i-h)/l;u.setAttribute("x",p),u.setAttribute("y",g),u.setAttribute("width",m),u.setAttribute("height",v),d.append(u),o?.push(`<rect vector-effect="non-scaling-stroke" x="${p}" y="${g}" width="${m}" height="${v}"/>`)}this.#ws&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(h),this.container.style.clipPath=`url(#${p})`}_createPopup(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const{data:e}=this;let n,i;t?(n={str:t.text},i=t.date):(n=e.contentsObj,i=e.modificationDate);const s=this.#xs=new Oo({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(s.render())}get hasPopupElement(){return!!(this.#xs||this.popup||this.data.popupRef)}render(){ai("Abstract method `AnnotationElement.render` called")}_getElementsByName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:t,id:s,exportValues:r}of i){if(-1===t)continue;if(s===e)continue;const i="string"===typeof r?r:null,o=document.querySelector(`[data-element-id="${s}"]`);!o||xo.has(o)?n.push({id:s,exportValue:i,domElement:o}):oi(`_getElementsByName - element not allowed: ${s}`)}return n}for(const i of document.getElementsByName(t)){const{exportValue:t}=i,s=i.getAttribute("data-element-id");s!==e&&(xo.has(i)&&n.push({id:s,exportValue:t,domElement:i}))}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Eo extends ko{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),i=!0):t.attachment?(this.#As(n,t.attachment,t.overlaidText,t.attachmentDest),i=!0):t.setOCGState?(this.#ks(n,t.setOCGState,t.overlaidText),i=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),i=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(n),this.container}#Es(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||""===e)&&this.#Es(),n&&(t.title=n)}_bindNamedAction(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#Es()}#As(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#Es()}#ks(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#Es()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const s=n.get(i);s&&(t[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#Es()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#Es(),!this._fieldObjects)return oi('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(t.onclick=()=>!1));t.onclick=()=>{n?.();const{fields:t,refs:i,include:s}=e,r=[];if(0!==t.length||0!==i.length){const e=new Set(i);for(const n of t){const t=this._fieldObjects[n]||[];for(const{id:n}of t)e.add(n)}for(const t of Object.values(this._fieldObjects))for(const n of t)e.has(n.id)===s&&r.push(n)}else for(const e of Object.values(this._fieldObjects))r.push(...e);const o=this.annotationStorage,a=[];for(const e of r){const{id:t}=e;switch(a.push(t),e.type){case"text":{const n=e.defaultValue||"";o.setValue(t,{value:n});break}case"checkbox":case"radiobutton":{const n=e.defaultValue===e.exportValues;o.setValue(t,{value:n});break}case"combobox":case"listbox":{const n=e.defaultValue||"";o.setValue(t,{value:n});break}default:continue}const n=document.querySelector(`[data-element-id="${t}"]`);n&&(xo.has(n)?n.dispatchEvent(new Event("resetform")):oi(`_bindResetFormAction - element not allowed: ${t}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:a,name:"ResetForm"}}),!1}}}class Co extends ko{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class To extends ko{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&("CANVAS"===t.previousSibling?.nodeName&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return wi.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,i,s){n.includes("mouse")?t.addEventListener(n,t=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(t),shift:t.shiftKey,modifier:this._getKeyModifier(t)}})}):t.addEventListener(n,t=>{if("blur"===n){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===n){if(e.focused)return;e.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(t)}})})}_setEventListeners(t,e,n,i){for(const[s,r]of n)("Action"===r||this.data.actions?.[r])&&("Focus"!==r&&"Blur"!==r||(e||={focused:!1}),this._setEventListener(t,e,s,r,i),"Focus"!==r||this.data.actions?.Blur?"Blur"!==r||this.data.actions?.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":Si.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||9,s=t.style;let r;const o=t=>Math.round(10*t)/10;if(this.data.multiLine){const t=Math.abs(this.data.rect[3]-this.data.rect[1]-2),e=t/(Math.round(t/(An*i))||1);r=Math.min(i,o(e/An))}else{const t=Math.abs(this.data.rect[3]-this.data.rect[1]-2);r=Math.min(i,o(t/An))}s.fontSize=`calc(${r}px * var(--total-scale-factor))`,s.color=Si.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(s.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Po extends To{constructor(t){super(t,{isRenderable:t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue})}setPropertyOnSiblings(t,e,n,i){const s=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=n),s.setValue(r.id,{[i]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let s=i.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&s.length>r&&(s=s.slice(0,r));let o=i.formattedValue||this.data.textContent?.join("\n")||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));const a={userValue:s,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=o??s,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",o??s),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),xo.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:l,datetimeType:c,timeStep:h}=this.data,u=!!c&&this.enableScripting;l&&(n.title=l),this._setRequired(n,this.data.required),r&&(n.maxLength=r),n.addEventListener("input",i=>{t.setValue(e,{value:i.target.value}),this.setPropertyOnSiblings(n,"value",i.target.value,"value"),a.formattedValue=null}),n.addEventListener("resetform",t=>{const e=this.data.defaultFieldValue??"";n.value=a.userValue=e,a.formattedValue=null});let d=t=>{const{formattedValue:e}=a;null!==e&&void 0!==e&&(t.target.value=e),t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",t=>{if(a.focused)return;const{target:e}=t;if(u&&(e.type=c,h&&(e.step=h)),a.userValue){const t=a.userValue;if(u)if("time"===c){const n=new Date(t),i=[n.getHours(),n.getMinutes(),n.getSeconds()];e.value=i.map(t=>t.toString().padStart(2,"0")).join(":")}else e.value=new Date(t-So).toISOString().split("date"===c?"T":".",1)[0];else e.value=t}a.lastCommittedValue=e.value,a.commitKey=1,this.data.actions?.Focus||(a.focused=!0)}),n.addEventListener("updatefromsandbox",n=>{this.showElementAndHideCanvas(n.target);const i={value(n){a.userValue=n.detail.value??"",u||t.setValue(e,{value:a.userValue.toString()}),n.target.value=a.userValue},formattedValue(n){const{formattedValue:i}=n.detail;a.formattedValue=i,null!==i&&void 0!==i&&n.target!==document.activeElement&&(n.target.value=i);const s={formattedValue:i};u&&(s.value=i),t.setValue(e,s)},selRange(t){t.target.setSelectionRange(...t.detail.selRange)},charLimit:n=>{const{charLimit:i}=n.detail,{target:s}=n;if(0===i)return void s.removeAttribute("maxLength");s.setAttribute("maxLength",i);let r=a.userValue;!r||r.length<=i||(r=r.slice(0,i),s.value=a.userValue=r,t.setValue(e,{value:r}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:r,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}};this._dispatchEventFromSandbox(i,n)}),n.addEventListener("keydown",t=>{a.commitKey=1;let n=-1;if("Escape"===t.key?n=0:"Enter"!==t.key||this.data.multiLine?"Tab"===t.key&&(a.commitKey=3):n=2,-1===n)return;const{value:i}=t.target;a.lastCommittedValue!==i&&(a.lastCommittedValue=i,a.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:i,willCommit:!0,commitKey:n,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}))});const i=d;d=null,n.addEventListener("blur",t=>{if(!a.focused||!t.relatedTarget)return;this.data.actions?.Blur||(a.focused=!1);const{target:n}=t;let{value:s}=n;if(u){if(s&&"time"===c){const t=s.split(":").map(t=>parseInt(t,10));s=new Date(2e3,0,1,t[0],t[1],t[2]||0).valueOf(),n.step=""}else s=new Date(s).valueOf();n.type="text"}a.userValue=s,a.lastCommittedValue!==s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:s,willCommit:!0,commitKey:a.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}),i(t)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",t=>{a.lastCommittedValue=null;const{data:n,target:i}=t,{value:s,selectionStart:r,selectionEnd:o}=i;let l=r,c=o;switch(t.inputType){case"deleteWordBackward":{const t=s.substring(0,r).match(/\w*[^\w]*$/);t&&(l-=t[0].length);break}case"deleteWordForward":{const t=s.substring(r).match(/^[^\w]*\w*/);t&&(c+=t[0].length);break}case"deleteContentBackward":r===o&&(l-=1);break;case"deleteContentForward":r===o&&(c+=1)}t.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:s,change:n||"",willCommit:!1,selStart:l,selEnd:c}})}),this._setEventListeners(n,a,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.value)}if(d&&n.addEventListener("blur",d),this.data.comb){const t=(this.data.rect[2]-this.data.rect[0])/r;n.classList.add("comb"),n.style.letterSpacing=`calc(${t}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Lo extends To{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Mo extends To{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let i=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;"string"===typeof i&&(i="Off"!==i,t.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return xo.add(s),s.setAttribute("data-element-id",n),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=e.fieldName,i&&s.setAttribute("checked",!0),s.setAttribute("exportValue",e.exportValue),s.tabIndex=0,s.addEventListener("change",i=>{const{name:s,checked:r}=i.target;for(const o of this._getElementsByName(s,n)){const n=r&&o.exportValue===e.exportValue;o.domElement&&(o.domElement.checked=n),t.setValue(o.id,{value:n})}t.setValue(n,{value:r})}),s.addEventListener("resetform",t=>{const n=e.defaultFieldValue||"Off";t.target.checked=n===e.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",e=>{const i={value(e){e.target.checked="Off"!==e.detail.value,t.setValue(n,{value:e.target.checked})}};this._dispatchEventFromSandbox(i,e)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Io extends To{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let i=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if("string"===typeof i&&(i=i!==e.buttonValue,t.setValue(n,{value:i})),i)for(const r of this._getElementsByName(e.fieldName,n))t.setValue(r.id,{value:!1});const s=document.createElement("input");if(xo.add(s),s.setAttribute("data-element-id",n),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=e.fieldName,i&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",e=>{const{name:i,checked:s}=e.target;for(const r of this._getElementsByName(i,n))t.setValue(r.id,{value:!1});t.setValue(n,{value:s})}),s.addEventListener("resetform",t=>{const n=e.defaultFieldValue;t.target.checked=null!==n&&void 0!==n&&n===e.buttonValue}),this.enableScripting&&this.hasJSActions){const i=e.buttonValue;s.addEventListener("updatefromsandbox",e=>{const s={value:e=>{const s=i===e.detail.value;for(const i of this._getElementsByName(e.target.name)){const e=s&&i.id===n;i.domElement&&(i.domElement.checked=e),t.setValue(i.id,{value:e})}}};this._dispatchEventFromSandbox(s,e)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Ro extends Eo{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",t=>{this._dispatchEventFromSandbox({},t)})),t}}class Do extends To{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");xo.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",t=>{const e=this.data.defaultFieldValue;for(const n of i.options)n.selected=n.value===e});for(const c of this.data.options){const t=document.createElement("option");t.textContent=c.displayValue,t.value=c.exportValue,n.value.includes(c.exportValue)&&(t.setAttribute("selected",!0),s=!1),i.append(t)}let r=null;if(s){const t=document.createElement("option");t.value=" ",t.setAttribute("hidden",!0),t.setAttribute("selected",!0),i.prepend(t),r=()=>{t.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const o=t=>{const e=t?"value":"textContent",{options:n,multiple:s}=i;return s?Array.prototype.filter.call(n,t=>t.selected).map(t=>t[e]):-1===n.selectedIndex?null:n[n.selectedIndex][e]};let a=o(!1);const l=t=>{const e=t.target.options;return Array.prototype.map.call(e,t=>({displayValue:t.textContent,exportValue:t.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",n=>{const s={value(n){r?.();const s=n.detail.value,l=new Set(Array.isArray(s)?s:[s]);for(const t of i.options)t.selected=l.has(t.value);t.setValue(e,{value:o(!0)}),a=o(!1)},multipleSelection(t){i.multiple=!0},remove(n){const s=i.options,r=n.detail.remove;if(s[r].selected=!1,i.remove(r),s.length>0){-1===Array.prototype.findIndex.call(s,t=>t.selected)&&(s[0].selected=!0)}t.setValue(e,{value:o(!0),items:l(n)}),a=o(!1)},clear(n){for(;0!==i.length;)i.remove(0);t.setValue(e,{value:null,items:[]}),a=o(!1)},insert(n){const{index:s,displayValue:r,exportValue:c}=n.detail.insert,h=i.children[s],u=document.createElement("option");u.textContent=r,u.value=c,h?h.before(u):i.append(u),t.setValue(e,{value:o(!0),items:l(n)}),a=o(!1)},items(n){const{items:s}=n.detail;for(;0!==i.length;)i.remove(0);for(const t of s){const{displayValue:e,exportValue:n}=t,s=document.createElement("option");s.textContent=e,s.value=n,i.append(s)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:o(!0),items:l(n)}),a=o(!1)},indices(n){const i=new Set(n.detail.indices);for(const t of n.target.options)t.selected=i.has(t.index);t.setValue(e,{value:o(!0)}),a=o(!1)},editable(t){t.target.disabled=!t.detail.editable}};this._dispatchEventFromSandbox(s,n)}),i.addEventListener("input",n=>{const i=o(!0),s=o(!1);t.setValue(e,{value:i}),n.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:a,change:s,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],t=>t.target.value)):i.addEventListener("input",function(n){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Oo extends ko{constructor(t){const{data:e,elements:n}=t;super(t,{isRenderable:ko._hasPopupData(e)}),this.elements=n,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new No({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),n=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",n.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(t=>`${Ci}${t}`).join(",")),this.container}}class No{#Cs=this.#gs.bind(this);#Ts=this.#Ps.bind(this);#Ls=this.#Ms.bind(this);#Is=this.#Rs.bind(this);#Ds=null;#vt=null;#Os=null;#Ns=null;#zs=null;#Fs=null;#js=null;#Bs=!1;#Us=null;#Hs=null;#C=null;#$s=null;#Ws=null;#Vs=null;#_s=null;#Gs=!1;constructor(t){let{container:e,color:n,elements:i,titleObj:s,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:c,parentRect:h,open:u}=t;this.#vt=e,this.#Vs=s,this.#Os=o,this.#Ws=a,this.#Fs=l,this.#Ds=n,this.#$s=c,this.#js=h,this.#zs=i,this.#Ns=Ui.toDateObject(r),this.trigger=i.flatMap(t=>t.getElementsToTriggerPopup()),this.#qs(),this.#vt.hidden=!0,u&&this.#Rs()}#qs(){if(this.#Hs)return;this.#Hs=new AbortController;const{signal:t}=this.#Hs;for(const e of this.trigger)e.addEventListener("click",this.#Is,{signal:t}),e.addEventListener("mouseenter",this.#Ls,{signal:t}),e.addEventListener("mouseleave",this.#Ts,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#zs)e.container?.addEventListener("keydown",this.#Cs,{signal:t})}render(){if(this.#Us)return;const t=this.#Us=document.createElement("div");if(t.className="popup",this.#Ds){const e=t.style.outlineColor=Si.makeHexColor(...this.#Ds);t.style.backgroundColor=`color-mix(in srgb, ${e} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#Vs?.str){const t=document.createElement("span");t.className="title",e.append(t),({dir:t.dir,str:t.textContent}=this.#Vs)}if(t.append(e),this.#Ns){const t=document.createElement("time");t.className="popupDate",t.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),t.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#Ns.valueOf()})),t.dateTime=this.#Ns.toISOString(),e.append(t)}const n=this.#Zs;if(n)wo.render({xfaHtml:n,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const e=this._formatContents(this.#Os);t.append(e)}this.#vt.append(t)}get#Zs(){const t=this.#Ws,e=this.#Os;return!t?.str||e?.str&&e.str!==t.str?null:this.#Ws.html||null}get#Ks(){return this.#Zs?.attributes?.style?.fontSize||0}get#Xs(){return this.#Zs?.attributes?.style?.color||null}#Ys(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#Xs,fontSize:this.#Ks?`calc(${this.#Ks}px * var(--total-scale-factor))`:""}};for(const s of t.split("\n"))e.push({name:"span",value:s,attributes:i});return n}_formatContents(t){let{str:e,dir:n}=t;const i=document.createElement("p");i.classList.add("popupContent"),i.dir=n;const s=e.split(/(?:\r\n?|\n)/);for(let r=0,o=s.length;r<o;++r){const t=s[r];i.append(document.createTextNode(t)),r<o-1&&i.append(document.createElement("br"))}return i}#gs(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&this.#Bs)&&this.#Rs()}updateEdited(t){let{rect:e,popup:n,deleted:i}=t;i||n?.deleted?this.remove():(this.#qs(),this.#_s||={contentsObj:this.#Os,richText:this.#Ws},e&&(this.#C=null),n&&(this.#Ws=this.#Ys(n.text),this.#Ns=Ui.toDateObject(n.date),this.#Os=null),this.#Us?.remove(),this.#Us=null)}resetEdited(){this.#_s&&(({contentsObj:this.#Os,richText:this.#Ws}=this.#_s),this.#_s=null,this.#Us?.remove(),this.#Us=null,this.#C=null)}remove(){this.#Hs?.abort(),this.#Hs=null,this.#Us?.remove(),this.#Us=null,this.#Gs=!1,this.#Bs=!1;for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#Js(){if(null!==this.#C)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:i,pageY:s}}}=this.#Fs;let r=!!this.#js,o=r?this.#js:this.#$s;for(const d of this.#zs)if(!o||null!==Si.intersect(d.data.rect,o)){o=d.data.rect,r=!0;break}const a=Si.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),l=r?o[2]-o[0]+5:0,c=a[0]+l,h=a[1];this.#C=[100*(c-i)/e,100*(h-s)/n];const{style:u}=this.#vt;u.left=`${this.#C[0]}%`,u.top=`${this.#C[1]}%`}#Rs(){this.#Bs=!this.#Bs,this.#Bs?(this.#Ms(),this.#vt.addEventListener("click",this.#Is),this.#vt.addEventListener("keydown",this.#Cs)):(this.#Ps(),this.#vt.removeEventListener("click",this.#Is),this.#vt.removeEventListener("keydown",this.#Cs))}#Ms(){this.#Us||this.render(),this.isVisible?this.#Bs&&this.#vt.classList.add("focused"):(this.#Js(),this.#vt.hidden=!1,this.#vt.style.zIndex=parseInt(this.#vt.style.zIndex)+1e3)}#Ps(){this.#vt.classList.remove("focused"),!this.#Bs&&this.isVisible&&(this.#vt.hidden=!0,this.#vt.style.zIndex=parseInt(this.#vt.style.zIndex)-1e3)}forceHide(){this.#Gs=this.isVisible,this.#Gs&&(this.#vt.hidden=!0)}maybeShow(){this.#qs(),this.#Gs&&(this.#Us||this.#Ms(),this.#Gs=!1,this.#vt.hidden=!1)}get isVisible(){return!1===this.#vt.hidden}}class zo extends ko{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=On.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Fo extends ko{#Qs=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,i=this.svgFactory.create(e,n,!0),s=this.#Qs=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),s.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),s.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),s.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),s.setAttribute("stroke-width",t.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#Qs}addHighlightArea(){this.container.classList.add("highlightArea")}}class jo extends ko{#tr=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,i=this.svgFactory.create(e,n,!0),s=t.borderStyle.width,r=this.#tr=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",s/2),r.setAttribute("y",s/2),r.setAttribute("width",e-s),r.setAttribute("height",n-s),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#tr}addHighlightArea(){this.container.classList.add("highlightArea")}}class Bo extends ko{#er=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,i=this.svgFactory.create(e,n,!0),s=t.borderStyle.width,r=this.#er=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",n/2),r.setAttribute("rx",e/2-s/2),r.setAttribute("ry",n/2-s/2),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#er}addHighlightArea(){this.container.classList.add("highlightArea")}}class Uo extends ko{#nr=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:i},width:s,height:r}=this;if(!e)return this.container;const o=this.svgFactory.create(s,r,!0);let a=[];for(let c=0,h=e.length;c<h;c+=2){const n=e[c]-t[0],i=t[3]-e[c+1];a.push(`${n},${i}`)}a=a.join(" ");const l=this.#nr=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",a),l.setAttribute("stroke-width",n.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),o.append(l),this.container.append(o),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#nr}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ho extends Uo{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class $o extends ko{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Wo extends ko{#ir=null;#sr=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?On.HIGHLIGHT:On.INK}#rr(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:i,popupRef:s}}=this,{transform:r,width:o,height:a}=this.#rr(e,t),l=this.svgFactory.create(o,a,!0),c=this.#ir=this.svgFactory.createElement("svg:g");l.append(c),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",r);for(let h=0,u=n.length;h<u;h++){const t=this.svgFactory.createElement(this.svgElementName);this.#sr.push(t),t.setAttribute("points",n[h].join(",")),c.append(t)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(l),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:i}=t,s=this.#ir;if(e>=0&&s.setAttribute("stroke-width",e||1),n)for(let r=0,o=this.#sr.length;r<o;r++)this.#sr[r].setAttribute("points",n[r].join(","));if(i){const{transform:t,width:e,height:n}=this.#rr(this.data.rotation,i);s.parentElement.setAttribute("viewBox",`0 0 ${e} ${n}`),s.setAttribute("transform",t)}}getElementsToTriggerPopup(){return this.#sr}addHighlightArea(){this.container.classList.add("highlightArea")}}class Vo extends ko{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=On.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const e=document.createElement("mark");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class Go extends ko{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const e=document.createElement("u");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class qo extends ko{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const e=document.createElement("u");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class Zo extends ko{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const e=document.createElement("s");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class Ko extends ko{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=On.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Xo extends ko{#or=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||0===e.fillAlpha?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(100*e.fillAlpha)}%);`)),n.addEventListener("dblclick",this.#ar.bind(this)),this.#or=n;const{isMac:i}=wi.platform;return t.addEventListener("keydown",t=>{"Enter"===t.key&&(i?t.metaKey:t.ctrlKey)&&this.#ar()}),!e.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#or}addHighlightArea(){this.container.classList.add("highlightArea")}#ar(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Yo{#lr=null;#cr=null;#hr=(()=>new Map)();#ur=null;constructor(t){let{div:e,accessibilityManager:n,annotationCanvasMap:i,annotationEditorUIManager:s,page:r,viewport:o,structTreeLayer:a}=t;this.div=e,this.#lr=n,this.#cr=i,this.#ur=a||null,this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#hr.size>0}async#dr(t,e,n){const i=t.firstChild||t,s=i.id=`${Ci}${e}`,r=await(this.#ur?.getAriaAttributes(s));if(r)for(const[o,a]of r)i.setAttribute(o,a);n?n.at(-1).container.after(t):(this.div.append(t),this.#lr?.moveElementInDOM(this.div,t,i,!1))}async render(t){const{annotations:e}=t,n=this.div;Vi(n,this.viewport);const i=new Map,s={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:!1!==t.renderForms,svgFactory:new _o,annotationStorage:t.annotationStorage||new ps,enableScripting:!0===t.enableScripting,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const r of e){if(r.noHTML)continue;const t=r.annotationType===Wn.POPUP;if(t){const t=i.get(r.id);if(!t)continue;s.elements=t}else if(r.rect[2]===r.rect[0]||r.rect[3]===r.rect[1])continue;s.data=r;const e=Ao.create(s);if(!e.isRenderable)continue;if(!t&&r.popupRef){const t=i.get(r.popupRef);t?t.push(e):i.set(r.popupRef,[e])}const n=e.render();r.hidden&&(n.style.visibility="hidden"),await this.#dr(n,r.id,s.elements),e._isEditable&&(this.#hr.set(e.data.id,e),this._annotationEditorUIManager?.renderAnnotationElement(e))}this.#pr()}async addLinkAnnotations(t,e){const n={data:null,layer:this.div,linkService:e,svgFactory:new _o,parent:this};for(const i of t){i.borderStyle||=Yo._defaultBorderStyle,n.data=i;const t=Ao.create(n);if(!t.isRenderable)continue;const e=t.render();await this.#dr(e,i.id,null)}}update(t){let{viewport:e}=t;const n=this.div;this.viewport=e,Vi(n,{rotation:e.rotation}),this.#pr(),n.hidden=!1}#pr(){if(!this.#cr)return;const t=this.div;for(const[e,n]of this.#cr){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;n.className="annotationContent";const{firstChild:s}=i;s?"CANVAS"===s.nodeName?s.replaceWith(n):s.classList.contains("annotationContent")?s.after(n):s.before(n):i.append(n);const r=this.#hr.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,i.id,n),r._hasNoCanvas=!1):r.canvas=n)}this.#cr.clear()}getEditableAnnotations(){return Array.from(this.#hr.values())}getEditableAnnotation(t){return this.#hr.get(t)}static get _defaultBorderStyle(){return ui(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Vn,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Jo=/\r\n?|\n/g;class Qo extends os{#Ds;#fr="";#gr=`${this.id}-editor`;#mr=null;#Ks;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Qo.prototype,e=t=>t.isEmpty(),n=ns.TRANSLATE_SMALL,i=ns.TRANSLATE_BIG;return ui(this,"_keyboardManager",new ts([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=(()=>On.FREETEXT)();constructor(t){super({...t,name:"freeTextEditor"}),this.#Ds=t.color||Qo._defaultColor||os._defaultLineColor,this.#Ks=t.fontSize||Qo._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){os.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case Nn.FREETEXT_SIZE:Qo._defaultFontSize=e;break;case Nn.FREETEXT_COLOR:Qo._defaultColor=e}}updateParams(t,e){switch(t){case Nn.FREETEXT_SIZE:this.#vr(e);break;case Nn.FREETEXT_COLOR:this.#yr(e)}}static get defaultPropertiesToUpdate(){return[[Nn.FREETEXT_SIZE,Qo._defaultFontSize],[Nn.FREETEXT_COLOR,Qo._defaultColor||os._defaultLineColor]]}get propertiesToUpdate(){return[[Nn.FREETEXT_SIZE,this.#Ks],[Nn.FREETEXT_COLOR,this.#Ds]]}get toolbarButtons(){return this._colorPicker||=new go(this),[["colorPicker",this._colorPicker]]}get colorType(){return Nn.FREETEXT_COLOR}get colorValue(){return this.#Ds}#vr(t){const e=t=>{this.editorDiv.style.fontSize=`calc(${t}px * var(--total-scale-factor))`,this.translate(0,-(t-this.#Ks)*this.parentScale),this.#Ks=t,this.#br()},n=this.#Ks;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nn.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#yr(t){const e=t=>{this.#Ds=this.editorDiv.style.color=t,this._colorPicker?.update(t)},n=this.#Ds;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nn.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Qo._internalPadding*t,-(Qo._internalPadding+this.#Ks)*t]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#mr=new AbortController;const t=this._uiManager.combinedSignal(this.#mr);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return!!super.disableEditMode()&&(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#gr),this._isDraggable=!0,this.#mr?.abort(),this.#mr=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0)}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#_r(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&"BR"===n.nodeName||(t.push(Qo.#wr(n)),e=n);return t.join("\n")}#br(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:t,div:e}=this,i=e.style.display,s=e.classList.contains("hidden");e.classList.remove("hidden"),e.style.display="hidden",t.div.append(this.div),n=e.getBoundingClientRect(),e.remove(),e.style.display=i,e.classList.toggle("hidden",s)}this.rotation%180===this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#fr,e=this.#fr=this.#_r().trimEnd();if(t===e)return;const n=t=>{this.#fr=t,t?(this.#xr(),this._uiManager.rebuild(this),this.#br()):this.remove()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#br()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&"Enter"===t.key&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Qo._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#gr),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#Ks}px * var(--total-scale-factor))`,n.color=this.#Ds,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,i]=this.parentDimensions;if(this.annotationElementId){const{position:s}=this._initialData;let[r,o]=this.getInitialTranslation();[r,o]=this.pageTranslationToScreen(r,o);const[a,l]=this.pageDimensions,[c,h]=this.pageTranslation;let u,d;switch(this.rotation){case 0:u=t+(s[0]-c)/a,d=e+this.height-(s[1]-h)/l;break;case 90:u=t+(s[0]-c)/a,d=e-(s[1]-h)/l,[r,o]=[o,-r];break;case 180:u=t-this.width+(s[0]-c)/a,d=e-(s[1]-h)/l,[r,o]=[-r,-o];break;case 270:u=t+(s[0]-c-this.height*l)/a,d=e+(s[1]-h-this.width*a)/l,[r,o]=[-o,r]}this.setAt(u*n,d*i,r,o)}else this._moveAfterPaste(t,e);this.#xr(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#wr(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Jo,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(1===n.length&&"text/plain"===n[0])return;t.preventDefault();const i=Qo.#Sr(e.getData("text")||"").replaceAll(Jo,"\n");if(!i)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const r=s.getRangeAt(0);if(!i.includes("\n"))return r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),void s.collapseToStart();const{startContainer:o,startOffset:a}=r,l=[],c=[];if(o.nodeType===Node.TEXT_NODE){const t=o.parentElement;if(c.push(o.nodeValue.slice(a).replaceAll(Jo,"")),t!==this.editorDiv){let e=l;for(const n of this.editorDiv.childNodes)n!==t?e.push(Qo.#wr(n)):e=c}l.push(o.nodeValue.slice(0,a).replaceAll(Jo,""))}else if(o===this.editorDiv){let t=l,e=0;for(const n of this.editorDiv.childNodes)e++===a&&(t=c),t.push(Qo.#wr(n))}this.#fr=`${l.join("\n")}${i}${c.join("\n")}`,this.#xr();const h=new Range;let u=Math.sumPrecise(l.map(t=>t.length));for(const{firstChild:d}of this.editorDiv.childNodes)if(d.nodeType===Node.TEXT_NODE){const t=d.nodeValue.length;if(u<=t){h.setStart(d,u),h.setEnd(d,u);break}u-=t}s.removeAllRanges(),s.addRange(h)}#xr(){if(this.editorDiv.replaceChildren(),this.#fr)for(const t of this.#fr.split("\n")){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#Ar(){return this.#fr.replaceAll("\xa0"," ")}static#Sr(t){return t.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}static async deserialize(t,e,n){let i=null;if(t instanceof zo){const{data:{defaultAppearanceData:{fontSize:e,fontColor:n},rect:s,rotation:r,id:o,popupRef:a,contentsObj:l},textContent:c,textPosition:h,parent:{page:{pageNumber:u}}}=t;if(!c||0===c.length)return null;i=t={annotationType:On.FREETEXT,color:Array.from(n),fontSize:e,value:c.join("\n"),position:h,pageIndex:u-1,rect:s.slice(0),rotation:r,annotationElementId:o,id:o,deleted:!1,popupRef:a,comment:l?.str||null}}const s=await super.deserialize(t,e,n);return s.#Ks=t.fontSize,s.#Ds=Si.makeHexColor(...t.color),s.#fr=Qo.#Sr(t.value),s._initialData=i,t.comment&&s.setCommentData(t.comment),s}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=Qo._internalPadding*this.parentScale,n=this.getRect(e,e),i=os._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#Ds),s={annotationType:On.FREETEXT,color:i,fontSize:this.#Ks,value:this.#Ar(),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#kr(s)?null:(s.id=this.annotationElementId,s)}#kr(t){const{value:e,fontSize:n,color:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((t,e)=>t!==i[e])||t.pageIndex!==s}renderAnnotationElement(t){const e=super.renderAnnotationElement(t),{style:n}=e;n.fontSize=`calc(${this.#Ks}px * var(--total-scale-factor))`,n.color=this.#Ds,e.replaceChildren();for(const r of this.#fr.split("\n")){const t=document.createElement("div");t.append(r?document.createTextNode(r):document.createElement("br")),e.append(t)}const i=Qo._internalPadding*this.parentScale,s={rect:this.getRect(i,i)};return s.popup=this.hasEditedComment?this.comment:{text:this.#fr},t.updateEdited(s),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class ta{static PRECISION=1e-4;toSVGPath(){ai("Abstract method `toSVGPath` must be implemented.")}get box(){ai("Abstract getter `box` must be implemented.")}serialize(t,e){ai("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,i,s,r){r||=new Float32Array(t.length);for(let o=0,a=t.length;o<a;o+=2)r[o]=e+t[o]*i,r[o+1]=n+t[o+1]*s;return r}static _rescaleAndSwap(t,e,n,i,s,r){r||=new Float32Array(t.length);for(let o=0,a=t.length;o<a;o+=2)r[o]=e+t[o+1]*i,r[o+1]=n+t[o]*s;return r}static _translate(t,e,n,i){i||=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s+=2)i[s]=e+t[s],i[s+1]=n+t[s+1];return i}static svgRound(t){return Math.round(1e4*t)}static _normalizePoint(t,e,n,i,s){switch(s){case 90:return[1-e/n,t/i];case 180:return[1-t/n,1-e/i];case 270:return[e/n,1-t/i];default:return[t/n,e/i]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,i,s,r){return[(t+5*n)/6,(e+5*i)/6,(5*n+s)/6,(5*i+r)/6,(n+s)/2,(i+r)/2]}}class ea{#Er;#Cr=[];#Tr;#Pr;#Lr=[];#Mr=(()=>new Float32Array(18))();#Ir;#Rr;#Dr;#Or;#Nr;#zr;#Fr=[];static#jr=8;static#Br=2;static#Ur=(()=>ea.#jr+ea.#Br)();constructor(t,e,n,i,s){let{x:r,y:o}=t,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.#Er=e,this.#zr=i*n,this.#Pr=s,this.#Mr.set([NaN,NaN,NaN,NaN,r,o],6),this.#Tr=a,this.#Or=ea.#jr*n,this.#Dr=ea.#Ur*n,this.#Nr=n,this.#Fr.push(r,o)}isEmpty(){return isNaN(this.#Mr[8])}#Hr(){const t=this.#Mr.subarray(4,6),e=this.#Mr.subarray(16,18),[n,i,s,r]=this.#Er;return[(this.#Ir+(t[0]-e[0])/2-n)/s,(this.#Rr+(t[1]-e[1])/2-i)/r,(this.#Ir+(e[0]-t[0])/2-n)/s,(this.#Rr+(e[1]-t[1])/2-i)/r]}add(t){let{x:e,y:n}=t;this.#Ir=e,this.#Rr=n;const[i,s,r,o]=this.#Er;let[a,l,c,h]=this.#Mr.subarray(8,12);const u=e-c,d=n-h,p=Math.hypot(u,d);if(p<this.#Dr)return!1;const f=p-this.#Or,g=f/p,m=g*u,v=g*d;let y=a,b=l;a=c,l=h,c+=m,h+=v,this.#Fr?.push(e,n);const _=m/f,w=-v/f*this.#zr,x=_*this.#zr;if(this.#Mr.set(this.#Mr.subarray(2,8),0),this.#Mr.set([c+w,h+x],4),this.#Mr.set(this.#Mr.subarray(14,18),12),this.#Mr.set([c-w,h-x],16),isNaN(this.#Mr[6]))return 0===this.#Lr.length&&(this.#Mr.set([a+w,l+x],2),this.#Lr.push(NaN,NaN,NaN,NaN,(a+w-i)/r,(l+x-s)/o),this.#Mr.set([a-w,l-x],14),this.#Cr.push(NaN,NaN,NaN,NaN,(a-w-i)/r,(l-x-s)/o)),this.#Mr.set([y,b,a,l,c,h],6),!this.isEmpty();this.#Mr.set([y,b,a,l,c,h],6);return Math.abs(Math.atan2(b-l,y-a)-Math.atan2(v,m))<Math.PI/2?([a,l,c,h]=this.#Mr.subarray(2,6),this.#Lr.push(NaN,NaN,NaN,NaN,((a+c)/2-i)/r,((l+h)/2-s)/o),[a,l,y,b]=this.#Mr.subarray(14,18),this.#Cr.push(NaN,NaN,NaN,NaN,((y+a)/2-i)/r,((b+l)/2-s)/o),!0):([y,b,a,l,c,h]=this.#Mr.subarray(0,6),this.#Lr.push(((y+5*a)/6-i)/r,((b+5*l)/6-s)/o,((5*a+c)/6-i)/r,((5*l+h)/6-s)/o,((a+c)/2-i)/r,((l+h)/2-s)/o),[c,h,a,l,y,b]=this.#Mr.subarray(12,18),this.#Cr.push(((y+5*a)/6-i)/r,((b+5*l)/6-s)/o,((5*a+c)/6-i)/r,((5*l+h)/6-s)/o,((a+c)/2-i)/r,((l+h)/2-s)/o),!0)}toSVGPath(){if(this.isEmpty())return"";const t=this.#Lr,e=this.#Cr;if(isNaN(this.#Mr[6])&&!this.isEmpty())return this.#$r();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?n.push(`L${t[i+4]} ${t[i+5]}`):n.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);this.#Wr(n);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?n.push(`L${e[i+4]} ${e[i+5]}`):n.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return this.#Vr(n),n.join(" ")}#$r(){const[t,e,n,i]=this.#Er,[s,r,o,a]=this.#Hr();return`M${(this.#Mr[2]-t)/n} ${(this.#Mr[3]-e)/i} L${(this.#Mr[4]-t)/n} ${(this.#Mr[5]-e)/i} L${s} ${r} L${o} ${a} L${(this.#Mr[16]-t)/n} ${(this.#Mr[17]-e)/i} L${(this.#Mr[14]-t)/n} ${(this.#Mr[15]-e)/i} Z`}#Vr(t){const e=this.#Cr;t.push(`L${e[4]} ${e[5]} Z`)}#Wr(t){const[e,n,i,s]=this.#Er,r=this.#Mr.subarray(4,6),o=this.#Mr.subarray(16,18),[a,l,c,h]=this.#Hr();t.push(`L${(r[0]-e)/i} ${(r[1]-n)/s} L${a} ${l} L${c} ${h} L${(o[0]-e)/i} ${(o[1]-n)/s}`)}newFreeDrawOutline(t,e,n,i,s,r){return new na(t,e,n,i,s,r)}getOutlines(){const t=this.#Lr,e=this.#Cr,n=this.#Mr,[i,s,r,o]=this.#Er,a=new Float32Array((this.#Fr?.length??0)+2);for(let h=0,u=a.length-2;h<u;h+=2)a[h]=(this.#Fr[h]-i)/r,a[h+1]=(this.#Fr[h+1]-s)/o;if(a[a.length-2]=(this.#Ir-i)/r,a[a.length-1]=(this.#Rr-s)/o,isNaN(n[6])&&!this.isEmpty())return this.#Gr(a);const l=new Float32Array(this.#Lr.length+24+this.#Cr.length);let c=t.length;for(let h=0;h<c;h+=2)isNaN(t[h])?l[h]=l[h+1]=NaN:(l[h]=t[h],l[h+1]=t[h+1]);c=this.#qr(l,c);for(let h=e.length-6;h>=6;h-=6)for(let t=0;t<6;t+=2)isNaN(e[h+t])?(l[c]=l[c+1]=NaN,c+=2):(l[c]=e[h+t],l[c+1]=e[h+t+1],c+=2);return this.#Zr(l,c),this.newFreeDrawOutline(l,a,this.#Er,this.#Nr,this.#Tr,this.#Pr)}#Gr(t){const e=this.#Mr,[n,i,s,r]=this.#Er,[o,a,l,c]=this.#Hr(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(e[2]-n)/s,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-n)/s,(e[5]-i)/r,NaN,NaN,NaN,NaN,o,a,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,(e[16]-n)/s,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-n)/s,(e[15]-i)/r],0),this.newFreeDrawOutline(h,t,this.#Er,this.#Nr,this.#Tr,this.#Pr)}#Zr(t,e){const n=this.#Cr;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+6}#qr(t,e){const n=this.#Mr.subarray(4,6),i=this.#Mr.subarray(16,18),[s,r,o,a]=this.#Er,[l,c,h,u]=this.#Hr();return t.set([NaN,NaN,NaN,NaN,(n[0]-s)/o,(n[1]-r)/a,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(i[0]-s)/o,(i[1]-r)/a],e),e+24}}class na extends ta{#Er;#Kr=(()=>new Float32Array(4))();#Tr;#Pr;#Fr;#Nr;#Xr;constructor(t,e,n,i,s,r){super(),this.#Xr=t,this.#Fr=e,this.#Er=n,this.#Nr=i,this.#Tr=s,this.#Pr=r,this.lastPoint=[NaN,NaN],this.#Yr(r);const[o,a,l,c]=this.#Kr;for(let h=0,u=t.length;h<u;h+=2)t[h]=(t[h]-o)/l,t[h+1]=(t[h+1]-a)/c;for(let h=0,u=e.length;h<u;h+=2)e[h]=(e[h]-o)/l,e[h+1]=(e[h+1]-a)/c}toSVGPath(){const t=[`M${this.#Xr[4]} ${this.#Xr[5]}`];for(let e=6,n=this.#Xr.length;e<n;e+=6)isNaN(this.#Xr[e])?t.push(`L${this.#Xr[e+4]} ${this.#Xr[e+5]}`):t.push(`C${this.#Xr[e]} ${this.#Xr[e+1]} ${this.#Xr[e+2]} ${this.#Xr[e+3]} ${this.#Xr[e+4]} ${this.#Xr[e+5]}`);return t.push("Z"),t.join(" ")}serialize(t,e){let[n,i,s,r]=t;const o=s-n,a=r-i;let l,c;switch(e){case 0:l=ta._rescale(this.#Xr,n,r,o,-a),c=ta._rescale(this.#Fr,n,r,o,-a);break;case 90:l=ta._rescaleAndSwap(this.#Xr,n,i,o,a),c=ta._rescaleAndSwap(this.#Fr,n,i,o,a);break;case 180:l=ta._rescale(this.#Xr,s,i,-o,a),c=ta._rescale(this.#Fr,s,i,-o,a);break;case 270:l=ta._rescaleAndSwap(this.#Xr,s,r,-o,-a),c=ta._rescaleAndSwap(this.#Fr,s,r,-o,-a)}return{outline:Array.from(l),points:[Array.from(c)]}}#Yr(t){const e=this.#Xr;let n=e[4],i=e[5];const s=[n,i,n,i];let r=n,o=i;const a=t?Math.max:Math.min;for(let c=6,h=e.length;c<h;c+=6){const t=e[c+4],l=e[c+5];if(isNaN(e[c]))Si.pointBoundingBox(t,l,s),o<l?(r=t,o=l):o===l&&(r=a(r,t));else{const t=[1/0,1/0,-1/0,-1/0];Si.bezierBoundingBox(n,i,...e.slice(c,c+6),t),Si.rectBoundingBox(...t,s),o<t[3]?(r=t[2],o=t[3]):o===t[3]&&(r=a(r,t[2]))}n=t,i=l}const l=this.#Kr;l[0]=s[0]-this.#Tr,l[1]=s[1]-this.#Tr,l[2]=s[2]-s[0]+2*this.#Tr,l[3]=s[3]-s[1]+2*this.#Tr,this.lastPoint=[r,o]}get box(){return this.#Kr}newOutliner(t,e,n,i,s){return new ea(t,e,n,i,s,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}getNewOutline(t,e){const[n,i,s,r]=this.#Kr,[o,a,l,c]=this.#Er,h=s*l,u=r*c,d=n*l+o,p=i*c+a,f=this.newOutliner({x:this.#Fr[0]*h+d,y:this.#Fr[1]*u+p},this.#Er,this.#Nr,t,this.#Pr,e??this.#Tr);for(let g=2;g<this.#Fr.length;g+=2)f.add({x:this.#Fr[g]*h+d,y:this.#Fr[g+1]*u+p});return f.getOutlines()}}class ia{#Er;#Jr;#Qr=[];#to=[];constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:d,y:p,width:f,height:g}of t){const t=Math.floor((d-e)/r)*r,n=Math.ceil((d+f+e)/r)*r,i=Math.floor((p-e)/r)*r,o=Math.ceil((p+g+e)/r)*r,a=[t,i,o,!0],l=[n,i,o,!1];this.#Qr.push(a,l),Si.rectBoundingBox(t,i,n,o,s)}const o=s[2]-s[0]+2*n,a=s[3]-s[1]+2*n,l=s[0]-n,c=s[1]-n,h=this.#Qr.at(i?-1:-2),u=[h[0],h[2]];for(const d of this.#Qr){const[t,e,n]=d;d[0]=(t-l)/o,d[1]=(e-c)/a,d[2]=(n-c)/a}this.#Er=new Float32Array([l,c,o,a]),this.#Jr=u}getOutlines(){this.#Qr.sort((t,e)=>t[0]-e[0]||t[1]-e[1]||t[2]-e[2]);const t=[];for(const e of this.#Qr)e[3]?(t.push(...this.#eo(e)),this.#no(e)):(this.#io(e),t.push(...this.#eo(e)));return this.#so(t)}#so(t){const e=[],n=new Set;for(const r of t){const[t,n,i]=r;e.push([t,n,r],[t,i,r])}e.sort((t,e)=>t[1]-e[1]||t[0]-e[0]);for(let r=0,o=e.length;r<o;r+=2){const t=e[r][2],i=e[r+1][2];t.push(i),i.push(t),n.add(t),n.add(i)}const i=[];let s;for(;n.size>0;){const t=n.values().next().value;let[e,r,o,a,l]=t;n.delete(t);let c=e,h=r;for(s=[e,o],i.push(s);;){let t;if(n.has(a))t=a;else{if(!n.has(l))break;t=l}n.delete(t),[e,r,o,a,l]=t,c!==e&&(s.push(c,h,e,h===r?r:o),c=e),h=h===r?o:r}s.push(c,h)}return new sa(i,this.#Er,this.#Jr)}#ro(t){const e=this.#to;let n=0,i=e.length-1;for(;n<=i;){const s=n+i>>1,r=e[s][0];if(r===t)return s;r<t?n=s+1:i=s-1}return i+1}#no(t){let[,e,n]=t;const i=this.#ro(e);this.#to.splice(i,0,[e,n])}#io(t){let[,e,n]=t;const i=this.#ro(e);for(let s=i;s<this.#to.length;s++){const[t,i]=this.#to[s];if(t!==e)break;if(t===e&&i===n)return void this.#to.splice(s,1)}for(let s=i-1;s>=0;s--){const[t,i]=this.#to[s];if(t!==e)break;if(t===e&&i===n)return void this.#to.splice(s,1)}}#eo(t){const[e,n,i]=t,s=[[e,n,i]],r=this.#ro(i);for(let o=0;o<r;o++){const[t,n]=this.#to[o];for(let i=0,r=s.length;i<r;i++){const[,o,a]=s[i];if(!(n<=o||a<=t))if(o>=t)if(a>n)s[i][1]=n;else{if(1===r)return[];s.splice(i,1),i--,r--}else s[i][2]=t,a>n&&s.push([e,n,a])}}return s}}class sa extends ta{#Er;#oo;constructor(t,e,n){super(),this.#oo=t,this.#Er=e,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#oo){let[n,i]=e;t.push(`M${n} ${i}`);for(let s=2;s<e.length;s+=2){const r=e[s],o=e[s+1];r===n?(t.push(`V${o}`),i=o):o===i&&(t.push(`H${r}`),n=r)}t.push("Z")}return t.join(" ")}serialize(t,e){let[n,i,s,r]=t;const o=[],a=s-n,l=r-i;for(const c of this.#oo){const t=new Array(c.length);for(let e=0;e<c.length;e+=2)t[e]=n+c[e]*a,t[e+1]=r-c[e+1]*l;o.push(t)}return o}get box(){return this.#Er}get classNamesForOutlining(){return["highlightOutline"]}}class ra extends ea{newFreeDrawOutline(t,e,n,i,s,r){return new oa(t,e,n,i,s,r)}}class oa extends na{newOutliner(t,e,n,i,s){return new ra(t,e,n,i,s,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}}class aa extends os{#ao=null;#lo=0;#co;#ho=null;#s=null;#uo=null;#do=null;#po=0;#fo=null;#go=null;#_=null;#mo=!1;#Jr=null;#vo;#yo=null;#se="";#zr;#bo="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=(()=>On.HIGHLIGHT)();static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=aa.prototype;return ui(this,"_keyboardManager",new ts([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||aa._defaultColor,this.#zr=t.thickness||aa._defaultThickness,this.#vo=t.opacity||aa._defaultOpacity,this.#co=t.boxes||null,this.#bo=t.methodOfCreation||"",this.#se=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#mo=!0,this.#_o(t),this.#wo()):this.#co&&(this.#ao=t.anchorNode,this.#lo=t.anchorOffset,this.#do=t.focusNode,this.#po=t.focusOffset,this.#xo(),this.#wo(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#mo?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#zr,methodOfCreation:this.#bo}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#xo(){const t=new ia(this.#co,.001);this.#go=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#go.box;const e=new ia(this.#co,.0025,.001,"ltr"===this._uiManager.direction);this.#uo=e.getOutlines();const{lastPoint:n}=this.#uo;this.#Jr=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#_o(t){let{highlightOutlines:e,highlightId:n,clipPathId:i}=t;this.#go=e;if(this.#uo=e.getNewOutline(this.#zr/2+1.5,.0025),n>=0)this.#_=n,this.#ho=i,this.parent.drawLayer.finalizeDraw(n,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#yo=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#uo.box,path:{d:this.#uo.toSVGPath()}},!0);else if(this.parent){const t=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#_,{bbox:aa.#So(this.#go.box,(t-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#yo,{bbox:aa.#So(this.#uo.box,t),path:{d:this.#uo.toSVGPath()}})}const[s,r,o,a]=e.box;switch(this.rotation){case 0:this.x=s,this.y=r,this.width=o,this.height=a;break;case 90:{const[t,e]=this.parentDimensions;this.x=r,this.y=1-s,this.width=o*e/t,this.height=a*t/e;break}case 180:this.x=1-s,this.y=1-r,this.width=o,this.height=a;break;case 270:{const[t,e]=this.parentDimensions;this.x=1-r,this.y=s,this.width=o*e/t,this.height=a*t/e;break}}const{lastPoint:l}=this.#uo;this.#Jr=[(l[0]-s)/o,(l[1]-r)/a]}static initialize(t,e){os.initialize(t,e),aa._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case Nn.HIGHLIGHT_COLOR:aa._defaultColor=e;break;case Nn.HIGHLIGHT_THICKNESS:aa._defaultThickness=e}}translateInPage(t,e){}get toolbarPosition(){return this.#Jr}updateParams(t,e){switch(t){case Nn.HIGHLIGHT_COLOR:this.#yr(e);break;case Nn.HIGHLIGHT_THICKNESS:this.#Ao(e)}}static get defaultPropertiesToUpdate(){return[[Nn.HIGHLIGHT_COLOR,aa._defaultColor],[Nn.HIGHLIGHT_THICKNESS,aa._defaultThickness]]}get propertiesToUpdate(){return[[Nn.HIGHLIGHT_COLOR,this.color||aa._defaultColor],[Nn.HIGHLIGHT_THICKNESS,this.#zr||aa._defaultThickness],[Nn.HIGHLIGHT_FREE,this.#mo]]}#yr(t){const e=(t,e)=>{this.color=t,this.#vo=e,this.parent?.drawLayer.updateProperties(this.#_,{root:{fill:t,"fill-opacity":e}}),this.#s?.updateColor(t)},n=this.color,i=this.#vo;this.addCommands({cmd:e.bind(this,t,aa._defaultOpacity),undo:e.bind(this,n,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nn.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#Ao(t){const e=this.#zr,n=t=>{this.#zr=t,this.#ko(t)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nn.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){if(this._uiManager.highlightColors){return[["colorPicker",this.#s=new fo({editor:this})]]}return super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#Eo())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#Eo())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#Co(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#wo(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#Co():t&&(this.#wo(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#ko(t){if(!this.#mo)return;this.#_o({highlightOutlines:this.#go.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}#Co(){null!==this.#_&&this.parent&&(this.parent.drawLayer.remove(this.#_),this.#_=null,this.parent.drawLayer.remove(this.#yo),this.#yo=null)}#wo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null===this.#_&&(({id:this.#_,clipPathId:this.#ho}=t.drawLayer.draw({bbox:this.#go.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#vo},rootClass:{highlight:!0,free:this.#mo},path:{d:this.#go.toSVGPath()}},!1,!0)),this.#yo=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#mo},bbox:this.#uo.box,path:{d:this.#uo.toSVGPath()}},this.#mo),this.#fo&&(this.#fo.style.clipPath=this.#ho))}static#So(t,e){let[n,i,s,r]=t;switch(e){case 90:return[1-i-r,n,r,s];case 180:return[1-n-s,1-i-r,s,r];case 270:return[i,1-n-s,r,s]}return[n,i,s,r]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#mo?(t=(t-this.rotation+360)%360,n=aa.#So(this.#go.box,t)):n=aa.#So([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#_,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#yo,{bbox:aa.#So(this.#uo.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#se&&(t.setAttribute("aria-label",this.#se),t.setAttribute("role","mark")),this.#mo?t.classList.add("free"):this.div.addEventListener("keydown",this.#To.bind(this),{signal:this._uiManager._signal});const e=this.#fo=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#ho;const[n,i]=this.parentDimensions;return this.setDims(this.width*n,this.height*i),Xi(this,this.#fo,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#yo,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#yo,{rootClass:{hovered:!1}})}#To(t){aa._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#Po(!0);break;case 1:case 3:this.#Po(!1)}}#Po(t){if(!this.#ao)return;const e=window.getSelection();t?e.setPosition(this.#ao,this.#lo):e.setPosition(this.#do,this.#po)}select(){super.select(),this.#yo&&this.parent?.drawLayer.updateProperties(this.#yo,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#yo&&(this.parent?.drawLayer.updateProperties(this.#yo,{rootClass:{selected:!1}}),this.#mo||this.#Po(!1))}get _mustFixPosition(){return!this.#mo}show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#_,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#yo,{rootClass:{hidden:!t}}))}#Eo(){return this.#mo?this.rotation:0}#Lo(){if(this.#mo)return null;const[t,e]=this.pageDimensions,[n,i]=this.pageTranslation,s=this.#co,r=new Float32Array(8*s.length);let o=0;for(const{x:a,y:l,width:c,height:h}of s){const s=a*t+n,u=(1-l)*e+i;r[o]=r[o+4]=s,r[o+1]=r[o+3]=u,r[o+2]=r[o+6]=s+c*t,r[o+5]=r[o+7]=u-h*e,o+=8}return r}#Mo(t){return this.#go.serialize(t,this.#Eo())}static startHighlighting(t,e,n){let{target:i,x:s,y:r}=n;const{x:o,y:a,width:l,height:c}=i.getBoundingClientRect(),h=new AbortController,u=t.combinedSignal(h),d=e=>{h.abort(),this.#Io(t,e)};window.addEventListener("blur",d,{signal:u}),window.addEventListener("pointerup",d,{signal:u}),window.addEventListener("pointerdown",Bi,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",ji,{signal:u}),i.addEventListener("pointermove",this.#Ro.bind(this,t),{signal:u}),this._freeHighlight=new ra({x:s,y:r},[o,a,l,c],t.scale,this._defaultThickness/2,e,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0))}static#Ro(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#Io(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let i=null;if(t instanceof Vo){const{data:{quadPoints:e,rect:n,rotation:s,id:r,color:o,opacity:a,popupRef:l,contentsObj:c},parent:{page:{pageNumber:h}}}=t;i=t={annotationType:On.HIGHLIGHT,color:Array.from(o),opacity:a,quadPoints:e,boxes:null,pageIndex:h-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:l,comment:c?.str||null}}else if(t instanceof Wo){const{data:{inkLists:e,rect:n,rotation:s,id:r,color:o,borderStyle:{rawWidth:a},popupRef:l,contentsObj:c},parent:{page:{pageNumber:h}}}=t;i=t={annotationType:On.HIGHLIGHT,color:Array.from(o),thickness:a,inkLists:e,boxes:null,pageIndex:h-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:l,comment:c?.str||null}}const{color:s,quadPoints:r,inkLists:o,opacity:a}=t,l=await super.deserialize(t,e,n);l.color=Si.makeHexColor(...s),l.#vo=a||1,o&&(l.#zr=t.thickness),l._initialData=i,t.comment&&l.setCommentData(t.comment);const[c,h]=l.pageDimensions,[u,d]=l.pageTranslation;if(r){const t=l.#co=[];for(let e=0;e<r.length;e+=8)t.push({x:(r[e]-u)/c,y:1-(r[e+1]-d)/h,width:(r[e+2]-r[e])/c,height:(r[e+1]-r[e+5])/h});l.#xo(),l.#wo(),l.rotate(l.rotation)}else if(o){l.#mo=!0;const t=o[0],n={x:t[0]-u,y:h-(t[1]-d)},i=new ra(n,[0,0,c,h],1,l.#zr/2,!0,.001);for(let e=0,o=t.length;e<o;e+=2)n.x=t[e]-u,n.y=h-(t[e+1]-d),i.add(n);const{id:s,clipPathId:r}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:l.color,"fill-opacity":l._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:i.toSVGPath()}},!0,!0);l.#_o({highlightOutlines:i.getOutlines(),highlightId:s,clipPathId:r}),l.#wo(),l.rotate(l.parentRotation)}return l}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getRect(0,0),n=os._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i={annotationType:On.HIGHLIGHT,color:n,opacity:this.#vo,thickness:this.#zr,quadPoints:this.#Lo(),outlines:this.#Mo(e),pageIndex:this.pageIndex,rect:e,rotation:this.#Eo(),structTreeParentId:this._structTreeParentId};return this.addComment(i),this.annotationElementId&&!this.#kr(i)?null:(i.id=this.annotationElementId,i)}#kr(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((t,n)=>t!==e[n])}renderAnnotationElement(t){const e={rect:this.getRect(0,0)};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}static canCreateNewEmptyEditor(){return!1}}class la{#Do=(()=>Object.create(null))();updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#Do[t]=e}toSVGProperties(){const t=this.#Do;return this.#Do=Object.create(null),{root:t}}reset(){this.#Do=Object.create(null)}updateAll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this.updateProperties(t)}clone(){ai("Not implemented")}}class ca extends os{#Oo=null;#No;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#zo=null;static#Fo=null;static#jo=null;static#Bo=NaN;static#Uo=null;static#Ho=null;static#$o=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#No=t.mustBeCommitted||!1,this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(this.#Wo(t),this.#wo())}#Wo(t){let{drawOutlines:e,drawId:n,drawingOptions:i}=t;this.#Oo=e,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,e.defaultProperties)):this._drawId=this.#Vo(e,this.parent),this.#Go(e.box)}#Vo(t,e){const{id:n}=e.drawLayer.draw(ca._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[i,s]of Object.entries(e))n.has(i)?Object.assign(t[i],s):t[i]=s;return t}static getDefaultDrawingOptions(t){ai("Not implemented")}static get typesMap(){ai("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(ca.#zo.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,i]of this.typesMap)t.push([n,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,i]of this.constructor.typesMap)t.push([n,e[i]]);return t}_updateProperty(t,e,n){const i=this._drawingOptions,s=i[e],r=n=>{i.updateProperty(e,n);const s=this.#Oo.updateProperty(e,n);s&&this.#Go(s),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),t===this.colorType&&this._colorPicker?.update(n)};this.addCommands({cmd:r.bind(this,n),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ca._mergeSVGProperties(this.#Oo.getPathResizingSVGProperties(this.#qo()),{bbox:this.#Zo()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ca._mergeSVGProperties(this.#Oo.getPathResizedSVGProperties(this.#qo()),{bbox:this.#Zo()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#Zo()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ca._mergeSVGProperties(this.#Oo.getPathTranslatedSVGProperties(this.#qo(),this.parentDimensions),{bbox:this.#Zo()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#No&&(this.#No=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#Co(),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#wo(),this.#Go(this.#Oo.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#Co()):t&&(this._uiManager.addShouldRescale(this),this.#wo(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#Co(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#wo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null!==this._drawId&&this.parent===t||(null===this._drawId?(this._drawingOptions.updateAll(),this._drawId=this.#Vo(this.#Oo,t)):this.parent.drawLayer.updateParent(this._drawId,t.drawLayer))}#Ko(t){let[e,n,i,s]=t;const{parentDimensions:[r,o],rotation:a}=this;switch(a){case 90:return[n,1-e,i*(o/r),s*(r/o)];case 180:return[1-e,1-n,i,s];case 270:return[1-n,e,i*(o/r),s*(r/o)];default:return[e,n,i,s]}}#qo(){const{x:t,y:e,width:n,height:i,parentDimensions:[s,r],rotation:o}=this;switch(o){case 90:return[1-e,t,n*(s/r),i*(r/s)];case 180:return[1-t,1-e,n,i];case 270:return[e,1-t,n*(s/r),i*(r/s)];default:return[t,e,n,i]}}#Go(t){if([this.x,this.y,this.width,this.height]=this.#Ko(t),this.div){this.fixAndSetPosition();const[t,e]=this.parentDimensions;this.setDims(this.width*t,this.height*e)}this._onResized()}#Zo(){const{x:t,y:e,width:n,height:i,rotation:s,parentRotation:r,parentDimensions:[o,a]}=this;switch((4*s+r)/90){case 1:return[1-e-i,t,i,n];case 2:return[1-t-n,1-e-i,n,i];case 3:return[e,1-t-n,i,n];case 4:return[t,e-n*(o/a),i*(a/o),n*(o/a)];case 5:return[1-e,t,n*(o/a),i*(a/o)];case 6:return[1-t-i*(a/o),1-e,i*(a/o),n*(o/a)];case 7:return[e-n*(o/a),1-t-i*(a/o),n*(o/a),i*(a/o)];case 8:return[t-n,e-i,n,i];case 9:return[1-e,t-n,i,n];case 10:return[1-t,1-e,n,i];case 11:return[e-i,1-t,i,n];case 12:return[t-i*(a/o),e,i*(a/o),n*(o/a)];case 13:return[1-e-n*(o/a),t-i*(a/o),n*(o/a),i*(a/o)];case 14:return[1-t,1-e-n*(o/a),i*(a/o),n*(o/a)];case 15:return[e,1-t,n*(o/a),i*(a/o)];default:return[t,e,n,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ca._mergeSVGProperties({bbox:this.#Zo()},this.#Oo.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#Go(this.#Oo.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const i=document.createElement("div");n.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,i,s){ai("Not implemented")}static startDrawing(t,e,n,i){const{target:s,offsetX:r,offsetY:o,pointerId:a,pointerType:l}=i;if(ca.#Uo&&ca.#Uo!==l)return;const{viewport:{rotation:c}}=t,{width:h,height:u}=s.getBoundingClientRect(),d=ca.#Fo=new AbortController,p=t.combinedSignal(d);ca.#Bo||=a,ca.#Uo??=l,window.addEventListener("pointerup",t=>{ca.#Bo===t.pointerId?this._endDraw(t):ca.#Ho?.delete(t.pointerId)},{signal:p}),window.addEventListener("pointercancel",t=>{ca.#Bo===t.pointerId?this._currentParent.endDrawingSession():ca.#Ho?.delete(t.pointerId)},{signal:p}),window.addEventListener("pointerdown",t=>{ca.#Uo===t.pointerType&&((ca.#Ho||=new Set).add(t.pointerId),ca.#zo.isCancellable()&&(ca.#zo.removeLastElement(),ca.#zo.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",ji,{signal:p}),s.addEventListener("pointermove",this._drawMove.bind(this),{signal:p}),s.addEventListener("touchmove",t=>{t.timeStamp===ca.#$o&&Bi(t)},{signal:p}),t.toggleDrawing(),e._editorUndoBar?.hide(),ca.#zo?t.drawLayer.updateProperties(this._currentDrawId,ca.#zo.startNew(r,o,h,u,c)):(e.updateUIForDefaultProperties(this),ca.#zo=this.createDrawerInstance(r,o,h,u,c),ca.#jo=this.getDefaultDrawingOptions(),this._currentParent=t,({id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(ca.#jo.toSVGProperties(),ca.#zo.defaultSVGProperties),!0,!1)))}static _drawMove(t){if(ca.#$o=-1,!ca.#zo)return;const{offsetX:e,offsetY:n,pointerId:i}=t;ca.#Bo===i&&(ca.#Ho?.size>=1?this._endDraw(t):(this._currentParent.drawLayer.updateProperties(this._currentDrawId,ca.#zo.add(e,n)),ca.#$o=t.timeStamp,Bi(t)))}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,ca.#zo=null,ca.#jo=null,ca.#Uo=null,ca.#$o=NaN),ca.#Fo&&(ca.#Fo.abort(),ca.#Fo=null,ca.#Bo=NaN,ca.#Ho=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,ca.#zo.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const t=ca.#zo,n=this._currentDrawId,i=t.getLastElement();return void e.addCommands({cmd:()=>{e.drawLayer.updateProperties(n,t.setLastElement(i))},undo:()=>{e.drawLayer.updateProperties(n,t.removeLastElement())},mustExec:!1,type:Nn.DRAW_STEP})}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(Nn.DRAW_STEP),!ca.#zo.isEmpty()){const{pageDimensions:[n,i],scale:s}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:ca.#zo.getOutlines(n*s,i*s,s,this._INNER_MARGIN),drawingOptions:ca.#jo,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,i,s,r){ai("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:i,pageHeight:s,pageX:r,pageY:o}}=e.viewport,a=this.deserializeDraw(r,o,i,s,this._INNER_MARGIN,t),l=await super.deserialize(t,e,n);return l.createDrawingOptions(t),l.#Wo({drawOutlines:a}),l.#wo(),l.onScaleChanging(),l.rotate(),l}serializeDraw(t){const[e,n]=this.pageTranslation,[i,s]=this.pageDimensions;return this.#Oo.serialize([e,n,i,s],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class ha{#Mr=(()=>new Float64Array(6))();#Qs;#Xo;#pi;#zr;#Fr;#Yo="";#Jo=0;#oo=(()=>new ua)();#Qo;#ta;constructor(t,e,n,i,s,r){this.#Qo=n,this.#ta=i,this.#pi=s,this.#zr=r,[t,e]=this.#ea(t,e);const o=this.#Qs=[NaN,NaN,NaN,NaN,t,e];this.#Fr=[t,e],this.#Xo=[{line:o,points:this.#Fr}],this.#Mr.set(o,0)}updateProperty(t,e){"stroke-width"===t&&(this.#zr=e)}#ea(t,e){return ta._normalizePoint(t,e,this.#Qo,this.#ta,this.#pi)}isEmpty(){return!this.#Xo||0===this.#Xo.length}isCancellable(){return this.#Fr.length<=10}add(t,e){[t,e]=this.#ea(t,e);const[n,i,s,r]=this.#Mr.subarray(2,6),o=t-s,a=e-r;return Math.hypot(this.#Qo*o,this.#ta*a)<=2?null:(this.#Fr.push(t,e),isNaN(n)?(this.#Mr.set([s,r,t,e],2),this.#Qs.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#Mr[0])&&this.#Qs.splice(6,6),this.#Mr.set([n,i,s,r,t,e],0),this.#Qs.push(...ta.createBezierPoints(n,i,s,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(2===this.#Fr.length?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,i,s){this.#Qo=n,this.#ta=i,this.#pi=s,[t,e]=this.#ea(t,e);const r=this.#Qs=[NaN,NaN,NaN,NaN,t,e];this.#Fr=[t,e];const o=this.#Xo.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#Xo.push({line:r,points:this.#Fr}),this.#Mr.set(r,0),this.#Jo=0,this.toSVGPath(),null}getLastElement(){return this.#Xo.at(-1)}setLastElement(t){return this.#Xo?(this.#Xo.push(t),this.#Qs=t.line,this.#Fr=t.points,this.#Jo=0,{path:{d:this.toSVGPath()}}):this.#oo.setLastElement(t)}removeLastElement(){if(!this.#Xo)return this.#oo.removeLastElement();this.#Xo.pop(),this.#Yo="";for(let t=0,e=this.#Xo.length;t<e;t++){const{line:e,points:n}=this.#Xo[t];this.#Qs=e,this.#Fr=n,this.#Jo=0,this.toSVGPath()}return{path:{d:this.#Yo}}}toSVGPath(){const t=ta.svgRound(this.#Qs[4]),e=ta.svgRound(this.#Qs[5]);if(2===this.#Fr.length)return this.#Yo=`${this.#Yo} M ${t} ${e} Z`,this.#Yo;if(this.#Fr.length<=6){const n=this.#Yo.lastIndexOf("M");this.#Yo=`${this.#Yo.slice(0,n)} M ${t} ${e}`,this.#Jo=6}if(4===this.#Fr.length){const t=ta.svgRound(this.#Qs[10]),e=ta.svgRound(this.#Qs[11]);return this.#Yo=`${this.#Yo} L ${t} ${e}`,this.#Jo=12,this.#Yo}const n=[];0===this.#Jo&&(n.push(`M ${t} ${e}`),this.#Jo=6);for(let i=this.#Jo,s=this.#Qs.length;i<s;i+=6){const[t,e,s,r,o,a]=this.#Qs.slice(i,i+6).map(ta.svgRound);n.push(`C${t} ${e} ${s} ${r} ${o} ${a}`)}return this.#Yo+=n.join(" "),this.#Jo=this.#Qs.length,this.#Yo}getOutlines(t,e,n,i){const s=this.#Xo.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#oo.build(this.#Xo,t,e,n,this.#pi,this.#zr,i),this.#Mr=null,this.#Qs=null,this.#Xo=null,this.#Yo=null,this.#oo}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class ua extends ta{#Kr;#na=0;#Tr;#Xo;#Qo;#ta;#ia;#pi;#zr;build(t,e,n,i,s,r,o){this.#Qo=e,this.#ta=n,this.#ia=i,this.#pi=s,this.#zr=r,this.#Tr=o??0,this.#Xo=t,this.#sa()}get thickness(){return this.#zr}setLastElement(t){return this.#Xo.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#Xo.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#Xo)if(t.push(`M${ta.svgRound(e[4])} ${ta.svgRound(e[5])}`),6!==e.length)if(12===e.length&&isNaN(e[6]))t.push(`L${ta.svgRound(e[10])} ${ta.svgRound(e[11])}`);else for(let n=6,i=e.length;n<i;n+=6){const[i,s,r,o,a,l]=e.subarray(n,n+6).map(ta.svgRound);t.push(`C${i} ${s} ${r} ${o} ${a} ${l}`)}else t.push("Z");return t.join("")}serialize(t,e){let[n,i,s,r]=t;const o=[],a=[],[l,c,h,u]=this.#ra();let d,p,f,g,m,v,y,b,_;switch(this.#pi){case 0:_=ta._rescale,d=n,p=i+r,f=s,g=-r,m=n+l*s,v=i+(1-c-u)*r,y=n+(l+h)*s,b=i+(1-c)*r;break;case 90:_=ta._rescaleAndSwap,d=n,p=i,f=s,g=r,m=n+c*s,v=i+l*r,y=n+(c+u)*s,b=i+(l+h)*r;break;case 180:_=ta._rescale,d=n+s,p=i,f=-s,g=r,m=n+(1-l-h)*s,v=i+c*r,y=n+(1-l)*s,b=i+(c+u)*r;break;case 270:_=ta._rescaleAndSwap,d=n+s,p=i+r,f=-s,g=-r,m=n+(1-c-u)*s,v=i+(1-l-h)*r,y=n+(1-c)*s,b=i+(1-l)*r}for(const{line:w,points:x}of this.#Xo)o.push(_(w,d,p,f,g,e?new Array(w.length):null)),a.push(_(x,d,p,f,g,e?new Array(x.length):null));return{lines:o,points:a,rect:[m,v,y,b]}}static deserialize(t,e,n,i,s,r){let{paths:{lines:o,points:a},rotation:l,thickness:c}=r;const h=[];let u,d,p,f,g;switch(l){case 0:g=ta._rescale,u=-t/n,d=e/i+1,p=1/n,f=-1/i;break;case 90:g=ta._rescaleAndSwap,u=-e/i,d=-t/n,p=1/i,f=1/n;break;case 180:g=ta._rescale,u=t/n+1,d=-e/i,p=-1/n,f=1/i;break;case 270:g=ta._rescaleAndSwap,u=e/i+1,d=t/n+1,p=-1/i,f=-1/n}if(!o){o=[];for(const t of a){const e=t.length;if(2===e){o.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1]]));continue}if(4===e){o.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1],NaN,NaN,NaN,NaN,t[2],t[3]]));continue}const n=new Float32Array(3*(e-2));o.push(n);let[i,s,r,a]=t.subarray(0,4);n.set([NaN,NaN,NaN,NaN,i,s],0);for(let o=4;o<e;o+=2){const e=t[o],l=t[o+1];n.set(ta.createBezierPoints(i,s,r,a,e,l),3*(o-2)),[i,s,r,a]=[r,a,e,l]}}}for(let v=0,y=o.length;v<y;v++)h.push({line:g(o[v].map(t=>t??NaN),u,d,p,f),points:g(a[v].map(t=>t??NaN),u,d,p,f)});const m=new this.prototype.constructor;return m.build(h,n,i,1,l,c,s),m}#oa(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.#zr;const e=this.#Tr+t/2*this.#ia;return this.#pi%180===0?[e/this.#Qo,e/this.#ta]:[e/this.#ta,e/this.#Qo]}#ra(){const[t,e,n,i]=this.#Kr,[s,r]=this.#oa(0);return[t+s,e+r,n-2*s,i-2*r]}#sa(){const t=this.#Kr=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#Xo){if(i.length<=12){for(let e=4,n=i.length;e<n;e+=6)Si.pointBoundingBox(i[e],i[e+1],t);continue}let e=i[4],n=i[5];for(let s=6,r=i.length;s<r;s+=6){const[r,o,a,l,c,h]=i.subarray(s,s+6);Si.bezierBoundingBox(e,n,r,o,a,l,c,h,t),e=c,n=h}}const[e,n]=this.#oa();t[0]=Ti(t[0]-e,0,1),t[1]=Ti(t[1]-n,0,1),t[2]=Ti(t[2]+e,0,1),t[3]=Ti(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#Kr}updateProperty(t,e){return"stroke-width"===t?this.#Ao(e):null}#Ao(t){const[e,n]=this.#oa();this.#zr=t;const[i,s]=this.#oa(),[r,o]=[i-e,s-n],a=this.#Kr;return a[0]-=r,a[1]-=o,a[2]+=2*r,a[3]+=2*o,a}updateParentDimensions(t,e){let[n,i]=t;const[s,r]=this.#oa();this.#Qo=n,this.#ta=i,this.#ia=e;const[o,a]=this.#oa(),l=o-s,c=a-r,h=this.#Kr;return h[0]-=l,h[1]-=c,h[2]+=2*l,h[3]+=2*c,h}updateRotation(t){return this.#na=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#Kr.map(ta.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#Kr;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ta.svgRound(t)} ${ta.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#Kr;let n=0,i=0,s=0,r=0,o=0,a=0;switch(this.#na){case 90:i=e/t,s=-t/e,o=t;break;case 180:n=-1,r=-1,o=t,a=e;break;case 270:i=-e/t,s=t/e,a=e;break;default:return""}return`matrix(${n} ${i} ${s} ${r} ${ta.svgRound(o)} ${ta.svgRound(a)})`}getPathResizingSVGProperties(t){let[e,n,i,s]=t;const[r,o]=this.#oa(),[a,l,c,h]=this.#Kr;if(Math.abs(c-r)<=ta.PRECISION||Math.abs(h-o)<=ta.PRECISION){const t=e+i/2-(a+c/2),r=n+s/2-(l+h/2);return{path:{"transform-origin":`${ta.svgRound(e)} ${ta.svgRound(n)}`,transform:`${this.rotationTransform} translate(${t} ${r})`}}}const u=(i-2*r)/(c-2*r),d=(s-2*o)/(h-2*o),p=c/i,f=h/s;return{path:{"transform-origin":`${ta.svgRound(a)} ${ta.svgRound(l)}`,transform:`${this.rotationTransform} scale(${p} ${f}) translate(${ta.svgRound(r)} ${ta.svgRound(o)}) scale(${u} ${d}) translate(${ta.svgRound(-r)} ${ta.svgRound(-o)})`}}}getPathResizedSVGProperties(t){let[e,n,i,s]=t;const[r,o]=this.#oa(),a=this.#Kr,[l,c,h,u]=a;if(a[0]=e,a[1]=n,a[2]=i,a[3]=s,Math.abs(h-r)<=ta.PRECISION||Math.abs(u-o)<=ta.PRECISION){const t=e+i/2-(l+h/2),r=n+s/2-(c+u/2);for(const{line:e,points:n}of this.#Xo)ta._translate(e,t,r,e),ta._translate(n,t,r,n);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ta.svgRound(e)} ${ta.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const d=(i-2*r)/(h-2*r),p=(s-2*o)/(u-2*o),f=-d*(l+r)+e+r,g=-p*(c+o)+n+o;if(1!==d||1!==p||0!==f||0!==g)for(const{line:m,points:v}of this.#Xo)ta._rescale(m,f,g,d,p,m),ta._rescale(v,f,g,d,p,v);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ta.svgRound(e)} ${ta.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties(t,e){let[n,i]=t;const[s,r]=e,o=this.#Kr,a=n-o[0],l=i-o[1];if(this.#Qo===s&&this.#ta===r)for(const{line:c,points:h}of this.#Xo)ta._translate(c,a,l,c),ta._translate(h,a,l,h);else{const t=this.#Qo/s,e=this.#ta/r;this.#Qo=s,this.#ta=r;for(const{line:n,points:i}of this.#Xo)ta._rescale(n,a,l,t,e,n),ta._rescale(i,a,l,t,e,i);o[2]*=t,o[3]*=e}return o[0]=n,o[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${ta.svgRound(n)} ${ta.svgRound(i)}`}}}get defaultSVGProperties(){const t=this.#Kr;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${ta.svgRound(t[0])} ${ta.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class da extends la{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:os._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){"stroke-width"===t&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new da(this._viewParameters);return t.updateAll(this),t}}class pa extends ca{static _type="ink";static _editorType=(()=>On.INK)();static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){os.initialize(t,e),this._defaultDrawingOptions=new da(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return ui(this,"typesMap",new Map([[Nn.INK_THICKNESS,"stroke-width"],[Nn.INK_COLOR,"stroke"],[Nn.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,i,s){return new ha(t,e,n,i,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,i,s,r){return ua.deserialize(t,e,n,i,s,r)}static async deserialize(t,e,n){let i=null;if(t instanceof Wo){const{data:{inkLists:e,rect:n,rotation:s,id:r,color:o,opacity:a,borderStyle:{rawWidth:l},popupRef:c,contentsObj:h},parent:{page:{pageNumber:u}}}=t;i=t={annotationType:On.INK,color:Array.from(o),thickness:l,opacity:a,paths:{points:e},boxes:null,pageIndex:u-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:c,comment:h?.str||null}}const s=await super.deserialize(t,e,n);return s._initialData=i,t.comment&&s.setCommentData(t.comment),s}get toolbarButtons(){return this._colorPicker||=new go(this),[["colorPicker",this._colorPicker]]}get colorType(){return Nn.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions(t){let{color:e,thickness:n,opacity:i}=t;this._drawingOptions=pa.getDefaultDrawingOptions({stroke:Si.makeHexColor(...e),"stroke-width":n,"stroke-opacity":i})}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:s,"stroke-opacity":r,"stroke-width":o}}=this,a={annotationType:On.INK,color:os._colorManager.convert(s),opacity:r,thickness:o,paths:{lines:e,points:n},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#kr(a)?null:(a.id=this.annotationElementId,a)}#kr(t){const{color:e,thickness:n,opacity:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((t,n)=>t!==e[n])||t.thickness!==n||t.opacity!==i||t.pageIndex!==s}renderAnnotationElement(t){const{points:e,rect:n}=this.serializeDraw(!1),i={rect:n,thickness:this._drawingOptions["stroke-width"],points:e};return this.hasEditedComment&&(i.popup=this.comment),t.updateEdited(i),null}}class fa extends ua{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}class ga{static#aa={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#la(t,e,n,i){return i-=e,0===(n-=t)?i>0?0:4:1===n?i+6:2-i}static#ca=(()=>new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]))();static#ha(t,e,n,i,s,r,o){const a=this.#la(n,i,s,r);for(let l=0;l<8;l++){const s=(-l+a-o+16)%8;if(0!==t[(n+this.#ca[2*s])*e+(i+this.#ca[2*s+1])])return s}return-1}static#ua(t,e,n,i,s,r,o){const a=this.#la(n,i,s,r);for(let l=0;l<8;l++){const s=(l+a+o+16)%8;if(0!==t[(n+this.#ca[2*s])*e+(i+this.#ca[2*s+1])])return s}return-1}static#da(t,e,n,i){const s=t.length,r=new Int32Array(s);for(let c=0;c<s;c++)r[c]=t[c]<=i?1:0;for(let c=1;c<n-1;c++)r[c*e]=r[c*e+e-1]=0;for(let c=0;c<e;c++)r[c]=r[e*n-1-c]=0;let o,a=1;const l=[];for(let c=1;c<n-1;c++){o=1;for(let t=1;t<e-1;t++){const n=c*e+t,i=r[n];if(0===i)continue;let s=c,h=t;if(1===i&&0===r[n-1])a+=1,h-=1;else{if(!(i>=1&&0===r[n+1])){1!==i&&(o=Math.abs(i));continue}a+=1,h+=1,i>1&&(o=i)}const u=[t,c],d=h===t+1,p={isHole:d,points:u,id:a,parent:0};let f;l.push(p);for(const t of l)if(t.id===o){f=t;break}f?f.isHole?p.parent=d?f.parent:o:p.parent=d?o:f.parent:p.parent=d?o:0;const g=this.#ha(r,e,c,t,s,h,0);if(-1===g){r[n]=-a,1!==r[n]&&(o=Math.abs(r[n]));continue}let m=this.#ca[2*g],v=this.#ca[2*g+1];const y=c+m,b=t+v;s=y,h=b;let _=c,w=t;for(;;){const i=this.#ua(r,e,_,w,s,h,1);m=this.#ca[2*i],v=this.#ca[2*i+1];const l=_+m,d=w+v;u.push(d,l);const p=_*e+w;if(0===r[p+1]?r[p]=-a:1===r[p]&&(r[p]=a),l===c&&d===t&&_===y&&w===b){1!==r[n]&&(o=Math.abs(r[n]));break}s=_,h=w,_=l,w=d}}}return l}static#pa(t,e,n,i){if(n-e<=4){for(let s=e;s<n-2;s+=2)i.push(t[s],t[s+1]);return}const s=t[e],r=t[e+1],o=t[n-4]-s,a=t[n-3]-r,l=Math.hypot(o,a),c=o/l,h=a/l,u=c*r-h*s,d=a/o,p=1/l,f=Math.atan(d),g=Math.cos(f),m=Math.sin(f),v=p*(Math.abs(g)+Math.abs(m)),y=p*(1-v+v**2),b=Math.max(Math.atan(Math.abs(m+g)*y),Math.atan(Math.abs(m-g)*y));let _=0,w=e;for(let x=e+2;x<n-2;x+=2){const e=Math.abs(u-c*t[x+1]+h*t[x]);e>_&&(w=x,_=e)}_>(l*b)**2?(this.#pa(t,e,w+2,i),this.#pa(t,w,n,i)):i.push(s,r)}static#fa(t){const e=[],n=t.length;return this.#pa(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#ga(t,e,n,i,s,r){const o=new Float32Array(r**2),a=-2*i**2,l=r>>1;for(let f=0;f<r;f++){const t=(f-l)**2;for(let e=0;e<r;e++)o[f*r+e]=Math.exp((t+(e-l)**2)/a)}const c=new Float32Array(256),h=-2*s**2;for(let f=0;f<256;f++)c[f]=Math.exp(f**2/h);const u=t.length,d=new Uint8Array(u),p=new Uint32Array(256);for(let f=0;f<n;f++)for(let i=0;i<e;i++){const s=f*e+i,a=t[s];let h=0,u=0;for(let d=0;d<r;d++){const s=f+d-l;if(!(s<0||s>=n))for(let n=0;n<r;n++){const p=i+n-l;if(p<0||p>=e)continue;const f=t[s*e+p],g=o[d*r+n]*c[Math.abs(f-a)];h+=f*g,u+=g}}p[d[s]=Math.round(h/u)]++}return[d,p]}static#ma(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#va(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let i=-1/0,s=1/0;for(let o=0,a=n.length;o<a;o++){const e=n[o]=t[o<<2];i=Math.max(i,e),s=Math.min(s,e)}const r=255/(i-s);for(let o=0,a=n.length;o<a;o++)n[o]=(n[o]-s)*r;return n}static#ya(t){let e,n=-1/0,i=-1/0;const s=t.findIndex(t=>0!==t);let r=s,o=s;for(e=s;e<256;e++){const s=t[e];s>n&&(e-r>i&&(i=e-r,o=e-1),n=s,r=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#ba(t){const e=t,{width:n,height:i}=t,{maxDim:s}=this.#aa;let r=n,o=i;if(n>s||i>s){let a=n,l=i,c=Math.log2(Math.max(n,i)/s);const h=Math.floor(c);c=c===h?h-1:h;for(let n=0;n<c;n++){r=Math.ceil(a/2),o=Math.ceil(l/2);const n=new OffscreenCanvas(r,o);n.getContext("2d").drawImage(t,0,0,a,l,0,0,r,o),a=r,l=o,t!==e&&t.close(),t=n.transferToImageBitmap()}const u=Math.min(s/r,s/o);r=Math.round(r*u),o=Math.round(o*u)}const a=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});a.fillStyle="white",a.fillRect(0,0,r,o),a.filter="grayscale(1)",a.drawImage(t,0,0,t.width,t.height,0,0,r,o);const l=a.getImageData(0,0,r,o).data;return[this.#va(l),r,o]}static extractContoursFromText(t,e,n,i,s,r){let{fontFamily:o,fontStyle:a,fontWeight:l}=e,c=new OffscreenCanvas(1,1),h=c.getContext("2d",{alpha:!1});const u=h.font=`${a} ${l} 200px ${o}`,{actualBoundingBoxLeft:d,actualBoundingBoxRight:p,actualBoundingBoxAscent:f,actualBoundingBoxDescent:g,fontBoundingBoxAscent:m,fontBoundingBoxDescent:v,width:y}=h.measureText(t),b=1.5,_=Math.ceil(Math.max(Math.abs(d)+Math.abs(p)||0,y)*b),w=Math.ceil(Math.max(Math.abs(f)+Math.abs(g)||200,Math.abs(m)+Math.abs(v)||200)*b);c=new OffscreenCanvas(_,w),h=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=u,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,_,w),h.fillStyle="black",h.fillText(t,.5*_/2,1.5*w/2);const x=this.#va(h.getImageData(0,0,_,w).data),S=this.#ma(x),A=this.#ya(S),k=this.#da(x,_,w,A);return this.processDrawnLines({lines:{curves:k,width:_,height:w},pageWidth:n,pageHeight:i,rotation:s,innerMargin:r,mustSmooth:!0,areContours:!0})}static process(t,e,n,i,s){const[r,o,a]=this.#ba(t),[l,c]=this.#ga(r,o,a,Math.hypot(o,a)*this.#aa.sigmaSFactor,this.#aa.sigmaR,this.#aa.kernelSize),h=this.#ya(c),u=this.#da(l,o,a,h);return this.processDrawnLines({lines:{curves:u,width:o,height:a},pageWidth:e,pageHeight:n,rotation:i,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines(t){let{lines:e,pageWidth:n,pageHeight:i,rotation:s,innerMargin:r,mustSmooth:o,areContours:a}=t;s%180!==0&&([n,i]=[i,n]);const{curves:l,width:c,height:h}=e,u=e.thickness??0,d=[],p=Math.min(n/c,i/h),f=p/n,g=p/i,m=[];for(const{points:y}of l){const t=o?this.#fa(y):y;if(!t)continue;m.push(t);const e=t.length,n=new Float32Array(e),i=new Float32Array(3*(2===e?2:e-2));if(d.push({line:i,points:n}),2===e){n[0]=t[0]*f,n[1]=t[1]*g,i.set([NaN,NaN,NaN,NaN,n[0],n[1]],0);continue}let[s,r,a,l]=t;s*=f,r*=g,a*=f,l*=g,n.set([s,r,a,l],0),i.set([NaN,NaN,NaN,NaN,s,r],0);for(let o=4;o<e;o+=2){const e=n[o]=t[o]*f,c=n[o+1]=t[o+1]*g;i.set(ta.createBezierPoints(s,r,a,l,e,c),3*(o-2)),[s,r,a,l]=[a,l,e,c]}}if(0===d.length)return null;const v=a?new fa:new ua;return v.build(d,n,i,1,s,a?0:u,r),{outline:v,newCurves:m,areContours:a,thickness:u,width:c,height:h}}static async compressSignature(t){let e,{outlines:n,areContours:i,thickness:s,width:r,height:o}=t,a=1/0,l=-1/0,c=0;for(const y of n){c+=y.length;for(let t=2,e=y.length;t<e;t++){const e=y[t]-y[t-2];a=Math.min(a,e),l=Math.max(l,e)}}e=a>=-128&&l<=127?Int8Array:a>=-32768&&l<=32767?Int16Array:Int32Array;const h=n.length,u=8+3*h,d=new Uint32Array(u);let p=0;d[p++]=u*Uint32Array.BYTES_PER_ELEMENT+(c-2*h)*e.BYTES_PER_ELEMENT,d[p++]=0,d[p++]=r,d[p++]=o,d[p++]=i?0:1,d[p++]=Math.max(0,Math.floor(s??0)),d[p++]=h,d[p++]=e.BYTES_PER_ELEMENT;for(const y of n)d[p++]=y.length-2,d[p++]=y[0],d[p++]=y[1];const f=new CompressionStream("deflate-raw"),g=f.writable.getWriter();await g.ready,g.write(d);const m=e.prototype.constructor;for(const y of n){const t=new m(y.length-2);for(let e=2,n=y.length;e<n;e++)t[e-2]=y[e]-y[e-2];g.write(t)}g.close();const v=await new Response(f.readable).arrayBuffer();return Pi(new Uint8Array(v))}static async decompressSignature(t){try{const n=(e=t,Uint8Array.fromBase64?Uint8Array.fromBase64(e):_i(atob(e))),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),r=s.getWriter();await r.ready,r.write(n).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,a=0;for await(const t of i)o||=new Uint8Array(new Uint32Array(t.buffer,0,4)[0]),o.set(t,a),a+=t.length;const l=new Uint32Array(o.buffer,0,o.length>>2),c=l[1];if(0!==c)throw new Error(`Invalid version: ${c}`);const h=l[2],u=l[3],d=0===l[4],p=l[5],f=l[6],g=l[7],m=[],v=(8+3*f)*Uint32Array.BYTES_PER_ELEMENT;let y;switch(g){case Int8Array.BYTES_PER_ELEMENT:y=new Int8Array(o.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:y=new Int16Array(o.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:y=new Int32Array(o.buffer,v)}a=0;for(let t=0;t<f;t++){const e=l[3*t+8],n=new Float32Array(e+2);m.push(n);for(let i=0;i<2;i++)n[i]=l[3*t+8+i+1];for(let t=0;t<e;t++)n[t+2]=n[t]+y[a++]}return{areContours:d,thickness:p,outlines:m,width:h,height:u}}catch(n){return oi(`decompressSignature: ${n}`),null}var e}}class ma extends la{constructor(){super(),super.updateProperties({fill:os._defaultLineColor,"stroke-width":0})}clone(){const t=new ma;return t.updateAll(this),t}}class va extends da{constructor(t){super(t),super.updateProperties({stroke:os._defaultLineColor,"stroke-width":1})}clone(){const t=new va(this._viewParameters);return t.updateAll(this),t}}class ya extends ca{#_a=!1;#wa=null;#xa=null;#Sa=null;static _type="signature";static _editorType=(()=>On.SIGNATURE)();static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#xa=t.signatureData||null,this.#wa=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){os.initialize(t,e),this._defaultDrawingOptions=new ma,this._defaultDrawnSignatureOptions=new va(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return ui(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#wa}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){null!==this._drawId&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),null===this._drawId)if(this.#xa){const{lines:t,mustSmooth:e,areContours:n,description:i,uuid:s,heightInPage:r}=this.#xa,{rawDims:{pageWidth:o,pageHeight:a},rotation:l}=this.parent.viewport,c=ga.processDrawnLines({lines:t,pageWidth:o,pageHeight:a,rotation:l,innerMargin:ya._INNER_MARGIN,mustSmooth:e,areContours:n});this.addSignature(c,r,i,s)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#wa||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#Sa=t,this.addEditToolbar()}getUuid(){return this.#Sa}get description(){return this.#wa}set description(t){this.#wa=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:i,height:s}=this.#xa,r=Math.max(i,s);return{areContours:e,outline:ga.processDrawnLines({lines:{curves:t.map(t=>({points:t})),thickness:n,width:i,height:s},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e}).outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,i){const{x:s,y:r}=this,{outline:o}=this.#xa=t;let a;this.#_a=o instanceof fa,this.description=n,this.#_a?a=ya.getDefaultDrawingOptions():(a=ya._defaultDrawnSignatureOptions.clone(),a.updateProperties({"stroke-width":o.thickness})),this._addOutlines({drawOutlines:o,drawingOptions:a});const[l,c]=this.parentDimensions,[,h]=this.pageDimensions;let u=e/h;u=u>=1?.5:u,this.width*=u/this.height,this.width>=1&&(u*=.9/this.width,this.width=.9),this.height=u,this.setDims(l*this.width,c*this.height),this.x=s,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:i}=this.parent.viewport;return ga.process(t,e,n,i,ya._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:i},rotation:s}=this.parent.viewport;return ga.extractContoursFromText(t,e,n,i,s,ya._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:i}=this.parent.viewport;return ga.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:i,innerMargin:ya._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions(t){let{areContours:e,thickness:n}=t;e?this._drawingOptions=ya.getDefaultDrawingOptions():(this._drawingOptions=ya._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;const{lines:e,points:n,rect:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":s}}=this,r={annotationType:On.SIGNATURE,isSignature:!0,areContours:this.#_a,color:[0,0,0],thickness:this.#_a?0:s,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(r),t?(r.paths={lines:e,points:n},r.uuid=this.#Sa,r.isCopy=!0):r.lines=e,this.#wa&&(r.accessibilityData={type:"Figure",alt:this.#wa}),r}static deserializeDraw(t,e,n,i,s,r){return r.areContours?fa.deserialize(t,e,n,i,s,r):ua.deserialize(t,e,n,i,s,r)}static async deserialize(t,e,n){const i=await super.deserialize(t,e,n);return i.#_a=t.areContours,i.description=t.accessibilityData?.alt||"",i.#Sa=t.uuid,i}}class ba extends os{#Aa=null;#ka=null;#Ea=null;#Ca=null;#Ta=null;#Pa="";#La=null;#Ma=!1;#Ia=null;#Ra=!1;#Da=!1;static _type="stamp";static _editorType=(()=>On.STAMP)();constructor(t){super({...t,name:"stampEditor"}),this.#Ca=t.bitmapUrl,this.#Ta=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){os.initialize(t,e)}static isHandlingMimeForPasting(t){return qi.includes(t)}static paste(t,e){e.pasteEditor({mode:On.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#Oa(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(this.#Aa=t.bitmap,e||(this.#ka=t.id,this.#Ra=t.isSvg),t.file&&(this.#Pa=t.file.name),this.#Na()):this.remove()}#za(){if(this.#Ea=null,this._uiManager.enableWaiting(!1),this.#La)if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#Aa)this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});else{if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#Aa){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:s,height:r}=t||this.copyCanvas(null,null,!0).imageData,o=await n.guess({name:"altText",request:{data:i,width:s,height:r,channels:i.length/(s*r)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");const a=o.output;return await this.setGuessedAltText(a),e&&!this.hasAltTextData()&&(this.altTextData={alt:a,decorative:!1}),a}#Fa(){if(this.#ka)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#ka).then(t=>this.#Oa(t,!0)).finally(()=>this.#za());if(this.#Ca){const t=this.#Ca;return this.#Ca=null,this._uiManager.enableWaiting(!0),void(this.#Ea=this._uiManager.imageManager.getFromUrl(t).then(t=>this.#Oa(t)).finally(()=>this.#za()))}if(this.#Ta){const t=this.#Ta;return this.#Ta=null,this._uiManager.enableWaiting(!0),void(this.#Ea=this._uiManager.imageManager.getFromFile(t).then(t=>this.#Oa(t)).finally(()=>this.#za()))}const t=document.createElement("input");t.type="file",t.accept=qi.join(",");const e=this._uiManager._signal;this.#Ea=new Promise(n=>{t.addEventListener("change",async()=>{if(t.files&&0!==t.files.length){this._uiManager.enableWaiting(!0);const e=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#Oa(e)}else this.remove();n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#za()),t.click()}remove(){this.#ka&&(this.#Aa=null,this._uiManager.imageManager.deleteId(this.#ka),this.#La?.remove(),this.#La=null,this.#Ia&&(clearTimeout(this.#Ia),this.#Ia=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#ka&&null===this.#La&&this.#Fa(),this.isAttachedToDOM||this.parent.add(this))):this.#ka&&this.#Fa()}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#Ea||this.#Aa||this.#Ca||this.#Ta||this.#ka||this.#Ma)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#Ma||(this.#Aa?this.#Na():this.#Fa()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#ka=n,i&&(this.#Aa=i),this.#Ma=!1,this.#Na())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;null!==this.#Ia&&clearTimeout(this.#Ia);this.#Ia=setTimeout(()=>{this.#Ia=null,this.#ja()},200)}#Na(){const{div:t}=this;let{width:e,height:n}=this.#Aa;const[i,s]=this.pageDimensions,r=.75;if(this.width)e=this.width*i,n=this.height*s;else if(e>r*i||n>r*s){const t=Math.min(r*i/e,r*s/n);e*=t,n*=t}const[o,a]=this.parentDimensions;this.setDims(e*o/i,n*a/s),this._uiManager.enableWaiting(!1);const l=this.#La=document.createElement("canvas");l.setAttribute("role","img"),this.addContainer(l),this.width=e/i,this.height=n/s,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(t.hidden=!1),this.#ja(),this.#Da||(this.parent.addUndoableEditor(this),this.#Da=!0),this._reportTelemetry({action:"inserted_image"}),this.#Pa&&this.div.setAttribute("aria-description",this.#Pa),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t||(t=224);const{width:i,height:s}=this.#Aa,r=new Gi;let o=this.#Aa,a=i,l=s,c=null;if(e){if(i>e||s>e){const t=Math.min(e/i,e/s);a=Math.floor(i*t),l=Math.floor(s*t)}c=document.createElement("canvas");const t=c.width=Math.ceil(a*r.sx),n=c.height=Math.ceil(l*r.sy);this.#Ra||(o=this.#Ba(t,n));const h=c.getContext("2d");h.filter=this._uiManager.hcmFilter;let u="white",d="#cfcfd8";"none"!==this._uiManager.hcmFilter?d="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(u="#8f8f9d",d="#42414d");const p=15,f=p*r.sx,g=p*r.sy,m=new OffscreenCanvas(2*f,2*g),v=m.getContext("2d");v.fillStyle=u,v.fillRect(0,0,2*f,2*g),v.fillStyle=d,v.fillRect(0,0,f,g),v.fillRect(f,g,f,g),h.fillStyle=h.createPattern(m,"repeat"),h.fillRect(0,0,t,n),h.drawImage(o,0,0,o.width,o.height,0,0,t,n)}let h=null;if(n){let e,n;if(r.symmetric&&o.width<t&&o.height<t)e=o.width,n=o.height;else if(o=this.#Aa,i>t||s>t){const r=Math.min(t/i,t/s);e=Math.floor(i*r),n=Math.floor(s*r),this.#Ra||(o=this.#Ba(e,n))}const a=new OffscreenCanvas(e,n).getContext("2d",{willReadFrequently:!0});a.drawImage(o,0,0,o.width,o.height,0,0,e,n),h={width:e,height:n,data:a.getImageData(0,0,e,n).data}}return{canvas:c,width:a,height:l,imageData:h}}#Ba(t,e){const{width:n,height:i}=this.#Aa;let s=n,r=i,o=this.#Aa;for(;s>2*t||r>2*e;){const n=s,i=r;s>2*t&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const a=new OffscreenCanvas(s,r);a.getContext("2d").drawImage(o,0,0,n,i,0,0,s,r),o=a.transferToImageBitmap()}return o}#ja(){const[t,e]=this.parentDimensions,{width:n,height:i}=this,s=new Gi,r=Math.ceil(n*t*s.sx),o=Math.ceil(i*e*s.sy),a=this.#La;if(!a||a.width===r&&a.height===o)return;a.width=r,a.height=o;const l=this.#Ra?this.#Aa:this.#Ba(r,o),c=a.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(l,0,0,l.width,l.height,0,0,r,o)}#Ua(t){if(t){if(this.#Ra){const t=this._uiManager.imageManager.getSvgUrl(this.#ka);if(t)return t}const t=document.createElement("canvas");({width:t.width,height:t.height}=this.#Aa);return t.getContext("2d").drawImage(this.#Aa,0,0),t.toDataURL()}if(this.#Ra){const[t,e]=this.pageDimensions,n=Math.round(this.width*t*Mi.PDF_TO_CSS_UNITS),i=Math.round(this.height*e*Mi.PDF_TO_CSS_UNITS),s=new OffscreenCanvas(n,i);return s.getContext("2d").drawImage(this.#Aa,0,0,this.#Aa.width,this.#Aa.height,0,0,n,i),s.transferToImageBitmap()}return structuredClone(this.#Aa)}static async deserialize(t,e,n){let i=null,s=!1;if(t instanceof Ko){const{data:{rect:r,rotation:o,id:a,structParent:l,popupRef:c,contentsObj:h},container:u,parent:{page:{pageNumber:d}},canvas:p}=t;let f,g;p?(delete t.canvas,({id:f,bitmap:g}=n.imageManager.getFromCanvas(u.id,p)),p.remove()):(s=!0,t._hasNoCanvas=!0);const m=(await e._structTree.getAriaAttributes(`${Ci}${a}`))?.get("aria-label")||"";i=t={annotationType:On.STAMP,bitmapId:f,bitmap:g,pageIndex:d-1,rect:r.slice(0),rotation:o,annotationElementId:a,id:a,deleted:!1,accessibilityData:{decorative:!1,altText:m},isSvg:!1,structParent:l,popupRef:c,comment:h?.str||null}}const r=await super.deserialize(t,e,n),{rect:o,bitmap:a,bitmapUrl:l,bitmapId:c,isSvg:h,accessibilityData:u}=t;s?(n.addMissingCanvas(t.id,r),r.#Ma=!0):c&&n.imageManager.isValidId(c)?(r.#ka=c,a&&(r.#Aa=a)):r.#Ca=l,r.#Ra=h;const[d,p]=r.pageDimensions;return r.width=(o[2]-o[0])/d,r.height=(o[3]-o[1])/p,u&&(r.altTextData=u),r._initialData=i,t.comment&&r.setCommentData(t.comment),r.#Da=!!i,r}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:On.STAMP,bitmapId:this.#ka,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#Ra,structTreeParentId:this._structTreeParentId};if(this.addComment(n),t)return n.bitmapUrl=this.#Ua(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:i,altText:s}=this.serializeAltText(!1);if(!i&&s&&(n.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const t=this.#kr(n);if(t.isSame)return null;t.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,null===e)return n;e.stamps||=new Map;const r=this.#Ra?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(e.stamps.has(this.#ka)){if(this.#Ra){const t=e.stamps.get(this.#ka);r>t.area&&(t.area=r,t.serialized.bitmap.close(),t.serialized.bitmap=this.#Ua(!1))}}else e.stamps.set(this.#ka,{area:r,serialized:n}),n.bitmap=this.#Ua(!1);return n}#kr(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,i=t.pageIndex===e,s=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&s,isSameAltText:s}}renderAnnotationElement(t){const e={rect:this.getRect(0,0)};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}}class _a{#lr;#Ha=!1;#$a=null;#Wa=null;#Va=null;#Ga=(()=>new Map)();#qa=!1;#Za=!1;#Ka=!1;#Xa=null;#Ya=null;#Ja=null;#Qa=null;#tl=null;#el=-1;#m;static _initialized=!1;static#$=(()=>new Map([Qo,pa,ba,aa,ya].map(t=>[t._editorType,t])))();constructor(t){let{uiManager:e,pageIndex:n,div:i,structTreeLayer:s,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:h}=t;const u=[..._a.#$.values()];if(!_a._initialized){_a._initialized=!0;for(const t of u)t.initialize(h,e)}e.registerEditorTypes(u),this.#m=e,this.pageIndex=n,this.div=i,this.#lr=r,this.#$a=o,this.viewport=c,this.#Ja=l,this.drawLayer=a,this._structTree=s,this.#m.addLayer(this)}get isEmpty(){return 0===this.#Ga.size}get isInvisible(){return this.isEmpty&&this.#m.getMode()===On.NONE}updateToolbar(t){this.#m.updateToolbar(t)}updateMode(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.#m.getMode();switch(this.#nl(),t){case On.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case On.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case On.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const n of _a.#$.values())e.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#Ja?.div}setEditingState(t){this.#m.setEditingState(t)}addCommands(t){this.#m.addCommands(t)}cleanUndoStack(t){this.#m.cleanUndoStack(t)}toggleDrawing(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("drawing",!t)}togglePointerEvents(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#$a?.div.classList.toggle("disabled",!t)}async enable(){this.#Ka=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#tl?.abort(),this.#tl=null;const t=new Set;for(const n of this.#Ga.values())n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#m.removeChangedExistingAnnotation(n),t.add(n.annotationElementId));if(!this.#$a)return void(this.#Ka=!1);const e=this.#$a.getEditableAnnotations();for(const n of e){if(n.hide(),this.#m.isDeletedAnnotationElement(n.data.id))continue;if(t.has(n.data.id))continue;const e=await this.deserialize(n);e&&(this.addOrRebuild(e),e.enableEditing())}this.#Ka=!1}disable(){if(this.#Za=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#Ja&&!this.#tl){this.#tl=new AbortController;const t=this.#m.combinedSignal(this.#tl);this.#Ja.div.addEventListener("pointerdown",t=>{const{clientX:e,clientY:n,timeStamp:i}=t;if(i-this.#el>500)return void(this.#el=i);this.#el=-1;const{classList:s}=this.div;s.toggle("getElements",!0);const r=document.elementsFromPoint(e,n);if(s.toggle("getElements",!1),!this.div.contains(r[0]))return;let o;const a=new RegExp(`^${Dn}[0-9]+$`);for(const c of r)if(a.test(c.id)){o=c.id;break}if(!o)return;const l=this.#Ga.get(o);null===l?.annotationElementId&&(t.stopPropagation(),t.preventDefault(),l.dblclick())},{signal:t,capture:!0})}const t=new Map,e=new Map;for(const i of this.#Ga.values())i.disableEditing(),i.annotationElementId&&(null===i.serialize()?(e.set(i.annotationElementId,i),this.getEditableAnnotation(i.annotationElementId)?.show(),i.remove()):t.set(i.annotationElementId,i));if(this.#$a){const n=this.#$a.getEditableAnnotations();for(const i of n){const{id:n}=i.data;if(this.#m.isDeletedAnnotationElement(n)){i.updateEdited({deleted:!0});continue}let s=e.get(n);s?(s.resetAnnotationElement(i),s.show(!1),i.show()):(s=t.get(n),s&&(this.#m.addChangedExistingAnnotation(s),s.renderAnnotationElement(i)&&s.show(!1)),i.show())}}this.#nl(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const i of _a.#$.values())n.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#Za=!1}getEditableAnnotation(t){return this.#$a?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#m.getActive()!==t&&this.#m.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#Ja?.div&&!this.#Qa){this.#Qa=new AbortController;const t=this.#m.combinedSignal(this.#Qa);this.#Ja.div.addEventListener("pointerdown",this.#il.bind(this),{signal:t}),this.#Ja.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#Ja?.div&&this.#Qa&&(this.#Qa.abort(),this.#Qa=null,this.#Ja.div.classList.remove("highlighting"))}#il(t){this.#m.unselectAll();const{target:e}=t;if(e===this.#Ja.div||("img"===e.getAttribute("role")||e.classList.contains("endOfContent"))&&this.#Ja.div.contains(e)){const{isMac:e}=wi.platform;if(0!==t.button||t.ctrlKey&&e)return;this.#m.showAllEditors("highlight",!0,!0),this.#Ja.div.classList.add("free"),this.toggleDrawing(),aa.startHighlighting(this,"ltr"===this.#m.direction,{target:this.#Ja.div,x:t.x,y:t.y}),this.#Ja.div.addEventListener("pointerup",()=>{this.#Ja.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#m._signal}),t.preventDefault()}}enableClick(){if(this.#Wa)return;this.#Wa=new AbortController;const t=this.#m.combinedSignal(this.#Wa);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#Wa?.abort(),this.#Wa=null}attach(t){this.#Ga.set(t.id,t);const{annotationElementId:e}=t;e&&this.#m.isDeletedAnnotationElement(e)&&this.#m.removeDeletedAnnotationElement(t)}detach(t){this.#Ga.delete(t.id),this.#lr?.removePointerInTextLayer(t.contentDiv),!this.#Za&&t.annotationElementId&&this.#m.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#m.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#m.addDeletedAnnotationElement(t.annotationElementId),os.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(t.parent!==this||!t.isAttachedToDOM){if(this.changeParent(t),this.#m.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#Ka),this.#m.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#Va&&(t._focusEventsAllowed=!1,this.#Va=setTimeout(()=>{this.#Va=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#m._signal}),e.focus())},0)),t._structTreeParentId=this.#lr?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){this.addCommands({cmd:()=>t._uiManager.rebuild(t),undo:()=>{t.remove()},mustExec:!1})}getNextId(){return this.#m.getId()}get#sl(){return _a.#$.get(this.#m.getMode())}combinedSignal(t){return this.#m.combinedSignal(t)}#rl(t){const e=this.#sl;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#sl?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#m.updateMode(t.mode);const{offsetX:n,offsetY:i}=this.#ol(),s=this.getNextId(),r=this.#rl({parent:this,id:s,x:n,y:i,uiManager:this.#m,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await(_a.#$.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#m))||null}createAndAddNewEditor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this.getNextId(),s=this.#rl({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#m,isCentered:e,...n});return s&&this.add(s),s}#ol(){const{x:t,y:e,width:n,height:i}=this.div.getBoundingClientRect(),s=Math.max(0,t),r=Math.max(0,e),o=(s+Math.min(window.innerWidth,t+n))/2-t,a=(r+Math.min(window.innerHeight,e+i))/2-e,[l,c]=this.viewport.rotation%180===0?[o,a]:[a,o];return{offsetX:l,offsetY:c}}addNewEditor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.createAndAddNewEditor(this.#ol(),!0,t)}setSelected(t){this.#m.setSelected(t)}toggleSelected(t){this.#m.toggleSelected(t)}unselect(t){this.#m.unselect(t)}pointerup(t){const{isMac:e}=wi.platform;if(0!==t.button||t.ctrlKey&&e)return;if(t.target!==this.div)return;if(!this.#qa)return;if(this.#qa=!1,this.#sl?.isDrawer&&this.#sl.supportMultipleDrawings)return;if(!this.#Ha)return void(this.#Ha=!0);const n=this.#m.getMode();n!==On.STAMP&&n!==On.SIGNATURE?this.createAndAddNewEditor(t,!1):this.#m.unselectAll()}pointerdown(t){if(this.#m.getMode()===On.HIGHLIGHT&&this.enableTextSelection(),this.#qa)return void(this.#qa=!1);const{isMac:e}=wi.platform;if(0!==t.button||t.ctrlKey&&e)return;if(t.target!==this.div)return;if(this.#qa=!0,this.#sl?.isDrawer)return void this.startDrawingSession(t);const n=this.#m.getActive();this.#Ha=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#Xa)return void this.#sl.startDrawing(this,this.#m,!1,t);this.#m.setCurrentDrawingSession(this),this.#Xa=new AbortController;const e=this.#m.combinedSignal(this.#Xa);this.div.addEventListener("blur",t=>{let{relatedTarget:e}=t;e&&!this.div.contains(e)&&(this.#Ya=null,this.commitOrRemove())},{signal:e}),this.#sl.startDrawing(this,this.#m,!1,t)}pause(t){if(t){const{activeElement:t}=document;return void(this.div.contains(t)&&(this.#Ya=t))}this.#Ya&&setTimeout(()=>{this.#Ya?.focus(),this.#Ya=null},0)}endDrawingSession(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.#Xa?(this.#m.setCurrentDrawingSession(null),this.#Xa.abort(),this.#Xa=null,this.#Ya=null,this.#sl.endDrawing(t)):null}findNewParent(t,e,n){const i=this.#m.findParent(e,n);return null!==i&&i!==this&&(i.changeParent(t),!0)}commitOrRemove(){return!!this.#Xa&&(this.endDrawingSession(),!0)}onScaleChanging(){this.#Xa&&this.#sl.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#m.getActive()?.parent===this&&(this.#m.commitOrRemove(),this.#m.setActiveEditor(null)),this.#Va&&(clearTimeout(this.#Va),this.#Va=null);for(const t of this.#Ga.values())this.#lr?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#Ga.clear(),this.#m.removeLayer(this)}#nl(){for(const t of this.#Ga.values())t.isEmpty()&&t.remove()}render(t){let{viewport:e}=t;this.viewport=e,Vi(this.div,e);for(const n of this.#m.getEditors(this.pageIndex))this.add(n),n.rebuild();this.updateMode()}update(t){let{viewport:e}=t;this.#m.commitOrRemove(),this.#nl();const n=this.viewport.rotation,i=e.rotation;if(this.viewport=e,Vi(this.div,{rotation:i}),n!==i)for(const s of this.#Ga.values())s.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#m.viewParameters.realScale}}class wa{#Fs=null;#al=(()=>new Map)();#ll=(()=>new Map)();static#_=0;constructor(t){let{pageIndex:e}=t;this.pageIndex=e}setParent(t){if(this.#Fs){if(this.#Fs!==t){if(this.#al.size>0)for(const e of this.#al.values())e.remove(),t.append(e);this.#Fs=t}}else this.#Fs=t}static get _svgFactory(){return ui(this,"_svgFactory",new _o)}static#cl(t,e){let[n,i,s,r]=e;const{style:o}=t;o.top=100*i+"%",o.left=100*n+"%",o.width=100*s+"%",o.height=100*r+"%"}#hl(){const t=wa._svgFactory.create(1,1,!0);return this.#Fs.append(t),t.setAttribute("aria-hidden",!0),t}#ul(t,e){const n=wa._svgFactory.createElement("clipPath");t.append(n);const i=`clip_${e}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");const s=wa._svgFactory.createElement("use");return n.append(s),s.setAttribute("href",`#${e}`),s.classList.add("clip"),i}#dl(t,e){for(const[n,i]of Object.entries(e))null===i?t.removeAttribute(n):t.setAttribute(n,i)}draw(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=wa.#_++,s=this.#hl(),r=wa._svgFactory.createElement("defs");s.append(r);const o=wa._svgFactory.createElement("path");r.append(o);const a=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#ll.set(i,o);const l=n?this.#ul(r,a):null,c=wa._svgFactory.createElement("use");return s.append(c),c.setAttribute("href",`#${a}`),this.updateProperties(s,t),this.#al.set(i,s),{id:i,clipPathId:`url(#${l})`}}drawOutline(t,e){const n=wa.#_++,i=this.#hl(),s=wa._svgFactory.createElement("defs");i.append(s);const r=wa._svgFactory.createElement("path");s.append(r);const o=`path_p${this.pageIndex}_${n}`;let a;if(r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke"),e){const t=wa._svgFactory.createElement("mask");s.append(t),a=`mask_p${this.pageIndex}_${n}`,t.setAttribute("id",a),t.setAttribute("maskUnits","objectBoundingBox");const e=wa._svgFactory.createElement("rect");t.append(e),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("fill","white");const i=wa._svgFactory.createElement("use");t.append(i),i.setAttribute("href",`#${o}`),i.setAttribute("stroke","none"),i.setAttribute("fill","black"),i.setAttribute("fill-rule","nonzero"),i.classList.add("mask")}const l=wa._svgFactory.createElement("use");i.append(l),l.setAttribute("href",`#${o}`),a&&l.setAttribute("mask",`url(#${a})`);const c=l.cloneNode();return i.append(c),l.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#al.set(n,i),n}finalizeDraw(t,e){this.#ll.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:i,rootClass:s,path:r}=e,o="number"===typeof t?this.#al.get(t):t;if(o){if(n&&this.#dl(o,n),i&&wa.#cl(o,i),s){const{classList:t}=o;for(const[e,n]of Object.entries(s))t.toggle(e,n)}if(r){const t=o.firstChild.firstChild;this.#dl(t,r)}}}updateParent(t,e){if(e===this)return;const n=this.#al.get(t);n&&(e.#Fs.append(n),this.#al.delete(t),e.#al.set(t,n))}remove(t){this.#ll.delete(t),null!==this.#Fs&&(this.#al.get(t).remove(),this.#al.delete(t))}destroy(){this.#Fs=null;for(const t of this.#al.values())t.remove();this.#al.clear(),this.#ll.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:ia},globalThis.pdfjsLib={AbortException:yi,AnnotationEditorLayer:_a,AnnotationEditorParamsType:Nn,AnnotationEditorType:On,AnnotationEditorUIManager:ns,AnnotationLayer:Yo,AnnotationMode:Rn,AnnotationType:Wn,build:"295fb3ec4",ColorPicker:fo,createValidAbsoluteUrl:ci,DOMSVGFactory:_o,DrawLayer:wa,FeatureTest:wi,fetchData:Ii,getDocument:so,getFilenameFromUrl:function(t){return[t]=t.split(/[#?]/,1),t.substring(t.lastIndexOf("/")+1)},getPdfFilenameFromUrl:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!==typeof t)return e;if(Oi(t))return oi('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(t=>{try{return new URL(t)}catch{try{return new URL(decodeURIComponent(t))}catch{try{return new URL(t,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(t),"https://foo.bar")}catch{return null}}}}})(t);if(!n)return e;const i=t=>{try{let e=decodeURIComponent(t);return e.includes("/")?(e=e.split("/").at(-1),e.test(/^\.pdf$/i)?e:t):e}catch{return t}},s=/\.pdf$/i,r=n.pathname.split("/").at(-1);if(s.test(r))return i(r);if(n.searchParams.size>0){const t=Array.from(n.searchParams.values()).reverse();for(const n of t)if(s.test(n))return i(n);const e=Array.from(n.searchParams.keys()).reverse();for(const n of e)if(s.test(n))return i(n)}if(n.hash){const t=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(t)return i(t[0])}return e},getRGB:Hi,getUuid:Ei,getXfaPageViewport:function(t,e){let{scale:n=1,rotation:i=0}=e;const{width:s,height:r}=t.attributes.style,o=[0,0,parseInt(s),parseInt(r)];return new Ri({viewBox:o,userUnit:1,scale:n,rotation:i})},GlobalWorkerOptions:Cr,ImageKind:$n,InvalidPDFException:gi,isDataScheme:Oi,isPdfFile:Ni,isValidExplicitDest:bs,MathClamp:Ti,noContextMenu:ji,normalizeUnicode:function(t){return Ai||(Ai=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ki=new Map([["\ufb05","\u017ft"]])),t.replaceAll(Ai,(t,e,n)=>e?e.normalize("NFKC"):ki.get(n))},OPS:Yn,OutputScale:Gi,PasswordResponses:{NEED_PASSWORD:1,INCORRECT_PASSWORD:2},PDFDataRangeTransport:oo,PDFDateString:Ui,PDFWorker:co,PermissionFlag:{PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},PixelsPerInch:Mi,RenderingCancelledException:Di,ResponseException:mi,setLayerDimensions:Vi,shadow:ui,SignatureExtractor:ga,stopEvent:Bi,SupportedImageMimeTypes:qi,TextLayer:no,TouchManager:rs,updateUrlHash:hi,Util:Si,VerbosityLevel:Xn,version:"5.4.54",XfaLayer:wo},Cr.workerSrc="/pdf.worker.min.mjs";class xa{static async convertPDFToImage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{scale:n=1.5,pageNumber:i=1,quality:s=.8}=e;try{const e=await t.arrayBuffer(),r=await so({data:e}).promise;if(i>r.numPages)throw new Error(`La p\xe1gina ${i} no existe. El PDF tiene ${r.numPages} p\xe1ginas.`);const o=await r.getPage(i),a=o.getViewport({scale:n}),l=document.createElement("canvas"),c=l.getContext("2d");if(!c)throw new Error("No se pudo obtener el contexto del canvas");l.width=a.width,l.height=a.height;const h={canvasContext:c,viewport:a};return await o.render(h).promise,new Promise((t,e)=>{l.toBlob(n=>{n?t({blob:n,width:a.width,height:a.height}):e(new Error("No se pudo convertir el canvas a imagen"))},"image/jpeg",s)})}catch(r){throw console.error("Error convirtiendo PDF a imagen:",r),new Error(`Error al convertir PDF: ${r instanceof Error?r.message:"Error desconocido"}`)}}static async convertPDFToImageURL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{blob:n,width:i,height:s}=await this.convertPDFToImage(t,e);return{url:URL.createObjectURL(n),width:i,height:s}}static isPDF(t){return"application/pdf"===t.type||t.name.toLowerCase().endsWith(".pdf")}static async getPDFInfo(t){try{const e=await t.arrayBuffer();return{numPages:(await so({data:e}).promise).numPages,fileName:t.name}}catch(e){throw console.error("Error obteniendo informaci\xf3n del PDF:",e),new Error(`Error al leer PDF: ${e instanceof Error?e.message:"Error desconocido"}`)}}static revokeObjectURL(t){URL.revokeObjectURL(t)}}const Sa=e=>{let{isOpen:n,onClose:i,file:s,onConversionComplete:r}=e;const[o,a]=(0,t.useState)(null),[l,c]=(0,t.useState)(1),[h,u]=(0,t.useState)(1.5),[d,p]=(0,t.useState)(.8),[f,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)(null),[b,_]=(0,t.useState)(0),[w,x]=(0,t.useState)("");(0,t.useEffect)(()=>{n&&s&&S()},[n,s]),(0,t.useEffect)(()=>{o&&l<=o.numPages&&n&&A()},[l,h,d,o,n]);const S=async()=>{try{x("");const t=await xa.getPDFInfo(s);a(t),c(1)}catch(w){x(`Error al cargar informaci\xf3n del PDF: ${w instanceof Error?w.message:"Error desconocido"}`)}},A=async()=>{if(o)try{g(!0),_(0),x("");const t=setInterval(()=>{_(t=>Math.min(t+10,90))},100),e={scale:h,pageNumber:l,quality:d},{url:n,width:i,height:r}=await xa.convertPDFToImageURL(s,e);clearInterval(t),_(100),y(n)}catch(w){x(`Error al generar previsualizaci\xf3n: ${w instanceof Error?w.message:"Error desconocido"}`)}finally{g(!1),_(0)}},k=()=>{f||(v&&(xa.revokeObjectURL(v),y(null)),a(null),c(1),u(1.5),p(.8),g(!1),_(0),x(""),i())};return n?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{onClick:k,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:3e3}}),(0,m.jsxs)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",borderRadius:"12px",padding:"32px",width:"90%",maxWidth:"600px",maxHeight:"90vh",overflowY:"auto",zIndex:3001,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},children:[(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[(0,m.jsx)("h2",{style:{margin:0,fontSize:"24px",fontWeight:"600",color:"#1f2937",fontFamily:"Inter, sans-serif"},children:"Convertir PDF a Imagen"}),(0,m.jsx)("button",{onClick:k,disabled:f,style:{background:"none",border:"none",fontSize:"24px",cursor:f?"not-allowed":"pointer",color:"#6b7280",padding:"4px"},children:"\xd7"})]}),o?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{style:{marginBottom:"20px"},children:(0,m.jsxs)("div",{style:{padding:"12px",backgroundColor:"#f3f4f6",borderRadius:"8px",fontSize:"14px",fontFamily:"Inter, sans-serif"},children:[(0,m.jsx)("strong",{children:"Archivo:"})," ",o.fileName,(0,m.jsx)("br",{}),(0,m.jsx)("strong",{children:"P\xe1ginas:"})," ",o.numPages]})}),(0,m.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"20px"},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:"500"},children:"P\xe1gina:"}),(0,m.jsx)("select",{value:l,onChange:t=>c(Number(t.target.value)),disabled:f,style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"},children:Array.from({length:o.numPages},(t,e)=>e+1).map(t=>(0,m.jsxs)("option",{value:t,children:["P\xe1gina ",t]},t))})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:"500"},children:"Escala:"}),(0,m.jsxs)("select",{value:h,onChange:t=>u(Number(t.target.value)),disabled:f,style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"},children:[(0,m.jsx)("option",{value:1,children:"1.0x (Original)"}),(0,m.jsx)("option",{value:1.5,children:"1.5x (Recomendado)"}),(0,m.jsx)("option",{value:2,children:"2.0x (Alta calidad)"}),(0,m.jsx)("option",{value:2.5,children:"2.5x (Muy alta calidad)"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:"500"},children:"Calidad JPEG:"}),(0,m.jsxs)("select",{value:d,onChange:t=>p(Number(t.target.value)),disabled:f,style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"},children:[(0,m.jsx)("option",{value:.6,children:"0.6 (Comprimido)"}),(0,m.jsx)("option",{value:.8,children:"0.8 (Recomendado)"}),(0,m.jsx)("option",{value:.9,children:"0.9 (Alta calidad)"}),(0,m.jsx)("option",{value:1,children:"1.0 (M\xe1xima calidad)"})]})]}),(0,m.jsx)("div",{style:{display:"flex",alignItems:"end"},children:(0,m.jsx)("button",{onClick:async()=>{if(o)try{g(!0),_(0),x("");const t={scale:h,pageNumber:l,quality:d},{blob:e,width:n,height:i}=await xa.convertPDFToImage(s,t),o=s.name.replace(/\.pdf$/i,".jpg"),a=new File([e],o,{type:"image/jpeg"});r(a,n,i)}catch(w){x(`Error al convertir PDF: ${w instanceof Error?w.message:"Error desconocido"}`)}finally{g(!1),_(0)}},disabled:f,style:{width:"100%",padding:"12px",backgroundColor:f?"#6c757d":"#007bff",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",fontWeight:"500",cursor:f?"not-allowed":"pointer",transition:"background-color 0.2s"},children:f?"Convirtiendo...":"Convertir y Continuar"})})]}),f&&(0,m.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,m.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e9ecef",borderRadius:"4px",overflow:"hidden"},children:(0,m.jsx)("div",{style:{width:`${b}%`,height:"100%",backgroundColor:"#007bff",transition:"width 0.3s ease"}})}),(0,m.jsxs)("div",{style:{fontSize:"12px",color:"#6c757d",marginTop:"4px"},children:["Progreso: ",b,"%"]})]}),w&&(0,m.jsx)("div",{style:{marginBottom:"20px",padding:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px",fontFamily:"Inter, sans-serif"},children:w}),v&&!f&&(0,m.jsxs)("div",{style:{marginTop:"20px"},children:[(0,m.jsxs)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#495057"},children:["Previsualizaci\xf3n (P\xe1gina ",l,"):"]}),(0,m.jsx)("div",{style:{border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden",maxHeight:"300px",overflowY:"auto"},children:(0,m.jsx)("img",{src:v,alt:`Previsualizaci\xf3n p\xe1gina ${l}`,style:{width:"100%",height:"auto",display:"block"}})})]})]}):(0,m.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:(0,m.jsx)("div",{style:{fontSize:"16px",color:"#6b7280"},children:"Cargando informaci\xf3n del PDF..."})})]})]}):null},Aa=e=>{let{isOpen:n,onClose:i,user:s,onMapLoaded:r}=e;const[o,a]=(0,t.useState)(null),[l,c]=(0,t.useState)(""),[h,u]=(0,t.useState)(!1),[d,p]=(0,t.useState)(""),[f,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)(null),[b,_]=(0,t.useState)(!1),w=(0,t.useRef)(null),x=["image/jpeg","image/jpg","image/png","image/tiff","image/tif","application/pdf"],S=()=>{h||(o&&URL.revokeObjectURL(URL.createObjectURL(o)),v&&URL.revokeObjectURL(URL.createObjectURL(v)),a(null),c(""),p(""),y(null),g(!1),_(!1),w.current&&(w.current.value=""),i())};return n?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{onClick:S,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:2e3}}),(0,m.jsxs)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",borderRadius:"12px",padding:"32px",width:"90%",maxWidth:"500px",zIndex:2001,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},children:[(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[(0,m.jsx)("h2",{style:{margin:0,fontSize:"24px",fontWeight:"600",color:"#1f2937",fontFamily:"Inter, sans-serif"},children:"Cargar Mapa"}),(0,m.jsx)("button",{onClick:S,disabled:h,style:{background:"none",border:"none",fontSize:"24px",cursor:h?"not-allowed":"pointer",color:"#6b7280",padding:"4px"},children:"\xd7"})]}),(0,m.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),o)if(l.trim())if(s)if(!f||v){u(!0),p("");try{let t;t=f&&v?v:o;const e=await bn.uploadImage(t,s.id);await yn.createOverlay({name:l.trim(),imageUrl:e,opacity:.7,scale:1,rotation:0,position:{lat:0,lng:0},userId:s.id}),a(null),c(""),y(null),g(!1),_(!1),w.current&&(w.current.value=""),r(),i()}catch(e){console.error("Error loading map:",e),p(`Error al cargar el mapa: ${(null===e||void 0===e?void 0:e.message)||"Error desconocido"}`)}finally{u(!1)}}else p("Por favor, convierte el PDF a imagen antes de continuar.");else p("Debes estar autenticado para cargar mapas.");else p("Por favor, especifica un nombre para el mapa.");else p("Por favor, selecciona un archivo.")},children:[(0,m.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#374151",fontFamily:"Inter, sans-serif"},children:"Nombre del Mapa"}),(0,m.jsx)("input",{type:"text",value:l,onChange:t=>c(t.target.value),placeholder:"Introduce el nombre del mapa",disabled:h,style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",fontFamily:"Inter, sans-serif",boxSizing:"border-box"}})]}),!o&&(0,m.jsxs)("div",{style:{marginBottom:"20px",textAlign:"center"},children:[(0,m.jsx)("button",{type:"button",onClick:()=>{var t;return null===(t=w.current)||void 0===t?void 0:t.click()},style:{padding:"16px 24px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer",fontFamily:"Inter, sans-serif",transition:"background-color 0.2s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#2563eb"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#3b82f6"},children:"\ud83d\udcc1 Seleccionar Archivo"}),(0,m.jsx)("div",{style:{marginTop:"12px",fontSize:"12px",color:"#6b7280",fontFamily:"Inter, sans-serif"},children:"Formatos permitidos: PDF, JPG, PNG, TIFF. M\xe1ximo 10MB."}),(0,m.jsx)("input",{ref:w,type:"file",accept:".pdf,.jpg,.jpeg,.png,.tiff,.tif",onChange:t=>{var e;const n=null===(e=t.target.files)||void 0===e?void 0:e[0];if(!n)return;if(!x.includes(n.type))return void p("Tipo de archivo no v\xe1lido. Solo se permiten PDF, JPG, PNG y TIFF.");if(n.size>10485760)return void p("El archivo es demasiado grande. M\xe1ximo 10MB.");a(n),p(""),y(null);const i=xa.isPDF(n);if(g(i),i&&_(!0),!l){const t=n.name.replace(/\.[^/.]+$/,"");c(t)}},disabled:h,style:{display:"none"}})]}),o&&(0,m.jsxs)("div",{style:{marginBottom:"20px",padding:"12px",backgroundColor:v?"#d1fae5":"#f3f4f6",border:v?"1px solid #a7f3d0":"none",borderRadius:"8px",fontSize:"14px",fontFamily:"Inter, sans-serif",color:v?"#065f46":"#1f2937"},children:[(0,m.jsx)("strong",{children:v?"\u2705 Archivo listo para subir:":f?"\ud83d\udcc4 PDF seleccionado (requiere conversi\xf3n):":"\ud83d\uddbc\ufe0f Imagen seleccionada:"})," ",o.name,"(",(o.size/1024/1024).toFixed(2)," MB)",v&&(0,m.jsx)("div",{style:{fontSize:"12px",marginTop:"4px",opacity:.8},children:"PDF convertido a imagen JPEG"}),!v&&f&&(0,m.jsx)("div",{style:{fontSize:"12px",marginTop:"4px",opacity:.8,color:"#f59e0b"},children:'Haz clic en "Convertir PDF a Imagen" para continuar'})]}),o&&(0,m.jsx)("div",{style:{textAlign:"center",marginTop:"12px",marginBottom:"17px"},children:(0,m.jsx)("button",{type:"button",onClick:()=>{var t;return null===(t=w.current)||void 0===t?void 0:t.click()},style:{padding:"8px 16px",backgroundColor:"#f3f4f6",color:"#1f2937",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",fontFamily:"Inter, sans-serif",transition:"background-color 0.2s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#e5e7eb",t.currentTarget.style.color="#111827"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#f3f4f6",t.currentTarget.style.color="#1f2937"},children:"\ud83d\udd04 Cambiar Archivo"})}),o&&!f&&!v&&(0,m.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,m.jsx)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#495057",fontWeight:"500"},children:"Previsualizaci\xf3n:"}),(0,m.jsx)("div",{style:{border:"1px solid #d1d5db",borderRadius:"8px",overflow:"hidden",maxHeight:"200px",overflowY:"auto",backgroundColor:"#f9fafb"},children:(0,m.jsx)("img",{src:URL.createObjectURL(o),alt:"Previsualizaci\xf3n del mapa",style:{width:"100%",height:"auto",display:"block",maxHeight:"200px",objectFit:"contain"},onError:t=>{t.currentTarget.style.display="none",t.currentTarget.parentElement.innerHTML='<div style="padding: 20px; text-align: center; color: #6b7280;">No se pudo cargar la previsualizaci\xf3n</div>'}})})]}),v&&(0,m.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,m.jsx)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#495057",fontWeight:"500"},children:"Previsualizaci\xf3n:"}),(0,m.jsx)("div",{style:{border:"1px solid #d1d5db",borderRadius:"8px",overflow:"hidden",maxHeight:"200px",overflowY:"auto",backgroundColor:"#f9fafb"},children:(0,m.jsx)("img",{src:URL.createObjectURL(v),alt:"Previsualizaci\xf3n del mapa convertido",style:{width:"100%",height:"auto",display:"block",maxHeight:"200px",objectFit:"contain"},onError:t=>{t.currentTarget.style.display="none",t.currentTarget.parentElement.innerHTML='<div style="padding: 20px; text-align: center; color: #6b7280;">No se pudo cargar la previsualizaci\xf3n</div>'}})})]}),o&&f&&!v&&(0,m.jsxs)("div",{style:{marginBottom:"20px",padding:"16px",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",fontSize:"14px",fontFamily:"Inter, sans-serif",color:"#92400e"},children:[(0,m.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,m.jsx)("strong",{children:"\ud83d\udcc4 Archivo PDF detectado:"})," ",o.name]}),(0,m.jsx)("button",{type:"button",onClick:()=>_(!0),style:{padding:"8px 16px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#d97706"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#f59e0b"},children:"\ud83d\udd04 Convertir PDF a Imagen"})]}),d&&(0,m.jsx)("div",{style:{marginBottom:"20px",padding:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px",fontFamily:"Inter, sans-serif"},children:d}),(0,m.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,m.jsx)("button",{type:"button",onClick:S,disabled:h,style:{padding:"12px 24px",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:h?"not-allowed":"pointer",fontFamily:"Inter, sans-serif"},children:"Cancelar"}),(0,m.jsx)("button",{type:"submit",disabled:h||!o||!l.trim(),style:{padding:"12px 24px",backgroundColor:!h&&o&&l.trim()?"#3b82f6":"#9ca3af",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:!h&&o&&l.trim()?"pointer":"not-allowed",fontFamily:"Inter, sans-serif"},onClick:()=>{console.log("Button clicked - Debug info:"),console.log("isLoading:",h),console.log("selectedFile:",null===o||void 0===o?void 0:o.name,null===o||void 0===o?void 0:o.size),console.log("mapName:",l),console.log("convertedFile:",null===v||void 0===v?void 0:v.name),console.log("isPDF:",f)},children:h?"Cargando...":"Cargar Mapa"})]})]})]}),o&&f&&(0,m.jsx)(Sa,{isOpen:b,onClose:()=>{_(!1),f&&!v&&(a(null),g(!1),w.current&&(w.current.value=""))},file:o,onConversionComplete:(t,e,n)=>{if(console.log("PDF conversion completed:",t.name,t.size),y(t),p(""),_(!1),a(t),g(!1),!l){const e=t.name.replace(/\.[^/.]+$/,"");c(e)}console.log("State updated - selectedFile:",t.name,"isPDF:",!1)}})]}):null},ka=t=>{let{isOpen:e,onClose:n,onConfirm:i,title:s,message:r,confirmText:o="Confirmar",cancelText:a="Cancelar"}=t;if(!e)return null;return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("div",{onClick:n,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,m.jsxs)("div",{onClick:t=>t.stopPropagation(),style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",fontFamily:"Inter, sans-serif"},children:[(0,m.jsxs)("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},children:[(0,m.jsx)("div",{style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"#E74C3C",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"20px"},children:"\u26a0\ufe0f"}),(0,m.jsx)("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#2D3748"},children:s})]}),(0,m.jsx)("p",{style:{margin:"0 0 24px 0",fontSize:"14px",lineHeight:"1.5",color:"#4A5568"},children:r}),(0,m.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,m.jsx)("button",{onClick:n,style:{padding:"10px 20px",border:"1px solid #E2E8F0",borderRadius:"8px",backgroundColor:"white",color:"#4A5568",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Inter, sans-serif"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#F7FAFC",t.currentTarget.style.borderColor="#CBD5E0"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="white",t.currentTarget.style.borderColor="#E2E8F0"},children:a}),(0,m.jsx)("button",{onClick:()=>{i(),n()},style:{padding:"10px 20px",border:"none",borderRadius:"8px",backgroundColor:"#E74C3C",color:"white",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease",fontFamily:"Inter, sans-serif"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#C53030"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#E74C3C"},children:o})]})]})})})},Ea=e=>{let{isOpen:n,onClose:i,user:s,onSignOut:r,onSignIn:o,onMapSelect:a,onMapEdit:l}=e;const[c,h]=(0,t.useState)(!1),[u,d]=(0,t.useState)([]),[p,f]=(0,t.useState)(!1),[g,v]=(0,t.useState)(!1),[y,b]=(0,t.useState)(!1),[_,w]=(0,t.useState)(null),x=(0,t.useCallback)(async()=>{if(s){v(!0);try{const t=await yn.getUserOverlays(s.id);d(t)}catch(t){console.error("Error loading user maps:",t)}finally{v(!1)}}},[s]);(0,t.useEffect)(()=>{n&&s&&x()},[n,s,x]);return(0,m.jsxs)(m.Fragment,{children:[n&&(0,m.jsx)("div",{onClick:i,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3}}),(0,m.jsxs)("div",{style:{position:"fixed",top:0,left:n?0:"-300px",width:"300px",height:"100vh",backgroundColor:"#3A5F76",boxShadow:n?"2px 0 10px rgba(0,0,0,0.3)":"none",transition:"left 0.3s ease",zIndex:1001,display:"flex",flexDirection:"column"},children:[(0,m.jsxs)("div",{style:{padding:"24px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,m.jsx)("img",{src:"/logo.png",alt:"Map Overlay Logo",style:{width:"48px",height:"48px",borderRadius:"8px",objectFit:"cover"}}),(0,m.jsx)("h2",{style:{margin:0,color:"white",fontFamily:"Inter, sans-serif",fontSize:"20px",fontWeight:"600"},children:"Map Overlay"})]}),(0,m.jsx)("button",{onClick:i,style:{background:"none",border:"none",color:"white",fontSize:"24px",cursor:"pointer",padding:"4px"},children:"\xd7"})]}),s&&(0,m.jsx)("div",{style:{padding:"24px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.avatar_url?(0,m.jsx)("img",{src:s.avatar_url,alt:"Profile",style:{width:"48px",height:"48px",borderRadius:"50%",objectFit:"cover"}}):(0,m.jsx)("div",{style:{width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"20px",fontWeight:"600"},children:s.name?s.name.charAt(0).toUpperCase():s.email.charAt(0).toUpperCase()}),(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{style:{color:"white",fontFamily:"Inter, sans-serif",fontSize:"16px",fontWeight:"600",marginBottom:"4px"},children:s.name||"User"}),(0,m.jsx)("div",{style:{color:"rgba(255,255,255,0.8)",fontFamily:"Inter, sans-serif",fontSize:"14px"},children:s.email})]})]})}),(0,m.jsxs)("div",{style:{flex:1,padding:"16px 0"},children:[(0,m.jsx)("div",{style:{padding:"12px 24px",color:"rgba(255,255,255,0.8)",fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"500",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Menu"}),(0,m.jsxs)("div",{style:{padding:"8px 0"},children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("button",{onClick:()=>h(!c),style:{width:"100%",padding:"12px 24px",background:"none",border:"none",color:"rgba(255,255,255,0.9)",textAlign:"left",cursor:"pointer",fontFamily:"Inter, sans-serif",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(255,255,255,0.1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:[(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,m.jsx)("span",{children:"\ud83d\uddfa\ufe0f"}),"My Maps"]}),(0,m.jsx)("span",{style:{transform:c?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease",fontSize:"12px"},children:"\u25bc"})]}),c&&(0,m.jsxs)("div",{style:{backgroundColor:"rgba(0,0,0,0.1)",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[(0,m.jsxs)("button",{onClick:()=>f(!0),style:{width:"100%",padding:"8px 24px 8px 48px",background:"none",border:"none",color:"rgba(255,255,255,0.8)",textAlign:"left",cursor:"pointer",fontFamily:"Inter, sans-serif",fontSize:"13px",display:"flex",alignItems:"center",gap:"8px",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(255,255,255,0.1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:[(0,m.jsx)("span",{children:"\ud83d\udcc1"}),"Load Map"]}),g?(0,m.jsx)("div",{style:{padding:"8px 24px 8px 48px",color:"rgba(255,255,255,0.6)",fontSize:"12px",fontFamily:"Inter, sans-serif"},children:"Cargando mapas..."}):u.length>0?u.map(t=>(0,m.jsxs)("div",{style:{padding:"8px 24px 8px 48px",color:"rgba(255,255,255,0.8)",fontSize:"13px",fontFamily:"Inter, sans-serif",borderBottom:"1px solid rgba(255,255,255,0.05)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",justifyContent:"flex-start"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(255,255,255,0.1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:[(0,m.jsxs)("div",{style:{cursor:"pointer",flex:1,textAlign:"left"},onClick:()=>{a(t),i()},children:["\ud83d\udcc4 ",t.name]}),(0,m.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,m.jsx)("button",{onClick:e=>{e.stopPropagation(),(t=>{l(t)})(t)},style:{background:"rgba(58, 95, 118, 0.8)",border:"none",borderRadius:"4px",padding:"4px 8px",color:"white",fontSize:"11px",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(58, 95, 118, 1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(58, 95, 118, 0.8)"},title:"Editar mapa",children:"\u270f\ufe0f"}),(0,m.jsx)("button",{onClick:e=>{e.stopPropagation(),(t=>{s&&(w(t),b(!0))})(t)},style:{background:"rgba(231, 76, 60, 0.8)",border:"none",borderRadius:"4px",padding:"4px 8px",color:"white",fontSize:"11px",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(231, 76, 60, 1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(231, 76, 60, 0.8)"},title:"Eliminar mapa",children:"\ud83d\uddd1\ufe0f"})]})]},t.id)):(0,m.jsx)("div",{style:{padding:"8px 24px 8px 48px",color:"rgba(255,255,255,0.6)",fontSize:"12px",fontFamily:"Inter, sans-serif"},children:"No hay mapas cargados"})]})]}),(0,m.jsxs)("button",{style:{width:"100%",padding:"12px 24px",background:"none",border:"none",color:"rgba(255,255,255,0.9)",textAlign:"left",cursor:"pointer",fontFamily:"Inter, sans-serif",fontSize:"14px",display:"flex",alignItems:"center",gap:"12px",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(255,255,255,0.1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:[(0,m.jsx)("span",{children:"\u2699\ufe0f"}),"Settings"]}),(0,m.jsxs)("button",{style:{width:"100%",padding:"12px 24px",background:"none",border:"none",color:"rgba(255,255,255,0.9)",textAlign:"left",cursor:"pointer",fontFamily:"Inter, sans-serif",fontSize:"14px",display:"flex",alignItems:"center",gap:"12px",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(255,255,255,0.1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:[(0,m.jsx)("span",{children:"\u2753"}),"Help"]})]})]}),!s&&(0,m.jsx)("div",{style:{padding:"24px",borderTop:"1px solid rgba(255,255,255,0.1)",marginTop:"auto"},children:(0,m.jsxs)("div",{style:{textAlign:"center",marginBottom:"16px"},children:[(0,m.jsx)("div",{style:{color:"rgba(255,255,255,0.8)",fontFamily:"Inter, sans-serif",fontSize:"14px",marginBottom:"16px"},children:"Sign in to save your maps and preferences"}),(0,m.jsx)("button",{onClick:o,style:{width:"100%",padding:"12px",backgroundColor:"#E74C3C",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",fontFamily:"Inter, sans-serif",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#C53030"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#E74C3C"},children:"Sign In"})]})}),s&&(0,m.jsx)("div",{style:{padding:"24px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:(0,m.jsx)("button",{onClick:r,style:{width:"100%",padding:"12px",backgroundColor:"rgba(231, 76, 60, 0.8)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",fontFamily:"Inter, sans-serif",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(231, 76, 60, 1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(231, 76, 60, 0.8)"},children:"Sign Out"})})]}),(0,m.jsx)(Aa,{isOpen:p,onClose:()=>f(!1),user:s,onMapLoaded:()=>{x()}}),(0,m.jsx)(ka,{isOpen:y,onClose:()=>{b(!1),w(null)},onConfirm:async()=>{if(_&&s)try{await yn.deleteOverlay(_.id),x()}catch(t){console.error("Error deleting map:",t),alert("Error al eliminar el mapa. Por favor, int\xe9ntalo de nuevo.")}},title:"Eliminar mapa",message:`\xbfEst\xe1s seguro de que quieres eliminar el mapa "${null===_||void 0===_?void 0:_.name}"? Esta acci\xf3n no se puede deshacer.`,confirmText:"Eliminar",cancelText:"Cancelar"})]})},Ca=e=>{let{isOpen:n,onClose:i,map:s,onMapUpdated:r}=e;const[o,a]=(0,t.useState)({name:"",opacity:.7,scale:1,rotation:0,position:{lat:0,lng:0},anchorPoints:null}),[l,c]=(0,t.useState)(!1),[h,u]=(0,t.useState)("");(0,t.useEffect)(()=>{if(s){const t=window.currentAnchorPoints;a({name:s.name,opacity:s.opacity,scale:s.scale,rotation:s.rotation,position:s.position,anchorPoints:t||s.anchorPoints||null})}},[s]);const d=()=>{l||(u(""),window.currentAnchorPoints=null,window.currentCenterPosition=null,i())};return n&&s?(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("div",{onClick:d,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,m.jsxs)("div",{onClick:t=>t.stopPropagation(),style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",width:"90%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},children:[(0,m.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,m.jsxs)("h2",{style:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1f2937"},children:["Editar Mapa: ",s.name]}),(0,m.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"14px",color:"#6b7280"},children:"Ajusta las propiedades del mapa"})]}),(0,m.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),s){c(!0),u("");try{await yn.updateOverlay(s.id,{name:o.name,opacity:o.opacity,scale:o.scale,rotation:o.rotation,position:o.position,anchorPoints:o.anchorPoints}),window.currentAnchorPoints=null,window.currentCenterPosition=null,r(),i()}catch(e){console.error("Error updating map:",e),u(`Error al actualizar el mapa: ${(null===e||void 0===e?void 0:e.message)||"Error desconocido"}`)}finally{c(!1)}}else u("No hay mapa seleccionado para editar.")},children:[(0,m.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"Nombre del mapa"}),(0,m.jsx)("input",{type:"text",value:o.name,onChange:t=>a({...o,name:t.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"},required:!0})]}),(0,m.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,m.jsxs)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:["Opacidad: ",Math.round(100*o.opacity),"%"]}),(0,m.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:o.opacity,onChange:t=>a({...o,opacity:parseFloat(t.target.value)}),style:{width:"100%"}})]}),(0,m.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,m.jsxs)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:["Escala: ",o.scale.toFixed(2),"x"]}),(0,m.jsx)("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:o.scale,onChange:t=>a({...o,scale:parseFloat(t.target.value)}),style:{width:"100%"}})]}),(0,m.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,m.jsxs)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:["Rotaci\xf3n: ",o.rotation,"\xb0"]}),(0,m.jsx)("input",{type:"range",min:"-180",max:"180",step:"1",value:o.rotation,onChange:t=>a({...o,rotation:parseInt(t.target.value)}),style:{width:"100%"}})]}),(0,m.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"Posici\xf3n Central"}),(0,m.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"12px",color:"#6b7280"},children:"Latitud"}),(0,m.jsx)("input",{type:"number",step:"0.000001",value:o.position.lat,onChange:t=>a({...o,position:{...o.position,lat:parseFloat(t.target.value)}}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"12px",color:"#6b7280"},children:"Longitud"}),(0,m.jsx)("input",{type:"number",step:"0.000001",value:o.position.lng,onChange:t=>a({...o,position:{...o.position,lng:parseFloat(t.target.value)}}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}})]})]})]}),o.anchorPoints&&(0,m.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,m.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"Coordenadas de Esquinas (calculadas autom\xe1ticamente)"}),(0,m.jsxs)("div",{style:{padding:"12px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"12px",color:"#6b7280"},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:"Esquina Superior Izquierda:"})," ",o.anchorPoints.topLeft.lat.toFixed(6),", ",o.anchorPoints.topLeft.lng.toFixed(6)]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:"Esquina Superior Derecha:"})," ",o.anchorPoints.topRight.lat.toFixed(6),", ",o.anchorPoints.topRight.lng.toFixed(6)]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:"Esquina Inferior Izquierda:"})," ",o.anchorPoints.bottomLeft.lat.toFixed(6),", ",o.anchorPoints.bottomLeft.lng.toFixed(6)]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:"Esquina Inferior Derecha:"})," ",o.anchorPoints.bottomRight.lat.toFixed(6),", ",o.anchorPoints.bottomRight.lng.toFixed(6)]})]})]}),h&&(0,m.jsx)("div",{style:{padding:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",color:"#dc2626",fontSize:"14px",marginBottom:"16px"},children:h}),(0,m.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,m.jsx)("button",{type:"button",onClick:d,disabled:l,style:{padding:"10px 16px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"white",color:"#374151",fontSize:"14px",cursor:l?"not-allowed":"pointer",opacity:l?.6:1},children:"Cancelar"}),(0,m.jsx)("button",{type:"submit",disabled:l,style:{padding:"10px 16px",border:"none",borderRadius:"6px",backgroundColor:"#3A5F76",color:"white",fontSize:"14px",cursor:l?"not-allowed":"pointer",opacity:l?.6:1},children:l?"Guardando...":"Guardar Cambios"})]})]})]})})}):null};const Ta=function(){const[e,n]=(0,t.useState)(null),[i,s]=(0,t.useState)(!1),[r,o]=(0,t.useState)(!1),[a,l]=(0,t.useState)(!0),[c,h]=(0,t.useState)(null),[u,d]=(0,t.useState)(!1),[p,f]=(0,t.useState)(null),[g,v]=(0,t.useState)(!1),[y,b]=(0,t.useState)(1),[_,x]=(0,t.useState)(0),{location:k,compass:E,isLoading:C,error:T,getCurrentLocation:P,startWatchingLocation:L,startCompass:M}=(()=>{const[e,n]=(0,t.useState)(null),[i,s]=(0,t.useState)(null),[r,o]=(0,t.useState)(!1),[a,l]=(0,t.useState)(null),[c,h]=(0,t.useState)(!1),[u,d]=(0,t.useState)(!1);(0,t.useEffect)(()=>{p()},[]);const p=async()=>{try{const t="web"===(await A.getInfo()).platform;d(t),h(t||"geolocation"in navigator)}catch(t){console.error("Error checking device support:",t),d(!0),h("geolocation"in navigator)}},f=()=>new Promise((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{if(!n)return void e(new Error("Position is null"));const i={latitude:n.coords.latitude,longitude:n.coords.longitude,accuracy:n.coords.accuracy,heading:n.coords.heading||void 0,speed:n.coords.speed||void 0,timestamp:n.timestamp};t(i)},t=>{switch(console.warn("Geolocation error:",t.code,t.message),t.code){case 1:e(new Error("Location permission denied. Please allow location access."));break;case 2:e(new Error("Location information unavailable. Please check your GPS settings."));break;case 3:e(new Error("Location request timed out. Please try again."));break;default:e(new Error(`Geolocation error: ${t.message}`))}},{enableHighAccuracy:!0,timeout:3e4,maximumAge:3e3}):e(new Error("Geolocation not supported"))}),g=t=>{if(!navigator.geolocation)return null;const e=navigator.geolocation.watchPosition(e=>{if(!e)return void console.error("Position is null");const i={latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,heading:e.coords.heading||void 0,speed:e.coords.speed||void 0,timestamp:e.timestamp};n(i),null!==e.coords.heading&&s({heading:e.coords.heading,accuracy:e.coords.accuracy,timestamp:e.timestamp}),t(i)},t=>{switch(console.warn("Web geolocation error:",t.code,t.message),t.code){case 1:l("Location permission denied. Please allow location access.");break;case 2:l("Location information unavailable. Please check your GPS settings.");break;case 3:l("Location request timed out. Please try again.");break;default:l(`Geolocation error: ${t.message}`)}},{enableHighAccuracy:!0,timeout:3e4,maximumAge:3e3});return e.toString()},m=async()=>{const t=await S.checkPermissions();if("granted"===t.location){const t=await S.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4});return{latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,heading:t.coords.heading||void 0,speed:t.coords.speed||void 0,timestamp:t.timestamp}}if("prompt"===t.location){if("granted"===(await S.requestPermissions()).location)return m();throw new Error("Location permission denied")}throw new Error("Location permission denied")},v=async t=>{const e=await S.checkPermissions();if("granted"!==e.location){if("prompt"!==e.location)return void l("Location permission denied");if("granted"!==(await S.requestPermissions()).location)return void l("Location permission denied")}return await S.watchPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4},e=>{if(!e)return void console.error("Position is null");const i={latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,heading:e.coords.heading||void 0,speed:e.coords.speed||void 0,timestamp:e.timestamp};n(i),null!==e.coords.heading&&s({heading:e.coords.heading,accuracy:e.coords.accuracy,timestamp:e.timestamp}),t&&t(i)})},y=async()=>{if(u)return new Promise(t=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{t(!!e)},e=>{console.warn("Permission check error:",e.code,e.message),e.code,t(!1)},{timeout:15e3,maximumAge:3e3,enableHighAccuracy:!1}):t(!1)});try{const t=await S.checkPermissions();return"granted"===t.location||"prompt"===t.location&&"granted"===(await S.requestPermissions()).location}catch(t){return console.error("Error requesting permissions:",t),!1}},b=(0,t.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;o(!0),l(null);try{if(!await y())return l("Location permission denied"),o(!1),null;const t=u?await f():await m();return n(t),o(!1),t}catch(e){return console.error("Error getting location:",e),e instanceof Error&&e.message.includes("timed out")&&t<2?(o(!1),await new Promise(t=>setTimeout(t,2e3)),b(t+1)):(l("Failed to get location"),o(!1),null)}},[u,y,f,m]),_=(0,t.useCallback)(async t=>{try{return await y()?u?g(t||(()=>{})):await v(t):void l("Location permission denied")}catch(e){console.error("Error watching location:",e),l("Failed to start location tracking")}},[u,y,g,v]),w=(0,t.useCallback)(()=>{if("DeviceOrientationEvent"in window){const t=t=>{null!==t.alpha&&s({heading:t.alpha,accuracy:5,timestamp:Date.now()})};return window.addEventListener("deviceorientation",t),()=>{window.removeEventListener("deviceorientation",t)}}},[]);return{location:e,compass:i,isLoading:r,error:a,isSupported:c,isWeb:u,getCurrentLocation:b,startWatchingLocation:_,stopWatchingLocation:async t=>{try{u?navigator.geolocation.clearWatch(parseInt(t)):await S.clearWatch({id:t})}catch(e){console.error("Error stopping location watch:",e)}},startCompass:w,requestPermissions:y}})();return(0,t.useEffect)(()=>{const t=setTimeout(()=>{l(!1)},1e4);(async()=>{try{const t=await _n.getCurrentUser();n(t)}catch(t){console.error("Error getting current user:",t)}finally{l(!1)}})();const{data:{subscription:e}}=_n.onAuthStateChange(e=>{n(e),clearTimeout(t)});return()=>{clearTimeout(t),e.unsubscribe()}},[]),(0,t.useEffect)(()=>{(async()=>{await P(),await L(),M()})()},[]),(0,t.useEffect)(()=>{const t=()=>{h(null),d(!1),f(null),b(1),x(0)},e=()=>{d(!1),p&&v(!0)},n=()=>{d(!1),f(null),h(null),b(1),x(0)};return window.addEventListener("clearMapSelection",t),window.addEventListener("confirmMapEdit",e),window.addEventListener("cancelMapEdit",n),()=>{window.removeEventListener("clearMapSelection",t),window.removeEventListener("confirmMapEdit",e),window.removeEventListener("cancelMapEdit",n)}},[p]),a?(0,m.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"#3A5F76",color:"white",fontFamily:"Inter, sans-serif"},children:(0,m.jsxs)("div",{style:{textAlign:"center"},children:[(0,m.jsx)("div",{style:{width:"40px",height:"40px",border:"4px solid rgba(255,255,255,0.3)",borderTop:"4px solid white",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),(0,m.jsx)("div",{children:"Loading Map Overlay..."})]})}):(0,m.jsxs)("div",{className:"App",children:[(0,m.jsx)(w,{currentLocation:k,selectedMap:c,isEditMode:u,onEditComplete:t=>{if(p){const e=window.currentAnchorPoints,n=window.currentCenterPosition||t.getCenter(),i={...p,position:{lat:n.lat,lng:n.lng},anchorPoints:e};f(i)}},onOpacityChange:t=>{b(t),c&&h({...c,opacity:t}),p&&f({...p,opacity:t})},onRotationChange:t=>{x(t),c&&h({...c,rotation:t}),p&&f({...p,rotation:t})}}),!u&&(0,m.jsx)("button",{onClick:()=>o(!0),style:{position:"fixed",top:"20px",left:"20px",zIndex:1e3,backgroundColor:"#3A5F76",color:"white",border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",fontSize:"20px"},title:"Menu",children:"\u2630"}),!u&&(0,m.jsxs)("div",{style:{position:"fixed",bottom:"20px",left:"20px",zIndex:1e3,backgroundColor:"rgba(58, 95, 118, 0.9)",color:"white",padding:"12px 16px",borderRadius:"8px",fontFamily:"Inter, sans-serif",fontSize:"14px",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,m.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:k?"#27AE60":T?"#E74C3C":"#95A5A6"}}),(0,m.jsx)("span",{children:C?"Getting location...":T?"GPS Error":k?"GPS Active":"GPS Off"})]}),k&&(0,m.jsxs)("div",{style:{fontSize:"12px",marginTop:"4px"},children:[k.latitude.toFixed(6),", ",k.longitude.toFixed(6)]}),T&&(0,m.jsx)("button",{onClick:()=>{P()},style:{background:"none",border:"1px solid #E74C3C",color:"#E74C3C",borderRadius:"4px",padding:"4px 8px",fontSize:"12px",cursor:"pointer",marginTop:"4px",transition:"all 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.background="#E74C3C",t.currentTarget.style.color="white"},onMouseLeave:t=>{t.currentTarget.style.background="none",t.currentTarget.style.color="#E74C3C"},children:"\ud83d\udd04 Reintentar"})]}),E&&(0,m.jsxs)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,backgroundColor:"#E74C3C",color:"white",borderRadius:"50%",width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Inter, sans-serif",fontWeight:"600",fontSize:"18px",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[Math.round(E.heading),"\xb0"]}),(0,m.jsx)(wn,{isOpen:i,onClose:()=>s(!1),onLoginSuccess:t=>{n(t),s(!1)}}),(0,m.jsx)(Ea,{isOpen:r,onClose:()=>o(!1),user:e,onSignOut:async()=>{try{await _n.signOut(),n(null),o(!1)}catch(t){console.error("Error signing out:",t)}},onSignIn:()=>s(!0),onMapSelect:t=>{h(t),d(!1)},onMapEdit:t=>{h(t),f(t),b(t.opacity||1),x(t.rotation||0),d(!0),o(!1)}}),(0,m.jsx)(Ca,{isOpen:g,onClose:()=>{v(!1),f(null)},map:p,onMapUpdated:()=>{v(!1),f(null),h(null)}})]})},Pa=t=>{t&&t instanceof Function&&n.e(453).then(n.bind(n,453)).then(e=>{let{getCLS:n,getFID:i,getFCP:s,getLCP:r,getTTFB:o}=e;n(t),i(t),s(t),r(t),o(t)})};e.createRoot(document.getElementById("root")).render((0,m.jsx)(t.StrictMode,{children:(0,m.jsx)(Ta,{})})),Pa()})()})();
//# sourceMappingURL=main.7e160c31.js.map